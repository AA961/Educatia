import{m as fe,E as Yt,n as Qe,C as Y,q as sa,s as Ke,u as ra,L as pi,x as w,y as oa,z as _l,A as At,B as yl,D as vc,f as Le,G as Yy,H as IC,I as Ae,J as TC,K as EC,M as bC,N as wl,O as aa,S as gi,P as SC,Q as pe,R as ws,T as Fs,U as Xr,V as xd,W as Ct,X as CC,Y as Ic,Z as Xy,$ as E,a0 as we,a1 as Md,a2 as Xt,a3 as kC,a4 as AC,a5 as zi,a6 as Tc,a7 as Ld,a8 as ca,a9 as Lt,aa as Jy,ab as RC,ac as NC,ad as vl,ae as PC,af as DC,ag as P,ah as be,ai as Dg,aj as OC,ak as xC,al as MC,am as LC,an as FC,ao as Bs}from"./index.94a85a8e.js";const Zy="@firebase/installations",Fd="0.5.12";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ew=1e4,tw=`w:${Fd}`,nw="FIS_v2",UC="https://firebaseinstallations.googleapis.com/v1",VC=60*60*1e3,BC="installations",$C="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qC={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["not-registered"]:"Firebase Installation is not registered.",["installation-not-found"]:"Firebase Installation not found.",["request-failed"]:'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',["app-offline"]:"Could not process request. Application offline.",["delete-pending-registration"]:"Can't delete installation while there is a pending registration request."},Qi=new Yt(BC,$C,qC);function iw(n){return n instanceof Ke&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sw({projectId:n}){return`${UC}/projects/${n}/installations`}function rw(n){return{token:n.token,requestStatus:2,expiresIn:KC(n.expiresIn),creationTime:Date.now()}}async function ow(n,e){const i=(await e.json()).error;return Qi.create("request-failed",{requestName:n,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function aw({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function jC(n,{refreshToken:e}){const t=aw(n);return t.append("Authorization",GC(e)),t}async function cw(n){const e=await n();return e.status>=500&&e.status<600?n():e}function KC(n){return Number(n.replace("s","000"))}function GC(n){return`${nw} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function WC({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const i=sw(n),s=aw(n),r=e.getImmediate({optional:!0});if(r){const l=await r.getHeartbeatsHeader();l&&s.append("x-firebase-client",l)}const o={fid:t,authVersion:nw,appId:n.appId,sdkVersion:tw},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await cw(()=>fetch(i,a));if(c.ok){const l=await c.json();return{fid:l.fid||t,registrationStatus:2,refreshToken:l.refreshToken,authToken:rw(l.authToken)}}else throw await ow("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lw(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HC(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zC=/^[cdef][\w-]{21}$/,kh="";function QC(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=YC(n);return zC.test(t)?t:kh}catch{return kh}}function YC(n){return HC(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Il(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uw=new Map;function hw(n,e){const t=Il(n);dw(t,e),XC(t,e)}function dw(n,e){const t=uw.get(n);if(!!t)for(const i of t)i(e)}function XC(n,e){const t=JC();t&&t.postMessage({key:n,fid:e}),ZC()}let Li=null;function JC(){return!Li&&"BroadcastChannel"in self&&(Li=new BroadcastChannel("[Firebase] FID Change"),Li.onmessage=n=>{dw(n.data.key,n.data.fid)}),Li}function ZC(){uw.size===0&&Li&&(Li.close(),Li=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ek="firebase-installations-database",tk=1,Yi="firebase-installations-store";let Fu=null;function Ud(){return Fu||(Fu=ra(ek,tk,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Yi)}}})),Fu}async function Ec(n,e){const t=Il(n),s=(await Ud()).transaction(Yi,"readwrite"),r=s.objectStore(Yi),o=await r.get(t);return await r.put(e,t),await s.done,(!o||o.fid!==e.fid)&&hw(n,e.fid),e}async function fw(n){const e=Il(n),i=(await Ud()).transaction(Yi,"readwrite");await i.objectStore(Yi).delete(e),await i.done}async function Tl(n,e){const t=Il(n),s=(await Ud()).transaction(Yi,"readwrite"),r=s.objectStore(Yi),o=await r.get(t),a=e(o);return a===void 0?await r.delete(t):await r.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&hw(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vd(n){let e;const t=await Tl(n.appConfig,i=>{const s=nk(i),r=ik(n,s);return e=r.registrationPromise,r.installationEntry});return t.fid===kh?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function nk(n){const e=n||{fid:QC(),registrationStatus:0};return pw(e)}function ik(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Qi.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=sk(n,t);return{installationEntry:t,registrationPromise:i}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:rk(n)}:{installationEntry:e}}async function sk(n,e){try{const t=await WC(n,e);return Ec(n.appConfig,t)}catch(t){throw iw(t)&&t.customData.serverCode===409?await fw(n.appConfig):await Ec(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function rk(n){let e=await Og(n.appConfig);for(;e.registrationStatus===1;)await lw(100),e=await Og(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:i}=await Vd(n);return i||t}return e}function Og(n){return Tl(n,e=>{if(!e)throw Qi.create("installation-not-found");return pw(e)})}function pw(n){return ok(n)?{fid:n.fid,registrationStatus:0}:n}function ok(n){return n.registrationStatus===1&&n.registrationTime+ew<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ak({appConfig:n,heartbeatServiceProvider:e},t){const i=ck(n,t),s=jC(n,t),r=e.getImmediate({optional:!0});if(r){const l=await r.getHeartbeatsHeader();l&&s.append("x-firebase-client",l)}const o={installation:{sdkVersion:tw,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await cw(()=>fetch(i,a));if(c.ok){const l=await c.json();return rw(l)}else throw await ow("Generate Auth Token",c)}function ck(n,{fid:e}){return`${sw(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bd(n,e=!1){let t;const i=await Tl(n.appConfig,r=>{if(!gw(r))throw Qi.create("not-registered");const o=r.authToken;if(!e&&hk(o))return r;if(o.requestStatus===1)return t=lk(n,e),r;{if(!navigator.onLine)throw Qi.create("app-offline");const a=fk(r);return t=uk(n,a),a}});return t?await t:i.authToken}async function lk(n,e){let t=await xg(n.appConfig);for(;t.authToken.requestStatus===1;)await lw(100),t=await xg(n.appConfig);const i=t.authToken;return i.requestStatus===0?Bd(n,e):i}function xg(n){return Tl(n,e=>{if(!gw(e))throw Qi.create("not-registered");const t=e.authToken;return pk(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function uk(n,e){try{const t=await ak(n,e),i=Object.assign(Object.assign({},e),{authToken:t});return await Ec(n.appConfig,i),t}catch(t){if(iw(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await fw(n.appConfig);else{const i=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Ec(n.appConfig,i)}throw t}}function gw(n){return n!==void 0&&n.registrationStatus===2}function hk(n){return n.requestStatus===2&&!dk(n)}function dk(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+VC}function fk(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function pk(n){return n.requestStatus===1&&n.requestTime+ew<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gk(n){const e=n,{installationEntry:t,registrationPromise:i}=await Vd(e);return i?i.catch(console.error):Bd(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mk(n,e=!1){const t=n;return await _k(t),(await Bd(t,e)).token}async function _k(n){const{registrationPromise:e}=await Vd(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yk(n){if(!n||!n.options)throw Uu("App Configuration");if(!n.name)throw Uu("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Uu(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Uu(n){return Qi.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mw="installations",wk="installations-internal",vk=n=>{const e=n.getProvider("app").getImmediate(),t=yk(e),i=sa(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},Ik=n=>{const e=n.getProvider("app").getImmediate(),t=sa(e,mw).getImmediate();return{getId:()=>gk(t),getToken:s=>mk(t,s)}};function Tk(){Qe(new Y(mw,vk,"PUBLIC")),Qe(new Y(wk,Ik,"PRIVATE"))}Tk();fe(Zy,Fd);fe(Zy,Fd,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mg="analytics",Ek="firebase_id",bk="origin",Sk=60*1e3,Ck="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",_w="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ge=new pi("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yw(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function kk(n,e){const t=document.createElement("script");t.src=`${_w}?l=${n}&id=${e}`,t.async=!0,document.head.appendChild(t)}function Ak(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function Rk(n,e,t,i,s,r){const o=i[s];try{if(o)await e[o];else{const c=(await yw(t)).find(l=>l.measurementId===s);c&&await e[c.appId]}}catch(a){Ge.error(a)}n("config",s,r)}async function Nk(n,e,t,i,s){try{let r=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await yw(t);for(const c of o){const l=a.find(h=>h.measurementId===c),u=l&&e[l.appId];if(u)r.push(u);else{r=[];break}}}r.length===0&&(r=Object.values(e)),await Promise.all(r),n("event",i,s||{})}catch(r){Ge.error(r)}}function Pk(n,e,t,i){async function s(r,o,a){try{r==="event"?await Nk(n,e,t,o,a):r==="config"?await Rk(n,e,t,i,o,a):r==="consent"?n("consent","update",a):n("set",o)}catch(c){Ge.error(c)}}return s}function Dk(n,e,t,i,s){let r=function(...o){window[i].push(arguments)};return window[s]&&typeof window[s]=="function"&&(r=window[s]),window[s]=Pk(r,n,e,t),{gtagCore:r,wrappedGtag:window[s]}}function Ok(){const n=window.document.getElementsByTagName("script");for(const e of Object.values(n))if(e.src&&e.src.includes(_w))return e;return null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xk={["already-exists"]:"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",["already-initialized"]:"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.",["already-initialized-settings"]:"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",["interop-component-reg-failed"]:"Firebase Analytics Interop Component failed to instantiate: {$reason}",["invalid-analytics-context"]:"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["indexeddb-unavailable"]:"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["fetch-throttle"]:"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",["config-fetch-failed"]:"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",["no-api-key"]:'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',["no-app-id"]:'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'},Ft=new Yt("analytics","Analytics",xk);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mk=30,Lk=1e3;class Fk{constructor(e={},t=Lk){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const ww=new Fk;function Uk(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function Vk(n){var e;const{appId:t,apiKey:i}=n,s={method:"GET",headers:Uk(i)},r=Ck.replace("{app-id}",t),o=await fetch(r,s);if(o.status!==200&&o.status!==304){let a="";try{const c=await o.json();!((e=c.error)===null||e===void 0)&&e.message&&(a=c.error.message)}catch{}throw Ft.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function Bk(n,e=ww,t){const{appId:i,apiKey:s,measurementId:r}=n.options;if(!i)throw Ft.create("no-app-id");if(!s){if(r)return{measurementId:r,appId:i};throw Ft.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new jk;return setTimeout(async()=>{a.abort()},t!==void 0?t:Sk),vw({appId:i,apiKey:s,measurementId:r},o,a,e)}async function vw(n,{throttleEndTimeMillis:e,backoffCount:t},i,s=ww){var r,o;const{appId:a,measurementId:c}=n;try{await $k(i,e)}catch(l){if(c)return Ge.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${(r=l)===null||r===void 0?void 0:r.message}]`),{appId:a,measurementId:c};throw l}try{const l=await Vk(n);return s.deleteThrottleMetadata(a),l}catch(l){const u=l;if(!qk(u)){if(s.deleteThrottleMetadata(a),c)return Ge.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${u==null?void 0:u.message}]`),{appId:a,measurementId:c};throw l}const h=Number((o=u==null?void 0:u.customData)===null||o===void 0?void 0:o.httpStatus)===503?vc(t,s.intervalMillis,Mk):vc(t,s.intervalMillis),d={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return s.setThrottleMetadata(a,d),Ge.debug(`Calling attemptFetch again in ${h} millis`),vw(n,d,i,s)}}function $k(n,e){return new Promise((t,i)=>{const s=Math.max(e-Date.now(),0),r=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(r),i(Ft.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function qk(n){if(!(n instanceof Ke)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class jk{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function Kk(n,e,t,i,s){if(s&&s.global){n("event",t,i);return}else{const r=await e,o=Object.assign(Object.assign({},i),{send_to:r});n("event",t,o)}}async function Gk(n,e,t,i){if(i&&i.global)return n("set",{screen_name:t}),Promise.resolve();{const s=await e;n("config",s,{update:!0,screen_name:t})}}async function Wk(n,e,t,i){if(i&&i.global)return n("set",{user_id:t}),Promise.resolve();{const s=await e;n("config",s,{update:!0,user_id:t})}}async function Hk(n,e,t,i){if(i&&i.global){const s={};for(const r of Object.keys(t))s[`user_properties.${r}`]=t[r];return n("set",s),Promise.resolve()}else{const s=await e;n("config",s,{update:!0,user_properties:t})}}async function zk(n,e){const t=await n;window[`ga-disable-${t}`]=!e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Qk(){var n;if(At())try{await yl()}catch(e){return Ge.warn(Ft.create("indexeddb-unavailable",{errorInfo:(n=e)===null||n===void 0?void 0:n.toString()}).message),!1}else return Ge.warn(Ft.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function Yk(n,e,t,i,s,r,o){var a;const c=Bk(n);c.then(f=>{t[f.measurementId]=f.appId,n.options.measurementId&&f.measurementId!==n.options.measurementId&&Ge.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${f.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(f=>Ge.error(f)),e.push(c);const l=Qk().then(f=>{if(f)return i.getId()}),[u,h]=await Promise.all([c,l]);Ok()||kk(r,u.measurementId),s("js",new Date);const d=(a=o==null?void 0:o.config)!==null&&a!==void 0?a:{};return d[bk]="firebase",d.update=!0,h!=null&&(d[Ek]=h),s("config",u.measurementId,d),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xk{constructor(e){this.app=e}_delete(){return delete kn[this.app.options.appId],Promise.resolve()}}let kn={},Lg=[];const Fg={};let lc="dataLayer",Iw="gtag",Ug,la,Ah=!1;function Jk(n){if(Ah)throw Ft.create("already-initialized");n.dataLayerName&&(lc=n.dataLayerName),n.gtagName&&(Iw=n.gtagName)}function Zk(){const n=[];if(oa()&&n.push("This is a browser extension environment."),_l()||n.push("Cookies are not available."),n.length>0){const e=n.map((i,s)=>`(${s+1}) ${i}`).join(" "),t=Ft.create("invalid-analytics-context",{errorInfo:e});Ge.warn(t.message)}}function e0(n,e,t){Zk();const i=n.options.appId;if(!i)throw Ft.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Ge.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Ft.create("no-api-key");if(kn[i]!=null)throw Ft.create("already-exists",{id:i});if(!Ah){Ak(lc);const{wrappedGtag:r,gtagCore:o}=Dk(kn,Lg,Fg,lc,Iw);la=r,Ug=o,Ah=!0}return kn[i]=Yk(n,Lg,Fg,e,Ug,lc,t),new Xk(n)}async function t0(){if(oa()||!_l()||!At())return!1;try{return await yl()}catch{return!1}}function n0(n,e,t){n=w(n),Gk(la,kn[n.app.options.appId],e,t).catch(i=>Ge.error(i))}function i0(n,e,t){n=w(n),Wk(la,kn[n.app.options.appId],e,t).catch(i=>Ge.error(i))}function s0(n,e,t){n=w(n),Hk(la,kn[n.app.options.appId],e,t).catch(i=>Ge.error(i))}function r0(n,e){n=w(n),zk(kn[n.app.options.appId],e).catch(t=>Ge.error(t))}function Tw(n,e,t,i){n=w(n),Kk(la,kn[n.app.options.appId],e,t,i).catch(s=>Ge.error(s))}const Vg="@firebase/analytics",Bg="0.8.0";function o0(){Qe(new Y(Mg,(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return e0(i,s,t)},"PUBLIC")),Qe(new Y("analytics-internal",n,"PRIVATE")),fe(Vg,Bg),fe(Vg,Bg,"esm2017");function n(e){try{const t=e.getProvider(Mg).getImmediate();return{logEvent:(i,s,r)=>Tw(t,i,s,r)}}catch(t){throw Ft.create("interop-component-reg-failed",{reason:t})}}}o0();const a0="@firebase/analytics-compat",c0="0.1.13";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ew{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,i){Tw(this._delegate,e,t,i)}setCurrentScreen(e,t){n0(this._delegate,e,t)}setUserId(e,t){i0(this._delegate,e,t)}setUserProperties(e,t){s0(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){r0(this._delegate,e)}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rh;(function(n){n.ADD_SHIPPING_INFO="add_shipping_info",n.ADD_PAYMENT_INFO="add_payment_info",n.ADD_TO_CART="add_to_cart",n.ADD_TO_WISHLIST="add_to_wishlist",n.BEGIN_CHECKOUT="begin_checkout",n.CHECKOUT_PROGRESS="checkout_progress",n.EXCEPTION="exception",n.GENERATE_LEAD="generate_lead",n.LOGIN="login",n.PAGE_VIEW="page_view",n.PURCHASE="purchase",n.REFUND="refund",n.REMOVE_FROM_CART="remove_from_cart",n.SCREEN_VIEW="screen_view",n.SEARCH="search",n.SELECT_CONTENT="select_content",n.SELECT_ITEM="select_item",n.SELECT_PROMOTION="select_promotion",n.SET_CHECKOUT_OPTION="set_checkout_option",n.SHARE="share",n.SIGN_UP="sign_up",n.TIMING_COMPLETE="timing_complete",n.VIEW_CART="view_cart",n.VIEW_ITEM="view_item",n.VIEW_ITEM_LIST="view_item_list",n.VIEW_PROMOTION="view_promotion",n.VIEW_SEARCH_RESULTS="view_search_results"})(Rh||(Rh={}));/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l0=n=>{const e=n.getProvider("app-compat").getImmediate(),t=n.getProvider("analytics").getImmediate();return new Ew(e,t)};function u0(){const n={Analytics:Ew,settings:Jk,isSupported:t0,EventName:Rh};Le.INTERNAL.registerComponent(new Y("analytics-compat",l0,"PUBLIC").setServiceProps(n).setMultipleInstances(!0))}u0();Le.registerVersion(a0,c0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bw=new Map,h0={activated:!1,tokenObservers:[]},d0={initialized:!1,enabled:!1};function De(n){return bw.get(n)||h0}function zt(n,e){bw.set(n,e)}function El(){return d0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $d="https://content-firebaseappcheck.googleapis.com/v1",f0="exchangeRecaptchaV3Token",p0="exchangeRecaptchaEnterpriseToken",g0="exchangeDebugToken",$g={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},m0=24*60*60*1e3;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _0{constructor(e,t,i,s,r){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=s,this.upperBound=r,this.pending=null,this.nextErrorWaitInterval=s,s>r)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new Ae,await y0(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new Ae,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}function y0(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const w0={["already-initialized"]:"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.",["use-before-activation"]:"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.",["fetch-network-error"]:"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",["fetch-parse-error"]:"Fetch client could not parse response. Original error: {$originalErrorMessage}.",["fetch-status-error"]:"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["recaptcha-error"]:"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},lt=new Yt("appCheck","AppCheck",w0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bc(n=!1){var e;return n?(e=self.grecaptcha)===null||e===void 0?void 0:e.enterprise:self.grecaptcha}function Sw(n){if(!De(n).activated)throw lt.create("use-before-activation",{appName:n.name})}function qd(n){const e=Math.round(n/1e3),t=Math.floor(e/(3600*24)),i=Math.floor((e-t*3600*24)/3600),s=Math.floor((e-t*3600*24-i*3600)/60),r=e-t*3600*24-i*3600-s*60;let o="";return t&&(o+=Ga(t)+"d:"),i&&(o+=Ga(i)+"h:"),o+=Ga(s)+"m:"+Ga(r)+"s",o}function Ga(n){return n===0?"00":n>=10?n.toString():"0"+n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jd({url:n,body:e},t){var i,s;const r={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){const f=await o.getHeartbeatsHeader();f&&(r["X-Firebase-Client"]=f)}const a={method:"POST",body:JSON.stringify(e),headers:r};let c;try{c=await fetch(n,a)}catch(f){throw lt.create("fetch-network-error",{originalErrorMessage:(i=f)===null||i===void 0?void 0:i.message})}if(c.status!==200)throw lt.create("fetch-status-error",{httpStatus:c.status});let l;try{l=await c.json()}catch(f){throw lt.create("fetch-parse-error",{originalErrorMessage:(s=f)===null||s===void 0?void 0:s.message})}const u=l.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw lt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${l.ttl}`});const h=Number(u[1])*1e3,d=Date.now();return{token:l.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}}function v0(n,e){const{projectId:t,appId:i,apiKey:s}=n.options;return{url:`${$d}/projects/${t}/apps/${i}:${f0}?key=${s}`,body:{recaptcha_v3_token:e}}}function I0(n,e){const{projectId:t,appId:i,apiKey:s}=n.options;return{url:`${$d}/projects/${t}/apps/${i}:${p0}?key=${s}`,body:{recaptcha_enterprise_token:e}}}function T0(n,e){const{projectId:t,appId:i,apiKey:s}=n.options;return{url:`${$d}/projects/${t}/apps/${i}:${g0}?key=${s}`,body:{debug_token:e}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E0="firebase-app-check-database",b0=1,wo="firebase-app-check-store",Cw="debug-token";let Wa=null;function kw(){return Wa||(Wa=new Promise((n,e)=>{var t;try{const i=indexedDB.open(E0,b0);i.onsuccess=s=>{n(s.target.result)},i.onerror=s=>{var r;e(lt.create("storage-open",{originalErrorMessage:(r=s.target.error)===null||r===void 0?void 0:r.message}))},i.onupgradeneeded=s=>{const r=s.target.result;switch(s.oldVersion){case 0:r.createObjectStore(wo,{keyPath:"compositeKey"})}}}catch(i){e(lt.create("storage-open",{originalErrorMessage:(t=i)===null||t===void 0?void 0:t.message}))}}),Wa)}function S0(n){return Rw(Nw(n))}function C0(n,e){return Aw(Nw(n),e)}function k0(n){return Aw(Cw,n)}function A0(){return Rw(Cw)}async function Aw(n,e){const i=(await kw()).transaction(wo,"readwrite"),r=i.objectStore(wo).put({compositeKey:n,value:e});return new Promise((o,a)=>{r.onsuccess=c=>{o()},i.onerror=c=>{var l;a(lt.create("storage-set",{originalErrorMessage:(l=c.target.error)===null||l===void 0?void 0:l.message}))}})}async function Rw(n){const t=(await kw()).transaction(wo,"readonly"),s=t.objectStore(wo).get(n);return new Promise((r,o)=>{s.onsuccess=a=>{const c=a.target.result;r(c?c.value:void 0)},t.onerror=a=>{var c;o(lt.create("storage-get",{originalErrorMessage:(c=a.target.error)===null||c===void 0?void 0:c.message}))}})}function Nw(n){return`${n.options.appId}-${n.name}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vo=new pi("@firebase/app-check");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R0(n){if(At()){let e;try{e=await S0(n)}catch(t){vo.warn(`Failed to read token from IndexedDB. Error: ${t}`)}return e}}function qg(n,e){return At()?C0(n,e).catch(t=>{vo.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}async function N0(){let n;try{n=await A0()}catch{}if(n)return n;{const e=bC();return k0(e).catch(t=>vo.warn(`Failed to persist debug token to IndexedDB. Error: ${t}`)),e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pw(){return El().enabled}async function Dw(){const n=El();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function P0(){const n=EC(),e=El();if(e.initialized=!0,typeof n.FIREBASE_APPCHECK_DEBUG_TOKEN!="string"&&n.FIREBASE_APPCHECK_DEBUG_TOKEN!==!0)return;e.enabled=!0;const t=new Ae;e.token=t,typeof n.FIREBASE_APPCHECK_DEBUG_TOKEN=="string"?t.resolve(n.FIREBASE_APPCHECK_DEBUG_TOKEN):t.resolve(N0())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D0={error:"UNKNOWN_ERROR"};function O0(n){return Yy.encodeString(JSON.stringify(n),!1)}async function Sc(n,e=!1){const t=n.app;Sw(t);const i=De(t);let s=i.token,r;if(!s){const c=await i.cachedTokenPromise;c&&Cc(c)&&(s=c)}if(!e&&s&&Cc(s))return{token:s.token};let o=!1;if(Pw()){i.exchangeTokenPromise||(i.exchangeTokenPromise=jd(T0(t,await Dw()),n.heartbeatServiceProvider).then(l=>(i.exchangeTokenPromise=void 0,l)),o=!0);const c=await i.exchangeTokenPromise;return await qg(t,c),zt(t,Object.assign(Object.assign({},i),{token:c})),{token:c.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().then(c=>(i.exchangeTokenPromise=void 0,c)),o=!0),s=await i.exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?vo.warn(c.message):vo.error(c),r=c}let a;return s?(a={token:s.token},zt(t,Object.assign(Object.assign({},i),{token:s})),await qg(t,s)):a=M0(r),o&&Ow(t,a),a}function Kd(n,e,t,i){const{app:s}=n,r=De(s),o={next:t,error:i,type:e};if(zt(s,Object.assign(Object.assign({},r),{tokenObservers:[...r.tokenObservers,o]})),r.token&&Cc(r.token)){const a=r.token;Promise.resolve().then(()=>{t({token:a.token}),jg(n)}).catch(()=>{})}r.cachedTokenPromise.then(()=>jg(n))}function Gd(n,e){const t=De(n),i=t.tokenObservers.filter(s=>s.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),zt(n,Object.assign(Object.assign({},t),{tokenObservers:i}))}function jg(n){const{app:e}=n,t=De(e);let i=t.tokenRefresher;i||(i=x0(n),zt(e,Object.assign(Object.assign({},t),{tokenRefresher:i}))),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function x0(n){const{app:e}=n;return new _0(async()=>{const t=De(e);let i;if(t.token?i=await Sc(n,!0):i=await Sc(n),i.error)throw i.error},()=>!0,()=>{const t=De(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5;const s=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,s),Math.max(0,i-Date.now())}else return 0},$g.RETRIAL_MIN_WAIT,$g.RETRIAL_MAX_WAIT)}function Ow(n,e){const t=De(n).tokenObservers;for(const i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function Cc(n){return n.expireTimeMillis-Date.now()>0}function M0(n){return{token:O0(D0),error:n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L0{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=De(this.app);for(const t of e)Gd(this.app,t.next);return Promise.resolve()}}function F0(n,e){return new L0(n,e)}function U0(n){return{getToken:e=>Sc(n,e),addTokenListener:e=>Kd(n,"INTERNAL",e),removeTokenListener:e=>Gd(n.app,e)}}const V0="@firebase/app-check",B0="0.5.11";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $0="https://www.google.com/recaptcha/api.js",q0="https://www.google.com/recaptcha/enterprise.js";function j0(n,e){const t=De(n),i=new Ae;zt(n,Object.assign(Object.assign({},t),{reCAPTCHAState:{initialized:i}}));const s=xw(n),r=bc(!1);return r?kc(n,e,r,s,i):W0(()=>{const o=bc(!1);if(!o)throw new Error("no recaptcha");kc(n,e,o,s,i)}),i.promise}function K0(n,e){const t=De(n),i=new Ae;zt(n,Object.assign(Object.assign({},t),{reCAPTCHAState:{initialized:i}}));const s=xw(n),r=bc(!0);return r?kc(n,e,r,s,i):H0(()=>{const o=bc(!0);if(!o)throw new Error("no recaptcha");kc(n,e,o,s,i)}),i.promise}function kc(n,e,t,i,s){t.ready(()=>{G0(n,e,t,i),s.resolve(t)})}function xw(n){const e=`fire_app_check_${n.name}`,t=document.createElement("div");return t.id=e,t.style.display="none",document.body.appendChild(t),e}async function Mw(n){Sw(n);const t=await De(n).reCAPTCHAState.initialized.promise;return new Promise((i,s)=>{const r=De(n).reCAPTCHAState;t.ready(()=>{i(t.execute(r.widgetId,{action:"fire_app_check"}))})})}function G0(n,e,t,i){const s=t.render(i,{sitekey:e,size:"invisible"}),r=De(n);zt(n,Object.assign(Object.assign({},r),{reCAPTCHAState:Object.assign(Object.assign({},r.reCAPTCHAState),{widgetId:s})}))}function W0(n){const e=document.createElement("script");e.src=$0,e.onload=n,document.head.appendChild(e)}function H0(n){const e=document.createElement("script");e.src=q0,e.onload=n,document.head.appendChild(e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Io{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e;Fw(this._throttleData);const t=await Mw(this._app).catch(s=>{throw lt.create("recaptcha-error")});let i;try{i=await jd(v0(this._app,t),this._heartbeatServiceProvider)}catch(s){throw s.code==="fetch-status-error"?(this._throttleData=Lw(Number((e=s.customData)===null||e===void 0?void 0:e.httpStatus),this._throttleData),lt.create("throttled",{time:qd(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):s}return this._throttleData=null,i}initialize(e){this._app=e,this._heartbeatServiceProvider=sa(e,"heartbeat"),j0(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof Io?this._siteKey===e._siteKey:!1}}class bl{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e;Fw(this._throttleData);const t=await Mw(this._app).catch(s=>{throw lt.create("recaptcha-error")});let i;try{i=await jd(I0(this._app,t),this._heartbeatServiceProvider)}catch(s){throw s.code==="fetch-status-error"?(this._throttleData=Lw(Number((e=s.customData)===null||e===void 0?void 0:e.httpStatus),this._throttleData),lt.create("throttled",{time:qd(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):s}return this._throttleData=null,i}initialize(e){this._app=e,this._heartbeatServiceProvider=sa(e,"heartbeat"),K0(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof bl?this._siteKey===e._siteKey:!1}}class To{constructor(e){this._customProviderOptions=e}async getToken(){const e=await this._customProviderOptions.getToken(),t=IC(e.token),i=t!==null&&t<Date.now()&&t>0?t*1e3:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:i})}initialize(e){this._app=e}isEqual(e){return e instanceof To?this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString():!1}}function Lw(n,e){if(n===404||n===403)return{backoffCount:1,allowRequestsAfter:Date.now()+m0,httpStatus:n};{const t=e?e.backoffCount:0,i=vc(t,1e3,2);return{backoffCount:t+1,allowRequestsAfter:Date.now()+i,httpStatus:n}}}function Fw(n){if(n&&Date.now()-n.allowRequestsAfter<=0)throw lt.create("throttled",{time:qd(n.allowRequestsAfter-Date.now()),httpStatus:n.httpStatus})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z0(n=TC(),e){n=w(n);const t=sa(n,"app-check");if(El().initialized||P0(),Pw()&&Dw().then(s=>console.log(`App Check debug token: ${s}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),t.isInitialized()){const s=t.getImmediate(),r=t.getOptions();if(r.isTokenAutoRefreshEnabled===e.isTokenAutoRefreshEnabled&&r.provider.isEqual(e.provider))return s;throw lt.create("already-initialized",{appName:n.name})}const i=t.initialize({options:e});return Q0(n,e.provider,e.isTokenAutoRefreshEnabled),De(n).isTokenAutoRefreshEnabled&&Kd(i,"INTERNAL",()=>{}),i}function Q0(n,e,t){const i=De(n),s=Object.assign(Object.assign({},i),{activated:!0});s.provider=e,s.cachedTokenPromise=R0(n).then(r=>(r&&Cc(r)&&(zt(n,Object.assign(Object.assign({},De(n)),{token:r})),Ow(n,{token:r.token})),r)),s.isTokenAutoRefreshEnabled=t===void 0?n.automaticDataCollectionEnabled:t,zt(n,s),s.provider.initialize(n)}function Y0(n,e){const t=n.app,i=De(t);i.tokenRefresher&&(e===!0?i.tokenRefresher.start():i.tokenRefresher.stop()),zt(t,Object.assign(Object.assign({},i),{isTokenAutoRefreshEnabled:e}))}async function X0(n,e){const t=await Sc(n,e);if(t.error)throw t.error;return{token:t.token}}function J0(n,e,t,i){let s=()=>{},r=()=>{};return e.next!=null?s=e.next.bind(e):s=e,e.error!=null?r=e.error.bind(e):t&&(r=t),Kd(n,"EXTERNAL",s,r),()=>Gd(n.app,s)}const Z0="app-check",Kg="app-check-internal";function eA(){Qe(new Y(Z0,n=>{const e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return F0(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Kg).initialize()})),Qe(new Y(Kg,n=>{const e=n.getProvider("app-check").getImmediate();return U0(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),fe(V0,B0)}eA();const tA="@firebase/app-check-compat",nA="0.2.11";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iA={["use-before-activation"]:"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."},Vu=new Yt("appCheck","AppCheck",iA);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sA{constructor(e){this.app=e}activate(e,t){let i;typeof e=="string"?i=new Io(e):e instanceof bl||e instanceof Io||e instanceof To?i=e:i=new To({getToken:e.getToken}),this._delegate=z0(this.app,{provider:i,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw Vu.create("use-before-activation",{appName:this.app.name});Y0(this._delegate,e)}getToken(e){if(!this._delegate)throw Vu.create("use-before-activation",{appName:this.app.name});return X0(this._delegate,e)}onTokenChanged(e,t,i){if(!this._delegate)throw Vu.create("use-before-activation",{appName:this.app.name});return J0(this._delegate,e,t)}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rA=n=>{const e=n.getProvider("app-compat").getImmediate();return new sA(e)};function oA(){Le.INTERNAL.registerComponent(new Y("appCheck-compat",rA,"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:bl,ReCaptchaV3Provider:Io,CustomProvider:To}))}oA();Le.registerVersion(tA,nA);function Wd(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(n);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(n,i[s])&&(t[i[s]]=n[i[s]]);return t}const Lr={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Ns={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aA(){return{["admin-restricted-operation"]:"This operation is restricted to administrators only.",["argument-error"]:"",["app-not-authorized"]:"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.",["app-not-installed"]:"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.",["captcha-check-failed"]:"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.",["code-expired"]:"The SMS code has expired. Please re-send the verification code to try again.",["cordova-not-ready"]:"Cordova framework is not ready.",["cors-unsupported"]:"This browser is not supported.",["credential-already-in-use"]:"This credential is already associated with a different user account.",["custom-token-mismatch"]:"The custom token corresponds to a different audience.",["requires-recent-login"]:"This operation is sensitive and requires recent authentication. Log in again before retrying this request.",["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.",["dynamic-link-not-activated"]:"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.",["email-change-needs-verification"]:"Multi-factor users must always have a verified email.",["email-already-in-use"]:"The email address is already in use by another account.",["emulator-config-failed"]:'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',["expired-action-code"]:"The action code has expired.",["cancelled-popup-request"]:"This operation has been cancelled due to another conflicting popup being opened.",["internal-error"]:"An internal AuthError has occurred.",["invalid-app-credential"]:"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.",["invalid-app-id"]:"The mobile app identifier is not registed for the current project.",["invalid-user-token"]:"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.",["invalid-auth-event"]:"An internal AuthError has occurred.",["invalid-verification-code"]:"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.",["invalid-continue-uri"]:"The continue URL provided in the request is invalid.",["invalid-cordova-configuration"]:"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.",["invalid-custom-token"]:"The custom token format is incorrect. Please check the documentation.",["invalid-dynamic-link-domain"]:"The provided dynamic link domain is not configured or authorized for the current project.",["invalid-email"]:"The email address is badly formatted.",["invalid-emulator-scheme"]:"Emulator URL must start with a valid scheme (http:// or https://).",["invalid-api-key"]:"Your API key is invalid, please check you have copied it correctly.",["invalid-cert-hash"]:"The SHA-1 certificate hash provided is invalid.",["invalid-credential"]:"The supplied auth credential is malformed or has expired.",["invalid-message-payload"]:"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-multi-factor-session"]:"The request does not contain a valid proof of first factor successful sign-in.",["invalid-oauth-provider"]:"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.",["invalid-oauth-client-id"]:"The OAuth client ID provided is either invalid or does not match the specified API key.",["unauthorized-domain"]:"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.",["invalid-action-code"]:"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.",["wrong-password"]:"The password is invalid or the user does not have a password.",["invalid-persistence-type"]:"The specified persistence type is invalid. It can only be local, session or none.",["invalid-phone-number"]:"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].",["invalid-provider-id"]:"The specified provider ID is invalid.",["invalid-recipient-email"]:"The email corresponding to this action failed to send as the provided recipient email address is invalid.",["invalid-sender"]:"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-verification-id"]:"The verification ID used to create the phone auth credential is invalid.",["invalid-tenant-id"]:"The Auth instance's tenant ID is invalid.",["login-blocked"]:"Login blocked by user-provided method: {$originalMessage}",["missing-android-pkg-name"]:"An Android Package Name must be provided if the Android App is required to be installed.",["auth-domain-config-required"]:"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.",["missing-app-credential"]:"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.",["missing-verification-code"]:"The phone auth credential was created with an empty SMS verification code.",["missing-continue-uri"]:"A continue URL must be provided in the request.",["missing-iframe-start"]:"An internal AuthError has occurred.",["missing-ios-bundle-id"]:"An iOS Bundle ID must be provided if an App Store ID is provided.",["missing-or-invalid-nonce"]:"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.",["missing-multi-factor-info"]:"No second factor identifier is provided.",["missing-multi-factor-session"]:"The request is missing proof of first factor successful sign-in.",["missing-phone-number"]:"To send verification codes, provide a phone number for the recipient.",["missing-verification-id"]:"The phone auth credential was created with an empty verification ID.",["app-deleted"]:"This instance of FirebaseApp has been deleted.",["multi-factor-info-not-found"]:"The user does not have a second factor matching the identifier provided.",["multi-factor-auth-required"]:"Proof of ownership of a second factor is required to complete sign-in.",["account-exists-with-different-credential"]:"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.",["network-request-failed"]:"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.",["no-auth-event"]:"An internal AuthError has occurred.",["no-such-provider"]:"User was not linked to an account with the given provider.",["null-user"]:"A null user object was provided as the argument for an operation which requires a non-null user object.",["operation-not-allowed"]:"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.",["operation-not-supported-in-this-environment"]:'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',["popup-blocked"]:"Unable to establish a connection with the popup. It may have been blocked by the browser.",["popup-closed-by-user"]:"The popup has been closed by the user before finalizing the operation.",["provider-already-linked"]:"User can only be linked to one identity for the given provider.",["quota-exceeded"]:"The project's quota for this operation has been exceeded.",["redirect-cancelled-by-user"]:"The redirect operation has been cancelled by the user before finalizing.",["redirect-operation-pending"]:"A redirect sign-in operation is already pending.",["rejected-credential"]:"The request contains malformed or mismatching credentials.",["second-factor-already-in-use"]:"The second factor is already enrolled on this account.",["maximum-second-factor-count-exceeded"]:"The maximum allowed number of second factors on a user has been exceeded.",["tenant-id-mismatch"]:"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.",["user-token-expired"]:"The user's credential is no longer valid. The user must sign in again.",["too-many-requests"]:"We have blocked all requests from this device due to unusual activity. Try again later.",["unauthorized-continue-uri"]:"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.",["unsupported-first-factor"]:"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.",["unsupported-persistence-type"]:"The current environment does not support the specified persistence type.",["unsupported-tenant-operation"]:"This operation is not supported in a multi-tenant context.",["unverified-email"]:"The operation requires a verified email.",["user-cancelled"]:"The user did not grant your application the permissions it requested.",["user-not-found"]:"There is no user record corresponding to this identifier. The user may have been deleted.",["user-disabled"]:"The user account has been disabled by an administrator.",["user-mismatch"]:"The supplied credentials do not correspond to the previously signed in user.",["user-signed-out"]:"",["weak-password"]:"The password must be 6 characters long or more.",["web-storage-unsupported"]:"This browser is not supported or 3rd party cookies and data may be disabled.",["already-initialized"]:"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}}function Uw(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const cA=aA,lA=Uw,Vw=new Yt("auth","Firebase",Uw());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gg=new pi("@firebase/auth");function uc(n,...e){Gg.logLevel<=Ct.ERROR&&Gg.error(`Auth (${gi}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ye(n,...e){throw Hd(n,...e)}function We(n,...e){return Hd(n,...e)}function Bw(n,e,t){const i=Object.assign(Object.assign({},lA()),{[e]:t});return new Yt("auth","Firebase",i).create(e,{appName:n.name})}function _r(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&Ye(n,"argument-error"),Bw(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Hd(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return Vw.create(n,...e)}function T(n,e,...t){if(!n)throw Hd(e,...t)}function rn(n){const e="INTERNAL ASSERTION FAILED: "+n;throw uc(e),new Error(e)}function Qt(n,e){n||rn(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wg=new Map;function bt(n){Qt(n instanceof Function,"Expected a class definition");let e=Wg.get(n);return e?(Qt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Wg.set(n,e),e)}function uA(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map(bt);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Eo(){var n;return typeof self!="undefined"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function zd(){return Hg()==="http:"||Hg()==="https:"}function Hg(){var n;return typeof self!="undefined"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hA(){return typeof navigator!="undefined"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(zd()||oa()||"connection"in navigator)?navigator.onLine:!0}function dA(){if(typeof navigator=="undefined")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ua{constructor(e,t){this.shortDelay=e,this.longDelay=t,Qt(t>e,"Short delay should be less than long delay!"),this.isMobile=wl()||aa()}get(){return hA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qd(n,e){Qt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $w{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self!="undefined"&&"fetch"in self)return self.fetch;rn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self!="undefined"&&"Headers"in self)return self.Headers;rn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self!="undefined"&&"Response"in self)return self.Response;rn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pA=new ua(3e4,6e4);function Ie(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Fe(n,e,t,i,s={}){return qw(n,s,async()=>{let r={},o={};i&&(e==="GET"?o=i:r={body:JSON.stringify(i)});const a=ws(Object.assign({key:n.config.apiKey},o)).slice(1),c=await n._getAdditionalHeaders();return c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode),$w.fetch()(jw(n,n.config.apiHost,t,a),Object.assign({method:e,headers:c,referrerPolicy:"no-referrer"},r))})}async function qw(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},fA),e);try{const s=new gA(n),r=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw Jr(n,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const a=r.ok?o.errorMessage:o.error.message,[c,l]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Jr(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Jr(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw Jr(n,"user-disabled",o);const u=i[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw Bw(n,u,l);Ye(n,u)}}catch(s){if(s instanceof Ke)throw s;Ye(n,"network-request-failed")}}async function Ln(n,e,t,i,s={}){const r=await Fe(n,e,t,i,s);return"mfaPendingCredential"in r&&Ye(n,"multi-factor-auth-required",{_serverResponse:r}),r}function jw(n,e,t,i){const s=`${e}${t}?${i}`;return n.config.emulator?Qd(n.config,s):`${n.config.apiScheme}://${s}`}class gA{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(We(this.auth,"network-request-failed")),pA.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Jr(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const s=We(n,e,i);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function mA(n,e){return Fe(n,"POST","/v1/accounts:delete",e)}async function _A(n,e){return Fe(n,"POST","/v1/accounts:update",e)}async function yA(n,e){return Fe(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function no(n){if(!!n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function wA(n,e=!1){const t=w(n),i=await t.getIdToken(e),s=Sl(i);T(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const r=typeof s.firebase=="object"?s.firebase:void 0,o=r==null?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:no(Bu(s.auth_time)),issuedAtTime:no(Bu(s.iat)),expirationTime:no(Bu(s.exp)),signInProvider:o||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function Bu(n){return Number(n)*1e3}function Sl(n){var e;const[t,i,s]=n.split(".");if(t===void 0||i===void 0||s===void 0)return uc("JWT malformed, contained fewer than 3 sections"),null;try{const r=CC(i);return r?JSON.parse(r):(uc("Failed to decode base64 JWT payload"),null)}catch(r){return uc("Caught error parsing JWT payload as JSON",(e=r)===null||e===void 0?void 0:e.toString()),null}}function vA(n){const e=Sl(n);return T(e,"internal-error"),T(typeof e.exp!="undefined","internal-error"),T(typeof e.iat!="undefined","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Pn(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof Ke&&IA(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function IA({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TA{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){var e;try{await this.user.getIdToken(!0)}catch(t){((e=t)===null||e===void 0?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=no(this.lastLoginAt),this.creationTime=no(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bo(n){var e;const t=n.auth,i=await n.getIdToken(),s=await Pn(n,yA(t,{idToken:i}));T(s==null?void 0:s.users.length,t,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const o=!((e=r.providerUserInfo)===null||e===void 0)&&e.length?SA(r.providerUserInfo):[],a=bA(n.providerData,o),c=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!(a!=null&&a.length),u=c?l:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Kw(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function EA(n){const e=w(n);await bo(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function bA(n,e){return[...n.filter(i=>!e.some(s=>s.providerId===i.providerId)),...e]}function SA(n){return n.map(e=>{var{providerId:t}=e,i=Wd(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CA(n,e){const t=await qw(n,{},async()=>{const i=ws({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:r}=n.config,o=jw(n,s,"/v1/token",`key=${r}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",$w.fetch()(o,{method:"POST",headers:a,body:i})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class So{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){T(e.idToken,"internal-error"),T(typeof e.idToken!="undefined","internal-error"),T(typeof e.refreshToken!="undefined","internal-error");const t="expiresIn"in e&&typeof e.expiresIn!="undefined"?Number(e.expiresIn):vA(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return T(!this.accessToken||this.refreshToken,e,"user-token-expired"),!t&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:s,expiresIn:r}=await CA(e,t);this.updateTokensAndExpiration(i,s,Number(r))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:s,expirationTime:r}=t,o=new So;return i&&(T(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),s&&(T(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),r&&(T(typeof r=="number","internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new So,this.toJSON())}_performRefresh(){return rn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qn(n,e){T(typeof n=="string"||typeof n=="undefined","internal-error",{appName:e})}class ji{constructor(e){var{uid:t,auth:i,stsTokenManager:s}=e,r=Wd(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new TA(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Kw(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await Pn(this,this.stsTokenManager.getToken(this.auth,e));return T(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return wA(this,e)}reload(){return EA(this)}_assign(e){this!==e&&(T(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new ji(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){T(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await bo(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Pn(this,mA(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,s,r,o,a,c,l,u;const h=(i=t.displayName)!==null&&i!==void 0?i:void 0,d=(s=t.email)!==null&&s!==void 0?s:void 0,f=(r=t.phoneNumber)!==null&&r!==void 0?r:void 0,p=(o=t.photoURL)!==null&&o!==void 0?o:void 0,_=(a=t.tenantId)!==null&&a!==void 0?a:void 0,v=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,R=(l=t.createdAt)!==null&&l!==void 0?l:void 0,x=(u=t.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:A,emailVerified:M,isAnonymous:H,providerData:G,stsTokenManager:he}=t;T(A&&he,e,"internal-error");const It=So.fromJSON(this.name,he);T(typeof A=="string",e,"internal-error"),qn(h,e.name),qn(d,e.name),T(typeof M=="boolean",e,"internal-error"),T(typeof H=="boolean",e,"internal-error"),qn(f,e.name),qn(p,e.name),qn(_,e.name),qn(v,e.name),qn(R,e.name),qn(x,e.name);const Si=new ji({uid:A,auth:e,email:d,emailVerified:M,displayName:h,isAnonymous:H,photoURL:p,phoneNumber:f,tenantId:_,stsTokenManager:It,createdAt:R,lastLoginAt:x});return G&&Array.isArray(G)&&(Si.providerData=G.map(vC=>Object.assign({},vC))),v&&(Si._redirectEventId=v),Si}static async _fromIdTokenResponse(e,t,i=!1){const s=new So;s.updateFromServerResponse(t);const r=new ji({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:i});return await bo(r),r}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gw{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Gw.type="NONE";const Js=Gw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ki(n,e,t){return`firebase:${n}:${e}:${t}`}class $s{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:s,name:r}=this.auth;this.fullUserKey=Ki(this.userKey,s.apiKey,r),this.fullPersistenceKey=Ki("persistence",s.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?ji._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new $s(bt(Js),e,i);const s=(await Promise.all(t.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let r=s[0]||bt(Js);const o=Ki(i,e.config.apiKey,e.name);let a=null;for(const l of t)try{const u=await l._get(o);if(u){const h=ji._fromJSON(e,u);l!==r&&(a=h),r=l;break}}catch{}const c=s.filter(l=>l._shouldAllowMigration);return!r._shouldAllowMigration||!c.length?new $s(r,e,i):(r=c[0],a&&await r._set(o,a.toJSON()),await Promise.all(t.map(async l=>{if(l!==r)try{await l._remove(o)}catch{}})),new $s(r,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zg(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(zw(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ww(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Qw(e))return"Blackberry";if(Yw(e))return"Webos";if(Yd(e))return"Safari";if((e.includes("chrome/")||Hw(e))&&!e.includes("edge/"))return"Chrome";if(ha(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function Ww(n=pe()){return/firefox\//i.test(n)}function Yd(n=pe()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Hw(n=pe()){return/crios\//i.test(n)}function zw(n=pe()){return/iemobile/i.test(n)}function ha(n=pe()){return/android/i.test(n)}function Qw(n=pe()){return/blackberry/i.test(n)}function Yw(n=pe()){return/webos/i.test(n)}function yr(n=pe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function kA(n=pe()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(n)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(n)}function AA(n=pe()){var e;return yr(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function RA(){return xd()&&document.documentMode===10}function Xw(n=pe()){return yr(n)||ha(n)||Yw(n)||Qw(n)||/windows phone/i.test(n)||zw(n)}function NA(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jw(n,e=[]){let t;switch(n){case"Browser":t=zg(pe());break;case"Worker":t=`${zg(pe())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${gi}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PA{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=r=>new Promise((o,a)=>{try{const c=e(r);o(c)}catch(c){a(c)}});i.onAbort=t,this.queue.push(i);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){var t;if(this.auth.currentUser===e)return;const i=[];try{for(const s of this.queue)await s(e),s.onAbort&&i.push(s.onAbort)}catch(s){i.reverse();for(const r of i)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:(t=s)===null||t===void 0?void 0:t.message})}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DA{constructor(e,t,i){this.app=e,this.heartbeatServiceProvider=t,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Qg(this),this.idTokenSubscription=new Qg(this),this.beforeStateQueue=new PA(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Vw,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=bt(t)),this._initializationPromise=this.queue(async()=>{var i,s;if(!this._deleted&&(this.persistenceManager=await $s.create(this,e),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t;const i=await this.assertedPersistence.getCurrentUser();let s=i,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c==null?void 0:c.user)&&(s=c.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return T(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){var t;try{await bo(e)}catch(i){if(((t=i)===null||t===void 0?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=dA()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?w(e):null;return t&&T(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&T(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(bt(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Yt("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&bt(e)||this._popupRedirectResolver;T(t,this,"argument-error"),this.redirectPersistenceManager=await $s.create(this,[bt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,s){if(this._deleted)return()=>{};const r=typeof t=="function"?t:t.next.bind(t),o=this._isInitialized?Promise.resolve():this._initializationPromise;return T(o,this,"internal-error"),o.then(()=>r(this.currentUser)),typeof t=="function"?e.addObserver(t,i,s):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return T(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Jw(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());return i&&(t["X-Firebase-Client"]=i),t}}function Oe(n){return w(n)}class Qg{constructor(e){this.auth=e,this.observer=null,this.addObserver=SC(t=>this.observer=t)}get next(){return T(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function OA(n,e,t){const i=Oe(n);T(i._canInitEmulator,i,"emulator-config-failed"),T(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),r=Zw(e),{host:o,port:a}=xA(e),c=a===null?"":`:${a}`;i.config.emulator={url:`${r}//${o}${c}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||MA()}function Zw(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function xA(n){const e=Zw(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const r=s[1];return{host:r,port:Yg(i.substr(r.length+1))}}else{const[r,o]=i.split(":");return{host:r,port:Yg(o)}}}function Yg(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function MA(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console!="undefined"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window!="undefined"&&typeof document!="undefined"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return rn("not implemented")}_getIdTokenResponse(e){return rn("not implemented")}_linkToIdToken(e,t){return rn("not implemented")}_getReauthenticationResolver(e){return rn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ev(n,e){return Fe(n,"POST","/v1/accounts:resetPassword",Ie(n,e))}async function tv(n,e){return Fe(n,"POST","/v1/accounts:update",e)}async function LA(n,e){return Fe(n,"POST","/v1/accounts:update",Ie(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FA(n,e){return Ln(n,"POST","/v1/accounts:signInWithPassword",Ie(n,e))}async function Cl(n,e){return Fe(n,"POST","/v1/accounts:sendOobCode",Ie(n,e))}async function UA(n,e){return Cl(n,e)}async function VA(n,e){return Cl(n,e)}async function BA(n,e){return Cl(n,e)}async function $A(n,e){return Cl(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qA(n,e){return Ln(n,"POST","/v1/accounts:signInWithEmailLink",Ie(n,e))}async function jA(n,e){return Ln(n,"POST","/v1/accounts:signInWithEmailLink",Ie(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Co extends wr{constructor(e,t,i,s=null){super("password",i),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new Co(e,t,"password")}static _fromEmailAndCode(e,t,i=null){return new Co(e,t,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if((t==null?void 0:t.email)&&(t==null?void 0:t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return FA(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return qA(e,{email:this._email,oobCode:this._password});default:Ye(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return tv(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return jA(e,{idToken:t,email:this._email,oobCode:this._password});default:Ye(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function An(n,e){return Ln(n,"POST","/v1/accounts:signInWithIdp",Ie(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KA="http://localhost";class fn extends wr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new fn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ye("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:s}=t,r=Wd(t,["providerId","signInMethod"]);if(!i||!s)return null;const o=new fn(i,s);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return An(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,An(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,An(e,t)}buildRequest(){const e={requestUri:KA,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=ws(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GA(n,e){return Fe(n,"POST","/v1/accounts:sendVerificationCode",Ie(n,e))}async function WA(n,e){return Ln(n,"POST","/v1/accounts:signInWithPhoneNumber",Ie(n,e))}async function HA(n,e){const t=await Ln(n,"POST","/v1/accounts:signInWithPhoneNumber",Ie(n,e));if(t.temporaryProof)throw Jr(n,"account-exists-with-different-credential",t);return t}const zA={USER_NOT_FOUND:"user-not-found"};async function QA(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Ln(n,"POST","/v1/accounts:signInWithPhoneNumber",Ie(n,t),zA)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi extends wr{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Gi({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Gi({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return WA(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return HA(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return QA(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:i,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:i,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:i,phoneNumber:s,temporaryProof:r}=e;return!i&&!t&&!s&&!r?null:new Gi({verificationId:t,verificationCode:i,phoneNumber:s,temporaryProof:r})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YA(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function XA(n){const e=Fs(Xr(n)).link,t=e?Fs(Xr(e)).deep_link_id:null,i=Fs(Xr(n)).deep_link_id;return(i?Fs(Xr(i)).link:null)||i||t||e||n}class kl{constructor(e){var t,i,s,r,o,a;const c=Fs(Xr(e)),l=(t=c.apiKey)!==null&&t!==void 0?t:null,u=(i=c.oobCode)!==null&&i!==void 0?i:null,h=YA((s=c.mode)!==null&&s!==void 0?s:null);T(l&&u&&h,"argument-error"),this.apiKey=l,this.operation=h,this.code=u,this.continueUrl=(r=c.continueUrl)!==null&&r!==void 0?r:null,this.languageCode=(o=c.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=c.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=XA(e);try{return new kl(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mi{constructor(){this.providerId=mi.PROVIDER_ID}static credential(e,t){return Co._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const i=kl.parseLink(t);return T(i,"argument-error"),Co._fromEmailAndCode(e,i.code,i.tenantId)}}mi.PROVIDER_ID="password";mi.EMAIL_PASSWORD_SIGN_IN_METHOD="password";mi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vr extends Fn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class qs extends vr{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return T("providerId"in t&&"signInMethod"in t,"argument-error"),fn._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return T(e.idToken||e.accessToken,"argument-error"),fn._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return qs.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return qs.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:r,nonce:o,providerId:a}=e;if(!i&&!s&&!t&&!r||!a)return null;try{return new qs(a)._credential({idToken:t,accessToken:i,nonce:o,pendingToken:r})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zt extends vr{constructor(){super("facebook.com")}static credential(e){return fn._fromParams({providerId:Zt.PROVIDER_ID,signInMethod:Zt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zt.credentialFromTaggedObject(e)}static credentialFromError(e){return Zt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Zt.credential(e.oauthAccessToken)}catch{return null}}}Zt.FACEBOOK_SIGN_IN_METHOD="facebook.com";Zt.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en extends vr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return fn._fromParams({providerId:en.PROVIDER_ID,signInMethod:en.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return en.credentialFromTaggedObject(e)}static credentialFromError(e){return en.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return en.credential(t,i)}catch{return null}}}en.GOOGLE_SIGN_IN_METHOD="google.com";en.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tn extends vr{constructor(){super("github.com")}static credential(e){return fn._fromParams({providerId:tn.PROVIDER_ID,signInMethod:tn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return tn.credentialFromTaggedObject(e)}static credentialFromError(e){return tn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return tn.credential(e.oauthAccessToken)}catch{return null}}}tn.GITHUB_SIGN_IN_METHOD="github.com";tn.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JA="http://localhost";class Zs extends wr{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return An(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,An(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,An(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:s,pendingToken:r}=t;return!i||!s||!r||i!==s?null:new Zs(i,r)}static _create(e,t){return new Zs(e,t)}buildRequest(){return{requestUri:JA,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZA="saml.";class Ac extends Fn{constructor(e){T(e.startsWith(ZA),"argument-error"),super(e)}static credentialFromResult(e){return Ac.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Ac.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Zs.fromJSON(e);return T(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:i}=e;if(!t||!i)return null;try{return Zs._create(i,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nn extends vr{constructor(){super("twitter.com")}static credential(e,t){return fn._fromParams({providerId:nn.PROVIDER_ID,signInMethod:nn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return nn.credentialFromTaggedObject(e)}static credentialFromError(e){return nn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return nn.credential(t,i)}catch{return null}}}nn.TWITTER_SIGN_IN_METHOD="twitter.com";nn.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nv(n,e){return Ln(n,"POST","/v1/accounts:signUp",Ie(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ut{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,s=!1){const r=await ji._fromIdTokenResponse(e,i,s),o=Xg(i);return new Ut({user:r,providerId:o,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const s=Xg(i);return new Ut({user:e,providerId:s,_tokenResponse:i,operationType:t})}}function Xg(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function eR(n){var e;const t=Oe(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Ut({user:t.currentUser,providerId:null,operationType:"signIn"});const i=await nv(t,{returnSecureToken:!0}),s=await Ut._fromIdTokenResponse(t,"signIn",i,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rc extends Ke{constructor(e,t,i,s){var r;super(t.code,t.message),this.operationType=i,this.user=s,Object.setPrototypeOf(this,Rc.prototype),this.customData={appName:e.name,tenantId:(r=e.tenantId)!==null&&r!==void 0?r:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,s){return new Rc(e,t,i,s)}}function iv(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?Rc._fromErrorAndOperation(n,r,e,i):r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sv(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tR(n,e){const t=w(n);await Al(!0,t,e);const{providerUserInfo:i}=await _A(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=sv(i||[]);return t.providerData=t.providerData.filter(r=>s.has(r.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Xd(n,e,t=!1){const i=await Pn(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ut._forOperation(n,"link",i)}async function Al(n,e,t){await bo(e);const i=sv(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";T(i.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rv(n,e,t=!1){var i;const{auth:s}=n,r="reauthenticate";try{const o=await Pn(n,iv(s,r,e,n),t);T(o.idToken,s,"internal-error");const a=Sl(o.idToken);T(a,s,"internal-error");const{sub:c}=a;return T(n.uid===c,s,"user-mismatch"),Ut._forOperation(n,r,o)}catch(o){throw((i=o)===null||i===void 0?void 0:i.code)==="auth/user-not-found"&&Ye(s,"user-mismatch"),o}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ov(n,e,t=!1){const i="signIn",s=await iv(n,i,e),r=await Ut._fromIdTokenResponse(n,i,s);return t||await n._updateCurrentUser(r.user),r}async function Rl(n,e){return ov(Oe(n),e)}async function av(n,e){const t=w(n);return await Al(!1,t,e.providerId),Xd(t,e)}async function cv(n,e){return rv(w(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nR(n,e){return Ln(n,"POST","/v1/accounts:signInWithCustomToken",Ie(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iR(n,e){const t=Oe(n),i=await nR(t,{token:e,returnSecureToken:!0}),s=await Ut._fromIdTokenResponse(t,"signIn",i);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nl{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?Jd._fromServerResponse(e,t):Ye(e,"internal-error")}}class Jd extends Nl{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new Jd(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pl(n,e,t){var i;T(((i=t.url)===null||i===void 0?void 0:i.length)>0,n,"invalid-continue-uri"),T(typeof t.dynamicLinkDomain=="undefined"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(T(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(T(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sR(n,e,t){const i=w(n),s={requestType:"PASSWORD_RESET",email:e};t&&Pl(i,s,t),await VA(i,s)}async function rR(n,e,t){await ev(w(n),{oobCode:e,newPassword:t})}async function oR(n,e){await LA(w(n),{oobCode:e})}async function lv(n,e){const t=w(n),i=await ev(t,{oobCode:e}),s=i.requestType;switch(T(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":T(i.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":T(i.mfaInfo,t,"internal-error");default:T(i.email,t,"internal-error")}let r=null;return i.mfaInfo&&(r=Nl._fromServerResponse(Oe(t),i.mfaInfo)),{data:{email:(i.requestType==="VERIFY_AND_CHANGE_EMAIL"?i.newEmail:i.email)||null,previousEmail:(i.requestType==="VERIFY_AND_CHANGE_EMAIL"?i.email:i.newEmail)||null,multiFactorInfo:r},operation:s}}async function aR(n,e){const{data:t}=await lv(w(n),e);return t.email}async function cR(n,e,t){const i=Oe(n),s=await nv(i,{returnSecureToken:!0,email:e,password:t}),r=await Ut._fromIdTokenResponse(i,"signIn",s);return await i._updateCurrentUser(r.user),r}function lR(n,e,t){return Rl(w(n),mi.credential(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uR(n,e,t){const i=w(n),s={requestType:"EMAIL_SIGNIN",email:e};T(t.handleCodeInApp,i,"argument-error"),t&&Pl(i,s,t),await BA(i,s)}function hR(n,e){const t=kl.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function dR(n,e,t){const i=w(n),s=mi.credentialWithLink(e,t||Eo());return T(s._tenantId===(i.tenantId||null),i,"tenant-id-mismatch"),Rl(i,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fR(n,e){return Fe(n,"POST","/v1/accounts:createAuthUri",Ie(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pR(n,e){const t=zd()?Eo():"http://localhost",i={identifier:e,continueUri:t},{signinMethods:s}=await fR(w(n),i);return s||[]}async function gR(n,e){const t=w(n),i=await n.getIdToken(),s={requestType:"VERIFY_EMAIL",idToken:i};e&&Pl(t.auth,s,e);const{email:r}=await UA(t.auth,s);r!==n.email&&await n.reload()}async function mR(n,e,t){const i=w(n),s=await n.getIdToken(),r={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:s,newEmail:e};t&&Pl(i.auth,r,t);const{email:o}=await $A(i.auth,r);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _R(n,e){return Fe(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yR(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const i=w(n),r={idToken:await i.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Pn(i,_R(i.auth,r));i.displayName=o.displayName||null,i.photoURL=o.photoUrl||null;const a=i.providerData.find(({providerId:c})=>c==="password");a&&(a.displayName=i.displayName,a.photoURL=i.photoURL),await i._updateTokensIfNecessary(o)}function wR(n,e){return uv(w(n),e,null)}function vR(n,e){return uv(w(n),null,e)}async function uv(n,e,t){const{auth:i}=n,r={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(r.email=e),t&&(r.password=t);const o=await Pn(n,tv(i,r));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IR(n){var e,t;if(!n)return null;const{providerId:i}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!i&&(n==null?void 0:n.idToken)){const o=(t=(e=Sl(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new js(r,a)}}if(!i)return null;switch(i){case"facebook.com":return new TR(r,s);case"github.com":return new ER(r,s);case"google.com":return new bR(r,s);case"twitter.com":return new SR(r,s,n.screenName||null);case"custom":case"anonymous":return new js(r,null);default:return new js(r,i,s)}}class js{constructor(e,t,i={}){this.isNewUser=e,this.providerId=t,this.profile=i}}class hv extends js{constructor(e,t,i,s){super(e,t,i),this.username=s}}class TR extends js{constructor(e,t){super(e,"facebook.com",t)}}class ER extends hv{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class bR extends js{constructor(e,t){super(e,"google.com",t)}}class SR extends hv{constructor(e,t,i){super(e,"twitter.com",t,i)}}function CR(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:IR(t)}class Fi{constructor(e,t){this.type=e,this.credential=t}static _fromIdtoken(e){return new Fi("enroll",e)}static _fromMfaPendingCredential(e){return new Fi("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,i;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return Fi._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((i=e.multiFactorSession)===null||i===void 0)&&i.idToken)return Fi._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zd{constructor(e,t,i){this.session=e,this.hints=t,this.signInResolver=i}static _fromError(e,t){const i=Oe(e),s=t.customData._serverResponse,r=(s.mfaInfo||[]).map(a=>Nl._fromServerResponse(i,a));T(s.mfaPendingCredential,i,"internal-error");const o=Fi._fromMfaPendingCredential(s.mfaPendingCredential);return new Zd(o,r,async a=>{const c=await a._process(i,o);delete s.mfaInfo,delete s.mfaPendingCredential;const l=Object.assign(Object.assign({},s),{idToken:c.idToken,refreshToken:c.refreshToken});switch(t.operationType){case"signIn":const u=await Ut._fromIdTokenResponse(i,t.operationType,l);return await i._updateCurrentUser(u.user),u;case"reauthenticate":return T(t.user,i,"internal-error"),Ut._forOperation(t.user,t.operationType,l);default:Ye(i,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function kR(n,e){var t;const i=w(n),s=e;return T(e.customData.operationType,i,"argument-error"),T((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,i,"argument-error"),Zd._fromError(i,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AR(n,e){return Fe(n,"POST","/v2/accounts/mfaEnrollment:start",Ie(n,e))}function RR(n,e){return Fe(n,"POST","/v2/accounts/mfaEnrollment:finalize",Ie(n,e))}function NR(n,e){return Fe(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Ie(n,e))}class ef{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(i=>Nl._fromServerResponse(e.auth,i)))})}static _fromUser(e){return new ef(e)}async getSession(){return Fi._fromIdtoken(await this.user.getIdToken())}async enroll(e,t){const i=e,s=await this.getSession(),r=await Pn(this.user,i._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){var t;const i=typeof e=="string"?e:e.uid,s=await this.user.getIdToken(),r=await Pn(this.user,NR(this.user.auth,{idToken:s,mfaEnrollmentId:i}));this.enrolledFactors=this.enrolledFactors.filter(({uid:o})=>o!==i),await this.user._updateTokensIfNecessary(r);try{await this.user.reload()}catch(o){if(((t=o)===null||t===void 0?void 0:t.code)!=="auth/user-token-expired")throw o}}}const $u=new WeakMap;function PR(n){const e=w(n);return $u.has(e)||$u.set(e,ef._fromUser(e)),$u.get(e)}const Nc="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dv{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Nc,"1"),this.storage.removeItem(Nc),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DR(){const n=pe();return Yd(n)||yr(n)}const OR=1e3,xR=10;class fv extends dv{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=DR()&&NA(),this.fallbackToPolling=Xw(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),s=this.localCache[t];i!==s&&e(t,s,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const i=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(i);if(e.newValue!==o)e.newValue!==null?this.storage.setItem(i,e.newValue):this.storage.removeItem(i);else if(this.localCache[i]===e.newValue&&!t)return}const s=()=>{const o=this.storage.getItem(i);!t&&this.localCache[i]===o||this.notifyListeners(i,o)},r=this.storage.getItem(i);RA()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,xR):s()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},OR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}fv.type="LOCAL";const tf=fv;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pv extends dv{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}pv.type="SESSION";const Xi=pv;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MR(n){return Promise.all(n.map(async e=>{try{const t=await e;return{fulfilled:!0,value:t}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dl{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const i=new Dl(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:s,data:r}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:s});const a=Array.from(o).map(async l=>l(t.origin,r)),c=await MR(a);t.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Dl.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function da(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LR{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const s=typeof MessageChannel!="undefined"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let r,o;return new Promise((a,c)=>{const l=da("",20);s.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},i);o={messageChannel:s,onMessage(h){const d=h;if(d.data.eventId===l)switch(d.data.status){case"ack":clearTimeout(u),r=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(d.data.response);break;default:clearTimeout(u),clearTimeout(r),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ye(){return window}function FR(n){ye().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nf(){return typeof ye().WorkerGlobalScope!="undefined"&&typeof ye().importScripts=="function"}async function UR(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function VR(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function BR(){return nf()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gv="firebaseLocalStorageDb",$R=1,Pc="firebaseLocalStorage",mv="fbase_key";class fa{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Ol(n,e){return n.transaction([Pc],e?"readwrite":"readonly").objectStore(Pc)}function qR(){const n=indexedDB.deleteDatabase(gv);return new fa(n).toPromise()}function Nh(){const n=indexedDB.open(gv,$R);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(Pc,{keyPath:mv})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(Pc)?e(i):(i.close(),await qR(),e(await Nh()))})})}async function Jg(n,e,t){const i=Ol(n,!0).put({[mv]:e,value:t});return new fa(i).toPromise()}async function jR(n,e){const t=Ol(n,!1).get(e),i=await new fa(t).toPromise();return i===void 0?null:i.value}function Zg(n,e){const t=Ol(n,!0).delete(e);return new fa(t).toPromise()}const KR=800,GR=3;class _v{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Nh(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>GR)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return nf()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Dl._getInstance(BR()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await UR(),!this.activeServiceWorker)return;this.sender=new LR(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);!i||((e=i[0])===null||e===void 0?void 0:e.fulfilled)&&((t=i[0])===null||t===void 0?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||VR()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Nh();return await Jg(e,Nc,"1"),await Zg(e,Nc),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>Jg(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>jR(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Zg(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const r=Ol(s,!1).getAll();return new fa(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;for(const{fbase_key:s,value:r}of e)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(r)&&(this.notifyListeners(s,r),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),KR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}_v.type="LOCAL";const ko=_v;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WR(n,e){return Fe(n,"POST","/v2/accounts/mfaSignIn:start",Ie(n,e))}function HR(n,e){return Fe(n,"POST","/v2/accounts/mfaSignIn:finalize",Ie(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zR(n){return(await Fe(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QR(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}function yv(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=s=>{const r=We("internal-error");r.customData=s,t(r)},i.type="text/javascript",i.charset="UTF-8",QR().appendChild(i)})}function wv(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YR=500,XR=6e4,Ha=1e12;class JR{constructor(e){this.auth=e,this.counter=Ha,this._widgets=new Map}render(e,t){const i=this.counter;return this._widgets.set(i,new ZR(e,this.auth.name,t||{})),this.counter++,i}reset(e){var t;const i=e||Ha;(t=this._widgets.get(i))===null||t===void 0||t.delete(),this._widgets.delete(i)}getResponse(e){var t;const i=e||Ha;return((t=this._widgets.get(i))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const i=e||Ha;return(t=this._widgets.get(i))===null||t===void 0||t.execute(),""}}class ZR{constructor(e,t,i){this.params=i,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;T(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=eN(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},XR)},YR))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function eN(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let i=0;i<n;i++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qu=wv("rcb"),tN=new ua(3e4,6e4),nN="https://www.google.com/recaptcha/api.js?";class iN{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=ye().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return T(sN(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(ye().grecaptcha):new Promise((i,s)=>{const r=ye().setTimeout(()=>{s(We(e,"network-request-failed"))},tN.get());ye()[qu]=()=>{ye().clearTimeout(r),delete ye()[qu];const a=ye().grecaptcha;if(!a){s(We(e,"internal-error"));return}const c=a.render;a.render=(l,u)=>{const h=c(l,u);return this.counter++,h},this.hostLanguage=t,i(a)};const o=`${nN}?${ws({onload:qu,render:"explicit",hl:t})}`;yv(o).catch(()=>{clearTimeout(r),s(We(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=ye().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function sN(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class rN{async load(e){return new JR(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vv="recaptcha",oN={theme:"light",type:"image"};class aN{constructor(e,t=Object.assign({},oN),i){this.parameters=t,this.type=vv,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Oe(i),this.isInvisible=this.parameters.size==="invisible",T(typeof document!="undefined",this.auth,"operation-not-supported-in-this-environment");const s=typeof e=="string"?document.getElementById(e):e;T(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new rN:new iN,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),i=t.getResponse(e);return i||new Promise(s=>{const r=o=>{!o||(this.tokenChangeListeners.delete(r),s(o))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){T(!this.parameters.sitekey,this.auth,"argument-error"),T(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),T(typeof document!="undefined",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(i=>i(t)),typeof e=="function")e(t);else if(typeof e=="string"){const i=ye()[e];typeof i=="function"&&i(t)}}}assertNotDestroyed(){T(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){T(zd()&&!nf(),this.auth,"internal-error"),await cN(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await zR(this.auth);T(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return T(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}function cN(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sf{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Gi._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function lN(n,e,t){const i=Oe(n),s=await xl(i,e,w(t));return new sf(s,r=>Rl(i,r))}async function uN(n,e,t){const i=w(n);await Al(!1,i,"phone");const s=await xl(i.auth,e,w(t));return new sf(s,r=>av(i,r))}async function hN(n,e,t){const i=w(n),s=await xl(i.auth,e,w(t));return new sf(s,r=>cv(i,r))}async function xl(n,e,t){var i;const s=await t.verify();try{T(typeof s=="string",n,"argument-error"),T(t.type===vv,n,"argument-error");let r;if(typeof e=="string"?r={phoneNumber:e}:r=e,"session"in r){const o=r.session;if("phoneNumber"in r)return T(o.type==="enroll",n,"internal-error"),(await AR(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{T(o.type==="signin",n,"internal-error");const a=((i=r.multiFactorHint)===null||i===void 0?void 0:i.uid)||r.multiFactorUid;return T(a,n,"missing-multi-factor-info"),(await WR(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await GA(n,{phoneNumber:r.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function dN(n,e){await Xd(w(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wt{constructor(e){this.providerId=Wt.PROVIDER_ID,this.auth=Oe(e)}verifyPhoneNumber(e,t){return xl(this.auth,e,w(t))}static credential(e,t){return Gi._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Wt.credentialFromTaggedObject(t)}static credentialFromError(e){return Wt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:i}=e;return t&&i?Gi._fromTokenResponse(t,i):null}}Wt.PROVIDER_ID="phone";Wt.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vs(n,e){return e?bt(e):(T(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rf extends wr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return An(e,this._buildIdpRequest())}_linkToIdToken(e,t){return An(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return An(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function fN(n){return ov(n.auth,new rf(n),n.bypassAuthState)}function pN(n){const{auth:e,user:t}=n;return T(t,e,"internal-error"),rv(t,new rf(n),n.bypassAuthState)}async function gN(n){const{auth:e,user:t}=n;return T(t,e,"internal-error"),Xd(t,new rf(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iv{constructor(e,t,i,s,r=!1){this.auth=e,this.resolver=i,this.user=s,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:s,tenantId:r,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:i,tenantId:r||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return fN;case"linkViaPopup":case"linkViaRedirect":return gN;case"reauthViaPopup":case"reauthViaRedirect":return pN;default:Ye(this.auth,"internal-error")}}resolve(e){Qt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Qt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mN=new ua(2e3,1e4);async function _N(n,e,t){const i=Oe(n);_r(n,e,Fn);const s=vs(i,t);return new En(i,"signInViaPopup",e,s).executeNotNull()}async function yN(n,e,t){const i=w(n);_r(i.auth,e,Fn);const s=vs(i.auth,t);return new En(i.auth,"reauthViaPopup",e,s,i).executeNotNull()}async function wN(n,e,t){const i=w(n);_r(i.auth,e,Fn);const s=vs(i.auth,t);return new En(i.auth,"linkViaPopup",e,s,i).executeNotNull()}class En extends Iv{constructor(e,t,i,s,r){super(e,t,s,r),this.provider=i,this.authWindow=null,this.pollId=null,En.currentPopupAction&&En.currentPopupAction.cancel(),En.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return T(e,this.auth,"internal-error"),e}async onExecution(){Qt(this.filter.length===1,"Popup operations only handle one event");const e=da();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(We(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(We(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,En.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if(!((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(We(this.auth,"popup-closed-by-user"))},2e3);return}this.pollId=window.setTimeout(e,mN.get())};e()}}En.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vN="pendingRedirect",io=new Map;class IN extends Iv{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=io.get(this.auth._key());if(!e){try{const i=await TN(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}io.set(this.auth._key(),e)}return this.bypassAuthState||io.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function TN(n,e){const t=Ev(e),i=Tv(n);if(!await i._isAvailable())return!1;const s=await i._get(t)==="true";return await i._remove(t),s}async function of(n,e){return Tv(n)._set(Ev(e),"true")}function EN(){io.clear()}function af(n,e){io.set(n._key(),e)}function Tv(n){return bt(n._redirectPersistence)}function Ev(n){return Ki(vN,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bN(n,e,t){return SN(n,e,t)}async function SN(n,e,t){const i=Oe(n);_r(n,e,Fn);const s=vs(i,t);return await of(s,i),s._openRedirect(i,e,"signInViaRedirect")}function CN(n,e,t){return kN(n,e,t)}async function kN(n,e,t){const i=w(n);_r(i.auth,e,Fn);const s=vs(i.auth,t);await of(s,i.auth);const r=await bv(i);return s._openRedirect(i.auth,e,"reauthViaRedirect",r)}function AN(n,e,t){return RN(n,e,t)}async function RN(n,e,t){const i=w(n);_r(i.auth,e,Fn);const s=vs(i.auth,t);await Al(!1,i,e.providerId),await of(s,i.auth);const r=await bv(i);return s._openRedirect(i.auth,e,"linkViaRedirect",r)}async function NN(n,e){return await Oe(n)._initializationPromise,Ml(n,e,!1)}async function Ml(n,e,t=!1){const i=Oe(n),s=vs(i,e),o=await new IN(i,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,e)),o}async function bv(n){const e=da(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PN=10*60*1e3;class Sv{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!DN(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!Cv(e)){const s=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(We(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=PN&&this.cachedEventUids.clear(),this.cachedEventUids.has(em(e))}saveEventToCache(e){this.cachedEventUids.add(em(e)),this.lastProcessedEventTime=Date.now()}}function em(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Cv({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function DN(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Cv(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kv(n,e={}){return Fe(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ON=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,xN=/^https?/;async function MN(n){if(n.config.emulator)return;const{authorizedDomains:e}=await kv(n);for(const t of e)try{if(LN(t))return}catch{}Ye(n,"unauthorized-domain")}function LN(n){const e=Eo(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===i}if(!xN.test(t))return!1;if(ON.test(n))return i===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FN=new ua(3e4,6e4);function tm(){const n=ye().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function UN(n){return new Promise((e,t)=>{var i,s,r;function o(){tm(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{tm(),t(We(n,"network-request-failed"))},timeout:FN.get()})}if(!((s=(i=ye().gapi)===null||i===void 0?void 0:i.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((r=ye().gapi)===null||r===void 0)&&r.load)o();else{const a=wv("iframefcb");return ye()[a]=()=>{gapi.load?o():t(We(n,"network-request-failed"))},yv(`https://apis.google.com/js/api.js?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw hc=null,e})}let hc=null;function VN(n){return hc=hc||UN(n),hc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BN=new ua(5e3,15e3),$N="__/auth/iframe",qN="emulator/auth/iframe",jN={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},KN=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function GN(n){const e=n.config;T(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Qd(e,qN):`https://${n.config.authDomain}/${$N}`,i={apiKey:e.apiKey,appName:n.name,v:gi},s=KN.get(n.config.apiHost);s&&(i.eid=s);const r=n._getFrameworks();return r.length&&(i.fw=r.join(",")),`${t}?${ws(i).slice(1)}`}async function WN(n){const e=await VN(n),t=ye().gapi;return T(t,n,"internal-error"),e.open({where:document.body,url:GN(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:jN,dontclear:!0},i=>new Promise(async(s,r)=>{await i.restyle({setHideOnLeave:!1});const o=We(n,"network-request-failed"),a=ye().setTimeout(()=>{r(o)},BN.get());function c(){ye().clearTimeout(a),s(i)}i.ping(c).then(c,()=>{r(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HN={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},zN=500,QN=600,YN="_blank",XN="http://localhost";class nm{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function JN(n,e,t,i=zN,s=QN){const r=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},HN),{width:i.toString(),height:s.toString(),top:r,left:o}),l=pe().toLowerCase();t&&(a=Hw(l)?YN:t),Ww(l)&&(e=e||XN,c.scrollbars="yes");const u=Object.entries(c).reduce((d,[f,p])=>`${d}${f}=${p},`,"");if(AA(l)&&a!=="_self")return ZN(e||"",a),new nm(null);const h=window.open(e||"",a,u);T(h,n,"popup-blocked");try{h.focus()}catch{}return new nm(h)}function ZN(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eP="__/auth/handler",tP="emulator/auth/handler";function Ph(n,e,t,i,s,r){T(n.config.authDomain,n,"auth-domain-config-required"),T(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:gi,eventId:s};if(e instanceof Fn){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",Ic(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,l]of Object.entries(r||{}))o[c]=l}if(e instanceof vr){const c=e.getScopes().filter(l=>l!=="");c.length>0&&(o.scopes=c.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const c of Object.keys(a))a[c]===void 0&&delete a[c];return`${nP(n)}?${ws(a).slice(1)}`}function nP({config:n}){return n.emulator?Qd(n,tP):`https://${n.authDomain}/${eP}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ju="webStorageSupport";class iP{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Xi,this._completeRedirectFn=Ml,this._overrideRedirectResult=af}async _openPopup(e,t,i,s){var r;Qt((r=this.eventManagers[e._key()])===null||r===void 0?void 0:r.manager,"_initialize() not called before _openPopup()");const o=Ph(e,t,i,Eo(),s);return JN(e,o,da())}async _openRedirect(e,t,i,s){return await this._originValidation(e),FR(Ph(e,t,i,Eo(),s)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:r}=this.eventManagers[t];return s?Promise.resolve(s):(Qt(r,"If manager is not set, promise should be"),r)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await WN(e),i=new Sv(e);return t.register("authEvent",s=>(T(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:i.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ju,{type:ju},s=>{var r;const o=(r=s==null?void 0:s[0])===null||r===void 0?void 0:r[ju];o!==void 0&&t(!!o),Ye(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=MN(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Xw()||Yd()||yr()}}const sP=iP;class rP{constructor(e){this.factorId=e}_process(e,t,i){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,i);case"signin":return this._finalizeSignIn(e,t.credential);default:return rn("unexpected MultiFactorSessionType")}}}class cf extends rP{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new cf(e)}_finalizeEnroll(e,t,i){return RR(e,{idToken:t,displayName:i,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return HR(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class Av{constructor(){}static assertion(e){return cf._fromCredential(e)}}Av.FACTOR_ID="phone";var im="@firebase/auth",sm="0.20.5";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oP{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{var s;e(((s=i)===null||s===void 0?void 0:s.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);!t||(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){T(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aP(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function cP(n){Qe(new Y("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),{apiKey:r,authDomain:o}=i.options;return((a,c)=>{T(r&&!r.includes(":"),"invalid-api-key",{appName:a.name}),T(!(o!=null&&o.includes(":")),"argument-error",{appName:a.name});const l={apiKey:r,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Jw(n)},u=new DA(a,c,l);return uA(u,t),u})(i,s)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),Qe(new Y("auth-internal",e=>{const t=Oe(e.getProvider("auth").getImmediate());return(i=>new oP(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),fe(im,sm,aP(n)),fe(im,sm,"esm2017")}cP("Browser");/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ji(){return window}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lP=2e3;async function uP(n,e,t){var i;const{BuildInfo:s}=Ji();Qt(e.sessionId,"AuthEvent did not contain a session ID");const r=await gP(e.sessionId),o={};return yr()?o.ibi=s.packageName:ha()?o.apn=s.packageName:Ye(n,"operation-not-supported-in-this-environment"),s.displayName&&(o.appDisplayName=s.displayName),o.sessionId=r,Ph(n,t,e.type,void 0,(i=e.eventId)!==null&&i!==void 0?i:void 0,o)}async function hP(n){const{BuildInfo:e}=Ji(),t={};yr()?t.iosBundleId=e.packageName:ha()?t.androidPackageName=e.packageName:Ye(n,"operation-not-supported-in-this-environment"),await kv(n,t)}function dP(n){const{cordova:e}=Ji();return new Promise(t=>{e.plugins.browsertab.isAvailable(i=>{let s=null;i?e.plugins.browsertab.openUrl(n):s=e.InAppBrowser.open(n,kA()?"_blank":"_system","location=yes"),t(s)})})}async function fP(n,e,t){const{cordova:i}=Ji();let s=()=>{};try{await new Promise((r,o)=>{let a=null;function c(){var h;r();const d=(h=i.plugins.browsertab)===null||h===void 0?void 0:h.close;typeof d=="function"&&d(),typeof(t==null?void 0:t.close)=="function"&&t.close()}function l(){a||(a=window.setTimeout(()=>{o(We(n,"redirect-cancelled-by-user"))},lP))}function u(){(document==null?void 0:document.visibilityState)==="visible"&&l()}e.addPassiveListener(c),document.addEventListener("resume",l,!1),ha()&&document.addEventListener("visibilitychange",u,!1),s=()=>{e.removePassiveListener(c),document.removeEventListener("resume",l,!1),document.removeEventListener("visibilitychange",u,!1),a&&window.clearTimeout(a)}})}finally{s()}}function pP(n){var e,t,i,s,r,o,a,c,l,u;const h=Ji();T(typeof((e=h==null?void 0:h.universalLinks)===null||e===void 0?void 0:e.subscribe)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),T(typeof((t=h==null?void 0:h.BuildInfo)===null||t===void 0?void 0:t.packageName)!="undefined",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),T(typeof((r=(s=(i=h==null?void 0:h.cordova)===null||i===void 0?void 0:i.plugins)===null||s===void 0?void 0:s.browsertab)===null||r===void 0?void 0:r.openUrl)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),T(typeof((c=(a=(o=h==null?void 0:h.cordova)===null||o===void 0?void 0:o.plugins)===null||a===void 0?void 0:a.browsertab)===null||c===void 0?void 0:c.isAvailable)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),T(typeof((u=(l=h==null?void 0:h.cordova)===null||l===void 0?void 0:l.InAppBrowser)===null||u===void 0?void 0:u.open)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}async function gP(n){const e=mP(n),t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(s=>s.toString(16).padStart(2,"0")).join("")}function mP(n){if(Qt(/[0-9a-zA-Z]+/.test(n),"Can only convert alpha-numeric strings"),typeof TextEncoder!="undefined")return new TextEncoder().encode(n);const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let i=0;i<n.length;i++)t[i]=n.charCodeAt(i);return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _P=20;class yP extends Sv{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}function wP(n,e,t=null){return{type:e,eventId:t,urlResponse:null,sessionId:TP(),postBody:null,tenantId:n.tenantId,error:We(n,"no-auth-event")}}function vP(n,e){return Dh()._set(Oh(n),e)}async function rm(n){const e=await Dh()._get(Oh(n));return e&&await Dh()._remove(Oh(n)),e}function IP(n,e){var t,i;const s=bP(e);if(s.includes("/__/auth/callback")){const r=dc(s),o=r.firebaseError?EP(decodeURIComponent(r.firebaseError)):null,a=(i=(t=o==null?void 0:o.code)===null||t===void 0?void 0:t.split("auth/"))===null||i===void 0?void 0:i[1],c=a?We(a):null;return c?{type:n.type,eventId:n.eventId,tenantId:n.tenantId,error:c,urlResponse:null,sessionId:null,postBody:null}:{type:n.type,eventId:n.eventId,tenantId:n.tenantId,sessionId:n.sessionId,urlResponse:s,postBody:null}}return null}function TP(){const n=[],e="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let t=0;t<_P;t++){const i=Math.floor(Math.random()*e.length);n.push(e.charAt(i))}return n.join("")}function Dh(){return bt(tf)}function Oh(n){return Ki("authEvent",n.config.apiKey,n.name)}function EP(n){try{return JSON.parse(n)}catch{return null}}function bP(n){const e=dc(n),t=e.link?decodeURIComponent(e.link):void 0,i=dc(t).link,s=e.deep_link_id?decodeURIComponent(e.deep_link_id):void 0;return dc(s).link||s||i||t||n}function dc(n){if(!(n!=null&&n.includes("?")))return{};const[e,...t]=n.split("?");return Fs(t.join("?"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SP=500;class CP{constructor(){this._redirectPersistence=Xi,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Ml,this._overrideRedirectResult=af}async _initialize(e){const t=e._key();let i=this.eventManagers.get(t);return i||(i=new yP(e),this.eventManagers.set(t,i),this.attachCallbackListeners(e,i)),i}_openPopup(e){Ye(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,i,s){pP(e);const r=await this._initialize(e);await r.initialized(),r.resetRedirect(),EN(),await this._originValidation(e);const o=wP(e,i,s);await vP(e,o);const a=await uP(e,o,t),c=await dP(a);return fP(e,r,c)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=hP(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:i,handleOpenURL:s,BuildInfo:r}=Ji(),o=setTimeout(async()=>{await rm(e),t.onEvent(om())},SP),a=async u=>{clearTimeout(o);const h=await rm(e);let d=null;h&&(u==null?void 0:u.url)&&(d=IP(h,u.url)),t.onEvent(d||om())};typeof i!="undefined"&&typeof i.subscribe=="function"&&i.subscribe(null,a);const c=s,l=`${r.packageName.toLowerCase()}://`;Ji().handleOpenURL=async u=>{if(u.toLowerCase().startsWith(l)&&a({url:u}),typeof c=="function")try{c(u)}catch(h){console.error(h)}}}}const kP=CP;function om(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:We("no-auth-event")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AP(n,e){Oe(n)._logFramework(e)}var RP="@firebase/auth-compat",NP="0.2.18";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PP=1e3;function so(){var n;return((n=self==null?void 0:self.location)===null||n===void 0?void 0:n.protocol)||null}function DP(){return so()==="http:"||so()==="https:"}function Rv(n=pe()){return!!((so()==="file:"||so()==="ionic:"||so()==="capacitor:")&&n.toLowerCase().match(/iphone|ipad|ipod|android/))}function OP(){return aa()||Xy()}function xP(){return xd()&&(document==null?void 0:document.documentMode)===11}function MP(n=pe()){return/Edge\/\d+/.test(n)}function LP(n=pe()){return xP()||MP(n)}function Nv(){try{const n=self.localStorage,e=da();if(n)return n.setItem(e,"1"),n.removeItem(e),LP()?At():!0}catch{return lf()&&At()}return!1}function lf(){return typeof global!="undefined"&&"WorkerGlobalScope"in global&&"importScripts"in global}function Ku(){return(DP()||oa()||Rv())&&!OP()&&Nv()&&!lf()}function Pv(){return Rv()&&typeof document!="undefined"}async function FP(){return Pv()?new Promise(n=>{const e=setTimeout(()=>{n(!1)},PP);document.addEventListener("deviceready",()=>{clearTimeout(e),n(!0)})}):!1}function UP(){return typeof window!="undefined"?window:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tt={LOCAL:"local",NONE:"none",SESSION:"session"},Fr=T,Dv="persistence";function VP(n,e){if(Fr(Object.values(Tt).includes(e),n,"invalid-persistence-type"),aa()){Fr(e!==Tt.SESSION,n,"unsupported-persistence-type");return}if(Xy()){Fr(e===Tt.NONE,n,"unsupported-persistence-type");return}if(lf()){Fr(e===Tt.NONE||e===Tt.LOCAL&&At(),n,"unsupported-persistence-type");return}Fr(e===Tt.NONE||Nv(),n,"unsupported-persistence-type")}async function xh(n){await n._initializationPromise;const e=Ov(),t=Ki(Dv,n.config.apiKey,n.name);e&&e.setItem(t,n._getPersistence())}function BP(n,e){const t=Ov();if(!t)return[];const i=Ki(Dv,n,e);switch(t.getItem(i)){case Tt.NONE:return[Js];case Tt.LOCAL:return[ko,Xi];case Tt.SESSION:return[Xi];default:return[]}}function Ov(){var n;try{return((n=UP())===null||n===void 0?void 0:n.sessionStorage)||null}catch{return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $P=T;class Hn{constructor(){this.browserResolver=bt(sP),this.cordovaResolver=bt(kP),this.underlyingResolver=null,this._redirectPersistence=Xi,this._completeRedirectFn=Ml,this._overrideRedirectResult=af}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,i,s){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,i,s)}async _openRedirect(e,t,i,s){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,i,s)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Pv()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return $P(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await FP();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xv(n){return n.unwrap()}function qP(n){return n.wrapped()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jP(n){return Mv(n)}function KP(n,e){var t,i;const s=(t=e.customData)===null||t===void 0?void 0:t._tokenResponse;if(((i=e)===null||i===void 0?void 0:i.code)==="auth/multi-factor-auth-required"){const r=e;r.resolver=new GP(n,kR(n,e))}else if(s){const r=Mv(e),o=e;r&&(o.credential=r,o.tenantId=s.tenantId||void 0,o.email=s.email||void 0,o.phoneNumber=s.phoneNumber||void 0)}}function Mv(n){const{_tokenResponse:e}=n instanceof Ke?n.customData:n;if(!e)return null;if(!(n instanceof Ke)&&"temporaryProof"in e&&"phoneNumber"in e)return Wt.credentialFromResult(n);const t=e.providerId;if(!t||t===Lr.PASSWORD)return null;let i;switch(t){case Lr.GOOGLE:i=en;break;case Lr.FACEBOOK:i=Zt;break;case Lr.GITHUB:i=tn;break;case Lr.TWITTER:i=nn;break;default:const{oauthIdToken:s,oauthAccessToken:r,oauthTokenSecret:o,pendingToken:a,nonce:c}=e;return!r&&!o&&!s&&!a?null:a?t.startsWith("saml.")?Zs._create(t,a):fn._fromParams({providerId:t,signInMethod:t,pendingToken:a,idToken:s,accessToken:r}):new qs(t).credential({idToken:s,accessToken:r,rawNonce:c})}return n instanceof Ke?i.credentialFromError(n):i.credentialFromResult(n)}function pt(n,e){return e.catch(t=>{throw t instanceof Ke&&KP(n,t),t}).then(t=>{const i=t.operationType,s=t.user;return{operationType:i,credential:jP(t),additionalUserInfo:CR(t),user:bn.getOrCreate(s)}})}async function Mh(n,e){const t=await e;return{verificationId:t.verificationId,confirm:i=>pt(n,t.confirm(i))}}class GP{constructor(e,t){this.resolver=t,this.auth=qP(e)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return pt(xv(this.auth),this.resolver.resolveSignIn(e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(e){this._delegate=e,this.multiFactor=PR(e)}static getOrCreate(e){return bn.USER_MAP.has(e)||bn.USER_MAP.set(e,new bn(e)),bn.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return pt(this.auth,av(this._delegate,e))}async linkWithPhoneNumber(e,t){return Mh(this.auth,uN(this._delegate,e,t))}async linkWithPopup(e){return pt(this.auth,wN(this._delegate,e,Hn))}async linkWithRedirect(e){return await xh(Oe(this.auth)),AN(this._delegate,e,Hn)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return pt(this.auth,cv(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Mh(this.auth,hN(this._delegate,e,t))}reauthenticateWithPopup(e){return pt(this.auth,yN(this._delegate,e,Hn))}async reauthenticateWithRedirect(e){return await xh(Oe(this.auth)),CN(this._delegate,e,Hn)}sendEmailVerification(e){return gR(this._delegate,e)}async unlink(e){return await tR(this._delegate,e),this}updateEmail(e){return wR(this._delegate,e)}updatePassword(e){return vR(this._delegate,e)}updatePhoneNumber(e){return dN(this._delegate,e)}updateProfile(e){return yR(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return mR(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}bn.USER_MAP=new WeakMap;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ur=T;class Lh{constructor(e,t){if(this.app=e,t.isInitialized()){this._delegate=t.getImmediate(),this.linkUnderlyingAuth();return}const{apiKey:i}=e.options;Ur(i,"invalid-api-key",{appName:e.name}),Ur(i,"invalid-api-key",{appName:e.name});const s=typeof window!="undefined"?Hn:void 0;this._delegate=t.initialize({options:{persistence:WP(i,e.name),popupRedirectResolver:s}}),this._delegate._updateErrorMap(cA),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?bn.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){OA(this._delegate,e,t)}applyActionCode(e){return oR(this._delegate,e)}checkActionCode(e){return lv(this._delegate,e)}confirmPasswordReset(e,t){return rR(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return pt(this._delegate,cR(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return pR(this._delegate,e)}isSignInWithEmailLink(e){return hR(this._delegate,e)}async getRedirectResult(){Ur(Ku(),this._delegate,"operation-not-supported-in-this-environment");const e=await NN(this._delegate,Hn);return e?pt(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){AP(this._delegate,e)}onAuthStateChanged(e,t,i){const{next:s,error:r,complete:o}=am(e,t,i);return this._delegate.onAuthStateChanged(s,r,o)}onIdTokenChanged(e,t,i){const{next:s,error:r,complete:o}=am(e,t,i);return this._delegate.onIdTokenChanged(s,r,o)}sendSignInLinkToEmail(e,t){return uR(this._delegate,e,t)}sendPasswordResetEmail(e,t){return sR(this._delegate,e,t||void 0)}async setPersistence(e){VP(this._delegate,e);let t;switch(e){case Tt.SESSION:t=Xi;break;case Tt.LOCAL:t=await bt(ko)._isAvailable()?ko:tf;break;case Tt.NONE:t=Js;break;default:return Ye("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return pt(this._delegate,eR(this._delegate))}signInWithCredential(e){return pt(this._delegate,Rl(this._delegate,e))}signInWithCustomToken(e){return pt(this._delegate,iR(this._delegate,e))}signInWithEmailAndPassword(e,t){return pt(this._delegate,lR(this._delegate,e,t))}signInWithEmailLink(e,t){return pt(this._delegate,dR(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Mh(this._delegate,lN(this._delegate,e,t))}async signInWithPopup(e){return Ur(Ku(),this._delegate,"operation-not-supported-in-this-environment"),pt(this._delegate,_N(this._delegate,e,Hn))}async signInWithRedirect(e){return Ur(Ku(),this._delegate,"operation-not-supported-in-this-environment"),await xh(this._delegate),bN(this._delegate,e,Hn)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return aR(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}Lh.Persistence=Tt;function am(n,e,t){let i=n;typeof n!="function"&&({next:i,error:e,complete:t}=n);const s=i;return{next:o=>s(o&&bn.getOrCreate(o)),error:e,complete:t}}function WP(n,e){const t=BP(n,e);if(typeof self!="undefined"&&!t.includes(ko)&&t.push(ko),typeof window!="undefined")for(const i of[tf,Xi])t.includes(i)||t.push(i);return t.includes(Js)||t.push(Js),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uf{constructor(){this.providerId="phone",this._delegate=new Wt(xv(Le.auth()))}static credential(e,t){return Wt.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}uf.PHONE_SIGN_IN_METHOD=Wt.PHONE_SIGN_IN_METHOD;uf.PROVIDER_ID=Wt.PROVIDER_ID;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HP=T;class zP{constructor(e,t,i=Le.app()){var s;HP((s=i.options)===null||s===void 0?void 0:s.apiKey,"invalid-api-key",{appName:i.name}),this._delegate=new aN(e,t,i.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QP="auth-compat";function YP(n){n.INTERNAL.registerComponent(new Y(QP,e=>{const t=e.getProvider("app-compat").getImmediate(),i=e.getProvider("auth");return new Lh(t,i)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Ns.EMAIL_SIGNIN,PASSWORD_RESET:Ns.PASSWORD_RESET,RECOVER_EMAIL:Ns.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:Ns.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:Ns.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:Ns.VERIFY_EMAIL}},EmailAuthProvider:mi,FacebookAuthProvider:Zt,GithubAuthProvider:tn,GoogleAuthProvider:en,OAuthProvider:qs,SAMLAuthProvider:Ac,PhoneAuthProvider:uf,PhoneMultiFactorGenerator:Av,RecaptchaVerifier:zP,TwitterAuthProvider:nn,Auth:Lh,AuthCredential:wr,Error:Ke}).setInstantiationMode("LAZY").setMultipleInstances(!1)),n.registerVersion(RP,NP)}YP(Le);const cm="@firebase/database",lm="0.13.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Lv="";function Fv(n){Lv=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XP{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),we(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Md(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Xt(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uv=function(n){try{if(typeof window!="undefined"&&typeof window[n]!="undefined"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new XP(e)}}catch{}return new JP},Ui=Uv("localStorage"),Fh=Uv("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ks=new pi("@firebase/database"),Vv=function(){let n=1;return function(){return n++}}(),Bv=function(n){const e=kC(n),t=new AC;t.update(e);const i=t.digest();return Yy.encodeByteArray(i)},pa=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=pa.apply(null,i):typeof i=="object"?e+=we(i):e+=i,e+=" "}return e};let Wi=null,um=!0;const $v=function(n,e){E(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Ks.logLevel=Ct.VERBOSE,Wi=Ks.log.bind(Ks),e&&Fh.set("logging_enabled",!0)):typeof n=="function"?Wi=n:(Wi=null,Fh.remove("logging_enabled"))},ke=function(...n){if(um===!0&&(um=!1,Wi===null&&Fh.get("logging_enabled")===!0&&$v(!0)),Wi){const e=pa.apply(null,n);Wi(e)}},ga=function(n){return function(...e){ke(n,...e)}},Uh=function(...n){const e="FIREBASE INTERNAL ERROR: "+pa(...n);Ks.error(e)},pn=function(...n){const e=`FIREBASE FATAL ERROR: ${pa(...n)}`;throw Ks.error(e),new Error(e)},et=function(...n){const e="FIREBASE WARNING: "+pa(...n);Ks.warn(e)},ZP=function(){typeof window!="undefined"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&et("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Ll=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},eD=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},Dn="[MIN_NAME]",gn="[MAX_NAME]",Is=function(n,e){if(n===e)return 0;if(n===Dn||e===gn)return-1;if(e===Dn||n===gn)return 1;{const t=Dc(n),i=Dc(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},tD=function(n,e){return n===e?0:n<e?-1:1},Vr=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+we(e))},hf=function(n){if(typeof n!="object"||n===null)return we(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=we(e[i]),t+=":",t+=hf(n[e[i]]);return t+="}",t},qv=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let s=0;s<t;s+=e)s+e>t?i.push(n.substring(s,t)):i.push(n.substring(s,s+e));return i};function xe(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const jv=function(n){E(!Ll(n),"Invalid JSON number");const e=11,t=52,i=(1<<e-1)-1;let s,r,o,a,c;n===0?(r=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-i-t))));const l=[];for(c=t;c;c-=1)l.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)l.push(r%2?1:0),r=Math.floor(r/2);l.push(s?1:0),l.reverse();const u=l.join("");let h="";for(c=0;c<64;c+=8){let d=parseInt(u.substr(c,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},nD=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},iD=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function sD(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}const rD=new RegExp("^-?(0*)\\d{1,10}$"),Kv=-2147483648,df=2147483647,Dc=function(n){if(rD.test(n)){const e=Number(n);if(e>=Kv&&e<=df)return e}return null},Ir=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw et("Exception was thrown by user callback.",t),e},Math.floor(0))}},oD=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ro=function(n,e){const t=setTimeout(n,e);return typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aD{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){et(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cD{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(ke("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',et(e)}}class Gs{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Gs.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ff="5",Gv="v",Wv="s",Hv="r",zv="f",Qv=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Yv="ls",Xv="p",Vh="ac",Jv="websocket",Zv="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eI{constructor(e,t,i,s,r=!1,o="",a=!1){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ui.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ui.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function lD(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function tI(n,e,t){E(typeof e=="string","typeof type must == string"),E(typeof t=="object","typeof params must == object");let i;if(e===Jv)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===Zv)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);lD(n)&&(t.ns=n.namespace);const s=[];return xe(t,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uD{constructor(){this.counters_={}}incrementCounter(e,t=1){Xt(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return PC(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gu={},Wu={};function pf(n){const e=n.toString();return Gu[e]||(Gu[e]=new uD),Gu[e]}function hD(n,e){const t=n.toString();return Wu[t]||(Wu[t]=e()),Wu[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dD{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&Ir(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hm="start",fD="close",pD="pLPCommand",gD="pRTLPCB",nI="id",iI="pw",sI="ser",mD="cb",_D="seg",yD="ts",wD="d",vD="dframe",rI=1870,oI=30,ID=rI-oI,TD=25e3,ED=3e4;class zn{constructor(e,t,i,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ga(e),this.stats_=pf(t),this.urlFn=c=>(this.appCheckToken&&(c[Vh]=this.appCheckToken),tI(t,Zv,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new dD(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(ED)),eD(()=>{if(this.isClosed_)return;this.scriptTagHolder=new gf((...r)=>{const[o,a,c,l,u]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===hm)this.id=a,this.password=c;else if(o===fD)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={};i[hm]="t",i[sI]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[mD]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Gv]=ff,this.transportSessionId&&(i[Wv]=this.transportSessionId),this.lastSessionId&&(i[Yv]=this.lastSessionId),this.applicationId&&(i[Xv]=this.applicationId),this.appCheckToken&&(i[Vh]=this.appCheckToken),typeof location!="undefined"&&location.hostname&&Qv.test(location.hostname)&&(i[Hv]=zv);const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){zn.forceAllow_=!0}static forceDisallow(){zn.forceDisallow_=!0}static isAvailable(){return zn.forceAllow_?!0:!zn.forceDisallow_&&typeof document!="undefined"&&document.createElement!=null&&!nD()&&!iD()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=we(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=DC(t),s=qv(i,ID);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const i={};i[vD]="t",i[nI]=e,i[iI]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=we(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class gf{constructor(e,t,i,s){this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Vv(),window[pD+this.uniqueCallbackIdentifier]=e,window[gD+this.uniqueCallbackIdentifier]=t,this.myIFrame=gf.createIFrame_();let r="";if(this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"){const a=document.domain;r='<script>document.domain="'+a+'";<\/script>'}const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){ke("frame writing exception"),a.stack&&ke(a.stack),ke(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||ke("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[nI]=this.myID,e[iI]=this.myPW,e[sI]=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+oI+i.length<=rI;){const o=this.pendingSegs.shift();i=i+"&"+_D+s+"="+o.seg+"&"+yD+s+"="+o.ts+"&"+wD+s+"="+o.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(TD)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{ke("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bD=16384,SD=45e3;let Oc=null;typeof MozWebSocket!="undefined"?Oc=MozWebSocket:typeof WebSocket!="undefined"&&(Oc=WebSocket);class Pt{constructor(e,t,i,s,r,o,a){this.connId=e,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ga(this.connId),this.stats_=pf(t),this.connURL=Pt.connectionURL_(t,o,a,s,i),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,i,s,r){const o={};return o[Gv]=ff,typeof location!="undefined"&&location.hostname&&Qv.test(location.hostname)&&(o[Hv]=zv),t&&(o[Wv]=t),i&&(o[Yv]=i),s&&(o[Vh]=s),r&&(o[Xv]=r),tI(e,Jv,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ui.set("previous_websocket_failure",!0);try{let i;Jy(),this.mySock=new Oc(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){Pt.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator!="undefined"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(t);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&Oc!==null&&!Pt.forceDisallow_}static previouslyFailed(){return Ui.isInMemoryStorage||Ui.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ui.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const i=Md(t);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(E(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const i=this.extractFrameCount_(t);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const t=we(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=qv(t,bD);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(SD))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Pt.responsesRequiredToBeHealthy=2;Pt.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[zn,Pt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=Pt&&Pt.isAvailable();let i=t&&!Pt.previouslyFailed();if(e.webSocketOnly&&(t||et("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Pt];else{const s=this.transports_=[];for(const r of er.ALL_TRANSPORTS)r&&r.isAvailable()&&s.push(r);er.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}er.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CD=6e4,kD=5e3,AD=10*1024,RD=100*1024,Hu="t",dm="d",ND="s",fm="r",PD="e",pm="o",gm="a",mm="n",_m="p",DD="h";class OD{constructor(e,t,i,s,r,o,a,c,l,u){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=l,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ga("c:"+this.id+":"),this.transportManager_=new er(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=ro(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>RD?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>AD?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Hu in e){const t=e[Hu];t===gm?this.upgradeIfSecondaryHealthy_():t===fm?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===pm&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Vr("t",e),i=Vr("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:_m,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:gm,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:mm,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Vr("t",e),i=Vr("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Vr(Hu,e);if(dm in e){const i=e[dm];if(t===DD)this.onHandshake_(i);else if(t===mm){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===ND?this.onConnectionShutdown_(i):t===fm?this.onReset_(i):t===PD?Uh("Server Error: "+i):t===pm?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Uh("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),ff!==i&&et("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),ro(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(CD))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ro(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(kD))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:_m,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ui.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aI{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cI{constructor(e){this.allowedEvents_=e,this.listeners_={},E(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){E(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xc extends cI{constructor(){super(["online"]),this.online_=!0,typeof window!="undefined"&&typeof window.addEventListener!="undefined"&&!wl()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new xc}getInitialEvent(e){return E(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ym=32,wm=768;class z{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function W(){return new z("")}function V(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ii(n){return n.pieces_.length-n.pieceNum_}function X(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new z(n.pieces_,e)}function mf(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function xD(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Ao(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function lI(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new z(e,0)}function ie(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof z)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new z(t,0)}function B(n){return n.pieceNum_>=n.pieces_.length}function ut(n,e){const t=V(n),i=V(e);if(t===null)return e;if(t===i)return ut(X(n),X(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function MD(n,e){const t=Ao(n,0),i=Ao(e,0);for(let s=0;s<t.length&&s<i.length;s++){const r=Is(t[s],i[s]);if(r!==0)return r}return t.length===i.length?0:t.length<i.length?-1:1}function _f(n,e){if(ii(n)!==ii(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function Dt(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(ii(n)>ii(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class LD{constructor(e,t){this.errorPrefix_=t,this.parts_=Ao(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=vl(this.parts_[i]);uI(this)}}function FD(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=vl(e),uI(n)}function UD(n){const e=n.parts_.pop();n.byteLength_-=vl(e),n.parts_.length>0&&(n.byteLength_-=1)}function uI(n){if(n.byteLength_>wm)throw new Error(n.errorPrefix_+"has a key path longer than "+wm+" bytes ("+n.byteLength_+").");if(n.parts_.length>ym)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ym+") or object contains a cycle "+Ai(n))}function Ai(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yf extends cI{constructor(){super(["visible"]);let e,t;typeof document!="undefined"&&typeof document.addEventListener!="undefined"&&(typeof document.hidden!="undefined"?(t="visibilitychange",e="hidden"):typeof document.mozHidden!="undefined"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden!="undefined"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden!="undefined"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new yf}getInitialEvent(e){return E(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Br=1e3,VD=60*5*1e3,vm=30*1e3,BD=1.3,$D=3e4,qD="server_kill",Im=3;class Rn extends aI{constructor(e,t,i,s,r,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=Rn.nextPersistentConnectionId_++,this.log_=ga("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Br,this.maxReconnectDelay_=VD,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!Jy())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");yf.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&xc.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,i){const s=++this.requestNumber_,r={r:s,a:e,b:t};this.log_(we(r)),E(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();const t=new Ae,i={p:e._path.toString(),q:e._queryObject},s={action:"g",request:i,onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,i,s){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),E(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),E(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:i};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(i)})}sendListen_(e){const t=e.query,i=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+i+" for "+s);const r={p:i},o="q";e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,a=>{const c=a.d,l=a.s;Rn.warnOnListenWarnings_(c,t),(this.listens.get(i)&&this.listens.get(i).get(s))===e&&(this.log_("listen response",a),l!=="ok"&&this.removeListen_(i,s),e.onComplete&&e.onComplete(l,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Xt(e,"w")){const i=zi(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();et(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||RC(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=vm)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=NC(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(t,i,s=>{const r=s.s,o=s.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,i=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,i)})}unlisten(e,t){const i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),E(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,t)}sendUnlisten_(e,t,i,s){this.log_("Unlisten on "+e+" for "+t);const r={p:e},o="n";s&&(r.q=i,r.t=s),this.sendRequest(o,r)}onDisconnectPut(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:i})}onDisconnectMerge(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:i})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,i,s){const r={p:t,d:i};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,i,s){this.putInternal("p",e,t,i,s)}merge(e,t,i,s){this.putInternal("m",e,t,i,s)}putInternal(e,t,i,s,r){this.initConnection_();const o={p:t,d:i};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,i,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(r.s,r.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,i=>{if(i.s!=="ok"){const r=i.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+we(e));const t=e.r,i=this.requestCBHash_[t];i&&(delete this.requestCBHash_[t],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Uh("Unrecognized action received from server: "+we(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){E(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Br,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Br,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>$D&&(this.reconnectDelay_=Br),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*BD)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+Rn.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,i())},l=function(h){E(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(h)};this.realtime_={close:c,sendRequest:l};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,d]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?ke("getToken() completed but was canceled"):(ke("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=d&&d.token,a=new OD(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,i,f=>{et(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(qD)},r))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&et(h),c())}}}interrupt(e){ke("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){ke("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ic(this.interruptReasons_)&&(this.reconnectDelay_=Br,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let i;t?i=t.map(r=>hf(r)).join("$"):i="default";const s=this.removeListen_(e,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const i=new z(e).toString();let s;if(this.listens.has(i)){const r=this.listens.get(i);s=r.get(t),r.delete(t),r.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(e,t){ke("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Im&&(this.reconnectDelay_=vm,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){ke("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Im&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Lv.replace(/\./g,"-")]=1,wl()?e["framework.cordova"]=1:aa()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=xc.getInstance().currentlyOnline();return Ic(this.interruptReasons_)&&e}}Rn.nextPersistentConnectionId_=0;Rn.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ${constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new $(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fl{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new $(Dn,e),s=new $(Dn,t);return this.compare(i,s)!==0}minPost(){return $.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let za;class hI extends Fl{static get __EMPTY_NODE(){return za}static set __EMPTY_NODE(e){za=e}compare(e,t){return Is(e.name,t.name)}isDefinedOn(e){throw ca("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return $.MIN}maxPost(){return new $(gn,za)}makePost(e,t){return E(typeof e=="string","KeyIndex indexValue must always be a string."),new $(e,za)}toString(){return".key"}}const cn=new hI;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qa{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Se{constructor(e,t,i,s,r){this.key=e,this.value=t,this.color=i!=null?i:Se.RED,this.left=s!=null?s:_t.EMPTY_NODE,this.right=r!=null?r:_t.EMPTY_NODE}copy(e,t,i,s,r){return new Se(e!=null?e:this.key,t!=null?t:this.value,i!=null?i:this.color,s!=null?s:this.left,r!=null?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const r=i(e,s.key);return r<0?s=s.copy(null,null,null,s.left.insert(e,t,i),null):r===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return _t.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let i,s;if(i=this,t(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),t(e,i.key)===0){if(i.right.isEmpty())return _t.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Se.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Se.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Se.RED=!0;Se.BLACK=!1;class jD{copy(e,t,i,s,r){return this}insert(e,t,i){return new Se(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class _t{constructor(e,t=_t.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new _t(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Se.BLACK,null,null))}remove(e){return new _t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Se.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Qa(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Qa(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Qa(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Qa(this.root_,null,this.comparator_,!0,e)}}_t.EMPTY_NODE=new jD;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KD(n,e){return Is(n.name,e.name)}function wf(n,e){return Is(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bh;function GD(n){Bh=n}const dI=function(n){return typeof n=="number"?"number:"+jv(n):"string:"+n},fI=function(n){if(n.isLeafNode()){const e=n.val();E(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Xt(e,".sv"),"Priority must be a string or number.")}else E(n===Bh||n.isEmpty(),"priority of unexpected type.");E(n===Bh||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tm;class Te{constructor(e,t=Te.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,E(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),fI(this.priorityNode_)}static set __childrenNodeConstructor(e){Tm=e}static get __childrenNodeConstructor(){return Tm}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Te(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Te.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return B(e)?this:V(e)===".priority"?this.priorityNode_:Te.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Te.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const i=V(e);return i===null?t:t.isEmpty()&&i!==".priority"?this:(E(i!==".priority"||ii(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,Te.__childrenNodeConstructor.EMPTY_NODE.updateChild(X(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+dI(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=jv(this.value_):e+=this.value_,this.lazyHash_=Bv(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Te.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Te.__childrenNodeConstructor?-1:(E(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,i=typeof this.value_,s=Te.VALUE_TYPE_ORDER.indexOf(t),r=Te.VALUE_TYPE_ORDER.indexOf(i);return E(s>=0,"Unknown leaf type: "+t),E(r>=0,"Unknown leaf type: "+i),s===r?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Te.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pI,gI;function WD(n){pI=n}function HD(n){gI=n}class zD extends Fl{compare(e,t){const i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return r===0?Is(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return $.MIN}maxPost(){return new $(gn,new Te("[PRIORITY-POST]",gI))}makePost(e,t){const i=pI(e);return new $(t,new Te("[PRIORITY-POST]",i))}toString(){return".priority"}}const ee=new zD;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QD=Math.log(2);class YD{constructor(e){const t=r=>parseInt(Math.log(r)/QD,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Mc=function(n,e,t,i){n.sort(e);const s=function(c,l){const u=l-c;let h,d;if(u===0)return null;if(u===1)return h=n[c],d=t?t(h):h,new Se(d,h.node,Se.BLACK,null,null);{const f=parseInt(u/2,10)+c,p=s(c,f),_=s(f+1,l);return h=n[f],d=t?t(h):h,new Se(d,h.node,Se.BLACK,p,_)}},r=function(c){let l=null,u=null,h=n.length;const d=function(p,_){const v=h-p,R=h;h-=p;const x=s(v+1,R),A=n[v],M=t?t(A):A;f(new Se(M,A.node,_,null,x))},f=function(p){l?(l.left=p,l=p):(u=p,l=p)};for(let p=0;p<c.count;++p){const _=c.nextBitIsOne(),v=Math.pow(2,c.count-(p+1));_?d(v,Se.BLACK):(d(v,Se.BLACK),d(v,Se.RED))}return u},o=new YD(n.length),a=r(o);return new _t(i||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zu;const Ps={};class Sn{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return E(Ps&&ee,"ChildrenNode.ts has not been loaded"),zu=zu||new Sn({".priority":Ps},{".priority":ee}),zu}get(e){const t=zi(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof _t?t:null}hasIndex(e){return Xt(this.indexSet_,e.toString())}addIndex(e,t){E(e!==cn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=t.getIterator($.Wrap);let o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=Mc(i,e.getCompare()):a=Ps;const c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;const u=Object.assign({},this.indexes_);return u[c]=a,new Sn(u,l)}addToIndexes(e,t){const i=Tc(this.indexes_,(s,r)=>{const o=zi(this.indexSet_,r);if(E(o,"Missing index implementation for "+r),s===Ps)if(o.isDefinedOn(e.node)){const a=[],c=t.getIterator($.Wrap);let l=c.getNext();for(;l;)l.name!==e.name&&a.push(l),l=c.getNext();return a.push(e),Mc(a,o.getCompare())}else return Ps;else{const a=t.get(e.name);let c=s;return a&&(c=c.remove(new $(e.name,a))),c.insert(e,e.node)}});return new Sn(i,this.indexSet_)}removeFromIndexes(e,t){const i=Tc(this.indexes_,s=>{if(s===Ps)return s;{const r=t.get(e.name);return r?s.remove(new $(e.name,r)):s}});return new Sn(i,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $r;class N{constructor(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&fI(this.priorityNode_),this.children_.isEmpty()&&E(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return $r||($r=new N(new _t(wf),null,Sn.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||$r}updatePriority(e){return this.children_.isEmpty()?this:new N(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?$r:t}}getChild(e){const t=V(e);return t===null?this:this.getImmediateChild(t).getChild(X(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(E(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const i=new $(e,t);let s,r;t.isEmpty()?(s=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_));const o=s.isEmpty()?$r:this.priorityNode_;return new N(s,o,r)}}updateChild(e,t){const i=V(e);if(i===null)return t;{E(V(e)!==".priority"||ii(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(X(e),t);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let i=0,s=0,r=!0;if(this.forEachChild(ee,(o,a)=>{t[o]=a.val(e),i++,r&&N.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):r=!1}),!e&&r&&s<2*i){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+dI(this.getPriority().val())+":"),this.forEachChild(ee,(t,i)=>{const s=i.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":Bv(e)}return this.lazyHash_}getPredecessorChildName(e,t,i){const s=this.resolveIndex_(i);if(s){const r=s.getPredecessorKey(new $(e,t));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new $(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new $(t,this.children_.get(t)):null}forEachChild(e,t){const i=this.resolveIndex_(e);return i?i.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,$.Wrap);let r=s.peek();for(;r!=null&&t.compare(r,e)<0;)s.getNext(),r=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,$.Wrap);let r=s.peek();for(;r!=null&&t.compare(r,e)>0;)s.getNext(),r=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ma?-1:0}withIndex(e){if(e===cn||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new N(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===cn||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const i=this.getIterator(ee),s=t.getIterator(ee);let r=i.getNext(),o=s.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=i.getNext(),o=s.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===cn?null:this.indexMap_.get(e.toString())}}N.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class XD extends N{constructor(){super(new _t(wf),N.EMPTY_NODE,Sn.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return N.EMPTY_NODE}isEmpty(){return!1}}const ma=new XD;Object.defineProperties($,{MIN:{value:new $(Dn,N.EMPTY_NODE)},MAX:{value:new $(gn,ma)}});hI.__EMPTY_NODE=N.EMPTY_NODE;Te.__childrenNodeConstructor=N;GD(ma);HD(ma);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JD=!0;function re(n,e=null){if(n===null)return N.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),E(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Te(t,re(e))}if(!(n instanceof Array)&&JD){const t=[];let i=!1;if(xe(n,(o,a)=>{if(o.substring(0,1)!=="."){const c=re(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),t.push(new $(o,c)))}}),t.length===0)return N.EMPTY_NODE;const r=Mc(t,KD,o=>o.name,wf);if(i){const o=Mc(t,ee.getCompare());return new N(r,re(e),new Sn({".priority":o},{".priority":ee}))}else return new N(r,re(e),Sn.Default)}else{let t=N.EMPTY_NODE;return xe(n,(i,s)=>{if(Xt(n,i)&&i.substring(0,1)!=="."){const r=re(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(re(e))}}WD(re);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vf extends Fl{constructor(e){super(),this.indexPath_=e,E(!B(e)&&V(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return r===0?Is(e.name,t.name):r}makePost(e,t){const i=re(e),s=N.EMPTY_NODE.updateChild(this.indexPath_,i);return new $(t,s)}maxPost(){const e=N.EMPTY_NODE.updateChild(this.indexPath_,ma);return new $(gn,e)}toString(){return Ao(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZD extends Fl{compare(e,t){const i=e.node.compareTo(t.node);return i===0?Is(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return $.MIN}maxPost(){return $.MAX}makePost(e,t){const i=re(e);return new $(t,i)}toString(){return".value"}}const If=new ZD;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tr="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",$h="-",mI="z",_I=786,eO=function(){let n=0;const e=[];return function(t){const i=t===n;n=t;let s;const r=new Array(8);for(s=7;s>=0;s--)r[s]=tr.charAt(t%64),t=Math.floor(t/64);E(t===0,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=tr.charAt(e[s]);return E(o.length===20,"nextPushId: Length should be 20."),o}}(),Em=function(n){if(n===""+df)return $h;const e=Dc(n);if(e!=null)return""+(e+1);const t=new Array(n.length);for(let o=0;o<t.length;o++)t[o]=n.charAt(o);if(t.length<_I)return t.push($h),t.join("");let i=t.length-1;for(;i>=0&&t[i]===mI;)i--;if(i===-1)return gn;const s=t[i],r=tr.charAt(tr.indexOf(s)+1);return t[i]=r,t.slice(0,i+1).join("")},bm=function(n){if(n===""+Kv)return Dn;const e=Dc(n);if(e!=null)return""+(e-1);const t=new Array(n.length);for(let i=0;i<t.length;i++)t[i]=n.charAt(i);return t[t.length-1]===$h?t.length===1?""+df:(delete t[t.length-1],t.join("")):(t[t.length-1]=tr.charAt(tr.indexOf(t[t.length-1])-1),t.join("")+mI.repeat(_I-t.length))};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yI(n){return{type:"value",snapshotNode:n}}function nr(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Ro(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function No(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function tO(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e){this.index_=e}updateChild(e,t,i,s,r,o){E(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(Ro(t,a)):E(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(nr(t,i)):o.trackChildChange(No(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(ee,(s,r)=>{t.hasChild(s)||i.trackChildChange(Ro(s,r))}),t.isLeafNode()||t.forEachChild(ee,(s,r)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(No(s,r,o))}else i.trackChildChange(nr(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?N.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Po{constructor(e){this.indexedFilter_=new Tf(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Po.getStartPost_(e),this.endPost_=Po.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,i,s,r,o){return this.matches(new $(t,i))||(i=N.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,r,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=N.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(N.EMPTY_NODE);const r=this;return t.forEachChild(ee,(o,a)=>{r.matches(new $(o,a))||(s=s.updateImmediateChild(o,N.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nO{constructor(e){this.rangedFilter_=new Po(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,i,s,r,o){return this.rangedFilter_.matches(new $(t,i))||(i=N.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,r,o):this.fullLimitUpdateChild_(e,t,i,r,o)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=N.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=N.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();let c;if(this.reverse_?c=this.index_.compare(this.rangedFilter_.getStartPost(),a)<=0:c=this.index_.compare(a,this.rangedFilter_.getEndPost())<=0,c)s=s.updateImmediateChild(a.name,a.node),o++;else break}}else{s=t.withIndex(this.index_),s=s.updatePriority(N.EMPTY_NODE);let r,o,a,c;if(this.reverse_){c=s.getReverseIterator(this.index_),r=this.rangedFilter_.getEndPost(),o=this.rangedFilter_.getStartPost();const h=this.index_.getCompare();a=(d,f)=>h(f,d)}else c=s.getIterator(this.index_),r=this.rangedFilter_.getStartPost(),o=this.rangedFilter_.getEndPost(),a=this.index_.getCompare();let l=0,u=!1;for(;c.hasNext();){const h=c.getNext();!u&&a(r,h)<=0&&(u=!0),u&&l<this.limit_&&a(h,o)<=0?l++:s=s.updateImmediateChild(h.name,N.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,r){let o;if(this.reverse_){const h=this.index_.getCompare();o=(d,f)=>h(f,d)}else o=this.index_.getCompare();const a=e;E(a.numChildren()===this.limit_,"");const c=new $(t,i),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(a.hasChild(t)){const h=a.getImmediateChild(t);let d=s.getChildAfterChild(this.index_,l,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=s.getChildAfterChild(this.index_,d,this.reverse_);const f=d==null?1:o(d,c);if(u&&!i.isEmpty()&&f>=0)return r!=null&&r.trackChildChange(No(t,i,h)),a.updateImmediateChild(t,i);{r!=null&&r.trackChildChange(Ro(t,h));const _=a.updateImmediateChild(t,N.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(r!=null&&r.trackChildChange(nr(d.name,d.node)),_.updateImmediateChild(d.name,d.node)):_}}else return i.isEmpty()?e:u&&o(l,c)>=0?(r!=null&&(r.trackChildChange(Ro(l.name,l.node)),r.trackChildChange(nr(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(l.name,N.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ul{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=ee}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return E(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return E(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Dn}hasEnd(){return this.endSet_}getIndexEndValue(){return E(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return E(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:gn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return E(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===ee}copy(){const e=new Ul;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function iO(n){return n.loadsAllData()?new Tf(n.getIndex()):n.hasLimit()?new nO(n):new Po(n)}function sO(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function rO(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function qh(n,e,t){const i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function oO(n,e,t){let i;if(n.index_===cn)typeof e=="string"&&(e=Em(e)),i=qh(n,e,t);else{let s;t==null?s=gn:s=Em(t),i=qh(n,e,s)}return i.startAfterSet_=!0,i}function jh(n,e,t){const i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function aO(n,e,t){let i,s;return n.index_===cn?(typeof e=="string"&&(e=bm(e)),s=jh(n,e,t)):(t==null?i=Dn:i=bm(t),s=jh(n,e,i)),s.endBeforeSet_=!0,s}function Vl(n,e){const t=n.copy();return t.index_=e,t}function Sm(n){const e={};if(n.isDefault())return e;let t;return n.index_===ee?t="$priority":n.index_===If?t="$value":n.index_===cn?t="$key":(E(n.index_ instanceof vf,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=we(t),n.startSet_&&(e.startAt=we(n.indexStartValue_),n.startNameSet_&&(e.startAt+=","+we(n.indexStartName_))),n.endSet_&&(e.endAt=we(n.indexEndValue_),n.endNameSet_&&(e.endAt+=","+we(n.indexEndName_))),n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function Cm(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_)),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_)),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==ee&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lc extends aI{constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=ga("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(E(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,s){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=Lc.getListenId_(e,i),a={};this.listens_[o]=a;const c=Sm(e._queryParams);this.restRequest_(r+".json",c,(l,u)=>{let h=u;if(l===404&&(h=null,l=null),l===null&&this.onDataUpdate_(r,h,!1,i),zi(this.listens_,o)===a){let d;l?l===401?d="permission_denied":d="rest_error:"+l:d="ok",s(d,null)}})}unlisten(e,t){const i=Lc.getListenId_(e,t);delete this.listens_[i]}get(e){const t=Sm(e._queryParams),i=e._path.toString(),s=new Ae;return this.restRequest_(i+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ws(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=Md(a.responseText)}catch{et("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else a.status!==401&&a.status!==404&&et("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cO{constructor(){this.rootNode_=N.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fc(){return{value:null,children:new Map}}function Tr(n,e,t){if(B(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const i=V(e);n.children.has(i)||n.children.set(i,Fc());const s=n.children.get(i);e=X(e),Tr(s,e,t)}}function Kh(n,e){if(B(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(ee,(i,s)=>{Tr(n,new z(i),s)}),Kh(n,e)}}else if(n.children.size>0){const t=V(e);return e=X(e),n.children.has(t)&&Kh(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Gh(n,e,t){n.value!==null?t(e,n.value):lO(n,(i,s)=>{const r=new z(e.toString()+"/"+i);Gh(s,r,t)})}function lO(n,e){n.children.forEach((t,i)=>{e(i,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uO{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&xe(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const km=10*1e3,hO=30*1e3,dO=5*60*1e3;class fO{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new uO(e);const i=km+(hO-km)*Math.random();ro(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;xe(e,(s,r)=>{r>0&&Xt(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),ro(this.reportStats_.bind(this),Math.floor(Math.random()*2*dO))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Kt;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Kt||(Kt={}));function Ef(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function bf(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Sf(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uc{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Kt.ACK_USER_WRITE,this.source=Ef()}operationForChild(e){if(B(this.path)){if(this.affectedTree.value!=null)return E(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new z(e));return new Uc(W(),t,this.revert)}}else return E(V(this.path)===e,"operationForChild called for unrelated child."),new Uc(X(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{constructor(e,t){this.source=e,this.path=t,this.type=Kt.LISTEN_COMPLETE}operationForChild(e){return B(this.path)?new Do(this.source,W()):new Do(this.source,X(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zi{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Kt.OVERWRITE}operationForChild(e){return B(this.path)?new Zi(this.source,W(),this.snap.getImmediateChild(e)):new Zi(this.source,X(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ir{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Kt.MERGE}operationForChild(e){if(B(this.path)){const t=this.children.subtree(new z(e));return t.isEmpty()?null:t.value?new Zi(this.source,W(),t.value):new ir(this.source,W(),t)}else return E(V(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new ir(this.source,X(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class si{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(B(e))return this.isFullyInitialized()&&!this.filtered_;const t=V(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pO{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function gO(n,e,t,i){const s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(tO(o.childName,o.snapshotNode))}),qr(n,s,"child_removed",e,i,t),qr(n,s,"child_added",e,i,t),qr(n,s,"child_moved",r,i,t),qr(n,s,"child_changed",e,i,t),qr(n,s,"value",e,i,t),s}function qr(n,e,t,i,s,r){const o=i.filter(a=>a.type===t);o.sort((a,c)=>_O(n,a,c)),o.forEach(a=>{const c=mO(n,a,r);s.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(c,n.query_))})})}function mO(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function _O(n,e,t){if(e.childName==null||t.childName==null)throw ca("Should only compare child_ events.");const i=new $(e.childName,e.snapshotNode),s=new $(t.childName,t.snapshotNode);return n.index_.compare(i,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bl(n,e){return{eventCache:n,serverCache:e}}function oo(n,e,t,i){return Bl(new si(e,t,i),n.serverCache)}function wI(n,e,t,i){return Bl(n.eventCache,new si(e,t,i))}function Vc(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function es(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Qu;const yO=()=>(Qu||(Qu=new _t(tD)),Qu);class J{constructor(e,t=yO()){this.value=e,this.children=t}static fromObject(e){let t=new J(null);return xe(e,(i,s)=>{t=t.set(new z(i),s)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:W(),value:this.value};if(B(e))return null;{const i=V(e),s=this.children.get(i);if(s!==null){const r=s.findRootMostMatchingPathAndValue(X(e),t);return r!=null?{path:ie(new z(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(B(e))return this;{const t=V(e),i=this.children.get(t);return i!==null?i.subtree(X(e)):new J(null)}}set(e,t){if(B(e))return new J(t,this.children);{const i=V(e),r=(this.children.get(i)||new J(null)).set(X(e),t),o=this.children.insert(i,r);return new J(this.value,o)}}remove(e){if(B(e))return this.children.isEmpty()?new J(null):new J(null,this.children);{const t=V(e),i=this.children.get(t);if(i){const s=i.remove(X(e));let r;return s.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,s),this.value===null&&r.isEmpty()?new J(null):new J(this.value,r)}else return this}}get(e){if(B(e))return this.value;{const t=V(e),i=this.children.get(t);return i?i.get(X(e)):null}}setTree(e,t){if(B(e))return t;{const i=V(e),r=(this.children.get(i)||new J(null)).setTree(X(e),t);let o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new J(this.value,o)}}fold(e){return this.fold_(W(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(ie(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,W(),t)}findOnPath_(e,t,i){const s=this.value?i(t,this.value):!1;if(s)return s;if(B(e))return null;{const r=V(e),o=this.children.get(r);return o?o.findOnPath_(X(e),ie(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,W(),t)}foreachOnPath_(e,t,i){if(B(e))return this;{this.value&&i(t,this.value);const s=V(e),r=this.children.get(s);return r?r.foreachOnPath_(X(e),ie(t,s),i):new J(null)}}foreach(e){this.foreach_(W(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(ie(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ht{constructor(e){this.writeTree_=e}static empty(){return new Ht(new J(null))}}function ao(n,e,t){if(B(e))return new Ht(new J(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){const s=i.path;let r=i.value;const o=ut(s,e);return r=r.updateChild(o,t),new Ht(n.writeTree_.set(s,r))}else{const s=new J(t),r=n.writeTree_.setTree(e,s);return new Ht(r)}}}function Wh(n,e,t){let i=n;return xe(t,(s,r)=>{i=ao(i,ie(e,s),r)}),i}function Am(n,e){if(B(e))return Ht.empty();{const t=n.writeTree_.setTree(e,new J(null));return new Ht(t)}}function Hh(n,e){return Ts(n,e)!=null}function Ts(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(ut(t.path,e)):null}function Rm(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(ee,(i,s)=>{e.push(new $(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new $(i,s.value))}),e}function Xn(n,e){if(B(e))return n;{const t=Ts(n,e);return t!=null?new Ht(new J(t)):new Ht(n.writeTree_.subtree(e))}}function zh(n){return n.writeTree_.isEmpty()}function sr(n,e){return vI(W(),n.writeTree_,e)}function vI(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(E(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):t=vI(ie(n,s),r,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(ie(n,".priority"),i)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $l(n,e){return bI(e,n)}function wO(n,e,t,i,s){E(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=ao(n.visibleWrites,e,t)),n.lastWriteId=i}function vO(n,e,t,i){E(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=Wh(n.visibleWrites,e,t),n.lastWriteId=i}function IO(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}function TO(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);E(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&EO(a,i.path)?s=!1:Dt(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return bO(n),!0;if(i.snap)n.visibleWrites=Am(n.visibleWrites,i.path);else{const a=i.children;xe(a,c=>{n.visibleWrites=Am(n.visibleWrites,ie(i.path,c))})}return!0}else return!1}function EO(n,e){if(n.snap)return Dt(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Dt(ie(n.path,t),e))return!0;return!1}function bO(n){n.visibleWrites=II(n.allWrites,SO,W()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function SO(n){return n.visible}function II(n,e,t){let i=Ht.empty();for(let s=0;s<n.length;++s){const r=n[s];if(e(r)){const o=r.path;let a;if(r.snap)Dt(t,o)?(a=ut(t,o),i=ao(i,a,r.snap)):Dt(o,t)&&(a=ut(o,t),i=ao(i,W(),r.snap.getChild(a)));else if(r.children){if(Dt(t,o))a=ut(t,o),i=Wh(i,a,r.children);else if(Dt(o,t))if(a=ut(o,t),B(a))i=Wh(i,W(),r.children);else{const c=zi(r.children,V(a));if(c){const l=c.getChild(X(a));i=ao(i,W(),l)}}}else throw ca("WriteRecord should have .snap or .children")}}return i}function TI(n,e,t,i,s){if(!i&&!s){const r=Ts(n.visibleWrites,e);if(r!=null)return r;{const o=Xn(n.visibleWrites,e);if(zh(o))return t;if(t==null&&!Hh(o,W()))return null;{const a=t||N.EMPTY_NODE;return sr(o,a)}}}else{const r=Xn(n.visibleWrites,e);if(!s&&zh(r))return t;if(!s&&t==null&&!Hh(r,W()))return null;{const o=function(l){return(l.visible||s)&&(!i||!~i.indexOf(l.writeId))&&(Dt(l.path,e)||Dt(e,l.path))},a=II(n.allWrites,o,e),c=t||N.EMPTY_NODE;return sr(a,c)}}}function CO(n,e,t){let i=N.EMPTY_NODE;const s=Ts(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(ee,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(t){const r=Xn(n.visibleWrites,e);return t.forEachChild(ee,(o,a)=>{const c=sr(Xn(r,new z(o)),a);i=i.updateImmediateChild(o,c)}),Rm(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{const r=Xn(n.visibleWrites,e);return Rm(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function kO(n,e,t,i,s){E(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=ie(e,t);if(Hh(n.visibleWrites,r))return null;{const o=Xn(n.visibleWrites,r);return zh(o)?s.getChild(t):sr(o,s.getChild(t))}}function AO(n,e,t,i){const s=ie(e,t),r=Ts(n.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(t)){const o=Xn(n.visibleWrites,s);return sr(o,i.getNode().getImmediateChild(t))}else return null}function RO(n,e){return Ts(n.visibleWrites,e)}function NO(n,e,t,i,s,r,o){let a;const c=Xn(n.visibleWrites,e),l=Ts(c,W());if(l!=null)a=l;else if(t!=null)a=sr(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const u=[],h=o.getCompare(),d=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let f=d.getNext();for(;f&&u.length<s;)h(f,i)!==0&&u.push(f),f=d.getNext();return u}else return[]}function PO(){return{visibleWrites:Ht.empty(),allWrites:[],lastWriteId:-1}}function Bc(n,e,t,i){return TI(n.writeTree,n.treePath,e,t,i)}function Cf(n,e){return CO(n.writeTree,n.treePath,e)}function Nm(n,e,t,i){return kO(n.writeTree,n.treePath,e,t,i)}function $c(n,e){return RO(n.writeTree,ie(n.treePath,e))}function DO(n,e,t,i,s,r){return NO(n.writeTree,n.treePath,e,t,i,s,r)}function kf(n,e,t){return AO(n.writeTree,n.treePath,e,t)}function EI(n,e){return bI(ie(n.treePath,e),n.writeTree)}function bI(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OO{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;E(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),E(i!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const r=s.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(i,No(i,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(i,Ro(i,s.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(i,nr(i,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(i,No(i,e.snapshotNode,s.oldSnap));else throw ca("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xO{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}}const SI=new xO;class Af{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new si(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return kf(this.writes_,e,i)}}getChildAfterChild(e,t,i){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:es(this.viewCache_),r=DO(this.writes_,s,t,1,i,e);return r.length===0?null:r[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MO(n){return{filter:n}}function LO(n,e){E(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),E(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function FO(n,e,t,i,s){const r=new OO;let o,a;if(t.type===Kt.OVERWRITE){const l=t;l.source.fromUser?o=Qh(n,e,l.path,l.snap,i,s,r):(E(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!B(l.path),o=qc(n,e,l.path,l.snap,i,s,a,r))}else if(t.type===Kt.MERGE){const l=t;l.source.fromUser?o=VO(n,e,l.path,l.children,i,s,r):(E(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=Yh(n,e,l.path,l.children,i,s,a,r))}else if(t.type===Kt.ACK_USER_WRITE){const l=t;l.revert?o=qO(n,e,l.path,i,s,r):o=BO(n,e,l.path,l.affectedTree,i,s,r)}else if(t.type===Kt.LISTEN_COMPLETE)o=$O(n,e,t.path,i,r);else throw ca("Unknown operation type: "+t.type);const c=r.getChanges();return UO(e,o,c),{viewCache:o,changes:c}}function UO(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Vc(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(yI(Vc(e)))}}function CI(n,e,t,i,s,r){const o=e.eventCache;if($c(i,t)!=null)return e;{let a,c;if(B(t))if(E(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const l=es(e),u=l instanceof N?l:N.EMPTY_NODE,h=Cf(i,u);a=n.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const l=Bc(i,es(e));a=n.filter.updateFullNode(e.eventCache.getNode(),l,r)}else{const l=V(t);if(l===".priority"){E(ii(t)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const h=Nm(i,t,u,c);h!=null?a=n.filter.updatePriority(u,h):a=o.getNode()}else{const u=X(t);let h;if(o.isCompleteForChild(l)){c=e.serverCache.getNode();const d=Nm(i,t,o.getNode(),c);d!=null?h=o.getNode().getImmediateChild(l).updateChild(u,d):h=o.getNode().getImmediateChild(l)}else h=kf(i,l,e.serverCache);h!=null?a=n.filter.updateChild(o.getNode(),l,h,u,s,r):a=o.getNode()}}return oo(e,a,o.isFullyInitialized()||B(t),n.filter.filtersNodes())}}function qc(n,e,t,i,s,r,o,a){const c=e.serverCache;let l;const u=o?n.filter:n.filter.getIndexedFilter();if(B(t))l=u.updateFullNode(c.getNode(),i,null);else if(u.filtersNodes()&&!c.isFiltered()){const f=c.getNode().updateChild(t,i);l=u.updateFullNode(c.getNode(),f,null)}else{const f=V(t);if(!c.isCompleteForPath(t)&&ii(t)>1)return e;const p=X(t),v=c.getNode().getImmediateChild(f).updateChild(p,i);f===".priority"?l=u.updatePriority(c.getNode(),v):l=u.updateChild(c.getNode(),f,v,p,SI,null)}const h=wI(e,l,c.isFullyInitialized()||B(t),u.filtersNodes()),d=new Af(s,h,r);return CI(n,h,t,s,d,a)}function Qh(n,e,t,i,s,r,o){const a=e.eventCache;let c,l;const u=new Af(s,e,r);if(B(t))l=n.filter.updateFullNode(e.eventCache.getNode(),i,o),c=oo(e,l,!0,n.filter.filtersNodes());else{const h=V(t);if(h===".priority")l=n.filter.updatePriority(e.eventCache.getNode(),i),c=oo(e,l,a.isFullyInitialized(),a.isFiltered());else{const d=X(t),f=a.getNode().getImmediateChild(h);let p;if(B(d))p=i;else{const _=u.getCompleteChild(h);_!=null?mf(d)===".priority"&&_.getChild(lI(d)).isEmpty()?p=_:p=_.updateChild(d,i):p=N.EMPTY_NODE}if(f.equals(p))c=e;else{const _=n.filter.updateChild(a.getNode(),h,p,d,u,o);c=oo(e,_,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function Pm(n,e){return n.eventCache.isCompleteForChild(e)}function VO(n,e,t,i,s,r,o){let a=e;return i.foreach((c,l)=>{const u=ie(t,c);Pm(e,V(u))&&(a=Qh(n,a,u,l,s,r,o))}),i.foreach((c,l)=>{const u=ie(t,c);Pm(e,V(u))||(a=Qh(n,a,u,l,s,r,o))}),a}function Dm(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function Yh(n,e,t,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,l;B(t)?l=i:l=new J(null).setTree(t,i);const u=e.serverCache.getNode();return l.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){const f=e.serverCache.getNode().getImmediateChild(h),p=Dm(n,f,d);c=qc(n,c,new z(h),p,s,r,o,a)}}),l.children.inorderTraversal((h,d)=>{const f=!e.serverCache.isCompleteForChild(h)&&d.value===void 0;if(!u.hasChild(h)&&!f){const p=e.serverCache.getNode().getImmediateChild(h),_=Dm(n,p,d);c=qc(n,c,new z(h),_,s,r,o,a)}}),c}function BO(n,e,t,i,s,r,o){if($c(s,t)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(i.value!=null){if(B(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return qc(n,e,t,c.getNode().getChild(t),s,r,a,o);if(B(t)){let l=new J(null);return c.getNode().forEachChild(cn,(u,h)=>{l=l.set(new z(u),h)}),Yh(n,e,t,l,s,r,a,o)}else return e}else{let l=new J(null);return i.foreach((u,h)=>{const d=ie(t,u);c.isCompleteForPath(d)&&(l=l.set(u,c.getNode().getChild(d)))}),Yh(n,e,t,l,s,r,a,o)}}function $O(n,e,t,i,s){const r=e.serverCache,o=wI(e,r.getNode(),r.isFullyInitialized()||B(t),r.isFiltered());return CI(n,o,t,i,SI,s)}function qO(n,e,t,i,s,r){let o;if($c(i,t)!=null)return e;{const a=new Af(i,e,s),c=e.eventCache.getNode();let l;if(B(t)||V(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Bc(i,es(e));else{const h=e.serverCache.getNode();E(h instanceof N,"serverChildren would be complete if leaf node"),u=Cf(i,h)}u=u,l=n.filter.updateFullNode(c,u,r)}else{const u=V(t);let h=kf(i,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=c.getImmediateChild(u)),h!=null?l=n.filter.updateChild(c,u,h,X(t),a,r):e.eventCache.getNode().hasChild(u)?l=n.filter.updateChild(c,u,N.EMPTY_NODE,X(t),a,r):l=c,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Bc(i,es(e)),o.isLeafNode()&&(l=n.filter.updateFullNode(l,o,r)))}return o=e.serverCache.isFullyInitialized()||$c(i,W())!=null,oo(e,l,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jO{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new Tf(i.getIndex()),r=iO(i);this.processor_=MO(r);const o=t.serverCache,a=t.eventCache,c=s.updateFullNode(N.EMPTY_NODE,o.getNode(),null),l=r.updateFullNode(N.EMPTY_NODE,a.getNode(),null),u=new si(c,o.isFullyInitialized(),s.filtersNodes()),h=new si(l,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Bl(h,u),this.eventGenerator_=new pO(this.query_)}get query(){return this.query_}}function KO(n){return n.viewCache_.serverCache.getNode()}function GO(n){return Vc(n.viewCache_)}function WO(n,e){const t=es(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!B(e)&&!t.getImmediateChild(V(e)).isEmpty())?t.getChild(e):null}function Om(n){return n.eventRegistrations_.length===0}function HO(n,e){n.eventRegistrations_.push(e)}function xm(n,e,t){const i=[];if(t){E(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function Mm(n,e,t,i){e.type===Kt.MERGE&&e.source.queryId!==null&&(E(es(n.viewCache_),"We should always have a full cache before handling merges"),E(Vc(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,r=FO(n.processor_,s,e,t,i);return LO(n.processor_,r.viewCache),E(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,kI(n,r.changes,r.viewCache.eventCache.getNode(),null)}function zO(n,e){const t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(ee,(r,o)=>{i.push(nr(r,o))}),t.isFullyInitialized()&&i.push(yI(t.getNode())),kI(n,i,t.getNode(),e)}function kI(n,e,t,i){const s=i?[i]:n.eventRegistrations_;return gO(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jc;class AI{constructor(){this.views=new Map}}function QO(n){E(!jc,"__referenceConstructor has already been defined"),jc=n}function YO(){return E(jc,"Reference.ts has not been loaded"),jc}function XO(n){return n.views.size===0}function Rf(n,e,t,i){const s=e.source.queryId;if(s!==null){const r=n.views.get(s);return E(r!=null,"SyncTree gave us an op for an invalid query."),Mm(r,e,t,i)}else{let r=[];for(const o of n.views.values())r=r.concat(Mm(o,e,t,i));return r}}function Nf(n,e,t,i,s){const r=e._queryIdentifier,o=n.views.get(r);if(!o){let a=Bc(t,s?i:null),c=!1;a?c=!0:i instanceof N?(a=Cf(t,i),c=!1):(a=N.EMPTY_NODE,c=!1);const l=Bl(new si(a,c,!1),new si(i,s,!1));return new jO(e,l)}return o}function JO(n,e,t,i,s,r){const o=Nf(n,e,i,s,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),HO(o,t),zO(o,t)}function ZO(n,e,t,i){const s=e._queryIdentifier,r=[];let o=[];const a=ri(n);if(s==="default")for(const[c,l]of n.views.entries())o=o.concat(xm(l,t,i)),Om(l)&&(n.views.delete(c),l.query._queryParams.loadsAllData()||r.push(l.query));else{const c=n.views.get(s);c&&(o=o.concat(xm(c,t,i)),Om(c)&&(n.views.delete(s),c.query._queryParams.loadsAllData()||r.push(c.query)))}return a&&!ri(n)&&r.push(new(YO())(e._repo,e._path)),{removed:r,events:o}}function RI(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Jn(n,e){let t=null;for(const i of n.views.values())t=t||WO(i,e);return t}function NI(n,e){if(e._queryParams.loadsAllData())return ql(n);{const i=e._queryIdentifier;return n.views.get(i)}}function PI(n,e){return NI(n,e)!=null}function ri(n){return ql(n)!=null}function ql(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kc;function ex(n){E(!Kc,"__referenceConstructor has already been defined"),Kc=n}function tx(){return E(Kc,"Reference.ts has not been loaded"),Kc}let nx=1;class Lm{constructor(e){this.listenProvider_=e,this.syncPointTree_=new J(null),this.pendingWriteTree_=PO(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Pf(n,e,t,i,s){return wO(n.pendingWriteTree_,e,t,i,s),s?Er(n,new Zi(Ef(),e,t)):[]}function ix(n,e,t,i){vO(n.pendingWriteTree_,e,t,i);const s=J.fromObject(t);return Er(n,new ir(Ef(),e,s))}function Qn(n,e,t=!1){const i=IO(n.pendingWriteTree_,e);if(TO(n.pendingWriteTree_,e)){let r=new J(null);return i.snap!=null?r=r.set(W(),!0):xe(i.children,o=>{r=r.set(new z(o),!0)}),Er(n,new Uc(i.path,r,t))}else return[]}function _a(n,e,t){return Er(n,new Zi(bf(),e,t))}function sx(n,e,t){const i=J.fromObject(t);return Er(n,new ir(bf(),e,i))}function rx(n,e){return Er(n,new Do(bf(),e))}function ox(n,e,t){const i=Df(n,t);if(i){const s=Of(i),r=s.path,o=s.queryId,a=ut(r,e),c=new Do(Sf(o),a);return xf(n,r,c)}else return[]}function Gc(n,e,t,i){const s=e._path,r=n.syncPointTree_.get(s);let o=[];if(r&&(e._queryIdentifier==="default"||PI(r,e))){const a=ZO(r,e,t,i);XO(r)&&(n.syncPointTree_=n.syncPointTree_.remove(s));const c=a.removed;o=a.events;const l=c.findIndex(h=>h._queryParams.loadsAllData())!==-1,u=n.syncPointTree_.findOnPath(s,(h,d)=>ri(d));if(l&&!u){const h=n.syncPointTree_.subtree(s);if(!h.isEmpty()){const d=ux(h);for(let f=0;f<d.length;++f){const p=d[f],_=p.query,v=LI(n,p);n.listenProvider_.startListening(co(_),Oo(n,_),v.hashFn,v.onComplete)}}}!u&&c.length>0&&!i&&(l?n.listenProvider_.stopListening(co(e),null):c.forEach(h=>{const d=n.queryToTagMap.get(Kl(h));n.listenProvider_.stopListening(co(h),d)})),hx(n,c)}return o}function ax(n,e){const{syncPoint:t,serverCache:i,writesCache:s,serverCacheComplete:r}=OI(e,n),o=Nf(t,e,s,i,r);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,o),e._queryParams.loadsAllData()?null:Oo(n,e)}function DI(n,e,t,i){const s=Df(n,i);if(s!=null){const r=Of(s),o=r.path,a=r.queryId,c=ut(o,e),l=new Zi(Sf(a),c,t);return xf(n,o,l)}else return[]}function cx(n,e,t,i){const s=Df(n,i);if(s){const r=Of(s),o=r.path,a=r.queryId,c=ut(o,e),l=J.fromObject(t),u=new ir(Sf(a),c,l);return xf(n,o,u)}else return[]}function OI(n,e){const t=n._path;let i=null,s=!1;e.syncPointTree_.foreachOnPath(t,(l,u)=>{const h=ut(l,t);i=i||Jn(u,h),s=s||ri(u)});let r=e.syncPointTree_.get(t);r?(s=s||ri(r),i=i||Jn(r,W())):(r=new AI,e.syncPointTree_=e.syncPointTree_.set(t,r));let o;i!=null?o=!0:(o=!1,i=N.EMPTY_NODE,e.syncPointTree_.subtree(t).foreachChild((u,h)=>{const d=Jn(h,W());d&&(i=i.updateImmediateChild(u,d))}));const a=PI(r,n);if(!a&&!n._queryParams.loadsAllData()){const l=Kl(n);E(!e.queryToTagMap.has(l),"View does not exist, but we have a tag");const u=dx();e.queryToTagMap.set(l,u),e.tagToQueryMap.set(u,l)}const c=$l(e.pendingWriteTree_,t);return{syncPoint:r,writesCache:c,serverCache:i,serverCacheComplete:o,foundAncestorDefaultView:s,viewAlreadyExists:a}}function Fm(n,e,t){const{syncPoint:i,serverCache:s,writesCache:r,serverCacheComplete:o,viewAlreadyExists:a,foundAncestorDefaultView:c}=OI(e,n);let l=JO(i,e,t,r,s,o);if(!a&&!c){const u=NI(i,e);l=l.concat(fx(n,e,u))}return l}function jl(n,e,t){const s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{const c=ut(o,e),l=Jn(a,c);if(l)return l});return TI(s,e,r,t,!0)}function lx(n,e){const t=e._path;let i=null;n.syncPointTree_.foreachOnPath(t,(l,u)=>{const h=ut(l,t);i=i||Jn(u,h)});let s=n.syncPointTree_.get(t);s?i=i||Jn(s,W()):(s=new AI,n.syncPointTree_=n.syncPointTree_.set(t,s));const r=i!=null,o=r?new si(i,!0,!1):null,a=$l(n.pendingWriteTree_,e._path),c=Nf(s,e,a,r?o.getNode():N.EMPTY_NODE,r);return GO(c)}function Er(n,e){return xI(e,n.syncPointTree_,null,$l(n.pendingWriteTree_,W()))}function xI(n,e,t,i){if(B(n.path))return MI(n,e,t,i);{const s=e.get(W());t==null&&s!=null&&(t=Jn(s,W()));let r=[];const o=V(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){const l=t?t.getImmediateChild(o):null,u=EI(i,o);r=r.concat(xI(a,c,l,u))}return s&&(r=r.concat(Rf(s,n,i,t))),r}}function MI(n,e,t,i){const s=e.get(W());t==null&&s!=null&&(t=Jn(s,W()));let r=[];return e.children.inorderTraversal((o,a)=>{const c=t?t.getImmediateChild(o):null,l=EI(i,o),u=n.operationForChild(o);u&&(r=r.concat(MI(u,a,c,l)))}),s&&(r=r.concat(Rf(s,n,i,t))),r}function LI(n,e){const t=e.query,i=Oo(n,t);return{hashFn:()=>(KO(e)||N.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?ox(n,t._path,i):rx(n,t._path);{const r=sD(s,t);return Gc(n,t,null,r)}}}}function Oo(n,e){const t=Kl(e);return n.queryToTagMap.get(t)}function Kl(n){return n._path.toString()+"$"+n._queryIdentifier}function Df(n,e){return n.tagToQueryMap.get(e)}function Of(n){const e=n.indexOf("$");return E(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new z(n.substr(0,e))}}function xf(n,e,t){const i=n.syncPointTree_.get(e);E(i,"Missing sync point for query tag that we're tracking");const s=$l(n.pendingWriteTree_,e);return Rf(i,t,s,null)}function ux(n){return n.fold((e,t,i)=>{if(t&&ri(t))return[ql(t)];{let s=[];return t&&(s=RI(t)),xe(i,(r,o)=>{s=s.concat(o)}),s}})}function co(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(tx())(n._repo,n._path):n}function hx(n,e){for(let t=0;t<e.length;++t){const i=e[t];if(!i._queryParams.loadsAllData()){const s=Kl(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}function dx(){return nx++}function fx(n,e,t){const i=e._path,s=Oo(n,e),r=LI(n,t),o=n.listenProvider_.startListening(co(e),s,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(i);if(s)E(!ri(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((l,u,h)=>{if(!B(l)&&u&&ri(u))return[ql(u).query];{let d=[];return u&&(d=d.concat(RI(u).map(f=>f.query))),xe(h,(f,p)=>{d=d.concat(p)}),d}});for(let l=0;l<c.length;++l){const u=c[l];n.listenProvider_.stopListening(co(u),Oo(n,u))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Mf(t)}node(){return this.node_}}class Lf{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=ie(this.path_,e);return new Lf(this.syncTree_,t)}node(){return jl(this.syncTree_,this.path_)}}const px=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Um=function(n,e,t){if(!n||typeof n!="object")return n;if(E(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return gx(n[".sv"],e,t);if(typeof n[".sv"]=="object")return mx(n[".sv"],e);E(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},gx=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:E(!1,"Unexpected server value: "+n)}},mx=function(n,e,t){n.hasOwnProperty("increment")||E(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;typeof i!="number"&&E(!1,"Unexpected increment value: "+i);const s=e.node();if(E(s!==null&&typeof s!="undefined","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return typeof o!="number"?i:o+i},FI=function(n,e,t,i){return Uf(e,new Lf(t,n),i)},Ff=function(n,e,t){return Uf(n,new Mf(e),t)};function Uf(n,e,t){const i=n.getPriority().val(),s=Um(i,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,a=Um(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Te(a,re(s)):n}else{const o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Te(s))),o.forEachChild(ee,(a,c)=>{const l=Uf(c,e.getImmediateChild(a),t);l!==c&&(r=r.updateImmediateChild(a,l))}),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vf{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function Gl(n,e){let t=e instanceof z?e:new z(e),i=n,s=V(t);for(;s!==null;){const r=zi(i.node.children,s)||{children:{},childCount:0};i=new Vf(s,i,r),t=X(t),s=V(t)}return i}function Es(n){return n.node.value}function Bf(n,e){n.node.value=e,Xh(n)}function UI(n){return n.node.childCount>0}function _x(n){return Es(n)===void 0&&!UI(n)}function Wl(n,e){xe(n.node.children,(t,i)=>{e(new Vf(t,n,i))})}function VI(n,e,t,i){t&&!i&&e(n),Wl(n,s=>{VI(s,e,!0,i)}),t&&i&&e(n)}function yx(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function ya(n){return new z(n.parent===null?n.name:ya(n.parent)+"/"+n.name)}function Xh(n){n.parent!==null&&wx(n.parent,n.name,n)}function wx(n,e,t){const i=_x(t),s=Xt(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,Xh(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,Xh(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vx=/[\[\].#$\/\u0000-\u001F\u007F]/,Ix=/[\[\].#$\u0000-\u001F\u007F]/,Yu=10*1024*1024,Hl=function(n){return typeof n=="string"&&n.length!==0&&!vx.test(n)},BI=function(n){return typeof n=="string"&&n.length!==0&&!Ix.test(n)},Tx=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),BI(n)},xo=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Ll(n)||n&&typeof n=="object"&&Xt(n,".sv")},mn=function(n,e,t,i){i&&e===void 0||wa(Lt(n,"value"),e,t)},wa=function(n,e,t){const i=t instanceof z?new LD(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Ai(i));if(typeof e=="function")throw new Error(n+"contains a function "+Ai(i)+" with contents = "+e.toString());if(Ll(e))throw new Error(n+"contains "+e.toString()+" "+Ai(i));if(typeof e=="string"&&e.length>Yu/3&&vl(e)>Yu)throw new Error(n+"contains a string greater than "+Yu+" utf8 bytes "+Ai(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(xe(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Hl(o)))throw new Error(n+" contains an invalid key ("+o+") "+Ai(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);FD(i,o),wa(n,a,i),UD(i)}),s&&r)throw new Error(n+' contains ".value" child '+Ai(i)+" in addition to actual children.")}},Ex=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];const r=Ao(i);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!Hl(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(MD);let s=null;for(t=0;t<e.length;t++){if(i=e[t],s!==null&&Dt(s,i))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}},$I=function(n,e,t,i){if(i&&e===void 0)return;const s=Lt(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const r=[];xe(e,(o,a)=>{const c=new z(o);if(wa(s,a,ie(t,c)),mf(c)===".priority"&&!xo(a))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(c)}),Ex(s,r)},$f=function(n,e,t){if(!(t&&e===void 0)){if(Ll(e))throw new Error(Lt(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!xo(e))throw new Error(Lt(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},va=function(n,e,t,i){if(!(i&&t===void 0)&&!Hl(t))throw new Error(Lt(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Mo=function(n,e,t,i){if(!(i&&t===void 0)&&!BI(t))throw new Error(Lt(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},bx=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Mo(n,e,t,i)},Ot=function(n,e){if(V(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},qI=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Hl(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Tx(t))throw new Error(Lt(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sx{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function zl(n,e){let t=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();t!==null&&!_f(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function jI(n,e,t){zl(n,t),KI(n,i=>_f(i,e))}function Vt(n,e,t){zl(n,t),KI(n,i=>Dt(i,e)||Dt(e,i))}function KI(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const s=n.eventLists_[i];if(s){const r=s.path;e(r)?(Cx(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Cx(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const i=t.getEventRunner();Wi&&ke("event: "+t.toString()),Ir(i)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GI="repo_interrupt",kx=25;class Ax{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Sx,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Fc(),this.transactionQueueTree_=new Vf,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Rx(n,e,t){if(n.stats_=pf(n.repoInfo_),n.forceRestClient_||oD())n.server_=new Lc(n.repoInfo_,(i,s,r,o)=>{Vm(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Bm(n,!0),0);else{if(typeof t!="undefined"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{we(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Rn(n.repoInfo_,e,(i,s,r,o)=>{Vm(n,i,s,r,o)},i=>{Bm(n,i)},i=>{Nx(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=hD(n.repoInfo_,()=>new fO(n.stats_,n.server_)),n.infoData_=new cO,n.infoSyncTree_=new Lm({startListening:(i,s,r,o)=>{let a=[];const c=n.infoData_.getNode(i._path);return c.isEmpty()||(a=_a(n.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),qf(n,"connected",!1),n.serverSyncTree_=new Lm({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(a,c)=>{const l=o(a,c);Vt(n.eventQueue_,i._path,l)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function WI(n){const t=n.infoData_.getNode(new z(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Ia(n){return px({timestamp:WI(n)})}function Vm(n,e,t,i,s){n.dataUpdateCount++;const r=new z(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(i){const c=Tc(t,l=>re(l));o=cx(n.serverSyncTree_,r,c,s)}else{const c=re(t);o=DI(n.serverSyncTree_,r,c,s)}else if(i){const c=Tc(t,l=>re(l));o=sx(n.serverSyncTree_,r,c)}else{const c=re(t);o=_a(n.serverSyncTree_,r,c)}let a=r;o.length>0&&(a=rr(n,r)),Vt(n.eventQueue_,a,o)}function Bm(n,e){qf(n,"connected",e),e===!1&&Ox(n)}function Nx(n,e){xe(e,(t,i)=>{qf(n,t,i)})}function qf(n,e,t){const i=new z("/.info/"+e),s=re(t);n.infoData_.updateSnapshot(i,s);const r=_a(n.infoSyncTree_,i,s);Vt(n.eventQueue_,i,r)}function Ql(n){return n.nextWriteId_++}function Px(n,e){const t=lx(n.serverSyncTree_,e);return t!=null?Promise.resolve(t):n.server_.get(e).then(i=>{const s=re(i).withIndex(e._queryParams.getIndex());if(e._queryParams.loadsAllData())_a(n.serverSyncTree_,e._path,s);else{const o=ax(n.serverSyncTree_,e);DI(n.serverSyncTree_,e._path,s,o)}return Gc(n.serverSyncTree_,e,null).length>0&&ts(n,"unexpected cancel events in repoGetValue"),s},i=>(ts(n,"get for query "+we(e)+" failed: "+i),Promise.reject(new Error(i))))}function jf(n,e,t,i,s){ts(n,"set",{path:e.toString(),value:t,priority:i});const r=Ia(n),o=re(t,i),a=jl(n.serverSyncTree_,e),c=Ff(o,a,r),l=Ql(n),u=Pf(n.serverSyncTree_,e,c,l,!0);zl(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(d,f)=>{const p=d==="ok";p||et("set at "+e+" failed: "+d);const _=Qn(n.serverSyncTree_,l,!p);Vt(n.eventQueue_,e,_),oi(n,s,d,f)});const h=Gf(n,e);rr(n,h),Vt(n.eventQueue_,h,[])}function Dx(n,e,t,i){ts(n,"update",{path:e.toString(),value:t});let s=!0;const r=Ia(n),o={};if(xe(t,(a,c)=>{s=!1,o[a]=FI(ie(e,a),re(c),n.serverSyncTree_,r)}),s)ke("update() called with empty data.  Don't do anything."),oi(n,i,"ok",void 0);else{const a=Ql(n),c=ix(n.serverSyncTree_,e,o,a);zl(n.eventQueue_,c),n.server_.merge(e.toString(),t,(l,u)=>{const h=l==="ok";h||et("update at "+e+" failed: "+l);const d=Qn(n.serverSyncTree_,a,!h),f=d.length>0?rr(n,e):e;Vt(n.eventQueue_,f,d),oi(n,i,l,u)}),xe(t,l=>{const u=Gf(n,ie(e,l));rr(n,u)}),Vt(n.eventQueue_,e,[])}}function Ox(n){ts(n,"onDisconnectEvents");const e=Ia(n),t=Fc();Gh(n.onDisconnect_,W(),(s,r)=>{const o=FI(s,r,n.serverSyncTree_,e);Tr(t,s,o)});let i=[];Gh(t,W(),(s,r)=>{i=i.concat(_a(n.serverSyncTree_,s,r));const o=Gf(n,s);rr(n,o)}),n.onDisconnect_=Fc(),Vt(n.eventQueue_,W(),i)}function xx(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,s)=>{i==="ok"&&Kh(n.onDisconnect_,e),oi(n,t,i,s)})}function $m(n,e,t,i){const s=re(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(r,o)=>{r==="ok"&&Tr(n.onDisconnect_,e,s),oi(n,i,r,o)})}function Mx(n,e,t,i,s){const r=re(t,i);n.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{o==="ok"&&Tr(n.onDisconnect_,e,r),oi(n,s,o,a)})}function Lx(n,e,t,i){if(Ic(t)){ke("onDisconnect().update() called with empty data.  Don't do anything."),oi(n,i,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,r)=>{s==="ok"&&xe(t,(o,a)=>{const c=re(a);Tr(n.onDisconnect_,ie(e,o),c)}),oi(n,i,s,r)})}function Fx(n,e,t){let i;V(e._path)===".info"?i=Fm(n.infoSyncTree_,e,t):i=Fm(n.serverSyncTree_,e,t),jI(n.eventQueue_,e._path,i)}function Jh(n,e,t){let i;V(e._path)===".info"?i=Gc(n.infoSyncTree_,e,t):i=Gc(n.serverSyncTree_,e,t),jI(n.eventQueue_,e._path,i)}function HI(n){n.persistentConnection_&&n.persistentConnection_.interrupt(GI)}function Ux(n){n.persistentConnection_&&n.persistentConnection_.resume(GI)}function ts(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),ke(t,...e)}function oi(n,e,t,i){e&&Ir(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let r=s;i&&(r+=": "+i);const o=new Error(r);o.code=s,e(o)}})}function Vx(n,e,t,i,s,r){ts(n,"transaction on "+e);const o={path:e,update:t,onComplete:i,status:null,order:Vv(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Kf(n,e,void 0);o.currentInputSnapshot=a;const c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{wa("transaction failed: Data returned ",c,o.path),o.status=0;const l=Gl(n.transactionQueueTree_,e),u=Es(l)||[];u.push(o),Bf(l,u);let h;typeof c=="object"&&c!==null&&Xt(c,".priority")?(h=zi(c,".priority"),E(xo(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(jl(n.serverSyncTree_,e)||N.EMPTY_NODE).getPriority().val();const d=Ia(n),f=re(c,h),p=Ff(f,a,d);o.currentOutputSnapshotRaw=f,o.currentOutputSnapshotResolved=p,o.currentWriteId=Ql(n);const _=Pf(n.serverSyncTree_,e,p,o.currentWriteId,o.applyLocally);Vt(n.eventQueue_,e,_),Yl(n,n.transactionQueueTree_)}}function Kf(n,e,t){return jl(n.serverSyncTree_,e,t)||N.EMPTY_NODE}function Yl(n,e=n.transactionQueueTree_){if(e||Xl(n,e),Es(e)){const t=QI(n,e);E(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&Bx(n,ya(e),t)}else UI(e)&&Wl(e,t=>{Yl(n,t)})}function Bx(n,e,t){const i=t.map(l=>l.currentWriteId),s=Kf(n,e,i);let r=s;const o=s.hash();for(let l=0;l<t.length;l++){const u=t[l];E(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=ut(e,u.path);r=r.updateChild(h,u.currentOutputSnapshotRaw)}const a=r.val(!0),c=e;n.server_.put(c.toString(),a,l=>{ts(n,"transaction put response",{path:c.toString(),status:l});let u=[];if(l==="ok"){const h=[];for(let d=0;d<t.length;d++)t[d].status=2,u=u.concat(Qn(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&h.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();Xl(n,Gl(n.transactionQueueTree_,e)),Yl(n,n.transactionQueueTree_),Vt(n.eventQueue_,e,u);for(let d=0;d<h.length;d++)Ir(h[d])}else{if(l==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{et("transaction at "+c.toString()+" failed: "+l);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=l}rr(n,e)}},o)}function rr(n,e){const t=zI(n,e),i=ya(t),s=QI(n,t);return $x(n,s,i),i}function $x(n,e,t){if(e.length===0)return;const i=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],l=ut(t,c.path);let u=!1,h;if(E(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,h=c.abortReason,s=s.concat(Qn(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=kx)u=!0,h="maxretry",s=s.concat(Qn(n.serverSyncTree_,c.currentWriteId,!0));else{const d=Kf(n,c.path,o);c.currentInputSnapshot=d;const f=e[a].update(d.val());if(f!==void 0){wa("transaction failed: Data returned ",f,c.path);let p=re(f);typeof f=="object"&&f!=null&&Xt(f,".priority")||(p=p.updatePriority(d.getPriority()));const v=c.currentWriteId,R=Ia(n),x=Ff(p,d,R);c.currentOutputSnapshotRaw=p,c.currentOutputSnapshotResolved=x,c.currentWriteId=Ql(n),o.splice(o.indexOf(v),1),s=s.concat(Pf(n.serverSyncTree_,c.path,x,c.currentWriteId,c.applyLocally)),s=s.concat(Qn(n.serverSyncTree_,v,!0))}else u=!0,h="nodata",s=s.concat(Qn(n.serverSyncTree_,c.currentWriteId,!0))}Vt(n.eventQueue_,t,s),s=[],u&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(h),!1,null))))}Xl(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Ir(i[a]);Yl(n,n.transactionQueueTree_)}function zI(n,e){let t,i=n.transactionQueueTree_;for(t=V(e);t!==null&&Es(i)===void 0;)i=Gl(i,t),e=X(e),t=V(e);return i}function QI(n,e){const t=[];return YI(n,e,t),t.sort((i,s)=>i.order-s.order),t}function YI(n,e,t){const i=Es(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);Wl(e,s=>{YI(n,s,t)})}function Xl(n,e){const t=Es(e);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,Bf(e,t.length>0?t:void 0)}Wl(e,i=>{Xl(n,i)})}function Gf(n,e){const t=ya(zI(n,e)),i=Gl(n.transactionQueueTree_,e);return yx(i,s=>{Xu(n,s)}),Xu(n,i),VI(i,s=>{Xu(n,s)}),t}function Xu(n,e){const t=Es(e);if(t){const i=[];let s=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(E(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(E(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(Qn(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Bf(e,void 0):t.length=r+1,Vt(n.eventQueue_,ya(e),s);for(let o=0;o<i.length;o++)Ir(i[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qx(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function jx(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):et(`Invalid query segment '${t}' in query '${n}'`)}return e}const Zh=function(n,e){const t=Kx(n),i=t.namespace;t.domain==="firebase.com"&&pn(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&pn("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||ZP();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new eI(t.host,t.secure,i,s,e,"",i!==t.subdomain),path:new z(t.pathString)}},Kx=function(n){let e="",t="",i="",s="",r="",o=!0,a="https",c=443;if(typeof n=="string"){let l=n.indexOf("//");l>=0&&(a=n.substring(0,l-1),n=n.substring(l+2));let u=n.indexOf("/");u===-1&&(u=n.length);let h=n.indexOf("?");h===-1&&(h=n.length),e=n.substring(0,Math.min(u,h)),u<h&&(s=qx(n.substring(u,h)));const d=jx(n.substring(Math.min(n.length,h)));l=e.indexOf(":"),l>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(l+1),10)):l=e.length;const f=e.slice(0,l);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{const p=e.indexOf(".");i=e.substring(0,p).toLowerCase(),t=e.substring(p+1),r=i}"ns"in d&&(r=d.ns)}return{host:e,port:c,domain:t,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XI{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+we(this.snapshot.exportVal())}}class JI{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZI{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return E(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gx{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Ae;return xx(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Ot("OnDisconnect.remove",this._path);const e=new Ae;return $m(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Ot("OnDisconnect.set",this._path),mn("OnDisconnect.set",e,this._path,!1);const t=new Ae;return $m(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Ot("OnDisconnect.setWithPriority",this._path),mn("OnDisconnect.setWithPriority",e,this._path,!1),$f("OnDisconnect.setWithPriority",t,!1);const i=new Ae;return Mx(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){Ot("OnDisconnect.update",this._path),$I("OnDisconnect.update",e,this._path,!1);const t=new Ae;return Lx(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vt{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return B(this._path)?null:mf(this._path)}get ref(){return new $t(this._repo,this._path)}get _queryIdentifier(){const e=Cm(this._queryParams),t=hf(e);return t==="{}"?"default":t}get _queryObject(){return Cm(this._queryParams)}isEqual(e){if(e=w(e),!(e instanceof vt))return!1;const t=this._repo===e._repo,i=_f(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+xD(this._path)}}function Jl(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function _i(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===cn){const i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==Dn)throw new Error(i);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==gn)throw new Error(i);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===ee){if(e!=null&&!xo(e)||t!=null&&!xo(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(E(n.getIndex()instanceof vf||n.getIndex()===If,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Zl(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class $t extends vt{constructor(e,t){super(e,t,new Ul,!1)}get parent(){const e=lI(this._path);return e===null?null:new $t(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}class ns{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new z(e),i=is(this.ref,e);return new ns(this._node.getChild(t),i,ee)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new ns(s,is(this.ref,i),ee)))}hasChild(e){const t=new z(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function eT(n,e){return n=w(n),n._checkNotDeleted("ref"),e!==void 0?is(n._root,e):n._root}function qm(n,e){n=w(n),n._checkNotDeleted("refFromURL");const t=Zh(e,n._repo.repoInfo_.nodeAdmin);qI("refFromURL",t);const i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&pn("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),eT(n,t.path.toString())}function is(n,e){return n=w(n),V(n._path)===null?bx("child","path",e,!1):Mo("child","path",e,!1),new $t(n._repo,ie(n._path,e))}function Wx(n,e){n=w(n),Ot("push",n._path),mn("push",e,n._path,!0);const t=WI(n._repo),i=eO(t),s=is(n,i),r=is(n,i);let o;return e!=null?o=Wf(r,e).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function Hx(n){return Ot("remove",n._path),Wf(n,null)}function Wf(n,e){n=w(n),Ot("set",n._path),mn("set",e,n._path,!1);const t=new Ae;return jf(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function zx(n,e){n=w(n),Ot("setPriority",n._path),$f("setPriority",e,!1);const t=new Ae;return jf(n._repo,ie(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function Qx(n,e,t){if(Ot("setWithPriority",n._path),mn("setWithPriority",e,n._path,!1),$f("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const i=new Ae;return jf(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}function Yx(n,e){$I("update",e,n._path,!1);const t=new Ae;return Dx(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Xx(n){return n=w(n),Px(n._repo,n).then(e=>new ns(e,new $t(n._repo,n._path),n._queryParams.getIndex()))}class eu{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const i=t._queryParams.getIndex();return new XI("value",this,new ns(e.snapshotNode,new $t(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new JI(this,e,t):null}matches(e){return e instanceof eu?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class tu{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new JI(this,e,t):null}createEvent(e,t){E(e.childName!=null,"Child events should have a childName.");const i=is(new $t(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new XI(e.type,this,new ns(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof tu?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function Ta(n,e,t,i,s){let r;if(typeof i=="object"&&(r=void 0,s=i),typeof i=="function"&&(r=i),s&&s.onlyOnce){const c=t,l=(u,h)=>{Jh(n._repo,n,a),c(u,h)};l.userCallback=t.userCallback,l.context=t.context,t=l}const o=new ZI(t,r||void 0),a=e==="value"?new eu(o):new tu(e,o);return Fx(n._repo,n,a),()=>Jh(n._repo,n,a)}function ed(n,e,t,i){return Ta(n,"value",e,t,i)}function jm(n,e,t,i){return Ta(n,"child_added",e,t,i)}function Km(n,e,t,i){return Ta(n,"child_changed",e,t,i)}function Gm(n,e,t,i){return Ta(n,"child_moved",e,t,i)}function Wm(n,e,t,i){return Ta(n,"child_removed",e,t,i)}function Hm(n,e,t){let i=null;const s=t?new ZI(t):null;e==="value"?i=new eu(s):e&&(i=new tu(e,s)),Jh(n._repo,n,i)}class Jt{}class tT extends Jt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){mn("endAt",this._value,e._path,!0);const t=jh(e._queryParams,this._value,this._key);if(Zl(t),_i(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new vt(e._repo,e._path,t,e._orderByCalled)}}function Jx(n,e){return va("endAt","key",e,!0),new tT(n,e)}class Zx extends Jt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){mn("endBefore",this._value,e._path,!1);const t=aO(e._queryParams,this._value,this._key);if(Zl(t),_i(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new vt(e._repo,e._path,t,e._orderByCalled)}}function eM(n,e){return va("endBefore","key",e,!0),new Zx(n,e)}class nT extends Jt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){mn("startAt",this._value,e._path,!0);const t=qh(e._queryParams,this._value,this._key);if(Zl(t),_i(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new vt(e._repo,e._path,t,e._orderByCalled)}}function tM(n=null,e){return va("startAt","key",e,!0),new nT(n,e)}class nM extends Jt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){mn("startAfter",this._value,e._path,!1);const t=oO(e._queryParams,this._value,this._key);if(Zl(t),_i(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new vt(e._repo,e._path,t,e._orderByCalled)}}function iM(n,e){return va("startAfter","key",e,!0),new nM(n,e)}class sM extends Jt{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new vt(e._repo,e._path,sO(e._queryParams,this._limit),e._orderByCalled)}}function rM(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new sM(n)}class oM extends Jt{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new vt(e._repo,e._path,rO(e._queryParams,this._limit),e._orderByCalled)}}function aM(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new oM(n)}class cM extends Jt{constructor(e){super(),this._path=e}_apply(e){Jl(e,"orderByChild");const t=new z(this._path);if(B(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const i=new vf(t),s=Vl(e._queryParams,i);return _i(s),new vt(e._repo,e._path,s,!0)}}function lM(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Mo("orderByChild","path",n,!1),new cM(n)}class uM extends Jt{_apply(e){Jl(e,"orderByKey");const t=Vl(e._queryParams,cn);return _i(t),new vt(e._repo,e._path,t,!0)}}function hM(){return new uM}class dM extends Jt{_apply(e){Jl(e,"orderByPriority");const t=Vl(e._queryParams,ee);return _i(t),new vt(e._repo,e._path,t,!0)}}function fM(){return new dM}class pM extends Jt{_apply(e){Jl(e,"orderByValue");const t=Vl(e._queryParams,If);return _i(t),new vt(e._repo,e._path,t,!0)}}function gM(){return new pM}class mM extends Jt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(mn("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new tT(this._value,this._key)._apply(new nT(this._value,this._key)._apply(e))}}function _M(n,e){return va("equalTo","key",e,!0),new mM(n,e)}function qt(n,...e){let t=w(n);for(const i of e)t=i._apply(t);return t}QO($t);ex($t);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yM="FIREBASE_DATABASE_EMULATOR_HOST",td={};let wM=!1;function vM(n,e,t,i){n.repoInfo_=new eI(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams),i&&(n.authTokenProvider_=i)}function iT(n,e,t,i,s){let r=i||n.options.databaseURL;r===void 0&&(n.options.projectId||pn("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),ke("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=Zh(r,s),a=o.repoInfo,c,l;typeof process!="undefined"&&process.env&&(l=process.env[yM]),l?(c=!0,r=`http://${l}?ns=${a.namespace}`,o=Zh(r,s),a=o.repoInfo):c=!o.repoInfo.secure;const u=s&&c?new Gs(Gs.OWNER):new cD(n.name,n.options,e);qI("Invalid Firebase Database URL",o),B(o.path)||pn("Database URL must point to the root of a Firebase Database (not including a child path).");const h=TM(a,n,u,new aD(n.name,t));return new EM(h,n)}function IM(n,e){const t=td[e];(!t||t[n.key]!==n)&&pn(`Database ${e}(${n.repoInfo_}) has already been deleted.`),HI(n),delete t[n.key]}function TM(n,e,t,i){let s=td[e.name];s||(s={},td[e.name]=s);let r=s[n.toURLString()];return r&&pn("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Ax(n,wM,t,i),s[n.toURLString()]=r,r}class EM{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Rx(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new $t(this._repo,W())),this._rootInternal}_delete(){return this._rootInternal!==null&&(IM(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&pn("Cannot call "+e+" on a deleted database.")}}function sT(){er.IS_TRANSPORT_INITIALIZED&&et("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function bM(){sT(),zn.forceDisallow()}function SM(){sT(),Pt.forceDisallow(),zn.forceAllow()}function CM(n,e,t,i={}){n=w(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&pn("Cannot call useEmulator() after instance has already been initialized.");const s=n._repoInternal;let r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&pn('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new Gs(Gs.OWNER);else if(i.mockUserToken){const o=typeof i.mockUserToken=="string"?i.mockUserToken:Ld(i.mockUserToken,n.app.options.projectId);r=new Gs(o)}vM(s,e,t,r)}function kM(n){n=w(n),n._checkNotDeleted("goOffline"),HI(n._repo)}function AM(n){n=w(n),n._checkNotDeleted("goOnline"),Ux(n._repo)}function RM(n,e){$v(n,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NM(n){Fv(gi),Qe(new Y("database",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return iT(i,s,r,t)},"PUBLIC").setMultipleInstances(!0)),fe(cm,lm,n),fe(cm,lm,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PM={".sv":"timestamp"};function DM(){return PM}function OM(n){return{".sv":{increment:n}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xM{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}}function MM(n,e,t){var i;if(n=w(n),Ot("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const s=(i=t==null?void 0:t.applyLocally)!==null&&i!==void 0?i:!0,r=new Ae,o=(c,l,u)=>{let h=null;c?r.reject(c):(h=new ns(u,new $t(n._repo,n._path),ee),r.resolve(new xM(l,h)))},a=ed(n,()=>{});return Vx(n._repo,n._path,e,o,a,s),r.promise}Rn.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Rn.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};NM();const LM="@firebase/database-compat",FM="0.2.3";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UM=new pi("@firebase/database-compat"),rT=function(n){const e="FIREBASE WARNING: "+n;UM.warn(e)};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VM=function(n,e,t,i){if(!(i&&t===void 0)&&typeof t!="boolean")throw new Error(Lt(n,e)+"must be a boolean.")},BM=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Lt(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $M{constructor(e){this._delegate=e}cancel(e){P("OnDisconnect.cancel",0,1,arguments.length),be("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){P("OnDisconnect.remove",0,1,arguments.length),be("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){P("OnDisconnect.set",1,2,arguments.length),be("OnDisconnect.set","onComplete",t,!0);const i=this._delegate.set(e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){P("OnDisconnect.setWithPriority",2,3,arguments.length),be("OnDisconnect.setWithPriority","onComplete",i,!0);const s=this._delegate.setWithPriority(e,t);return i&&s.then(()=>i(null),r=>i(r)),s}update(e,t){if(P("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,rT("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}be("OnDisconnect.update","onComplete",t,!0);const i=this._delegate.update(e);return t&&i.then(()=>t(null),s=>t(s)),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qM{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return P("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zn{constructor(e,t){this._database=e,this._delegate=t}val(){return P("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return P("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return P("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return P("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return P("DataSnapshot.child",0,1,arguments.length),e=String(e),Mo("DataSnapshot.child","path",e,!1),new Zn(this._database,this._delegate.child(e))}hasChild(e){return P("DataSnapshot.hasChild",1,1,arguments.length),Mo("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return P("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return P("DataSnapshot.forEach",1,1,arguments.length),be("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new Zn(this._database,t)))}hasChildren(){return P("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return P("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return P("DataSnapshot.ref",0,0,arguments.length),new Et(this._database,this._delegate.ref)}get ref(){return this.getRef()}}class Be{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,s){var r;P("Query.on",2,4,arguments.length),be("Query.on","callback",t,!1);const o=Be.getCancelAndContextArgs_("Query.on",i,s),a=(l,u)=>{t.call(o.context,new Zn(this.database,l),u)};a.userCallback=t,a.context=o.context;const c=(r=o.cancel)===null||r===void 0?void 0:r.bind(o.context);switch(e){case"value":return ed(this._delegate,a,c),t;case"child_added":return jm(this._delegate,a,c),t;case"child_removed":return Wm(this._delegate,a,c),t;case"child_changed":return Km(this._delegate,a,c),t;case"child_moved":return Gm(this._delegate,a,c),t;default:throw new Error(Lt("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if(P("Query.off",0,3,arguments.length),BM("Query.off",e,!0),be("Query.off","callback",t,!0),Dg("Query.off","context",i,!0),t){const s=()=>{};s.userCallback=t,s.context=i,Hm(this._delegate,e,s)}else Hm(this._delegate,e)}get(){return Xx(this._delegate).then(e=>new Zn(this.database,e))}once(e,t,i,s){P("Query.once",1,4,arguments.length),be("Query.once","callback",t,!0);const r=Be.getCancelAndContextArgs_("Query.once",i,s),o=new Ae,a=(l,u)=>{const h=new Zn(this.database,l);t&&t.call(r.context,h,u),o.resolve(h)};a.userCallback=t,a.context=r.context;const c=l=>{r.cancel&&r.cancel.call(r.context,l),o.reject(l)};switch(e){case"value":ed(this._delegate,a,c,{onlyOnce:!0});break;case"child_added":jm(this._delegate,a,c,{onlyOnce:!0});break;case"child_removed":Wm(this._delegate,a,c,{onlyOnce:!0});break;case"child_changed":Km(this._delegate,a,c,{onlyOnce:!0});break;case"child_moved":Gm(this._delegate,a,c,{onlyOnce:!0});break;default:throw new Error(Lt("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return P("Query.limitToFirst",1,1,arguments.length),new Be(this.database,qt(this._delegate,rM(e)))}limitToLast(e){return P("Query.limitToLast",1,1,arguments.length),new Be(this.database,qt(this._delegate,aM(e)))}orderByChild(e){return P("Query.orderByChild",1,1,arguments.length),new Be(this.database,qt(this._delegate,lM(e)))}orderByKey(){return P("Query.orderByKey",0,0,arguments.length),new Be(this.database,qt(this._delegate,hM()))}orderByPriority(){return P("Query.orderByPriority",0,0,arguments.length),new Be(this.database,qt(this._delegate,fM()))}orderByValue(){return P("Query.orderByValue",0,0,arguments.length),new Be(this.database,qt(this._delegate,gM()))}startAt(e=null,t){return P("Query.startAt",0,2,arguments.length),new Be(this.database,qt(this._delegate,tM(e,t)))}startAfter(e=null,t){return P("Query.startAfter",0,2,arguments.length),new Be(this.database,qt(this._delegate,iM(e,t)))}endAt(e=null,t){return P("Query.endAt",0,2,arguments.length),new Be(this.database,qt(this._delegate,Jx(e,t)))}endBefore(e=null,t){return P("Query.endBefore",0,2,arguments.length),new Be(this.database,qt(this._delegate,eM(e,t)))}equalTo(e,t){return P("Query.equalTo",1,2,arguments.length),new Be(this.database,qt(this._delegate,_M(e,t)))}toString(){return P("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return P("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(P("Query.isEqual",1,1,arguments.length),!(e instanceof Be)){const t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){const s={cancel:void 0,context:void 0};if(t&&i)s.cancel=t,be(e,"cancel",s.cancel,!0),s.context=i,Dg(e,"context",s.context,!0);else if(t)if(typeof t=="object"&&t!==null)s.context=t;else if(typeof t=="function")s.cancel=t;else throw new Error(Lt(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return s}get ref(){return new Et(this.database,new $t(this._delegate._repo,this._delegate._path))}}class Et extends Be{constructor(e,t){super(e,new vt(t._repo,t._path,new Ul,!1)),this.database=e,this._delegate=t}getKey(){return P("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return P("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new Et(this.database,is(this._delegate,e))}getParent(){P("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new Et(this.database,e):null}getRoot(){return P("Reference.root",0,0,arguments.length),new Et(this.database,this._delegate.root)}set(e,t){P("Reference.set",1,2,arguments.length),be("Reference.set","onComplete",t,!0);const i=Wf(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}update(e,t){if(P("Reference.update",1,2,arguments.length),Array.isArray(e)){const s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,rT("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ot("Reference.update",this._delegate._path),be("Reference.update","onComplete",t,!0);const i=Yx(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){P("Reference.setWithPriority",2,3,arguments.length),be("Reference.setWithPriority","onComplete",i,!0);const s=Qx(this._delegate,e,t);return i&&s.then(()=>i(null),r=>i(r)),s}remove(e){P("Reference.remove",0,1,arguments.length),be("Reference.remove","onComplete",e,!0);const t=Hx(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){P("Reference.transaction",1,3,arguments.length),be("Reference.transaction","transactionUpdate",e,!1),be("Reference.transaction","onComplete",t,!0),VM("Reference.transaction","applyLocally",i,!0);const s=MM(this._delegate,e,{applyLocally:i}).then(r=>new qM(r.committed,new Zn(this.database,r.snapshot)));return t&&s.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),s}setPriority(e,t){P("Reference.setPriority",1,2,arguments.length),be("Reference.setPriority","onComplete",t,!0);const i=zx(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}push(e,t){P("Reference.push",0,2,arguments.length),be("Reference.push","onComplete",t,!0);const i=Wx(this._delegate,e),s=i.then(o=>new Et(this.database,o));t&&s.then(()=>t(null),o=>t(o));const r=new Et(this.database,i);return r.then=s.then.bind(s),r.catch=s.catch.bind(s,void 0),r}onDisconnect(){return Ot("Reference.onDisconnect",this._delegate._path),new $M(new Gx(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:bM,forceLongPolling:SM}}useEmulator(e,t,i={}){CM(this._delegate,e,t,i)}ref(e){if(P("database.ref",0,1,arguments.length),e instanceof Et){const t=qm(this._delegate,e.toString());return new Et(this,t)}else{const t=eT(this._delegate,e);return new Et(this,t)}}refFromURL(e){P("database.refFromURL",1,1,arguments.length);const i=qm(this._delegate,e);return new Et(this,i)}goOffline(){return P("database.goOffline",0,0,arguments.length),kM(this._delegate)}goOnline(){return P("database.goOnline",0,0,arguments.length),AM(this._delegate)}}Lo.ServerValue={TIMESTAMP:DM(),increment:n=>OM(n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jM({app:n,url:e,version:t,customAuthImpl:i,namespace:s,nodeAdmin:r=!1}){Fv(t);const o=new OC("auth-internal",new xC("database-standalone"));return o.setComponent(new Y("auth-internal",()=>i,"PRIVATE")),{instance:new Lo(iT(n,o,void 0,e,r),n),namespace:s}}var KM=Object.freeze({__proto__:null,initStandalone:jM});/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GM=Lo.ServerValue;function WM(n){n.INTERNAL.registerComponent(new Y("database-compat",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app-compat").getImmediate(),s=e.getProvider("database").getImmediate({identifier:t});return new Lo(s,i)},"PUBLIC").setServiceProps({Reference:Et,Query:Be,Database:Lo,DataSnapshot:Zn,enableLogging:RM,INTERNAL:KM,ServerValue:GM}).setMultipleInstances(!0)),n.registerVersion(LM,FM)}WM(Le);var HM=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},C,Hf=Hf||{},L=HM||self;function Wc(){}function nd(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function Ea(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function zM(n){return Object.prototype.hasOwnProperty.call(n,Ju)&&n[Ju]||(n[Ju]=++QM)}var Ju="closure_uid_"+(1e9*Math.random()>>>0),QM=0;function YM(n,e,t){return n.call.apply(n.bind,arguments)}function XM(n,e,t){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,i),n.apply(e,s)}}return function(){return n.apply(e,arguments)}}function He(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?He=YM:He=XM,He.apply(null,arguments)}function Ya(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var i=t.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function Xe(n,e){function t(){}t.prototype=e.prototype,n.Z=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Vb=function(i,s,r){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(i,o)}}function yi(){this.s=this.s,this.o=this.o}var JM=0;yi.prototype.s=!1;yi.prototype.na=function(){!this.s&&(this.s=!0,this.M(),JM!=0)&&zM(this)};yi.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const oT=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1},aT=Array.prototype.forEach?function(n,e,t){Array.prototype.forEach.call(n,e,t)}:function(n,e,t){const i=n.length,s=typeof n=="string"?n.split(""):n;for(let r=0;r<i;r++)r in s&&e.call(t,s[r],r,n)};function ZM(n){e:{var e=KL;const t=n.length,i=typeof n=="string"?n.split(""):n;for(let s=0;s<t;s++)if(s in i&&e.call(void 0,i[s],s,n)){e=s;break e}e=-1}return 0>e?null:typeof n=="string"?n.charAt(e):n[e]}function zm(n){return Array.prototype.concat.apply([],arguments)}function zf(n){const e=n.length;if(0<e){const t=Array(e);for(let i=0;i<e;i++)t[i]=n[i];return t}return[]}function Hc(n){return/^[\s\xa0]*$/.test(n)}var Qm=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function at(n,e){return n.indexOf(e)!=-1}function Zu(n,e){return n<e?-1:n>e?1:0}var ct;e:{var Ym=L.navigator;if(Ym){var Xm=Ym.userAgent;if(Xm){ct=Xm;break e}}ct=""}function Qf(n,e,t){for(const i in n)e.call(t,n[i],i,n)}function cT(n){const e={};for(const t in n)e[t]=n[t];return e}var Jm="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function lT(n,e){let t,i;for(let s=1;s<arguments.length;s++){i=arguments[s];for(t in i)n[t]=i[t];for(let r=0;r<Jm.length;r++)t=Jm[r],Object.prototype.hasOwnProperty.call(i,t)&&(n[t]=i[t])}}function Yf(n){return Yf[" "](n),n}Yf[" "]=Wc;function eL(n){var e=iL;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}var tL=at(ct,"Opera"),or=at(ct,"Trident")||at(ct,"MSIE"),uT=at(ct,"Edge"),id=uT||or,hT=at(ct,"Gecko")&&!(at(ct.toLowerCase(),"webkit")&&!at(ct,"Edge"))&&!(at(ct,"Trident")||at(ct,"MSIE"))&&!at(ct,"Edge"),nL=at(ct.toLowerCase(),"webkit")&&!at(ct,"Edge");function dT(){var n=L.document;return n?n.documentMode:void 0}var zc;e:{var eh="",th=function(){var n=ct;if(hT)return/rv:([^\);]+)(\)|;)/.exec(n);if(uT)return/Edge\/([\d\.]+)/.exec(n);if(or)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(nL)return/WebKit\/(\S+)/.exec(n);if(tL)return/(?:Version)[ \/]?(\S+)/.exec(n)}();if(th&&(eh=th?th[1]:""),or){var nh=dT();if(nh!=null&&nh>parseFloat(eh)){zc=String(nh);break e}}zc=eh}var iL={};function sL(){return eL(function(){let n=0;const e=Qm(String(zc)).split("."),t=Qm("9").split("."),i=Math.max(e.length,t.length);for(let o=0;n==0&&o<i;o++){var s=e[o]||"",r=t[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],s[0].length==0&&r[0].length==0)break;n=Zu(s[1].length==0?0:parseInt(s[1],10),r[1].length==0?0:parseInt(r[1],10))||Zu(s[2].length==0,r[2].length==0)||Zu(s[2],r[2]),s=s[3],r=r[3]}while(n==0)}return 0<=n})}var sd;if(L.document&&or){var Zm=dT();sd=Zm||parseInt(zc,10)||void 0}else sd=void 0;var rL=sd,oL=function(){if(!L.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{L.addEventListener("test",Wc,e),L.removeEventListener("test",Wc,e)}catch{}return n}();function tt(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}tt.prototype.h=function(){this.defaultPrevented=!0};function Fo(n,e){if(tt.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(hT){e:{try{Yf(e.nodeName);var s=!0;break e}catch{}s=!1}s||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,i?(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:aL[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Fo.Z.h.call(this)}}Xe(Fo,tt);var aL={2:"touch",3:"pen",4:"mouse"};Fo.prototype.h=function(){Fo.Z.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var ba="closure_listenable_"+(1e6*Math.random()|0),cL=0;function lL(n,e,t,i,s){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!i,this.ia=s,this.key=++cL,this.ca=this.fa=!1}function nu(n){n.ca=!0,n.listener=null,n.proxy=null,n.src=null,n.ia=null}function iu(n){this.src=n,this.g={},this.h=0}iu.prototype.add=function(n,e,t,i,s){var r=n.toString();n=this.g[r],n||(n=this.g[r]=[],this.h++);var o=od(n,e,i,s);return-1<o?(e=n[o],t||(e.fa=!1)):(e=new lL(e,this.src,r,!!i,s),e.fa=t,n.push(e)),e};function rd(n,e){var t=e.type;if(t in n.g){var i=n.g[t],s=oT(i,e),r;(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(nu(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function od(n,e,t,i){for(var s=0;s<n.length;++s){var r=n[s];if(!r.ca&&r.listener==e&&r.capture==!!t&&r.ia==i)return s}return-1}var Xf="closure_lm_"+(1e6*Math.random()|0),ih={};function fT(n,e,t,i,s){if(i&&i.once)return gT(n,e,t,i,s);if(Array.isArray(e)){for(var r=0;r<e.length;r++)fT(n,e[r],t,i,s);return null}return t=ep(t),n&&n[ba]?n.N(e,t,Ea(i)?!!i.capture:!!i,s):pT(n,e,t,!1,i,s)}function pT(n,e,t,i,s,r){if(!e)throw Error("Invalid event type");var o=Ea(s)?!!s.capture:!!s,a=Zf(n);if(a||(n[Xf]=a=new iu(n)),t=a.add(e,t,i,o,r),t.proxy)return t;if(i=uL(),t.proxy=i,i.src=n,i.listener=t,n.addEventListener)oL||(s=o),s===void 0&&(s=!1),n.addEventListener(e.toString(),i,s);else if(n.attachEvent)n.attachEvent(_T(e.toString()),i);else if(n.addListener&&n.removeListener)n.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return t}function uL(){function n(t){return e.call(n.src,n.listener,t)}var e=hL;return n}function gT(n,e,t,i,s){if(Array.isArray(e)){for(var r=0;r<e.length;r++)gT(n,e[r],t,i,s);return null}return t=ep(t),n&&n[ba]?n.O(e,t,Ea(i)?!!i.capture:!!i,s):pT(n,e,t,!0,i,s)}function mT(n,e,t,i,s){if(Array.isArray(e))for(var r=0;r<e.length;r++)mT(n,e[r],t,i,s);else i=Ea(i)?!!i.capture:!!i,t=ep(t),n&&n[ba]?(n=n.i,e=String(e).toString(),e in n.g&&(r=n.g[e],t=od(r,t,i,s),-1<t&&(nu(r[t]),Array.prototype.splice.call(r,t,1),r.length==0&&(delete n.g[e],n.h--)))):n&&(n=Zf(n))&&(e=n.g[e.toString()],n=-1,e&&(n=od(e,t,i,s)),(t=-1<n?e[n]:null)&&Jf(t))}function Jf(n){if(typeof n!="number"&&n&&!n.ca){var e=n.src;if(e&&e[ba])rd(e.i,n);else{var t=n.type,i=n.proxy;e.removeEventListener?e.removeEventListener(t,i,n.capture):e.detachEvent?e.detachEvent(_T(t),i):e.addListener&&e.removeListener&&e.removeListener(i),(t=Zf(e))?(rd(t,n),t.h==0&&(t.src=null,e[Xf]=null)):nu(n)}}}function _T(n){return n in ih?ih[n]:ih[n]="on"+n}function hL(n,e){if(n.ca)n=!0;else{e=new Fo(e,this);var t=n.listener,i=n.ia||n.src;n.fa&&Jf(n),n=t.call(i,e)}return n}function Zf(n){return n=n[Xf],n instanceof iu?n:null}var sh="__closure_events_fn_"+(1e9*Math.random()>>>0);function ep(n){return typeof n=="function"?n:(n[sh]||(n[sh]=function(e){return n.handleEvent(e)}),n[sh])}function Me(){yi.call(this),this.i=new iu(this),this.P=this,this.I=null}Xe(Me,yi);Me.prototype[ba]=!0;Me.prototype.removeEventListener=function(n,e,t,i){mT(this,n,e,t,i)};function ze(n,e){var t,i=n.I;if(i)for(t=[];i;i=i.I)t.push(i);if(n=n.P,i=e.type||e,typeof e=="string")e=new tt(e,n);else if(e instanceof tt)e.target=e.target||n;else{var s=e;e=new tt(i,n),lT(e,s)}if(s=!0,t)for(var r=t.length-1;0<=r;r--){var o=e.g=t[r];s=Xa(o,i,!0,e)&&s}if(o=e.g=n,s=Xa(o,i,!0,e)&&s,s=Xa(o,i,!1,e)&&s,t)for(r=0;r<t.length;r++)o=e.g=t[r],s=Xa(o,i,!1,e)&&s}Me.prototype.M=function(){if(Me.Z.M.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],i=0;i<t.length;i++)nu(t[i]);delete n.g[e],n.h--}}this.I=null};Me.prototype.N=function(n,e,t,i){return this.i.add(String(n),e,!1,t,i)};Me.prototype.O=function(n,e,t,i){return this.i.add(String(n),e,!0,t,i)};function Xa(n,e,t,i){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var s=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.ca&&o.capture==t){var a=o.listener,c=o.ia||o.src;o.fa&&rd(n.i,o),s=a.call(c,i)!==!1&&s}}return s&&!i.defaultPrevented}var tp=L.JSON.stringify;function dL(){var n=wT;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}class fL{constructor(){this.h=this.g=null}add(e,t){const i=yT.get();i.set(e,t),this.h?this.h.next=i:this.g=i,this.h=i}}var yT=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new pL,n=>n.reset());class pL{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function gL(n){L.setTimeout(()=>{throw n},0)}function np(n,e){ad||mL(),cd||(ad(),cd=!0),wT.add(n,e)}var ad;function mL(){var n=L.Promise.resolve(void 0);ad=function(){n.then(_L)}}var cd=!1,wT=new fL;function _L(){for(var n;n=dL();){try{n.h.call(n.g)}catch(t){gL(t)}var e=yT;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}cd=!1}function su(n,e){Me.call(this),this.h=n||1,this.g=e||L,this.j=He(this.kb,this),this.l=Date.now()}Xe(su,Me);C=su.prototype;C.da=!1;C.S=null;C.kb=function(){if(this.da){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-n):(this.S&&(this.g.clearTimeout(this.S),this.S=null),ze(this,"tick"),this.da&&(ip(this),this.start()))}};C.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function ip(n){n.da=!1,n.S&&(n.g.clearTimeout(n.S),n.S=null)}C.M=function(){su.Z.M.call(this),ip(this),delete this.g};function sp(n,e,t){if(typeof n=="function")t&&(n=He(n,t));else if(n&&typeof n.handleEvent=="function")n=He(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:L.setTimeout(n,e||0)}function vT(n){n.g=sp(()=>{n.g=null,n.i&&(n.i=!1,vT(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}class yL extends yi{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:vT(this)}M(){super.M(),this.g&&(L.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Uo(n){yi.call(this),this.h=n,this.g={}}Xe(Uo,yi);var e_=[];function IT(n,e,t,i){Array.isArray(t)||(t&&(e_[0]=t.toString()),t=e_);for(var s=0;s<t.length;s++){var r=fT(e,t[s],i||n.handleEvent,!1,n.h||n);if(!r)break;n.g[r.key]=r}}function TT(n){Qf(n.g,function(e,t){this.g.hasOwnProperty(t)&&Jf(e)},n),n.g={}}Uo.prototype.M=function(){Uo.Z.M.call(this),TT(this)};Uo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function ru(){this.g=!0}ru.prototype.Aa=function(){this.g=!1};function wL(n,e,t,i,s,r){n.info(function(){if(n.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");o=2<=h.length&&h[1]=="type"?o+(u+"="+l+"&"):o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+e+`
`+t+`
`+o})}function vL(n,e,t,i,s,r,o){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+e+`
`+t+`
`+r+" "+o})}function Us(n,e,t,i){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+TL(n,t)+(i?" "+i:"")})}function IL(n,e){n.info(function(){return"TIMEOUT: "+e})}ru.prototype.info=function(){};function TL(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var i=t[n];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if(r!="noop"&&r!="stop"&&r!="close")for(var o=1;o<s.length;o++)s[o]=""}}}}return tp(t)}catch{return e}}var bs={},t_=null;function ou(){return t_=t_||new Me}bs.Ma="serverreachability";function ET(n){tt.call(this,bs.Ma,n)}Xe(ET,tt);function Vo(n){const e=ou();ze(e,new ET(e))}bs.STAT_EVENT="statevent";function bT(n,e){tt.call(this,bs.STAT_EVENT,n),this.stat=e}Xe(bT,tt);function ht(n){const e=ou();ze(e,new bT(e,n))}bs.Na="timingevent";function ST(n,e){tt.call(this,bs.Na,n),this.size=e}Xe(ST,tt);function Sa(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return L.setTimeout(function(){n()},e)}var au={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},CT={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function rp(){}rp.prototype.h=null;function n_(n){return n.h||(n.h=n.i())}function kT(){}var Ca={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function op(){tt.call(this,"d")}Xe(op,tt);function ap(){tt.call(this,"c")}Xe(ap,tt);var ld;function cu(){}Xe(cu,rp);cu.prototype.g=function(){return new XMLHttpRequest};cu.prototype.i=function(){return{}};ld=new cu;function ka(n,e,t,i){this.l=n,this.j=e,this.m=t,this.X=i||1,this.V=new Uo(this),this.P=EL,n=id?125:void 0,this.W=new su(n),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new AT}function AT(){this.i=null,this.g="",this.h=!1}var EL=45e3,ud={},Qc={};C=ka.prototype;C.setTimeout=function(n){this.P=n};function hd(n,e,t){n.K=1,n.v=uu(On(e)),n.s=t,n.U=!0,RT(n,null)}function RT(n,e){n.F=Date.now(),Aa(n),n.A=On(n.v);var t=n.A,i=n.X;Array.isArray(i)||(i=[String(i)]),LT(t.h,"t",i),n.C=0,t=n.l.H,n.h=new AT,n.g=nE(n.l,t?e:null,!n.s),0<n.O&&(n.L=new yL(He(n.Ia,n,n.g),n.O)),IT(n.V,n.g,"readystatechange",n.gb),e=n.H?cT(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ea(n.A,n.u,n.s,e)):(n.u="GET",n.g.ea(n.A,n.u,null,e)),Vo(),wL(n.j,n.u,n.A,n.m,n.X,n.s)}C.gb=function(n){n=n.target;const e=this.L;e&&Cn(n)==3?e.l():this.Ia(n)};C.Ia=function(n){try{if(n==this.g)e:{const u=Cn(this.g);var e=this.g.Da();const h=this.g.ba();if(!(3>u)&&(u!=3||id||this.g&&(this.h.h||this.g.ga()||o_(this.g)))){this.I||u!=4||e==7||(e==8||0>=h?Vo(3):Vo(2)),lu(this);var t=this.g.ba();this.N=t;t:if(NT(this)){var i=o_(this.g);n="";var s=i.length,r=Cn(this.g)==4;if(!this.h.i){if(typeof TextDecoder=="undefined"){Vi(this),lo(this);var o="";break t}this.h.i=new L.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,n+=this.h.i.decode(i[e],{stream:r&&e==s-1});i.splice(0,s),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=t==200,vL(this.j,this.u,this.A,this.m,this.X,u,t),this.i){if(this.$&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Hc(a)){var l=a;break t}}l=null}if(t=l)Us(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,dd(this,t);else{this.i=!1,this.o=3,ht(12),Vi(this),lo(this);break e}}this.U?(PT(this,u,o),id&&this.i&&u==3&&(IT(this.V,this.W,"tick",this.fb),this.W.start())):(Us(this.j,this.m,o,null),dd(this,o)),u==4&&Vi(this),this.i&&!this.I&&(u==4?JT(this.l,this):(this.i=!1,Aa(this)))}else t==400&&0<o.indexOf("Unknown SID")?(this.o=3,ht(12)):(this.o=0,ht(13)),Vi(this),lo(this)}}}catch{}finally{}};function NT(n){return n.g?n.u=="GET"&&n.K!=2&&n.l.Ba:!1}function PT(n,e,t){let i=!0,s;for(;!n.I&&n.C<t.length;)if(s=bL(n,t),s==Qc){e==4&&(n.o=4,ht(14),i=!1),Us(n.j,n.m,null,"[Incomplete Response]");break}else if(s==ud){n.o=4,ht(15),Us(n.j,n.m,t,"[Invalid Chunk]"),i=!1;break}else Us(n.j,n.m,s,null),dd(n,s);NT(n)&&s!=Qc&&s!=ud&&(n.h.g="",n.C=0),e!=4||t.length!=0||n.h.h||(n.o=1,ht(16),i=!1),n.i=n.i&&i,i?0<t.length&&!n.aa&&(n.aa=!0,e=n.l,e.g==n&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+t.length),mp(e),e.L=!0,ht(11))):(Us(n.j,n.m,t,"[Invalid Chunked Response]"),Vi(n),lo(n))}C.fb=function(){if(this.g){var n=Cn(this.g),e=this.g.ga();this.C<e.length&&(lu(this),PT(this,n,e),this.i&&n!=4&&Aa(this))}};function bL(n,e){var t=n.C,i=e.indexOf(`
`,t);return i==-1?Qc:(t=Number(e.substring(t,i)),isNaN(t)?ud:(i+=1,i+t>e.length?Qc:(e=e.substr(i,t),n.C=i+t,e)))}C.cancel=function(){this.I=!0,Vi(this)};function Aa(n){n.Y=Date.now()+n.P,DT(n,n.P)}function DT(n,e){if(n.B!=null)throw Error("WatchDog timer not null");n.B=Sa(He(n.eb,n),e)}function lu(n){n.B&&(L.clearTimeout(n.B),n.B=null)}C.eb=function(){this.B=null;const n=Date.now();0<=n-this.Y?(IL(this.j,this.A),this.K!=2&&(Vo(),ht(17)),Vi(this),this.o=2,lo(this)):DT(this,this.Y-n)};function lo(n){n.l.G==0||n.I||JT(n.l,n)}function Vi(n){lu(n);var e=n.L;e&&typeof e.na=="function"&&e.na(),n.L=null,ip(n.W),TT(n.V),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function dd(n,e){try{var t=n.l;if(t.G!=0&&(t.g==n||fd(t.i,n))){if(t.I=n.N,!n.J&&fd(t.i,n)&&t.G==3){try{var i=t.Ca.g.parse(e)}catch{i=null}if(Array.isArray(i)&&i.length==3){var s=i;if(s[0]==0){e:if(!t.u){if(t.g)if(t.g.F+3e3<n.F)Zc(t),fu(t);else break e;gp(t),ht(18)}}else t.ta=s[1],0<t.ta-t.U&&37500>s[2]&&t.N&&t.A==0&&!t.v&&(t.v=Sa(He(t.ab,t),6e3));if(1>=VT(t.i)&&t.ka){try{t.ka()}catch{}t.ka=void 0}}else Bi(t,11)}else if((n.J||t.g==n)&&Zc(t),!Hc(e))for(s=t.Ca.g.parse(e),e=0;e<s.length;e++){let l=s[e];if(t.U=l[0],l=l[1],t.G==2)if(l[0]=="c"){t.J=l[1],t.la=l[2];const u=l[3];u!=null&&(t.ma=u,t.h.info("VER="+t.ma));const h=l[4];h!=null&&(t.za=h,t.h.info("SVER="+t.za));const d=l[5];d!=null&&typeof d=="number"&&0<d&&(i=1.5*d,t.K=i,t.h.info("backChannelRequestTimeoutMs_="+i)),i=t;const f=n.g;if(f){const p=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(p){var r=i.i;!r.g&&(at(p,"spdy")||at(p,"quic")||at(p,"h2"))&&(r.j=r.l,r.g=new Set,r.h&&(up(r,r.h),r.h=null))}if(i.D){const _=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;_&&(i.sa=_,ne(i.F,i.D,_))}}t.G=3,t.j&&t.j.xa(),t.$&&(t.O=Date.now()-n.F,t.h.info("Handshake RTT: "+t.O+"ms")),i=t;var o=n;if(i.oa=tE(i,i.H?i.la:null,i.W),o.J){BT(i.i,o);var a=o,c=i.K;c&&a.setTimeout(c),a.B&&(lu(a),Aa(a)),i.g=o}else YT(i);0<t.l.length&&pu(t)}else l[0]!="stop"&&l[0]!="close"||Bi(t,7);else t.G==3&&(l[0]=="stop"||l[0]=="close"?l[0]=="stop"?Bi(t,7):pp(t):l[0]!="noop"&&t.j&&t.j.wa(l),t.A=0)}}Vo(4)}catch{}}function SL(n){if(n.R&&typeof n.R=="function")return n.R();if(typeof n=="string")return n.split("");if(nd(n)){for(var e=[],t=n.length,i=0;i<t;i++)e.push(n[i]);return e}e=[],t=0;for(i in n)e[t++]=n[i];return e}function cp(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(nd(n)||typeof n=="string")aT(n,e,void 0);else{if(n.T&&typeof n.T=="function")var t=n.T();else if(n.R&&typeof n.R=="function")t=void 0;else if(nd(n)||typeof n=="string"){t=[];for(var i=n.length,s=0;s<i;s++)t.push(s)}else for(s in t=[],i=0,n)t[i++]=s;i=SL(n),s=i.length;for(var r=0;r<s;r++)e.call(void 0,i[r],t&&t[r],n)}}function br(n,e){this.h={},this.g=[],this.i=0;var t=arguments.length;if(1<t){if(t%2)throw Error("Uneven number of arguments");for(var i=0;i<t;i+=2)this.set(arguments[i],arguments[i+1])}else if(n)if(n instanceof br)for(t=n.T(),i=0;i<t.length;i++)this.set(t[i],n.get(t[i]));else for(i in n)this.set(i,n[i])}C=br.prototype;C.R=function(){lp(this);for(var n=[],e=0;e<this.g.length;e++)n.push(this.h[this.g[e]]);return n};C.T=function(){return lp(this),this.g.concat()};function lp(n){if(n.i!=n.g.length){for(var e=0,t=0;e<n.g.length;){var i=n.g[e];ss(n.h,i)&&(n.g[t++]=i),e++}n.g.length=t}if(n.i!=n.g.length){var s={};for(t=e=0;e<n.g.length;)i=n.g[e],ss(s,i)||(n.g[t++]=i,s[i]=1),e++;n.g.length=t}}C.get=function(n,e){return ss(this.h,n)?this.h[n]:e};C.set=function(n,e){ss(this.h,n)||(this.i++,this.g.push(n)),this.h[n]=e};C.forEach=function(n,e){for(var t=this.T(),i=0;i<t.length;i++){var s=t[i],r=this.get(s);n.call(e,r,s,this)}};function ss(n,e){return Object.prototype.hasOwnProperty.call(n,e)}var OT=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function CL(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var i=n[t].indexOf("="),s=null;if(0<=i){var r=n[t].substring(0,i);s=n[t].substring(i+1)}else r=n[t];e(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}function rs(n,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,n instanceof rs){this.g=e!==void 0?e:n.g,Yc(this,n.j),this.s=n.s,Xc(this,n.i),Jc(this,n.m),this.l=n.l,e=n.h;var t=new Bo;t.i=e.i,e.g&&(t.g=new br(e.g),t.h=e.h),i_(this,t),this.o=n.o}else n&&(t=String(n).match(OT))?(this.g=!!e,Yc(this,t[1]||"",!0),this.s=uo(t[2]||""),Xc(this,t[3]||"",!0),Jc(this,t[4]),this.l=uo(t[5]||"",!0),i_(this,t[6]||"",!0),this.o=uo(t[7]||"")):(this.g=!!e,this.h=new Bo(null,this.g))}rs.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Zr(e,s_,!0),":");var t=this.i;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Zr(e,s_,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.i&&t.charAt(0)!="/"&&n.push("/"),n.push(Zr(t,t.charAt(0)=="/"?PL:NL,!0))),(t=this.h.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Zr(t,OL)),n.join("")};function On(n){return new rs(n)}function Yc(n,e,t){n.j=t?uo(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Xc(n,e,t){n.i=t?uo(e,!0):e}function Jc(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function i_(n,e,t){e instanceof Bo?(n.h=e,xL(n.h,n.g)):(t||(e=Zr(e,DL)),n.h=new Bo(e,n.g))}function ne(n,e,t){n.h.set(e,t)}function uu(n){return ne(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function kL(n){return n instanceof rs?On(n):new rs(n,void 0)}function AL(n,e,t,i){var s=new rs(null,void 0);return n&&Yc(s,n),e&&Xc(s,e),t&&Jc(s,t),i&&(s.l=i),s}function uo(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Zr(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,RL),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function RL(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var s_=/[#\/\?@]/g,NL=/[#\?:]/g,PL=/[#\?]/g,DL=/[#\?@]/g,OL=/#/g;function Bo(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function wi(n){n.g||(n.g=new br,n.h=0,n.i&&CL(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}C=Bo.prototype;C.add=function(n,e){wi(this),this.i=null,n=Sr(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function xT(n,e){wi(n),e=Sr(n,e),ss(n.g.h,e)&&(n.i=null,n.h-=n.g.get(e).length,n=n.g,ss(n.h,e)&&(delete n.h[e],n.i--,n.g.length>2*n.i&&lp(n)))}function MT(n,e){return wi(n),e=Sr(n,e),ss(n.g.h,e)}C.forEach=function(n,e){wi(this),this.g.forEach(function(t,i){aT(t,function(s){n.call(e,s,i,this)},this)},this)};C.T=function(){wi(this);for(var n=this.g.R(),e=this.g.T(),t=[],i=0;i<e.length;i++)for(var s=n[i],r=0;r<s.length;r++)t.push(e[i]);return t};C.R=function(n){wi(this);var e=[];if(typeof n=="string")MT(this,n)&&(e=zm(e,this.g.get(Sr(this,n))));else{n=this.g.R();for(var t=0;t<n.length;t++)e=zm(e,n[t])}return e};C.set=function(n,e){return wi(this),this.i=null,n=Sr(this,n),MT(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};C.get=function(n,e){return n?(n=this.R(n),0<n.length?String(n[0]):e):e};function LT(n,e,t){xT(n,e),0<t.length&&(n.i=null,n.g.set(Sr(n,e),zf(t)),n.h+=t.length)}C.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var n=[],e=this.g.T(),t=0;t<e.length;t++){var i=e[t],s=encodeURIComponent(String(i));i=this.R(i);for(var r=0;r<i.length;r++){var o=s;i[r]!==""&&(o+="="+encodeURIComponent(String(i[r]))),n.push(o)}}return this.i=n.join("&")};function Sr(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function xL(n,e){e&&!n.j&&(wi(n),n.i=null,n.g.forEach(function(t,i){var s=i.toLowerCase();i!=s&&(xT(this,i),LT(this,s,t))},n)),n.j=e}var ML=class{constructor(n,e){this.h=n,this.g=e}};function FT(n){this.l=n||LL,L.PerformanceNavigationTiming?(n=L.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(L.g&&L.g.Ea&&L.g.Ea()&&L.g.Ea().Zb),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var LL=10;function UT(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function VT(n){return n.h?1:n.g?n.g.size:0}function fd(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function up(n,e){n.g?n.g.add(e):n.h=e}function BT(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}FT.prototype.cancel=function(){if(this.i=$T(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const n of this.g.values())n.cancel();this.g.clear()}};function $T(n){if(n.h!=null)return n.i.concat(n.h.D);if(n.g!=null&&n.g.size!==0){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return zf(n.i)}function hp(){}hp.prototype.stringify=function(n){return L.JSON.stringify(n,void 0)};hp.prototype.parse=function(n){return L.JSON.parse(n,void 0)};function FL(){this.g=new hp}function UL(n,e,t){const i=t||"";try{cp(n,function(s,r){let o=s;Ea(s)&&(o=tp(s)),e.push(i+r+"="+encodeURIComponent(o))})}catch(s){throw e.push(i+"type="+encodeURIComponent("_badmap")),s}}function VL(n,e){const t=new ru;if(L.Image){const i=new Image;i.onload=Ya(Ja,t,i,"TestLoadImage: loaded",!0,e),i.onerror=Ya(Ja,t,i,"TestLoadImage: error",!1,e),i.onabort=Ya(Ja,t,i,"TestLoadImage: abort",!1,e),i.ontimeout=Ya(Ja,t,i,"TestLoadImage: timeout",!1,e),L.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else e(!1)}function Ja(n,e,t,i,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(i)}catch{}}function Ra(n){this.l=n.$b||null,this.j=n.ib||!1}Xe(Ra,rp);Ra.prototype.g=function(){return new hu(this.l,this.j)};Ra.prototype.i=function(n){return function(){return n}}({});function hu(n,e){Me.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=dp,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Xe(hu,Me);var dp=0;C=hu.prototype;C.open=function(n,e){if(this.readyState!=dp)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,$o(this)};C.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||L).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))};C.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Na(this)),this.readyState=dp};C.Va=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,$o(this)),this.g&&(this.readyState=3,$o(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(typeof L.ReadableStream!="undefined"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;qT(this)}else n.text().then(this.Ua.bind(this),this.ha.bind(this))};function qT(n){n.j.read().then(n.Sa.bind(n)).catch(n.ha.bind(n))}C.Sa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Na(this):$o(this),this.readyState==3&&qT(this)}};C.Ua=function(n){this.g&&(this.response=this.responseText=n,Na(this))};C.Ta=function(n){this.g&&(this.response=n,Na(this))};C.ha=function(){this.g&&Na(this)};function Na(n){n.readyState=4,n.l=null,n.j=null,n.A=null,$o(n)}C.setRequestHeader=function(n,e){this.v.append(n,e)};C.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};C.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function $o(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(hu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var BL=L.JSON.parse;function _e(n){Me.call(this),this.headers=new br,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=jT,this.K=this.L=!1}Xe(_e,Me);var jT="",$L=/^https?$/i,qL=["POST","PUT"];C=_e.prototype;C.ea=function(n,e,t,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ld.g(),this.C=this.u?n_(this.u):n_(ld),this.g.onreadystatechange=He(this.Fa,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(r){r_(this,r);return}n=t||"";const s=new br(this.headers);i&&cp(i,function(r,o){s.set(o,r)}),i=ZM(s.T()),t=L.FormData&&n instanceof L.FormData,!(0<=oT(qL,e))||i||t||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(r,o){this.g.setRequestHeader(o,r)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{WT(this),0<this.B&&((this.K=jL(this.g))?(this.g.timeout=this.B,this.g.ontimeout=He(this.pa,this)):this.A=sp(this.pa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(r){r_(this,r)}};function jL(n){return or&&sL()&&typeof n.timeout=="number"&&n.ontimeout!==void 0}function KL(n){return n.toLowerCase()=="content-type"}C.pa=function(){typeof Hf!="undefined"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ze(this,"timeout"),this.abort(8))};function r_(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,KT(n),du(n)}function KT(n){n.D||(n.D=!0,ze(n,"complete"),ze(n,"error"))}C.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ze(this,"complete"),ze(this,"abort"),du(this))};C.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),du(this,!0)),_e.Z.M.call(this)};C.Fa=function(){this.s||(this.F||this.v||this.l?GT(this):this.cb())};C.cb=function(){GT(this)};function GT(n){if(n.h&&typeof Hf!="undefined"&&(!n.C[1]||Cn(n)!=4||n.ba()!=2)){if(n.v&&Cn(n)==4)sp(n.Fa,0,n);else if(ze(n,"readystatechange"),Cn(n)==4){n.h=!1;try{const a=n.ba();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var i;if(i=a===0){var s=String(n.H).match(OT)[1]||null;if(!s&&L.self&&L.self.location){var r=L.self.location.protocol;s=r.substr(0,r.length-1)}i=!$L.test(s?s.toLowerCase():"")}t=i}if(t)ze(n,"complete"),ze(n,"success");else{n.m=6;try{var o=2<Cn(n)?n.g.statusText:""}catch{o=""}n.j=o+" ["+n.ba()+"]",KT(n)}}finally{du(n)}}}}function du(n,e){if(n.g){WT(n);const t=n.g,i=n.C[0]?Wc:null;n.g=null,n.C=null,e||ze(n,"ready");try{t.onreadystatechange=i}catch{}}}function WT(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(L.clearTimeout(n.A),n.A=null)}function Cn(n){return n.g?n.g.readyState:0}C.ba=function(){try{return 2<Cn(this)?this.g.status:-1}catch{return-1}};C.ga=function(){try{return this.g?this.g.responseText:""}catch{return""}};C.Qa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),BL(e)}};function o_(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case jT:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}C.Da=function(){return this.m};C.La=function(){return typeof this.j=="string"?this.j:String(this.j)};function GL(n){let e="";return Qf(n,function(t,i){e+=i,e+=":",e+=t,e+=`\r
`}),e}function fp(n,e,t){e:{for(i in t){var i=!1;break e}i=!0}i||(t=GL(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):ne(n,e,t))}function jr(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function HT(n){this.za=0,this.l=[],this.h=new ru,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=jr("failFast",!1,n),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=jr("baseRetryDelayMs",5e3,n),this.$a=jr("retryDelaySeedMs",1e4,n),this.Ya=jr("forwardChannelMaxRetries",2,n),this.ra=jr("forwardChannelRequestTimeoutMs",2e4,n),this.qa=n&&n.xmlHttpFactory||void 0,this.Ba=n&&n.Yb||!1,this.K=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.J="",this.i=new FT(n&&n.concurrentRequestLimit),this.Ca=new FL,this.ja=n&&n.fastHandshake||!1,this.Ra=n&&n.Wb||!1,n&&n.Aa&&this.h.Aa(),n&&n.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&n&&n.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!n||n.Xb!==!1}C=HT.prototype;C.ma=8;C.G=1;function pp(n){if(zT(n),n.G==3){var e=n.V++,t=On(n.F);ne(t,"SID",n.J),ne(t,"RID",e),ne(t,"TYPE","terminate"),Pa(n,t),e=new ka(n,n.h,e,void 0),e.K=2,e.v=uu(On(t)),t=!1,L.navigator&&L.navigator.sendBeacon&&(t=L.navigator.sendBeacon(e.v.toString(),"")),!t&&L.Image&&(new Image().src=e.v,t=!0),t||(e.g=nE(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Aa(e)}eE(n)}C.hb=function(n){try{this.h.info("Origin Trials invoked: "+n)}catch{}};function fu(n){n.g&&(mp(n),n.g.cancel(),n.g=null)}function zT(n){fu(n),n.u&&(L.clearTimeout(n.u),n.u=null),Zc(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&L.clearTimeout(n.m),n.m=null)}function rh(n,e){n.l.push(new ML(n.Za++,e)),n.G==3&&pu(n)}function pu(n){UT(n.i)||n.m||(n.m=!0,np(n.Ha,n),n.C=0)}function WL(n,e){return VT(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.l=e.D.concat(n.l),!0):n.G==1||n.G==2||n.C>=(n.Xa?0:n.Ya)?!1:(n.m=Sa(He(n.Ha,n,e),ZT(n,n.C)),n.C++,!0)}C.Ha=function(n){if(this.m)if(this.m=null,this.G==1){if(!n){this.V=Math.floor(1e5*Math.random()),n=this.V++;const s=new ka(this,this.h,n,void 0);let r=this.s;if(this.P&&(r?(r=cT(r),lT(r,this.P)):r=this.P),this.o===null&&(s.H=r),this.ja)e:{for(var e=0,t=0;t<this.l.length;t++){t:{var i=this.l[t];if("__data__"in i.g&&(i=i.g.__data__,typeof i=="string")){i=i.length;break t}i=void 0}if(i===void 0)break;if(e+=i,4096<e){e=t;break e}if(e===4096||t===this.l.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=QT(this,s,e),t=On(this.F),ne(t,"RID",n),ne(t,"CVER",22),this.D&&ne(t,"X-HTTP-Session-Id",this.D),Pa(this,t),this.o&&r&&fp(t,this.o,r),up(this.i,s),this.Ra&&ne(t,"TYPE","init"),this.ja?(ne(t,"$req",e),ne(t,"SID","null"),s.$=!0,hd(s,t,null)):hd(s,t,e),this.G=2}}else this.G==3&&(n?a_(this,n):this.l.length==0||UT(this.i)||a_(this))};function a_(n,e){var t;e?t=e.m:t=n.V++;const i=On(n.F);ne(i,"SID",n.J),ne(i,"RID",t),ne(i,"AID",n.U),Pa(n,i),n.o&&n.s&&fp(i,n.o,n.s),t=new ka(n,n.h,t,n.C+1),n.o===null&&(t.H=n.s),e&&(n.l=e.D.concat(n.l)),e=QT(n,t,1e3),t.setTimeout(Math.round(.5*n.ra)+Math.round(.5*n.ra*Math.random())),up(n.i,t),hd(t,i,e)}function Pa(n,e){n.j&&cp({},function(t,i){ne(e,i,t)})}function QT(n,e,t){t=Math.min(n.l.length,t);var i=n.j?He(n.j.Oa,n.j,n):null;e:{var s=n.l;let r=-1;for(;;){const o=["count="+t];r==-1?0<t?(r=s[0].h,o.push("ofs="+r)):r=0:o.push("ofs="+r);let a=!0;for(let c=0;c<t;c++){let l=s[c].h;const u=s[c].g;if(l-=r,0>l)r=Math.max(0,s[c].h-100),a=!1;else try{UL(u,o,"req"+l+"_")}catch{i&&i(u)}}if(a){i=o.join("&");break e}}}return n=n.l.splice(0,t),e.D=n,i}function YT(n){n.g||n.u||(n.Y=1,np(n.Ga,n),n.A=0)}function gp(n){return n.g||n.u||3<=n.A?!1:(n.Y++,n.u=Sa(He(n.Ga,n),ZT(n,n.A)),n.A++,!0)}C.Ga=function(){if(this.u=null,XT(this),this.$&&!(this.L||this.g==null||0>=this.O)){var n=2*this.O;this.h.info("BP detection timer enabled: "+n),this.B=Sa(He(this.bb,this),n)}};C.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ht(10),fu(this),XT(this))};function mp(n){n.B!=null&&(L.clearTimeout(n.B),n.B=null)}function XT(n){n.g=new ka(n,n.h,"rpc",n.Y),n.o===null&&(n.g.H=n.s),n.g.O=0;var e=On(n.oa);ne(e,"RID","rpc"),ne(e,"SID",n.J),ne(e,"CI",n.N?"0":"1"),ne(e,"AID",n.U),Pa(n,e),ne(e,"TYPE","xmlhttp"),n.o&&n.s&&fp(e,n.o,n.s),n.K&&n.g.setTimeout(n.K);var t=n.g;n=n.la,t.K=1,t.v=uu(On(e)),t.s=null,t.U=!0,RT(t,n)}C.ab=function(){this.v!=null&&(this.v=null,fu(this),gp(this),ht(19))};function Zc(n){n.v!=null&&(L.clearTimeout(n.v),n.v=null)}function JT(n,e){var t=null;if(n.g==e){Zc(n),mp(n),n.g=null;var i=2}else if(fd(n.i,e))t=e.D,BT(n.i,e),i=1;else return;if(n.I=e.N,n.G!=0){if(e.i)if(i==1){t=e.s?e.s.length:0,e=Date.now()-e.F;var s=n.C;i=ou(),ze(i,new ST(i,t)),pu(n)}else YT(n);else if(s=e.o,s==3||s==0&&0<n.I||!(i==1&&WL(n,e)||i==2&&gp(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),s){case 1:Bi(n,5);break;case 4:Bi(n,10);break;case 3:Bi(n,6);break;default:Bi(n,2)}}}function ZT(n,e){let t=n.Pa+Math.floor(Math.random()*n.$a);return n.j||(t*=2),t*e}function Bi(n,e){if(n.h.info("Error code "+e),e==2){var t=null;n.j&&(t=null);var i=He(n.jb,n);t||(t=new rs("//www.google.com/images/cleardot.gif"),L.location&&L.location.protocol=="http"||Yc(t,"https"),uu(t)),VL(t.toString(),i)}else ht(2);n.G=0,n.j&&n.j.va(e),eE(n),zT(n)}C.jb=function(n){n?(this.h.info("Successfully pinged google.com"),ht(2)):(this.h.info("Failed to ping google.com"),ht(1))};function eE(n){n.G=0,n.I=-1,n.j&&(($T(n.i).length!=0||n.l.length!=0)&&(n.i.i.length=0,zf(n.l),n.l.length=0),n.j.ua())}function tE(n,e,t){let i=kL(t);if(i.i!="")e&&Xc(i,e+"."+i.i),Jc(i,i.m);else{const s=L.location;i=AL(s.protocol,e?e+"."+s.hostname:s.hostname,+s.port,t)}return n.aa&&Qf(n.aa,function(s,r){ne(i,r,s)}),e=n.D,t=n.sa,e&&t&&ne(i,e,t),ne(i,"VER",n.ma),Pa(n,i),i}function nE(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return e=t&&n.Ba&&!n.qa?new _e(new Ra({ib:!0})):new _e(n.qa),e.L=n.H,e}function iE(){}C=iE.prototype;C.xa=function(){};C.wa=function(){};C.va=function(){};C.ua=function(){};C.Oa=function(){};function el(){if(or&&!(10<=Number(rL)))throw Error("Environmental error: no available transport.")}el.prototype.g=function(n,e){return new Rt(n,e)};function Rt(n,e){Me.call(this),this.g=new HT(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.P=n,(n=e&&e.httpHeadersOverwriteParam)&&!Hc(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Hc(e)&&(this.g.D=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new Cr(this)}Xe(Rt,Me);Rt.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;n.Wa&&(n.h.info("Origin Trials enabled."),np(He(n.hb,n,e))),ht(0),n.W=e,n.aa=t||{},n.N=n.X,n.F=tE(n,null,n.W),pu(n)};Rt.prototype.close=function(){pp(this.g)};Rt.prototype.u=function(n){if(typeof n=="string"){var e={};e.__data__=n,rh(this.g,e)}else this.v?(e={},e.__data__=tp(n),rh(this.g,e)):rh(this.g,n)};Rt.prototype.M=function(){this.g.j=null,delete this.j,pp(this.g),delete this.g,Rt.Z.M.call(this)};function sE(n){op.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}Xe(sE,op);function rE(){ap.call(this),this.status=1}Xe(rE,ap);function Cr(n){this.g=n}Xe(Cr,iE);Cr.prototype.xa=function(){ze(this.g,"a")};Cr.prototype.wa=function(n){ze(this.g,new sE(n))};Cr.prototype.va=function(n){ze(this.g,new rE)};Cr.prototype.ua=function(){ze(this.g,"b")};el.prototype.createWebChannel=el.prototype.g;Rt.prototype.send=Rt.prototype.u;Rt.prototype.open=Rt.prototype.m;Rt.prototype.close=Rt.prototype.close;au.NO_ERROR=0;au.TIMEOUT=8;au.HTTP_ERROR=6;CT.COMPLETE="complete";kT.EventType=Ca;Ca.OPEN="a";Ca.CLOSE="b";Ca.ERROR="c";Ca.MESSAGE="d";Me.prototype.listen=Me.prototype.N;_e.prototype.listenOnce=_e.prototype.O;_e.prototype.getLastError=_e.prototype.La;_e.prototype.getLastErrorCode=_e.prototype.Da;_e.prototype.getStatus=_e.prototype.ba;_e.prototype.getResponseJson=_e.prototype.Qa;_e.prototype.getResponseText=_e.prototype.ga;_e.prototype.send=_e.prototype.ea;var HL=function(){return new el},zL=function(){return ou()},oh=au,QL=CT,YL=bs,c_={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},XL=Ra,Za=kT,JL=_e;const l_="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ce{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ce.UNAUTHENTICATED=new Ce(null),Ce.GOOGLE_CREDENTIALS=new Ce("google-credentials-uid"),Ce.FIRST_PARTY=new Ce("first-party-uid"),Ce.MOCK_USER=new Ce("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kr="9.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ai=new pi("@firebase/firestore");function pd(){return ai.logLevel}function ZL(n){ai.setLogLevel(n)}function I(n,...e){if(ai.logLevel<=Ct.DEBUG){const t=e.map(_p);ai.debug(`Firestore (${kr}): ${n}`,...t)}}function me(n,...e){if(ai.logLevel<=Ct.ERROR){const t=e.map(_p);ai.error(`Firestore (${kr}): ${n}`,...t)}}function qo(n,...e){if(ai.logLevel<=Ct.WARN){const t=e.map(_p);ai.warn(`Firestore (${kr}): ${n}`,...t)}}function _p(n){if(typeof n=="string")return n;try{return e=n,JSON.stringify(e)}catch{return n}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k(n="Unexpected state"){const e=`FIRESTORE (${kr}) INTERNAL ASSERTION FAILED: `+n;throw me(e),new Error(e)}function O(n,e){n||k()}function e1(n,e){n||k()}function S(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class y extends Ke{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oE{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class t1{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ce.UNAUTHENTICATED))}shutdown(){}}class n1{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class i1{constructor(e){this.t=e,this.currentUser=Ce.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let i=this.i;const s=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let r=new Re;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Re,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=r;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},a=c=>{I("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(I("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Re)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(I("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(O(typeof i.accessToken=="string"),new oE(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return O(e===null||typeof e=="string"),new Ce(e)}}class s1{constructor(e,t,i){this.type="FirstParty",this.user=Ce.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",t);const s=e.auth.getAuthHeaderValueForFirstParty([]);s&&this.headers.set("Authorization",s),i&&this.headers.set("X-Goog-Iam-Authorization-Token",i)}}class r1{constructor(e,t,i){this.h=e,this.l=t,this.m=i}getToken(){return Promise.resolve(new s1(this.h,this.l,this.m))}start(e,t){e.enqueueRetryable(()=>t(Ce.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class o1{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class a1{constructor(e){this.g=e,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(e,t){const i=r=>{r.error!=null&&I("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const o=r.token!==this.p;return this.p=r.token,I("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable(()=>i(r))};const s=r=>{I("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.appCheck.addTokenListener(this.o)};this.g.onInit(r=>s(r)),setTimeout(()=>{if(!this.appCheck){const r=this.g.getImmediate({optional:!0});r?s(r):I("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(O(typeof t.token=="string"),this.p=t.token,new o1(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function c1(n){const e=typeof self!="undefined"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aE{static I(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let i="";for(;i.length<20;){const s=c1(40);for(let r=0;r<s.length;++r)i.length<20&&s[r]<t&&(i+=e.charAt(s[r]%e.length))}return i}}function F(n,e){return n<e?-1:n>e?1:0}function ar(n,e,t){return n.length===e.length&&n.every((i,s)=>t(i,e[s]))}function cE(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class se{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return se.fromMillis(Date.now())}static fromDate(e){return se.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new se(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?F(this.nanoseconds,e.nanoseconds):F(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D{constructor(e){this.timestamp=e}static fromTimestamp(e){return new D(e)}static min(){return new D(new se(0,0))}static max(){return new D(new se(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jo{constructor(e,t,i){t===void 0?t=0:t>e.length&&k(),i===void 0?i=e.length-t:i>e.length-t&&k(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return jo.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof jo?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let s=0;s<i;s++){const r=e.get(s),o=t.get(s);if(r<o)return-1;if(r>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class j extends jo{construct(e,t,i){return new j(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new y(m.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(s=>s.length>0))}return new j(t)}static emptyPath(){return new j([])}}const l1=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class de extends jo{construct(e,t,i){return new de(e,t,i)}static isValidIdentifier(e){return l1.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),de.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new de(["__name__"])}static fromServerFormat(e){const t=[];let i="",s=0;const r=()=>{if(i.length===0)throw new y(m.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new y(m.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new y(m.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=c,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(i+=a,s++):(r(),s++)}if(r(),o)throw new y(m.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new de(t)}static emptyPath(){return new de([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b{constructor(e){this.path=e}static fromPath(e){return new b(j.fromString(e))}static fromName(e){return new b(j.fromString(e).popFirst(5))}static empty(){return new b(j.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&j.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return j.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new b(new j(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lE{constructor(e,t,i,s){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=s}}function gd(n){return n.fields.find(e=>e.kind===2)}function Ri(n){return n.fields.filter(e=>e.kind!==2)}lE.UNKNOWN_ID=-1;class u1{constructor(e,t){this.fieldPath=e,this.kind=t}}class tl{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new tl(0,Nt.min())}}function uE(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,s=D.fromTimestamp(i===1e9?new se(t+1,0):new se(t,i));return new Nt(s,b.empty(),e)}function hE(n){return new Nt(n.readTime,n.key,-1)}class Nt{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new Nt(D.min(),b.empty(),-1)}static max(){return new Nt(D.max(),b.empty(),-1)}}function yp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=b.comparator(n.documentKey,e.documentKey),t!==0?t:F(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class fE{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vi(n){if(n.code!==m.FAILED_PRECONDITION||n.message!==dE)throw n;I("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&k(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new g((i,s)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(i,s)},this.catchCallback=r=>{this.wrapFailure(t,r).next(i,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof g?t:g.resolve(t)}catch(t){return g.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):g.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):g.reject(t)}static resolve(e){return new g((t,i)=>{t(e)})}static reject(e){return new g((t,i)=>{i(e)})}static waitFor(e){return new g((t,i)=>{let s=0,r=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++r,o&&r===s&&t()},c=>i(c))}),o=!0,r===s&&t()})}static or(e){let t=g.resolve(!1);for(const i of e)t=t.next(s=>s?g.resolve(s):i());return t}static forEach(e,t){const i=[];return e.forEach((s,r)=>{i.push(t.call(this,s,r))}),this.waitFor(i)}static mapArray(e,t){return new g((i,s)=>{const r=e.length,o=new Array(r);let a=0;for(let c=0;c<r;c++){const l=c;t(e[l]).next(u=>{o[l]=u,++a,a===r&&i(o)},u=>s(u))}})}static doWhile(e,t){return new g((i,s)=>{const r=()=>{e()===!0?t().next(()=>{r()},s):i()};r()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.T=new Re,this.transaction.oncomplete=()=>{this.T.resolve()},this.transaction.onabort=()=>{t.error?this.T.reject(new ho(e,t.error)):this.T.resolve()},this.transaction.onerror=i=>{const s=wp(i.target.error);this.T.reject(new ho(e,s))}}static open(e,t,i,s){try{return new gu(t,e.transaction(s,i))}catch(r){throw new ho(t,r)}}get A(){return this.T.promise}abort(e){e&&this.T.reject(e),this.aborted||(I("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}R(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new d1(t)}}class Gt{constructor(e,t,i){this.name=e,this.version=t,this.P=i,Gt.v(pe())===12.2&&me("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return I("SimpleDb","Removing database:",e),Pi(window.indexedDB.deleteDatabase(e)).toPromise()}static V(){if(!At())return!1;if(Gt.S())return!0;const e=pe(),t=Gt.v(e),i=0<t&&t<10,s=Gt.D(e),r=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||r)}static S(){var e;return typeof process!="undefined"&&((e=process.env)===null||e===void 0?void 0:e.C)==="YES"}static N(e,t){return e.store(t)}static v(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}static D(e){const t=e.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}async k(e){return this.db||(I("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,i)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=r=>{const o=r.target.result;t(o)},s.onblocked=()=>{i(new ho(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=r=>{const o=r.target.error;o.name==="VersionError"?i(new y(m.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new y(m.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new ho(e,o))},s.onupgradeneeded=r=>{I("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',r.oldVersion);const o=r.target.result;this.P.O(o,s.transaction,r.oldVersion,this.version).next(()=>{I("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.M&&(this.db.onversionchange=t=>this.M(t)),this.db}F(e){this.M=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,i,s){const r=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.k(e);const a=gu.open(this.db,e,r?"readonly":"readwrite",i),c=s(a).next(l=>(a.R(),l)).catch(l=>(a.abort(l),g.reject(l))).toPromise();return c.catch(()=>{}),await a.A,c}catch(a){const c=a,l=c.name!=="FirebaseError"&&o<3;if(I("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),this.close(),!l)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}class h1{constructor(e){this.$=e,this.B=!1,this.L=null}get isDone(){return this.B}get U(){return this.L}set cursor(e){this.$=e}done(){this.B=!0}q(e){this.L=e}delete(){return Pi(this.$.delete())}}class ho extends y{constructor(e,t){super(m.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ii(n){return n.name==="IndexedDbTransactionError"}class d1{constructor(e){this.store=e}put(e,t){let i;return t!==void 0?(I("SimpleDb","PUT",this.store.name,e,t),i=this.store.put(t,e)):(I("SimpleDb","PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),Pi(i)}add(e){return I("SimpleDb","ADD",this.store.name,e,e),Pi(this.store.add(e))}get(e){return Pi(this.store.get(e)).next(t=>(t===void 0&&(t=null),I("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return I("SimpleDb","DELETE",this.store.name,e),Pi(this.store.delete(e))}count(){return I("SimpleDb","COUNT",this.store.name),Pi(this.store.count())}K(e,t){const i=this.options(e,t);if(i.index||typeof this.store.getAll!="function"){const s=this.cursor(i),r=[];return this.G(s,(o,a)=>{r.push(a)}).next(()=>r)}{const s=this.store.getAll(i.range);return new g((r,o)=>{s.onerror=a=>{o(a.target.error)},s.onsuccess=a=>{r(a.target.result)}})}}j(e,t){const i=this.store.getAll(e,t===null?void 0:t);return new g((s,r)=>{i.onerror=o=>{r(o.target.error)},i.onsuccess=o=>{s(o.target.result)}})}W(e,t){I("SimpleDb","DELETE ALL",this.store.name);const i=this.options(e,t);i.H=!1;const s=this.cursor(i);return this.G(s,(r,o,a)=>a.delete())}J(e,t){let i;t?i=e:(i={},t=e);const s=this.cursor(i);return this.G(s,t)}Y(e){const t=this.cursor({});return new g((i,s)=>{t.onerror=r=>{const o=wp(r.target.error);s(o)},t.onsuccess=r=>{const o=r.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():i()}):i()}})}G(e,t){const i=[];return new g((s,r)=>{e.onerror=o=>{r(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const c=new h1(a),l=t(a.primaryKey,a.value,c);if(l instanceof g){const u=l.catch(h=>(c.done(),g.reject(h)));i.push(u)}c.isDone?s():c.U===null?a.continue():a.continue(c.U)}}).next(()=>g.waitFor(i))}options(e,t){let i;return e!==void 0&&(typeof e=="string"?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const i=this.store.index(e.index);return e.H?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Pi(n){return new g((e,t)=>{n.onsuccess=i=>{const s=i.target.result;e(s)},n.onerror=i=>{const s=wp(i.target.error);t(s)}})}let u_=!1;function wp(n){const e=Gt.v(pe());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const i=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return u_||(u_=!0,setTimeout(()=>{throw i},0)),i}}return n}class f1{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}Z(e){I("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{I("IndexBackiller",`Documents written: ${await this.X.tt()}`)}catch(t){Ii(t)?I("IndexBackiller","Ignoring IndexedDB error during index backfill: ",t):await vi(t)}await this.Z(1)})}}class p1{constructor(e,t){this.localStore=e,this.persistence=t}async tt(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.et(t,e))}et(e,t){const i=new Set;let s=t,r=!0;return g.doWhile(()=>r===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!i.has(o))return I("IndexBackiller",`Processing collection: ${o}`),this.nt(e,o,s).next(a=>{s-=a,i.add(o)});r=!1})).next(()=>t-s)}nt(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,i).next(r=>{const o=r.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.st(s,r)).next(a=>(I("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}st(e,t){let i=e;return t.changes.forEach((s,r)=>{const o=hE(r);yp(o,i)>0&&(i=o)}),new Nt(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.it(i),this.rt=i=>t.writeSequenceNumber(i))}it(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.rt&&this.rt(e),e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h_(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ss(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function pE(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yt.ot=-1;class ce{constructor(e,t){this.comparator=e,this.root=t||$e.EMPTY}insert(e,t){return new ce(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,$e.BLACK,null,null))}remove(e){return new ce(this.comparator,this.root.remove(e,this.comparator).copy(null,null,$e.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const s=this.comparator(e,i.key);if(s===0)return t+i.left.size;s<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ec(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ec(this.root,e,this.comparator,!1)}getReverseIterator(){return new ec(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ec(this.root,e,this.comparator,!0)}}class ec{constructor(e,t,i,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?i(e.key,t):1,t&&s&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class $e{constructor(e,t,i,s,r){this.key=e,this.value=t,this.color=i!=null?i:$e.RED,this.left=s!=null?s:$e.EMPTY,this.right=r!=null?r:$e.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,s,r){return new $e(e!=null?e:this.key,t!=null?t:this.value,i!=null?i:this.color,s!=null?s:this.left,r!=null?r:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const r=i(e,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(e,t,i),null):r===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return $e.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return $e.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,$e.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,$e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw k();const e=this.left.check();if(e!==this.right.check())throw k();return e+(this.isRed()?0:1)}}$e.EMPTY=null,$e.RED=!0,$e.BLACK=!1;$e.EMPTY=new class{constructor(){this.size=0}get key(){throw k()}get value(){throw k()}get color(){throw k()}get left(){throw k()}get right(){throw k()}copy(n,e,t,i,s){return this}insert(n,e,t){return new $e(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q{constructor(e){this.comparator=e,this.data=new ce(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const s=i.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new d_(this.data.getIterator())}getIteratorFrom(e){return new d_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof Q)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,r=i.getNext().key;if(this.comparator(s,r)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Q(this.comparator);return t.data=e,t}}class d_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ds(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kt{constructor(e){this.fields=e,e.sort(de.comparator)}static empty(){return new kt([])}unionWith(e){let t=new Q(de.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new kt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ar(this.fields,e.fields,(t,i)=>t.isEqual(i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function g1(){return typeof atob!="undefined"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ve{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new ve(t)}static fromUint8Array(e){const t=function(i){let s="";for(let r=0;r<i.length;++r)s+=String.fromCharCode(i[r]);return s}(e);return new ve(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return F(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}ve.EMPTY_BYTE_STRING=new ve("");const m1=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ci(n){if(O(!!n),typeof n=="string"){let e=0;const t=m1.exec(n);if(O(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:ae(n.seconds),nanos:ae(n.nanos)}}function ae(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function os(n){return typeof n=="string"?ve.fromBase64String(n):ve.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vp(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function gE(n){const e=n.mapValue.fields.__previous_value__;return vp(e)?gE(e):e}function Ko(n){const e=ci(n.mapValue.fields.__local_write_time__.timestampValue);return new se(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _1{constructor(e,t,i,s,r,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=s,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=c}}class xn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new xn("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof xn&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Da(n){return n==null}function Go(n){return n===0&&1/n==-1/0}function mE(n){return typeof n=="number"&&Number.isInteger(n)&&!Go(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},fc={nullValue:"NULL_VALUE"};function as(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?vp(n)?4:_E(n)?9007199254740991:10:k()}function _n(n,e){if(n===e)return!0;const t=as(n);if(t!==as(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Ko(n).isEqual(Ko(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const r=ci(i.timestampValue),o=ci(s.timestampValue);return r.seconds===o.seconds&&r.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return os(i.bytesValue).isEqual(os(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ae(i.geoPointValue.latitude)===ae(s.geoPointValue.latitude)&&ae(i.geoPointValue.longitude)===ae(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ae(i.integerValue)===ae(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const r=ae(i.doubleValue),o=ae(s.doubleValue);return r===o?Go(r)===Go(o):isNaN(r)&&isNaN(o)}return!1}(n,e);case 9:return ar(n.arrayValue.values||[],e.arrayValue.values||[],_n);case 10:return function(i,s){const r=i.mapValue.fields||{},o=s.mapValue.fields||{};if(h_(r)!==h_(o))return!1;for(const a in r)if(r.hasOwnProperty(a)&&(o[a]===void 0||!_n(r[a],o[a])))return!1;return!0}(n,e);default:return k()}}function Wo(n,e){return(n.values||[]).find(t=>_n(t,e))!==void 0}function li(n,e){if(n===e)return 0;const t=as(n),i=as(e);if(t!==i)return F(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return F(n.booleanValue,e.booleanValue);case 2:return function(s,r){const o=ae(s.integerValue||s.doubleValue),a=ae(r.integerValue||r.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return f_(n.timestampValue,e.timestampValue);case 4:return f_(Ko(n),Ko(e));case 5:return F(n.stringValue,e.stringValue);case 6:return function(s,r){const o=os(s),a=os(r);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(s,r){const o=s.split("/"),a=r.split("/");for(let c=0;c<o.length&&c<a.length;c++){const l=F(o[c],a[c]);if(l!==0)return l}return F(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,r){const o=F(ae(s.latitude),ae(r.latitude));return o!==0?o:F(ae(s.longitude),ae(r.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,r){const o=s.values||[],a=r.values||[];for(let c=0;c<o.length&&c<a.length;++c){const l=li(o[c],a[c]);if(l)return l}return F(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,r){if(s===Yn.mapValue&&r===Yn.mapValue)return 0;if(s===Yn.mapValue)return 1;if(r===Yn.mapValue)return-1;const o=s.fields||{},a=Object.keys(o),c=r.fields||{},l=Object.keys(c);a.sort(),l.sort();for(let u=0;u<a.length&&u<l.length;++u){const h=F(a[u],l[u]);if(h!==0)return h;const d=li(o[a[u]],c[l[u]]);if(d!==0)return d}return F(a.length,l.length)}(n.mapValue,e.mapValue);default:throw k()}}function f_(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return F(n,e);const t=ci(n),i=ci(e),s=F(t.seconds,i.seconds);return s!==0?s:F(t.nanos,i.nanos)}function Ws(n){return md(n)}function md(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const s=ci(i);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?os(n.bytesValue).toBase64():"referenceValue"in n?(t=n.referenceValue,b.fromName(t).toString()):"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(i){let s="[",r=!0;for(const o of i.values||[])r?r=!1:s+=",",s+=md(o);return s+"]"}(n.arrayValue):"mapValue"in n?function(i){const s=Object.keys(i.fields||{}).sort();let r="{",o=!0;for(const a of s)o?o=!1:r+=",",r+=`${a}:${md(i.fields[a])}`;return r+"}"}(n.mapValue):k();var e,t}function cs(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function _d(n){return!!n&&"integerValue"in n}function Ho(n){return!!n&&"arrayValue"in n}function p_(n){return!!n&&"nullValue"in n}function g_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function pc(n){return!!n&&"mapValue"in n}function fo(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Ss(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=fo(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=fo(n.arrayValue.values[t]);return e}return Object.assign({},n)}function _E(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function y1(n){return"nullValue"in n?fc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?cs(xn.empty(),b.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:k()}function w1(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?cs(xn.empty(),b.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Yn:k()}function m_(n,e){const t=li(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function __(n,e){const t=li(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qe{constructor(e){this.value=e}static empty(){return new qe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!pc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=fo(t)}setAll(e){let t=de.emptyPath(),i={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,i,s),i={},s=[],t=a.popLast()}o?i[a.lastSegment()]=fo(o):s.push(a.lastSegment())});const r=this.getFieldsMap(t);this.applyChanges(r,i,s)}delete(e){const t=this.field(e.popLast());pc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return _n(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let s=t.mapValue.fields[e.get(i)];pc(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,i){Ss(t,(s,r)=>e[s]=r);for(const s of i)delete e[s]}clone(){return new qe(fo(this.value))}}function yE(n){const e=[];return Ss(n.fields,(t,i)=>{const s=new de([t]);if(pc(i)){const r=yE(i.mapValue).fields;if(r.length===0)e.push(s);else for(const o of r)e.push(s.child(o))}else e.push(s)}),new kt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z{constructor(e,t,i,s,r,o){this.key=e,this.documentType=t,this.version=i,this.readTime=s,this.data=r,this.documentState=o}static newInvalidDocument(e){return new Z(e,0,D.min(),D.min(),qe.empty(),0)}static newFoundDocument(e,t,i){return new Z(e,1,t,D.min(),i,0)}static newNoDocument(e,t){return new Z(e,2,t,D.min(),qe.empty(),0)}static newUnknownDocument(e,t){return new Z(e,3,t,D.min(),qe.empty(),2)}convertToFoundDocument(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=qe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=qe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=D.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Z&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Z(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v1{constructor(e,t=null,i=[],s=[],r=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=s,this.limit=r,this.startAt=o,this.endAt=a,this.ut=null}}function y_(n,e=null,t=[],i=[],s=null,r=null,o=null){return new v1(n,e,t,i,s,r,o)}function ls(n){const e=S(n);if(e.ut===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>{return(s=i).field.canonicalString()+s.op.toString()+Ws(s.value);var s}).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),Da(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>Ws(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>Ws(i)).join(",")),e.ut=t}return e.ut}function I1(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>{return`${(i=t).field.canonicalString()} ${i.op} ${Ws(i.value)}`;var i}).join(", ")}]`),Da(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>function(i){return`${i.field.canonicalString()} (${i.dir})`}(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>Ws(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>Ws(t)).join(",")),`Target(${e})`}function Oa(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let s=0;s<n.orderBy.length;s++)if(!R1(n.orderBy[s],e.orderBy[s]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let s=0;s<n.filters.length;s++)if(t=n.filters[s],i=e.filters[s],t.op!==i.op||!t.field.isEqual(i.field)||!_n(t.value,i.value))return!1;var t,i;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!T_(n.startAt,e.startAt)&&T_(n.endAt,e.endAt)}function nl(n){return b.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function il(n,e){return n.filters.filter(t=>t instanceof je&&t.field.isEqual(e))}function w_(n,e,t){let i=fc,s=!0;for(const r of il(n,e)){let o=fc,a=!0;switch(r.op){case"<":case"<=":o=y1(r.value);break;case"==":case"in":case">=":o=r.value;break;case">":o=r.value,a=!1;break;case"!=":case"not-in":o=fc}m_({value:i,inclusive:s},{value:o,inclusive:a})<0&&(i=o,s=a)}if(t!==null){for(let r=0;r<n.orderBy.length;++r)if(n.orderBy[r].field.isEqual(e)){const o=t.position[r];m_({value:i,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(i=o,s=t.inclusive);break}}return{value:i,inclusive:s}}function v_(n,e,t){let i=Yn,s=!0;for(const r of il(n,e)){let o=Yn,a=!0;switch(r.op){case">=":case">":o=w1(r.value),a=!1;break;case"==":case"in":case"<=":o=r.value;break;case"<":o=r.value,a=!1;break;case"!=":case"not-in":o=Yn}__({value:i,inclusive:s},{value:o,inclusive:a})>0&&(i=o,s=a)}if(t!==null){for(let r=0;r<n.orderBy.length;++r)if(n.orderBy[r].field.isEqual(e)){const o=t.position[r];__({value:i,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(i=o,s=t.inclusive);break}}return{value:i,inclusive:s}}class je extends class{}{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.ct(e,t,i):new T1(e,t,i):t==="array-contains"?new S1(e,i):t==="in"?new C1(e,i):t==="not-in"?new k1(e,i):t==="array-contains-any"?new A1(e,i):new je(e,t,i)}static ct(e,t,i){return t==="in"?new E1(e,i):new b1(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.at(li(t,this.value)):t!==null&&as(this.value)===as(t)&&this.at(li(t,this.value))}at(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return k()}}ht(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class T1 extends je{constructor(e,t,i){super(e,t,i),this.key=b.fromName(i.referenceValue)}matches(e){const t=b.comparator(e.key,this.key);return this.at(t)}}class E1 extends je{constructor(e,t){super(e,"in",t),this.keys=wE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class b1 extends je{constructor(e,t){super(e,"not-in",t),this.keys=wE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function wE(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>b.fromName(i.referenceValue))}class S1 extends je{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ho(t)&&Wo(t.arrayValue,this.value)}}class C1 extends je{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Wo(this.value.arrayValue,t)}}class k1 extends je{constructor(e,t){super(e,"not-in",t)}matches(e){if(Wo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Wo(this.value.arrayValue,t)}}class A1 extends je{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ho(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>Wo(this.value.arrayValue,i))}}class ui{constructor(e,t){this.position=e,this.inclusive=t}}class Hs{constructor(e,t="asc"){this.field=e,this.dir=t}}function R1(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}function I_(n,e,t){let i=0;for(let s=0;s<n.position.length;s++){const r=e[s],o=n.position[s];if(r.field.isKeyField()?i=b.comparator(b.fromName(o.referenceValue),t.key):i=li(o,t.data.field(r.field)),r.dir==="desc"&&(i*=-1),i!==0)break}return i}function T_(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!_n(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(e,t=null,i=[],s=[],r=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=s,this.limit=r,this.limitType=o,this.startAt=a,this.endAt=c,this.lt=null,this.ft=null,this.startAt,this.endAt}}function vE(n,e,t,i,s,r,o,a){return new Un(n,e,t,i,s,r,o,a)}function Ar(n){return new Un(n)}function N1(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Ip(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Tp(n){for(const e of n.filters)if(e.ht())return e.field;return null}function Ep(n){return n.collectionGroup!==null}function cr(n){const e=S(n);if(e.lt===null){e.lt=[];const t=Tp(e),i=Ip(e);if(t!==null&&i===null)t.isKeyField()||e.lt.push(new Hs(t)),e.lt.push(new Hs(de.keyField(),"asc"));else{let s=!1;for(const r of e.explicitOrderBy)e.lt.push(r),r.field.isKeyField()&&(s=!0);if(!s){const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.lt.push(new Hs(de.keyField(),r))}}}return e.lt}function Bt(n){const e=S(n);if(!e.ft)if(e.limitType==="F")e.ft=y_(e.path,e.collectionGroup,cr(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const r of cr(e)){const o=r.dir==="desc"?"asc":"desc";t.push(new Hs(r.field,o))}const i=e.endAt?new ui(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new ui(e.startAt.position,e.startAt.inclusive):null;e.ft=y_(e.path,e.collectionGroup,t,e.filters,e.limit,i,s)}return e.ft}function IE(n,e,t){return new Un(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function xa(n,e){return Oa(Bt(n),Bt(e))&&n.limitType===e.limitType}function TE(n){return`${ls(Bt(n))}|lt:${n.limitType}`}function yd(n){return`Query(target=${I1(Bt(n))}; limitType=${n.limitType})`}function bp(n,e){return e.isFoundDocument()&&function(t,i){const s=i.key.path;return t.collectionGroup!==null?i.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(s):b.isDocumentKey(t.path)?t.path.isEqual(s):t.path.isImmediateParentOf(s)}(n,e)&&function(t,i){for(const s of t.explicitOrderBy)if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(t,i){for(const s of t.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(t,i){return!(t.startAt&&!function(s,r,o){const a=I_(s,r,o);return s.inclusive?a<=0:a<0}(t.startAt,cr(t),i)||t.endAt&&!function(s,r,o){const a=I_(s,r,o);return s.inclusive?a>=0:a>0}(t.endAt,cr(t),i))}(n,e)}function EE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function bE(n){return(e,t)=>{let i=!1;for(const s of cr(n)){const r=P1(s,e,t);if(r!==0)return r;i=i||s.field.isKeyField()}return 0}}function P1(n,e,t){const i=n.field.isKeyField()?b.comparator(e.key,t.key):function(s,r,o){const a=r.data.field(s),c=o.data.field(s);return a!==null&&c!==null?li(a,c):k()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return k()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SE(n,e){if(n.dt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Go(e)?"-0":e}}function CE(n){return{integerValue:""+n}}function kE(n,e){return mE(e)?CE(e):SE(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mu{constructor(){this._=void 0}}function D1(n,e,t){return n instanceof lr?function(i,s){const r={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&(r.fields.__previous_value__=s),{mapValue:r}}(t,e):n instanceof us?RE(n,e):n instanceof hs?NE(n,e):function(i,s){const r=AE(i,s),o=E_(r)+E_(i._t);return _d(r)&&_d(i._t)?CE(o):SE(i.wt,o)}(n,e)}function O1(n,e,t){return n instanceof us?RE(n,e):n instanceof hs?NE(n,e):t}function AE(n,e){return n instanceof ur?_d(t=e)||function(i){return!!i&&"doubleValue"in i}(t)?e:{integerValue:0}:null;var t}class lr extends mu{}class us extends mu{constructor(e){super(),this.elements=e}}function RE(n,e){const t=PE(e);for(const i of n.elements)t.some(s=>_n(s,i))||t.push(i);return{arrayValue:{values:t}}}class hs extends mu{constructor(e){super(),this.elements=e}}function NE(n,e){let t=PE(e);for(const i of n.elements)t=t.filter(s=>!_n(s,i));return{arrayValue:{values:t}}}class ur extends mu{constructor(e,t){super(),this.wt=e,this._t=t}}function E_(n){return ae(n.integerValue||n.doubleValue)}function PE(n){return Ho(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{constructor(e,t){this.field=e,this.transform=t}}function x1(n,e){return n.field.isEqual(e.field)&&function(t,i){return t instanceof us&&i instanceof us||t instanceof hs&&i instanceof hs?ar(t.elements,i.elements,_n):t instanceof ur&&i instanceof ur?_n(t._t,i._t):t instanceof lr&&i instanceof lr}(n.transform,e.transform)}class M1{constructor(e,t){this.version=e,this.transformResults=t}}class oe{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new oe}static exists(e){return new oe(void 0,e)}static updateTime(e){return new oe(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function gc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class _u{}function DE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Nr(n.key,oe.none()):new Rr(n.key,n.data,oe.none());{const t=n.data,i=qe.empty();let s=new Q(de.comparator);for(let r of e.fields)if(!s.has(r)){let o=t.field(r);o===null&&r.length>1&&(r=r.popLast(),o=t.field(r)),o===null?i.delete(r):i.set(r,o),s=s.add(r)}return new Vn(n.key,i,new kt(s.toArray()),oe.none())}}function L1(n,e,t){n instanceof Rr?function(i,s,r){const o=i.value.clone(),a=S_(i.fieldTransforms,s,r.transformResults);o.setAll(a),s.convertToFoundDocument(r.version,o).setHasCommittedMutations()}(n,e,t):n instanceof Vn?function(i,s,r){if(!gc(i.precondition,s))return void s.convertToUnknownDocument(r.version);const o=S_(i.fieldTransforms,s,r.transformResults),a=s.data;a.setAll(OE(i)),a.setAll(o),s.convertToFoundDocument(r.version,a).setHasCommittedMutations()}(n,e,t):function(i,s,r){s.convertToNoDocument(r.version).setHasCommittedMutations()}(0,e,t)}function po(n,e,t,i){return n instanceof Rr?function(s,r,o,a){if(!gc(s.precondition,r))return o;const c=s.value.clone(),l=C_(s.fieldTransforms,a,r);return c.setAll(l),r.convertToFoundDocument(r.version,c).setHasLocalMutations(),null}(n,e,t,i):n instanceof Vn?function(s,r,o,a){if(!gc(s.precondition,r))return o;const c=C_(s.fieldTransforms,a,r),l=r.data;return l.setAll(OE(s)),l.setAll(c),r.convertToFoundDocument(r.version,l).setHasLocalMutations(),o===null?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(u=>u.field))}(n,e,t,i):function(s,r,o){return gc(s.precondition,r)?(r.convertToNoDocument(r.version).setHasLocalMutations(),null):o}(n,e,t)}function F1(n,e){let t=null;for(const i of n.fieldTransforms){const s=e.data.field(i.field),r=AE(i.transform,s||null);r!=null&&(t===null&&(t=qe.empty()),t.set(i.field,r))}return t||null}function b_(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(t,i){return t===void 0&&i===void 0||!(!t||!i)&&ar(t,i,(s,r)=>x1(s,r))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Rr extends _u{constructor(e,t,i,s=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Vn extends _u{constructor(e,t,i,s,r=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function OE(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function S_(n,e,t){const i=new Map;O(n.length===t.length);for(let s=0;s<t.length;s++){const r=n[s],o=r.transform,a=e.data.field(r.field);i.set(r.field,O1(o,a,t[s]))}return i}function C_(n,e,t){const i=new Map;for(const s of n){const r=s.transform,o=t.data.field(s.field);i.set(s.field,D1(r,o,e))}return i}class Nr extends _u{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Sp extends _u{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class U1{constructor(e){this.count=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ge,q;function xE(n){switch(n){default:return k();case m.CANCELLED:case m.UNKNOWN:case m.DEADLINE_EXCEEDED:case m.RESOURCE_EXHAUSTED:case m.INTERNAL:case m.UNAVAILABLE:case m.UNAUTHENTICATED:return!1;case m.INVALID_ARGUMENT:case m.NOT_FOUND:case m.ALREADY_EXISTS:case m.PERMISSION_DENIED:case m.FAILED_PRECONDITION:case m.ABORTED:case m.OUT_OF_RANGE:case m.UNIMPLEMENTED:case m.DATA_LOSS:return!0}}function ME(n){if(n===void 0)return me("GRPC error has no .code"),m.UNKNOWN;switch(n){case ge.OK:return m.OK;case ge.CANCELLED:return m.CANCELLED;case ge.UNKNOWN:return m.UNKNOWN;case ge.DEADLINE_EXCEEDED:return m.DEADLINE_EXCEEDED;case ge.RESOURCE_EXHAUSTED:return m.RESOURCE_EXHAUSTED;case ge.INTERNAL:return m.INTERNAL;case ge.UNAVAILABLE:return m.UNAVAILABLE;case ge.UNAUTHENTICATED:return m.UNAUTHENTICATED;case ge.INVALID_ARGUMENT:return m.INVALID_ARGUMENT;case ge.NOT_FOUND:return m.NOT_FOUND;case ge.ALREADY_EXISTS:return m.ALREADY_EXISTS;case ge.PERMISSION_DENIED:return m.PERMISSION_DENIED;case ge.FAILED_PRECONDITION:return m.FAILED_PRECONDITION;case ge.ABORTED:return m.ABORTED;case ge.OUT_OF_RANGE:return m.OUT_OF_RANGE;case ge.UNIMPLEMENTED:return m.UNIMPLEMENTED;case ge.DATA_LOSS:return m.DATA_LOSS;default:return k()}}(q=ge||(ge={}))[q.OK=0]="OK",q[q.CANCELLED=1]="CANCELLED",q[q.UNKNOWN=2]="UNKNOWN",q[q.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",q[q.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",q[q.NOT_FOUND=5]="NOT_FOUND",q[q.ALREADY_EXISTS=6]="ALREADY_EXISTS",q[q.PERMISSION_DENIED=7]="PERMISSION_DENIED",q[q.UNAUTHENTICATED=16]="UNAUTHENTICATED",q[q.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",q[q.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",q[q.ABORTED=10]="ABORTED",q[q.OUT_OF_RANGE=11]="OUT_OF_RANGE",q[q.UNIMPLEMENTED=12]="UNIMPLEMENTED",q[q.INTERNAL=13]="INTERNAL",q[q.UNAVAILABLE=14]="UNAVAILABLE",q[q.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ti{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[s,r]of i)if(this.equalsFn(s,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),s=this.inner[i];if(s===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return void(s[r]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return i.length===1?delete this.inner[t]:i.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Ss(this.inner,(t,i)=>{for(const[s,r]of i)e(s,r)})}isEmpty(){return pE(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V1=new ce(b.comparator);function wt(){return V1}const LE=new ce(b.comparator);function eo(...n){let e=LE;for(const t of n)e=e.insert(t.key,t);return e}function FE(n){let e=LE;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function on(){return go()}function UE(){return go()}function go(){return new Ti(n=>n.toString(),(n,e)=>n.isEqual(e))}const B1=new ce(b.comparator),$1=new Q(b.comparator);function U(...n){let e=$1;for(const t of n)e=e.add(t);return e}const q1=new Q(F);function yu(){return q1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e,t,i,s,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t){const i=new Map;return i.set(e,Fa.createSynthesizedTargetChangeForCurrentChange(e,t)),new La(D.min(),i,yu(),wt(),U())}}class Fa{constructor(e,t,i,s,r){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t){return new Fa(ve.EMPTY_BYTE_STRING,t,U(),U(),U())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mc{constructor(e,t,i,s){this.gt=e,this.removedTargetIds=t,this.key=i,this.yt=s}}class VE{constructor(e,t){this.targetId=e,this.It=t}}class BE{constructor(e,t,i=ve.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=s}}class k_{constructor(){this.Tt=0,this.Et=R_(),this.At=ve.EMPTY_BYTE_STRING,this.Rt=!1,this.bt=!0}get current(){return this.Rt}get resumeToken(){return this.At}get Pt(){return this.Tt!==0}get vt(){return this.bt}Vt(e){e.approximateByteSize()>0&&(this.bt=!0,this.At=e)}St(){let e=U(),t=U(),i=U();return this.Et.forEach((s,r)=>{switch(r){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:i=i.add(s);break;default:k()}}),new Fa(this.At,this.Rt,e,t,i)}Dt(){this.bt=!1,this.Et=R_()}Ct(e,t){this.bt=!0,this.Et=this.Et.insert(e,t)}xt(e){this.bt=!0,this.Et=this.Et.remove(e)}Nt(){this.Tt+=1}kt(){this.Tt-=1}Ot(){this.bt=!0,this.Rt=!0}}class j1{constructor(e){this.Mt=e,this.Ft=new Map,this.$t=wt(),this.Bt=A_(),this.Lt=new Q(F)}Ut(e){for(const t of e.gt)e.yt&&e.yt.isFoundDocument()?this.qt(t,e.yt):this.Kt(t,e.key,e.yt);for(const t of e.removedTargetIds)this.Kt(t,e.key,e.yt)}Gt(e){this.forEachTarget(e,t=>{const i=this.Qt(t);switch(e.state){case 0:this.jt(t)&&i.Vt(e.resumeToken);break;case 1:i.kt(),i.Pt||i.Dt(),i.Vt(e.resumeToken);break;case 2:i.kt(),i.Pt||this.removeTarget(t);break;case 3:this.jt(t)&&(i.Ot(),i.Vt(e.resumeToken));break;case 4:this.jt(t)&&(this.Wt(t),i.Vt(e.resumeToken));break;default:k()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ft.forEach((i,s)=>{this.jt(s)&&t(s)})}zt(e){const t=e.targetId,i=e.It.count,s=this.Ht(t);if(s){const r=s.target;if(nl(r))if(i===0){const o=new b(r.path);this.Kt(t,o,Z.newNoDocument(o,D.min()))}else O(i===1);else this.Jt(t)!==i&&(this.Wt(t),this.Lt=this.Lt.add(t))}}Yt(e){const t=new Map;this.Ft.forEach((r,o)=>{const a=this.Ht(o);if(a){if(r.current&&nl(a.target)){const c=new b(a.target.path);this.$t.get(c)!==null||this.Xt(o,c)||this.Kt(o,c,Z.newNoDocument(c,e))}r.vt&&(t.set(o,r.St()),r.Dt())}});let i=U();this.Bt.forEach((r,o)=>{let a=!0;o.forEachWhile(c=>{const l=this.Ht(c);return!l||l.purpose===2||(a=!1,!1)}),a&&(i=i.add(r))}),this.$t.forEach((r,o)=>o.setReadTime(e));const s=new La(e,t,this.Lt,this.$t,i);return this.$t=wt(),this.Bt=A_(),this.Lt=new Q(F),s}qt(e,t){if(!this.jt(e))return;const i=this.Xt(e,t.key)?2:0;this.Qt(e).Ct(t.key,i),this.$t=this.$t.insert(t.key,t),this.Bt=this.Bt.insert(t.key,this.Zt(t.key).add(e))}Kt(e,t,i){if(!this.jt(e))return;const s=this.Qt(e);this.Xt(e,t)?s.Ct(t,1):s.xt(t),this.Bt=this.Bt.insert(t,this.Zt(t).delete(e)),i&&(this.$t=this.$t.insert(t,i))}removeTarget(e){this.Ft.delete(e)}Jt(e){const t=this.Qt(e).St();return this.Mt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Nt(e){this.Qt(e).Nt()}Qt(e){let t=this.Ft.get(e);return t||(t=new k_,this.Ft.set(e,t)),t}Zt(e){let t=this.Bt.get(e);return t||(t=new Q(F),this.Bt=this.Bt.insert(e,t)),t}jt(e){const t=this.Ht(e)!==null;return t||I("WatchChangeAggregator","Detected inactive target",e),t}Ht(e){const t=this.Ft.get(e);return t&&t.Pt?null:this.Mt.te(e)}Wt(e){this.Ft.set(e,new k_),this.Mt.getRemoteKeysForTarget(e).forEach(t=>{this.Kt(e,t,null)})}Xt(e,t){return this.Mt.getRemoteKeysForTarget(e).has(t)}}function A_(){return new ce(b.comparator)}function R_(){return new ce(b.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K1=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),G1=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))();class W1{constructor(e,t){this.databaseId=e,this.dt=t}}function zo(n,e){return n.dt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function $E(n,e){return n.dt?e.toBase64():e.toUint8Array()}function H1(n,e){return zo(n,e.toTimestamp())}function Ne(n){return O(!!n),D.fromTimestamp(function(e){const t=ci(e);return new se(t.seconds,t.nanos)}(n))}function Cp(n,e){return function(t){return new j(["projects",t.projectId,"databases",t.database])}(n).child("documents").child(e).canonicalString()}function qE(n){const e=j.fromString(n);return O(YE(e)),e}function Qo(n,e){return Cp(n.databaseId,e.path)}function ln(n,e){const t=qE(e);if(t.get(1)!==n.databaseId.projectId)throw new y(m.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new y(m.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new b(KE(t))}function wd(n,e){return Cp(n.databaseId,e)}function jE(n){const e=qE(n);return e.length===4?j.emptyPath():KE(e)}function Yo(n){return new j(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function KE(n){return O(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function N_(n,e,t){return{name:Qo(n,e),fields:t.value.mapValue.fields}}function GE(n,e,t){const i=ln(n,e.name),s=Ne(e.updateTime),r=new qe({mapValue:{fields:e.fields}}),o=Z.newFoundDocument(i,s,r);return t&&o.setHasCommittedMutations(),t?o.setHasCommittedMutations():o}function z1(n,e){return"found"in e?function(t,i){O(!!i.found),i.found.name,i.found.updateTime;const s=ln(t,i.found.name),r=Ne(i.found.updateTime),o=new qe({mapValue:{fields:i.found.fields}});return Z.newFoundDocument(s,r,o)}(n,e):"missing"in e?function(t,i){O(!!i.missing),O(!!i.readTime);const s=ln(t,i.missing),r=Ne(i.readTime);return Z.newNoDocument(s,r)}(n,e):k()}function Q1(n,e){let t;if("targetChange"in e){e.targetChange;const i=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:k()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],r=function(c,l){return c.dt?(O(l===void 0||typeof l=="string"),ve.fromBase64String(l||"")):(O(l===void 0||l instanceof Uint8Array),ve.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const l=c.code===void 0?m.UNKNOWN:ME(c.code);return new y(l,c.message||"")}(o);t=new BE(i,s,r,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const s=ln(n,i.document.name),r=Ne(i.document.updateTime),o=new qe({mapValue:{fields:i.document.fields}}),a=Z.newFoundDocument(s,r,o),c=i.targetIds||[],l=i.removedTargetIds||[];t=new mc(c,l,a.key,a)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const s=ln(n,i.document),r=i.readTime?Ne(i.readTime):D.min(),o=Z.newNoDocument(s,r),a=i.removedTargetIds||[];t=new mc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const s=ln(n,i.document),r=i.removedTargetIds||[];t=new mc([],r,s,null)}else{if(!("filter"in e))return k();{e.filter;const i=e.filter;i.targetId;const s=i.count||0,r=new U1(s),o=i.targetId;t=new VE(o,r)}}return t}function Xo(n,e){let t;if(e instanceof Rr)t={update:N_(n,e.key,e.value)};else if(e instanceof Nr)t={delete:Qo(n,e.key)};else if(e instanceof Vn)t={update:N_(n,e.key,e.data),updateMask:nF(e.fieldMask)};else{if(!(e instanceof Sp))return k();t={verify:Qo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(s,r){const o=r.transform;if(o instanceof lr)return{fieldPath:r.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof us)return{fieldPath:r.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof hs)return{fieldPath:r.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof ur)return{fieldPath:r.field.canonicalString(),increment:o._t};throw k()}(0,i))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:H1(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:k()}(n,e.precondition)),t}function vd(n,e){const t=e.currentDocument?function(s){return s.updateTime!==void 0?oe.updateTime(Ne(s.updateTime)):s.exists!==void 0?oe.exists(s.exists):oe.none()}(e.currentDocument):oe.none(),i=e.updateTransforms?e.updateTransforms.map(s=>function(r,o){let a=null;if("setToServerValue"in o)O(o.setToServerValue==="REQUEST_TIME"),a=new lr;else if("appendMissingElements"in o){const l=o.appendMissingElements.values||[];a=new us(l)}else if("removeAllFromArray"in o){const l=o.removeAllFromArray.values||[];a=new hs(l)}else"increment"in o?a=new ur(r,o.increment):k();const c=de.fromServerFormat(o.fieldPath);return new Ma(c,a)}(n,s)):[];if(e.update){e.update.name;const s=ln(n,e.update.name),r=new qe({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(a){const c=a.fieldPaths||[];return new kt(c.map(l=>de.fromServerFormat(l)))}(e.updateMask);return new Vn(s,r,o,t,i)}return new Rr(s,r,t,i)}if(e.delete){const s=ln(n,e.delete);return new Nr(s,t)}if(e.verify){const s=ln(n,e.verify);return new Sp(s,t)}return k()}function Y1(n,e){return n&&n.length>0?(O(e!==void 0),n.map(t=>function(i,s){let r=i.updateTime?Ne(i.updateTime):Ne(s);return r.isEqual(D.min())&&(r=Ne(s)),new M1(r,i.transformResults||[])}(t,e))):[]}function WE(n,e){return{documents:[wd(n,e.path)]}}function HE(n,e){const t={structuredQuery:{}},i=e.path;e.collectionGroup!==null?(t.parent=wd(n,i),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=wd(n,i.popLast()),t.structuredQuery.from=[{collectionId:i.lastSegment()}]);const s=function(c){if(c.length===0)return;const l=c.map(u=>function(h){if(h.op==="=="){if(g_(h.value))return{unaryFilter:{field:Os(h.field),op:"IS_NAN"}};if(p_(h.value))return{unaryFilter:{field:Os(h.field),op:"IS_NULL"}}}else if(h.op==="!="){if(g_(h.value))return{unaryFilter:{field:Os(h.field),op:"IS_NOT_NAN"}};if(p_(h.value))return{unaryFilter:{field:Os(h.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Os(h.field),op:Z1(h.op),value:h.value}}}(u));return l.length===1?l[0]:{compositeFilter:{op:"AND",filters:l}}}(e.filters);s&&(t.structuredQuery.where=s);const r=function(c){if(c.length!==0)return c.map(l=>function(u){return{field:Os(u.field),direction:J1(u.dir)}}(l))}(e.orderBy);r&&(t.structuredQuery.orderBy=r);const o=function(c,l){return c.dt||Da(l)?l:{value:l}}(n,e.limit);var a;return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),t}function zE(n){let e=jE(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let s=null;if(i>0){O(i===1);const u=t.from[0];u.allDescendants?s=u.collectionId:e=e.child(u.collectionId)}let r=[];t.where&&(r=QE(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(u=>function(h){return new Hs(Vs(h.field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(h.direction))}(u)));let a=null;t.limit&&(a=function(u){let h;return h=typeof u=="object"?u.value:u,Da(h)?null:h}(t.limit));let c=null;t.startAt&&(c=function(u){const h=!!u.before,d=u.values||[];return new ui(d,h)}(t.startAt));let l=null;return t.endAt&&(l=function(u){const h=!u.before,d=u.values||[];return new ui(d,h)}(t.endAt)),vE(e,s,o,r,a,"F",c,l)}function X1(n,e){const t=function(i,s){switch(s){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return k()}}(0,e.purpose);return t==null?null:{"goog-listen-tags":t}}function QE(n){return n?n.unaryFilter!==void 0?[tF(n)]:n.fieldFilter!==void 0?[eF(n)]:n.compositeFilter!==void 0?n.compositeFilter.filters.map(e=>QE(e)).reduce((e,t)=>e.concat(t)):k():[]}function J1(n){return K1[n]}function Z1(n){return G1[n]}function Os(n){return{fieldPath:n.canonicalString()}}function Vs(n){return de.fromServerFormat(n.fieldPath)}function eF(n){return je.create(Vs(n.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return k()}}(n.fieldFilter.op),n.fieldFilter.value)}function tF(n){switch(n.unaryFilter.op){case"IS_NAN":const e=Vs(n.unaryFilter.field);return je.create(e,"==",{doubleValue:NaN});case"IS_NULL":const t=Vs(n.unaryFilter.field);return je.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Vs(n.unaryFilter.field);return je.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Vs(n.unaryFilter.field);return je.create(s,"!=",{nullValue:"NULL_VALUE"});default:return k()}}function nF(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function YE(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=P_(e)),e=iF(n.get(t),e);return P_(e)}function iF(n,e){let t=e;const i=n.length;for(let s=0;s<i;s++){const r=n.charAt(s);switch(r){case"\0":t+="";break;case"":t+="";break;default:t+=r}}return t}function P_(n){return n+""}function an(n){const e=n.length;if(O(e>=2),e===2)return O(n.charAt(0)===""&&n.charAt(1)===""),j.emptyPath();const t=e-2,i=[];let s="";for(let r=0;r<e;){const o=n.indexOf("",r);switch((o<0||o>t)&&k(),n.charAt(o+1)){case"":const a=n.substring(r,o);let c;s.length===0?c=a:(s+=a,c=s,s=""),i.push(c);break;case"":s+=n.substring(r,o),s+="\0";break;case"":s+=n.substring(r,o+1);break;default:k()}r=o+2}return new j(i)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D_=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _c(n,e){return[n,dt(e)]}function XE(n,e,t){return[n,dt(e),t]}const sF={},rF=["prefixPath","collectionGroup","readTime","documentId"],oF=["prefixPath","collectionGroup","documentId"],aF=["collectionGroup","readTime","prefixPath","documentId"],cF=["canonicalId","targetId"],lF=["targetId","path"],uF=["path","targetId"],hF=["collectionId","parent"],dF=["indexId","uid"],fF=["uid","sequenceNumber"],pF=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],gF=["indexId","uid","orderedDocumentKey"],mF=["userId","collectionPath","documentId"],_F=["userId","collectionPath","largestBatchId"],yF=["userId","collectionGroup","largestBatchId"],JE=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],wF=[...JE,"documentOverlays"],ZE=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],eb=ZE,vF=[...eb,"indexConfiguration","indexState","indexEntries"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Id extends fE{constructor(e,t){super(),this.ee=e,this.currentSequenceNumber=t}}function Ue(n,e){const t=S(n);return Gt.N(t.ee,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kp{constructor(e,t,i,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=s}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const r=this.mutations[s];r.key.isEqual(e.key)&&L1(r,e,i[s])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=po(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=po(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=UE();return this.mutations.forEach(s=>{const r=e.get(s.key),o=r.overlayedDocument;let a=this.applyToLocalView(o,r.mutatedFields);a=t.has(s.key)?null:a;const c=DE(o,a);c!==null&&i.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(D.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),U())}isEqual(e){return this.batchId===e.batchId&&ar(this.mutations,e.mutations,(t,i)=>b_(t,i))&&ar(this.baseMutations,e.baseMutations,(t,i)=>b_(t,i))}}class Ap{constructor(e,t,i,s){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=s}static from(e,t,i){O(e.mutations.length===i.length);let s=B1;const r=e.mutations;for(let o=0;o<r.length;o++)s=s.insert(r[o].key,i[o].version);return new Ap(e,t,i,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rp{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e,t,i,s,r=D.min(),o=D.min(),a=ve.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new ei(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new ei(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new ei(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tb{constructor(e){this.ne=e}}function IF(n,e){let t;if(e.document)t=GE(n.ne,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const i=b.fromSegments(e.noDocument.path),s=fs(e.noDocument.readTime);t=Z.newNoDocument(i,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return k();{const i=b.fromSegments(e.unknownDocument.path),s=fs(e.unknownDocument.version);t=Z.newUnknownDocument(i,s)}}return e.readTime&&t.setReadTime(function(i){const s=new se(i[0],i[1]);return D.fromTimestamp(s)}(e.readTime)),t}function O_(n,e){const t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:sl(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document=function(s,r){return{name:Qo(s,r.key),fields:r.data.value.mapValue.fields,updateTime:zo(s,r.version.toTimestamp())}}(n.ne,e);else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:ds(e.version)};else{if(!e.isUnknownDocument())return k();i.unknownDocument={path:t.path.toArray(),version:ds(e.version)}}return i}function sl(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function ds(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function fs(n){const e=new se(n.seconds,n.nanoseconds);return D.fromTimestamp(e)}function Di(n,e){const t=(e.baseMutations||[]).map(r=>vd(n.ne,r));for(let r=0;r<e.mutations.length-1;++r){const o=e.mutations[r];if(r+1<e.mutations.length&&e.mutations[r+1].transform!==void 0){const a=e.mutations[r+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}const i=e.mutations.map(r=>vd(n.ne,r)),s=se.fromMillis(e.localWriteTimeMs);return new kp(e.batchId,s,t,i)}function to(n){const e=fs(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?fs(n.lastLimboFreeSnapshotVersion):D.min();let i;var s;return n.query.documents!==void 0?(O((s=n.query).documents.length===1),i=Bt(Ar(jE(s.documents[0])))):i=function(r){return Bt(zE(r))}(n.query),new ei(i,n.targetId,0,n.lastListenSequenceNumber,e,t,ve.fromBase64String(n.resumeToken))}function nb(n,e){const t=ds(e.snapshotVersion),i=ds(e.lastLimboFreeSnapshotVersion);let s;s=nl(e.target)?WE(n.ne,e.target):HE(n.ne,e.target);const r=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ls(e.target),readTime:t,resumeToken:r,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:s}}function Np(n){const e=zE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?IE(e,e.limit,"L"):e}function ah(n,e){return new Rp(e.largestBatchId,vd(n.ne,e.overlayMutation))}function x_(n,e){const t=e.path.lastSegment();return[n,dt(e.path.popLast()),t]}function M_(n,e,t,i){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:ds(i.readTime),documentKey:dt(i.documentKey.path),largestBatchId:i.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TF{getBundleMetadata(e,t){return L_(e).get(t).next(i=>{if(i)return{id:(s=i).bundleId,createTime:fs(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return L_(e).put({bundleId:(i=t).id,createTime:ds(Ne(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return F_(e).get(t).next(i=>{if(i)return{name:(s=i).name,query:Np(s.bundledQuery),readTime:fs(s.readTime)};var s})}saveNamedQuery(e,t){return F_(e).put(function(i){return{name:i.name,readTime:ds(Ne(i.readTime)),bundledQuery:i.bundledQuery}}(t))}}function L_(n){return Ue(n,"bundles")}function F_(n){return Ue(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu{constructor(e,t){this.wt=e,this.userId=t}static se(e,t){const i=t.uid||"";return new wu(e,i)}getOverlay(e,t){return Kr(e).get(x_(this.userId,t)).next(i=>i?ah(this.wt,i):null)}getOverlays(e,t){const i=on();return g.forEach(t,s=>this.getOverlay(e,s).next(r=>{r!==null&&i.set(s,r)})).next(()=>i)}saveOverlays(e,t,i){const s=[];return i.forEach((r,o)=>{const a=new Rp(t,o);s.push(this.ie(e,a))}),g.waitFor(s)}removeOverlaysForBatchId(e,t,i){const s=new Set;t.forEach(o=>s.add(dt(o.getCollectionPath())));const r=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);r.push(Kr(e).W("collectionPathOverlayIndex",a))}),g.waitFor(r)}getOverlaysForCollection(e,t,i){const s=on(),r=dt(t),o=IDBKeyRange.bound([this.userId,r,i],[this.userId,r,Number.POSITIVE_INFINITY],!0);return Kr(e).K("collectionPathOverlayIndex",o).next(a=>{for(const c of a){const l=ah(this.wt,c);s.set(l.getKey(),l)}return s})}getOverlaysForCollectionGroup(e,t,i,s){const r=on();let o;const a=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Kr(e).J({index:"collectionGroupOverlayIndex",range:a},(c,l,u)=>{const h=ah(this.wt,l);r.size()<s||h.largestBatchId===o?(r.set(h.getKey(),h),o=h.largestBatchId):u.done()}).next(()=>r)}ie(e,t){return Kr(e).put(function(i,s,r){const[o,a,c]=x_(s,r.mutation.key);return{userId:s,collectionPath:a,documentId:c,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:Xo(i.ne,r.mutation)}}(this.wt,this.userId,t))}}function Kr(n){return Ue(n,"documentOverlays")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(){}re(e,t){this.oe(e,t),t.ue()}oe(e,t){if("nullValue"in e)this.ce(t,5);else if("booleanValue"in e)this.ce(t,10),t.ae(e.booleanValue?1:0);else if("integerValue"in e)this.ce(t,15),t.ae(ae(e.integerValue));else if("doubleValue"in e){const i=ae(e.doubleValue);isNaN(i)?this.ce(t,13):(this.ce(t,15),Go(i)?t.ae(0):t.ae(i))}else if("timestampValue"in e){const i=e.timestampValue;this.ce(t,20),typeof i=="string"?t.he(i):(t.he(`${i.seconds||""}`),t.ae(i.nanos||0))}else if("stringValue"in e)this.le(e.stringValue,t),this.fe(t);else if("bytesValue"in e)this.ce(t,30),t.de(os(e.bytesValue)),this.fe(t);else if("referenceValue"in e)this._e(e.referenceValue,t);else if("geoPointValue"in e){const i=e.geoPointValue;this.ce(t,45),t.ae(i.latitude||0),t.ae(i.longitude||0)}else"mapValue"in e?_E(e)?this.ce(t,Number.MAX_SAFE_INTEGER):(this.we(e.mapValue,t),this.fe(t)):"arrayValue"in e?(this.me(e.arrayValue,t),this.fe(t)):k()}le(e,t){this.ce(t,25),this.ge(e,t)}ge(e,t){t.he(e)}we(e,t){const i=e.fields||{};this.ce(t,55);for(const s of Object.keys(i))this.le(s,t),this.oe(i[s],t)}me(e,t){const i=e.values||[];this.ce(t,50);for(const s of i)this.oe(s,t)}_e(e,t){this.ce(t,37),b.fromName(e).path.forEach(i=>{this.ce(t,60),this.ge(i,t)})}ce(e,t){e.ae(t)}fe(e){e.ae(2)}}Oi.ye=new Oi;function EF(n){if(n===0)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function U_(n){const e=64-function(t){let i=0;for(let s=0;s<8;++s){const r=EF(255&t[s]);if(i+=r,r!==8)break}return i}(n);return Math.ceil(e/8)}class bF{constructor(){this.buffer=new Uint8Array(1024),this.position=0}pe(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.Ie(i.value),i=t.next();this.Te()}Ee(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.Ae(i.value),i=t.next();this.Re()}be(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.Ie(i);else if(i<2048)this.Ie(960|i>>>6),this.Ie(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.Ie(480|i>>>12),this.Ie(128|63&i>>>6),this.Ie(128|63&i);else{const s=t.codePointAt(0);this.Ie(240|s>>>18),this.Ie(128|63&s>>>12),this.Ie(128|63&s>>>6),this.Ie(128|63&s)}}this.Te()}Pe(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.Ae(i);else if(i<2048)this.Ae(960|i>>>6),this.Ae(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.Ae(480|i>>>12),this.Ae(128|63&i>>>6),this.Ae(128|63&i);else{const s=t.codePointAt(0);this.Ae(240|s>>>18),this.Ae(128|63&s>>>12),this.Ae(128|63&s>>>6),this.Ae(128|63&s)}}this.Re()}ve(e){const t=this.Ve(e),i=U_(t);this.Se(1+i),this.buffer[this.position++]=255&i;for(let s=t.length-i;s<t.length;++s)this.buffer[this.position++]=255&t[s]}De(e){const t=this.Ve(e),i=U_(t);this.Se(1+i),this.buffer[this.position++]=~(255&i);for(let s=t.length-i;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}Ce(){this.xe(255),this.xe(255)}Ne(){this.ke(255),this.ke(255)}reset(){this.position=0}seed(e){this.Se(e.length),this.buffer.set(e,this.position),this.position+=e.length}Oe(){return this.buffer.slice(0,this.position)}Ve(e){const t=function(s){const r=new DataView(new ArrayBuffer(8));return r.setFloat64(0,s,!1),new Uint8Array(r.buffer)}(e),i=(128&t[0])!=0;t[0]^=i?255:128;for(let s=1;s<t.length;++s)t[s]^=i?255:0;return t}Ie(e){const t=255&e;t===0?(this.xe(0),this.xe(255)):t===255?(this.xe(255),this.xe(0)):this.xe(t)}Ae(e){const t=255&e;t===0?(this.ke(0),this.ke(255)):t===255?(this.ke(255),this.ke(0)):this.ke(e)}Te(){this.xe(0),this.xe(1)}Re(){this.ke(0),this.ke(1)}xe(e){this.Se(1),this.buffer[this.position++]=e}ke(e){this.Se(1),this.buffer[this.position++]=~e}Se(e){const t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);const s=new Uint8Array(i);s.set(this.buffer),this.buffer=s}}class SF{constructor(e){this.Me=e}de(e){this.Me.pe(e)}he(e){this.Me.be(e)}ae(e){this.Me.ve(e)}ue(){this.Me.Ce()}}class CF{constructor(e){this.Me=e}de(e){this.Me.Ee(e)}he(e){this.Me.Pe(e)}ae(e){this.Me.De(e)}ue(){this.Me.Ne()}}class Gr{constructor(){this.Me=new bF,this.Fe=new SF(this.Me),this.$e=new CF(this.Me)}seed(e){this.Me.seed(e)}Be(e){return e===0?this.Fe:this.$e}Oe(){return this.Me.Oe()}reset(){this.Me.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(e,t,i,s){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=s}Le(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,i=new Uint8Array(t);return i.set(this.directionalValue,0),t!==e?i.set([0],this.directionalValue.length):++i[i.length-1],new xi(this.indexId,this.documentKey,this.arrayValue,i)}}function Ci(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=V_(n.arrayValue,e.arrayValue),t!==0?t:(t=V_(n.directionalValue,e.directionalValue),t!==0?t:b.comparator(n.documentKey,e.documentKey)))}function V_(n,e){for(let t=0;t<n.length&&t<e.length;++t){const i=n[t]-e[t];if(i!==0)return i}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kF{constructor(e){this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Ue=e.orderBy,this.qe=[];for(const t of e.filters){const i=t;i.ht()?this.Ke=i:this.qe.push(i)}}Ge(e){const t=gd(e);if(t!==void 0&&!this.Qe(t))return!1;const i=Ri(e);let s=0,r=0;for(;s<i.length&&this.Qe(i[s]);++s);if(s===i.length)return!0;if(this.Ke!==void 0){const o=i[s];if(!this.je(this.Ke,o)||!this.We(this.Ue[r++],o))return!1;++s}for(;s<i.length;++s){const o=i[s];if(r>=this.Ue.length||!this.We(this.Ue[r++],o))return!1}return!0}Qe(e){for(const t of this.qe)if(this.je(t,e))return!0;return!1}je(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const i=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===i}We(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AF{constructor(){this.ze=new Pp}addToCollectionParentIndex(e,t){return this.ze.add(t),g.resolve()}getCollectionParents(e,t){return g.resolve(this.ze.getEntries(t))}addFieldIndex(e,t){return g.resolve()}deleteFieldIndex(e,t){return g.resolve()}getDocumentsMatchingTarget(e,t){return g.resolve(null)}getIndexType(e,t){return g.resolve(0)}getFieldIndexes(e,t){return g.resolve([])}getNextCollectionGroupToUpdate(e){return g.resolve(null)}getMinOffset(e,t){return g.resolve(Nt.min())}getMinOffsetFromCollectionGroup(e,t){return g.resolve(Nt.min())}updateCollectionGroup(e,t,i){return g.resolve()}updateIndexEntries(e,t){return g.resolve()}}class Pp{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t]||new Q(j.comparator),r=!s.has(i);return this.index[t]=s.add(i),r}has(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t];return s&&s.has(i)}getEntries(e){return(this.index[e]||new Q(j.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tc=new Uint8Array(0);class RF{constructor(e,t){this.user=e,this.databaseId=t,this.He=new Pp,this.Je=new Ti(i=>ls(i),(i,s)=>Oa(i,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.He.has(t)){const i=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.He.add(t)});const r={collectionId:i,parent:dt(s)};return B_(e).put(r)}return g.resolve()}getCollectionParents(e,t){const i=[],s=IDBKeyRange.bound([t,""],[cE(t),""],!1,!0);return B_(e).K(s).next(r=>{for(const o of r){if(o.collectionId!==t)break;i.push(an(o.parent))}return i})}addFieldIndex(e,t){const i=nc(e),s=function(o){return{indexId:o.indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])}}(t);delete s.indexId;const r=i.add(s);if(t.indexState){const o=Hr(e);return r.next(a=>{o.put(M_(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return r.next()}deleteFieldIndex(e,t){const i=nc(e),s=Hr(e),r=Wr(e);return i.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const i=Wr(e);let s=!0;const r=new Map;return g.forEach(this.Ye(t),o=>this.Xe(e,o).next(a=>{s&&(s=!!a),r.set(o,a)})).next(()=>{if(s){let o=U();const a=[];return g.forEach(r,(c,l)=>{var u;I("IndexedDbIndexManager",`Using index ${u=c,`id=${u.indexId}|cg=${u.collectionGroup}|f=${u.fields.map(A=>`${A.fieldPath}:${A.kind}`).join(",")}`} to execute ${ls(t)}`);const h=function(A,M){const H=gd(M);if(H===void 0)return null;for(const G of il(A,H.fieldPath))switch(G.op){case"array-contains-any":return G.value.arrayValue.values||[];case"array-contains":return[G.value]}return null}(l,c),d=function(A,M){const H=new Map;for(const G of Ri(M))for(const he of il(A,G.fieldPath))switch(he.op){case"==":case"in":H.set(G.fieldPath.canonicalString(),he.value);break;case"not-in":case"!=":return H.set(G.fieldPath.canonicalString(),he.value),Array.from(H.values())}return null}(l,c),f=function(A,M){const H=[];let G=!0;for(const he of Ri(M)){const It=he.kind===0?w_(A,he.fieldPath,A.startAt):v_(A,he.fieldPath,A.startAt);H.push(It.value),G&&(G=It.inclusive)}return new ui(H,G)}(l,c),p=function(A,M){const H=[];let G=!0;for(const he of Ri(M)){const It=he.kind===0?v_(A,he.fieldPath,A.endAt):w_(A,he.fieldPath,A.endAt);H.push(It.value),G&&(G=It.inclusive)}return new ui(H,G)}(l,c),_=this.Ze(c,l,f),v=this.Ze(c,l,p),R=this.tn(c,l,d),x=this.en(c.indexId,h,_,f.inclusive,v,p.inclusive,R);return g.forEach(x,A=>i.j(A,t.limit).next(M=>{M.forEach(H=>{const G=b.fromSegments(H.documentKey);o.has(G)||(o=o.add(G),a.push(G))})}))}).next(()=>a)}return g.resolve(null)})}Ye(e){let t=this.Je.get(e);return t||(t=[e],this.Je.set(e,t),t)}en(e,t,i,s,r,o,a){const c=(t!=null?t.length:1)*Math.max(i.length,r.length),l=c/(t!=null?t.length:1),u=[];for(let h=0;h<c;++h){const d=t?this.nn(t[h/l]):tc,f=this.sn(e,d,i[h%l],s),p=this.rn(e,d,r[h%l],o),_=a.map(v=>this.sn(e,d,v,!0));u.push(...this.createRange(f,p,_))}return u}sn(e,t,i,s){const r=new xi(e,b.empty(),t,i);return s?r:r.Le()}rn(e,t,i,s){const r=new xi(e,b.empty(),t,i);return s?r.Le():r}Xe(e,t){const i=new kF(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(r=>{let o=null;for(const a of r)i.Ge(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let i=2;return g.forEach(this.Ye(t),s=>this.Xe(e,s).next(r=>{r?i!==0&&r.fields.length<function(o){let a=new Q(de.comparator),c=!1;for(const l of o.filters){const u=l;u.field.isKeyField()||(u.op==="array-contains"||u.op==="array-contains-any"?c=!0:a=a.add(u.field))}for(const l of o.orderBy)l.field.isKeyField()||(a=a.add(l.field));return a.size+(c?1:0)}(s)&&(i=1):i=0})).next(()=>i)}on(e,t){const i=new Gr;for(const s of Ri(e)){const r=t.data.field(s.fieldPath);if(r==null)return null;const o=i.Be(s.kind);Oi.ye.re(r,o)}return i.Oe()}nn(e){const t=new Gr;return Oi.ye.re(e,t.Be(0)),t.Oe()}un(e,t){const i=new Gr;return Oi.ye.re(cs(this.databaseId,t),i.Be(function(s){const r=Ri(s);return r.length===0?0:r[r.length-1].kind}(e))),i.Oe()}tn(e,t,i){if(i===null)return[];let s=[];s.push(new Gr);let r=0;for(const o of Ri(e)){const a=i[r++];for(const c of s)if(this.cn(t,o.fieldPath)&&Ho(a))s=this.an(s,o,a);else{const l=c.Be(o.kind);Oi.ye.re(a,l)}}return this.hn(s)}Ze(e,t,i){return this.tn(e,t,i.position)}hn(e){const t=[];for(let i=0;i<e.length;++i)t[i]=e[i].Oe();return t}an(e,t,i){const s=[...e],r=[];for(const o of i.arrayValue.values||[])for(const a of s){const c=new Gr;c.seed(a.Oe()),Oi.ye.re(o,c.Be(t.kind)),r.push(c)}return r}cn(e,t){return!!e.filters.find(i=>i instanceof je&&i.field.isEqual(t)&&(i.op==="in"||i.op==="not-in"))}getFieldIndexes(e,t){const i=nc(e),s=Hr(e);return(t?i.K("collectionGroupIndex",IDBKeyRange.bound(t,t)):i.K()).next(r=>{const o=[];return g.forEach(r,a=>s.get([a.indexId,this.uid]).next(c=>{o.push(function(l,u){const h=u?new tl(u.sequenceNumber,new Nt(fs(u.readTime),new b(an(u.documentKey)),u.largestBatchId)):tl.empty(),d=l.fields.map(([f,p])=>new u1(de.fromServerFormat(f),p));return new lE(l.indexId,l.collectionGroup,d,h)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((i,s)=>{const r=i.indexState.sequenceNumber-s.indexState.sequenceNumber;return r!==0?r:F(i.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){const s=nc(e),r=Hr(e);return this.ln(e).next(o=>s.K("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>g.forEach(a,c=>r.put(M_(c.indexId,this.user,o,i)))))}updateIndexEntries(e,t){const i=new Map;return g.forEach(t,(s,r)=>{const o=i.get(s.collectionGroup);return(o?g.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(i.set(s.collectionGroup,a),g.forEach(a,c=>this.fn(e,s,c).next(l=>{const u=this.dn(r,c);return l.isEqual(u)?g.resolve():this._n(e,r,c,l,u)}))))})}wn(e,t,i,s){return Wr(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.un(i,t.key),documentKey:t.key.path.toArray()})}mn(e,t,i,s){return Wr(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.un(i,t.key),t.key.path.toArray()])}fn(e,t,i){const s=Wr(e);let r=new Q(Ci);return s.J({index:"documentKeyIndex",range:IDBKeyRange.only([i.indexId,this.uid,this.un(i,t)])},(o,a)=>{r=r.add(new xi(i.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>r)}dn(e,t){let i=new Q(Ci);const s=this.on(t,e);if(s==null)return i;const r=gd(t);if(r!=null){const o=e.data.field(r.fieldPath);if(Ho(o))for(const a of o.arrayValue.values||[])i=i.add(new xi(t.indexId,e.key,this.nn(a),s))}else i=i.add(new xi(t.indexId,e.key,tc,s));return i}_n(e,t,i,s,r){I("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(a,c,l,u,h){const d=a.getIterator(),f=c.getIterator();let p=Ds(d),_=Ds(f);for(;p||_;){let v=!1,R=!1;if(p&&_){const x=l(p,_);x<0?R=!0:x>0&&(v=!0)}else p!=null?R=!0:v=!0;v?(u(_),_=Ds(f)):R?(h(p),p=Ds(d)):(p=Ds(d),_=Ds(f))}}(s,r,Ci,a=>{o.push(this.wn(e,t,i,a))},a=>{o.push(this.mn(e,t,i,a))}),g.waitFor(o)}ln(e){let t=1;return Hr(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,r)=>{r.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((o,a)=>Ci(o,a)).filter((o,a,c)=>!a||Ci(o,c[a-1])!==0);const s=[];s.push(e);for(const o of i){const a=Ci(o,e),c=Ci(o,t);if(a===0)s[0]=e.Le();else if(a>0&&c<0)s.push(o),s.push(o.Le());else if(c>0)break}s.push(t);const r=[];for(let o=0;o<s.length;o+=2)r.push(IDBKeyRange.bound([s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,tc,[]],[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,tc,[]]));return r}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next($_)}getMinOffset(e,t){return g.mapArray(this.Ye(t),i=>this.Xe(e,i).next(s=>s||k())).next($_)}}function B_(n){return Ue(n,"collectionParents")}function Wr(n){return Ue(n,"indexEntries")}function nc(n){return Ue(n,"indexConfiguration")}function Hr(n){return Ue(n,"indexState")}function $_(n){O(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){const s=n[i].indexState.offset;yp(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Nt(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q_={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class gt{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new gt(e,gt.DEFAULT_COLLECTION_PERCENTILE,gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ib(n,e,t){const i=n.store("mutations"),s=n.store("documentMutations"),r=[],o=IDBKeyRange.only(t.batchId);let a=0;const c=i.J({range:o},(u,h,d)=>(a++,d.delete()));r.push(c.next(()=>{O(a===1)}));const l=[];for(const u of t.mutations){const h=XE(e,u.key.path,t.batchId);r.push(s.delete(h)),l.push(u.key)}return g.waitFor(r).next(()=>l)}function rl(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw k();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */gt.DEFAULT_COLLECTION_PERCENTILE=10,gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,gt.DEFAULT=new gt(41943040,gt.DEFAULT_COLLECTION_PERCENTILE,gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),gt.DISABLED=new gt(-1,0,0);class vu{constructor(e,t,i,s){this.userId=e,this.wt=t,this.indexManager=i,this.referenceDelegate=s,this.gn={}}static se(e,t,i,s){O(e.uid!=="");const r=e.isAuthenticated()?e.uid:"";return new vu(r,t,i,s)}checkEmpty(e){let t=!0;const i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return jn(e).J({index:"userMutationsIndex",range:i},(s,r,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,i,s){const r=Ls(e),o=jn(e);return o.add({}).next(a=>{O(typeof a=="number");const c=new kp(a,t,i,s),l=function(d,f,p){const _=p.baseMutations.map(R=>Xo(d.ne,R)),v=p.mutations.map(R=>Xo(d.ne,R));return{userId:f,batchId:p.batchId,localWriteTimeMs:p.localWriteTime.toMillis(),baseMutations:_,mutations:v}}(this.wt,this.userId,c),u=[];let h=new Q((d,f)=>F(d.canonicalString(),f.canonicalString()));for(const d of s){const f=XE(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),u.push(o.put(l)),u.push(r.put(f,sF))}return h.forEach(d=>{u.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.gn[a]=c.keys()}),g.waitFor(u).next(()=>c)})}lookupMutationBatch(e,t){return jn(e).get(t).next(i=>i?(O(i.userId===this.userId),Di(this.wt,i)):null)}yn(e,t){return this.gn[t]?g.resolve(this.gn[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){const s=i.keys();return this.gn[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const i=t+1,s=IDBKeyRange.lowerBound([this.userId,i]);let r=null;return jn(e).J({index:"userMutationsIndex",range:s},(o,a,c)=>{a.userId===this.userId&&(O(a.batchId>=i),r=Di(this.wt,a)),c.done()}).next(()=>r)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let i=-1;return jn(e).J({index:"userMutationsIndex",range:t,reverse:!0},(s,r,o)=>{i=r.batchId,o.done()}).next(()=>i)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return jn(e).K("userMutationsIndex",t).next(i=>i.map(s=>Di(this.wt,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const i=_c(this.userId,t.path),s=IDBKeyRange.lowerBound(i),r=[];return Ls(e).J({range:s},(o,a,c)=>{const[l,u,h]=o,d=an(u);if(l===this.userId&&t.path.isEqual(d))return jn(e).get(h).next(f=>{if(!f)throw k();O(f.userId===this.userId),r.push(Di(this.wt,f))});c.done()}).next(()=>r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Q(F);const s=[];return t.forEach(r=>{const o=_c(this.userId,r.path),a=IDBKeyRange.lowerBound(o),c=Ls(e).J({range:a},(l,u,h)=>{const[d,f,p]=l,_=an(f);d===this.userId&&r.path.isEqual(_)?i=i.add(p):h.done()});s.push(c)}),g.waitFor(s).next(()=>this.pn(e,i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,s=i.length+1,r=_c(this.userId,i),o=IDBKeyRange.lowerBound(r);let a=new Q(F);return Ls(e).J({range:o},(c,l,u)=>{const[h,d,f]=c,p=an(d);h===this.userId&&i.isPrefixOf(p)?p.length===s&&(a=a.add(f)):u.done()}).next(()=>this.pn(e,a))}pn(e,t){const i=[],s=[];return t.forEach(r=>{s.push(jn(e).get(r).next(o=>{if(o===null)throw k();O(o.userId===this.userId),i.push(Di(this.wt,o))}))}),g.waitFor(s).next(()=>i)}removeMutationBatch(e,t){return ib(e.ee,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.In(t.batchId)}),g.forEach(i,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}In(e){delete this.gn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return g.resolve();const i=IDBKeyRange.lowerBound([this.userId]),s=[];return Ls(e).J({range:i},(r,o,a)=>{if(r[0]===this.userId){const c=an(r[1]);s.push(c)}else a.done()}).next(()=>{O(s.length===0)})})}containsKey(e,t){return sb(e,this.userId,t)}Tn(e){return rb(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function sb(n,e,t){const i=_c(e,t.path),s=i[1],r=IDBKeyRange.lowerBound(i);let o=!1;return Ls(n).J({range:r,H:!0},(a,c,l)=>{const[u,h,d]=a;u===e&&h===s&&(o=!0),l.done()}).next(()=>o)}function jn(n){return Ue(n,"mutations")}function Ls(n){return Ue(n,"documentMutations")}function rb(n){return Ue(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ps{constructor(e){this.En=e}next(){return this.En+=2,this.En}static An(){return new ps(0)}static Rn(){return new ps(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NF{constructor(e,t){this.referenceDelegate=e,this.wt=t}allocateTargetId(e){return this.bn(e).next(t=>{const i=new ps(t.highestTargetId);return t.highestTargetId=i.next(),this.Pn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.bn(e).next(t=>D.fromTimestamp(new se(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.bn(e).next(s=>(s.highestListenSequenceNumber=t,i&&(s.lastRemoteSnapshotVersion=i.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Pn(e,s)))}addTargetData(e,t){return this.vn(e,t).next(()=>this.bn(e).next(i=>(i.targetCount+=1,this.Vn(t,i),this.Pn(e,i))))}updateTargetData(e,t){return this.vn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>xs(e).delete(t.targetId)).next(()=>this.bn(e)).next(i=>(O(i.targetCount>0),i.targetCount-=1,this.Pn(e,i)))}removeTargets(e,t,i){let s=0;const r=[];return xs(e).J((o,a)=>{const c=to(a);c.sequenceNumber<=t&&i.get(c.targetId)===null&&(s++,r.push(this.removeTargetData(e,c)))}).next(()=>g.waitFor(r)).next(()=>s)}forEachTarget(e,t){return xs(e).J((i,s)=>{const r=to(s);t(r)})}bn(e){return j_(e).get("targetGlobalKey").next(t=>(O(t!==null),t))}Pn(e,t){return j_(e).put("targetGlobalKey",t)}vn(e,t){return xs(e).put(nb(this.wt,t))}Vn(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.bn(e).next(t=>t.targetCount)}getTargetData(e,t){const i=ls(t),s=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]);let r=null;return xs(e).J({range:s,index:"queryTargetsIndex"},(o,a,c)=>{const l=to(a);Oa(t,l.target)&&(r=l,c.done())}).next(()=>r)}addMatchingKeys(e,t,i){const s=[],r=Gn(e);return t.forEach(o=>{const a=dt(o.path);s.push(r.put({targetId:i,path:a})),s.push(this.referenceDelegate.addReference(e,i,o))}),g.waitFor(s)}removeMatchingKeys(e,t,i){const s=Gn(e);return g.forEach(t,r=>{const o=dt(r.path);return g.waitFor([s.delete([i,o]),this.referenceDelegate.removeReference(e,i,r)])})}removeMatchingKeysForTargetId(e,t){const i=Gn(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(s)}getMatchingKeysForTargetId(e,t){const i=IDBKeyRange.bound([t],[t+1],!1,!0),s=Gn(e);let r=U();return s.J({range:i,H:!0},(o,a,c)=>{const l=an(o[1]),u=new b(l);r=r.add(u)}).next(()=>r)}containsKey(e,t){const i=dt(t.path),s=IDBKeyRange.bound([i],[cE(i)],!1,!0);let r=0;return Gn(e).J({index:"documentTargetsIndex",H:!0,range:s},([o,a],c,l)=>{o!==0&&(r++,l.done())}).next(()=>r>0)}te(e,t){return xs(e).get(t).next(i=>i?to(i):null)}}function xs(n){return Ue(n,"targets")}function j_(n){return Ue(n,"targetGlobal")}function Gn(n){return Ue(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function K_([n,e],[t,i]){const s=F(n,t);return s===0?F(e,i):s}class PF{constructor(e){this.Sn=e,this.buffer=new Q(K_),this.Dn=0}Cn(){return++this.Dn}xn(e){const t=[e,this.Cn()];if(this.buffer.size<this.Sn)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();K_(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class DF{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Nn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.kn(6e4)}stop(){this.Nn&&(this.Nn.cancel(),this.Nn=null)}get started(){return this.Nn!==null}kn(e){I("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Nn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Nn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ii(t)?I("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await vi(t)}await this.kn(3e5)})}}class OF{constructor(e,t){this.On=e,this.params=t}calculateTargetCount(e,t){return this.On.Mn(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return g.resolve(yt.ot);const i=new PF(t);return this.On.forEachTarget(e,s=>i.xn(s.sequenceNumber)).next(()=>this.On.Fn(e,s=>i.xn(s))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.On.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.On.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(I("LruGarbageCollector","Garbage collection skipped; disabled"),g.resolve(q_)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),q_):this.$n(e,t))}getCacheSize(e){return this.On.getCacheSize(e)}$n(e,t){let i,s,r,o,a,c,l;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(I("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(i=h,a=Date.now(),this.removeTargets(e,i,t))).next(h=>(r=h,c=Date.now(),this.removeOrphanedDocuments(e,i))).next(h=>(l=Date.now(),pd()<=Ct.DEBUG&&I("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${r} targets in `+(c-a)+`ms
	Removed ${h} documents in `+(l-c)+`ms
Total Duration: ${l-u}ms`),g.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:h})))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xF{constructor(e,t){this.db=e,this.garbageCollector=function(i,s){return new OF(i,s)}(this,t)}Mn(e){const t=this.Bn(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}Bn(e){let t=0;return this.Fn(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Fn(e,t){return this.Ln(e,(i,s)=>t(s))}addReference(e,t,i){return ic(e,i)}removeReference(e,t,i){return ic(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return ic(e,t)}Un(e,t){return function(i,s){let r=!1;return rb(i).Y(o=>sb(i,o,s).next(a=>(a&&(r=!0),g.resolve(!a)))).next(()=>r)}(e,t)}removeOrphanedDocuments(e,t){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let r=0;return this.Ln(e,(o,a)=>{if(a<=t){const c=this.Un(e,o).next(l=>{if(!l)return r++,i.getEntry(e,o).next(()=>(i.removeEntry(o,D.min()),Gn(e).delete([0,dt(o.path)])))});s.push(c)}}).next(()=>g.waitFor(s)).next(()=>i.apply(e)).next(()=>r)}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return ic(e,t)}Ln(e,t){const i=Gn(e);let s,r=yt.ot;return i.J({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:l})=>{o===0?(r!==yt.ot&&t(new b(an(s)),r),r=l,s=c):r=yt.ot}).next(()=>{r!==yt.ot&&t(new b(an(s)),r)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function ic(n,e){return Gn(n).put(function(t,i){return{targetId:0,path:dt(t.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ob{constructor(){this.changes=new Ti(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Z.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?g.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MF{constructor(e){this.wt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return ki(e).put(i)}removeEntry(e,t,i){return ki(e).delete(function(s,r){const o=s.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],sl(r),o[o.length-1]]}(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.qn(e,i)))}getEntry(e,t){let i=Z.newInvalidDocument(t);return ki(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(zr(t))},(s,r)=>{i=this.Kn(t,r)}).next(()=>i)}Gn(e,t){let i={size:0,document:Z.newInvalidDocument(t)};return ki(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(zr(t))},(s,r)=>{i={document:this.Kn(t,r),size:rl(r)}}).next(()=>i)}getEntries(e,t){let i=wt();return this.Qn(e,t,(s,r)=>{const o=this.Kn(s,r);i=i.insert(s,o)}).next(()=>i)}jn(e,t){let i=wt(),s=new ce(b.comparator);return this.Qn(e,t,(r,o)=>{const a=this.Kn(r,o);i=i.insert(r,a),s=s.insert(r,rl(o))}).next(()=>({documents:i,Wn:s}))}Qn(e,t,i){if(t.isEmpty())return g.resolve();let s=new Q(H_);t.forEach(c=>s=s.add(c));const r=IDBKeyRange.bound(zr(s.first()),zr(s.last())),o=s.getIterator();let a=o.getNext();return ki(e).J({index:"documentKeyIndex",range:r},(c,l,u)=>{const h=b.fromSegments([...l.prefixPath,l.collectionGroup,l.documentId]);for(;a&&H_(a,h)<0;)i(a,null),a=o.getNext();a&&a.isEqual(h)&&(i(a,l),a=o.hasNext()?o.getNext():null),a?u.q(zr(a)):u.done()}).next(()=>{for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})}getAllFromCollection(e,t,i){const s=[t.popLast().toArray(),t.lastSegment(),sl(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],r=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ki(e).K(IDBKeyRange.bound(s,r,!0)).next(o=>{let a=wt();for(const c of o){const l=this.Kn(b.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);a=a.insert(l.key,l)}return a})}getAllFromCollectionGroup(e,t,i,s){let r=wt();const o=W_(t,i),a=W_(t,Nt.max());return ki(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,l,u)=>{const h=this.Kn(b.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);r=r.insert(h.key,h),r.size===s&&u.done()}).next(()=>r)}newChangeBuffer(e){return new LF(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return G_(e).get("remoteDocumentGlobalKey").next(t=>(O(!!t),t))}qn(e,t){return G_(e).put("remoteDocumentGlobalKey",t)}Kn(e,t){if(t){const i=IF(this.wt,t);if(!(i.isNoDocument()&&i.version.isEqual(D.min())))return i}return Z.newInvalidDocument(e)}}function ab(n){return new MF(n)}class LF extends ob{constructor(e,t){super(),this.zn=e,this.trackRemovals=t,this.Hn=new Ti(i=>i.toString(),(i,s)=>i.isEqual(s))}applyChanges(e){const t=[];let i=0,s=new Q((r,o)=>F(r.canonicalString(),o.canonicalString()));return this.changes.forEach((r,o)=>{const a=this.Hn.get(r);if(t.push(this.zn.removeEntry(e,r,a.readTime)),o.isValidDocument()){const c=O_(this.zn.wt,o);s=s.add(r.path.popLast()),i+=rl(c)-a.size,t.push(this.zn.addEntry(e,r,c))}else if(i-=a.size,this.trackRemovals){const c=O_(this.zn.wt,o.convertToNoDocument(D.min()));t.push(this.zn.addEntry(e,r,c))}}),s.forEach(r=>{t.push(this.zn.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.zn.updateMetadata(e,i)),g.waitFor(t)}getFromCache(e,t){return this.zn.Gn(e,t).next(i=>(this.Hn.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.zn.jn(e,t).next(({documents:i,Wn:s})=>(s.forEach((r,o)=>{this.Hn.set(r,{size:o,readTime:i.get(r).readTime})}),i))}}function G_(n){return Ue(n,"remoteDocumentGlobal")}function ki(n){return Ue(n,"remoteDocumentsV14")}function zr(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function W_(n,e){const t=e.documentKey.path.toArray();return[n,sl(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function H_(n,e){const t=n.path.toArray(),i=e.path.toArray();let s=0;for(let r=0;r<t.length-2&&r<i.length-2;++r)if(s=F(t[r],i[r]),s)return s;return s=F(t.length,i.length),s||(s=F(t[t.length-2],i[i.length-2]),s||F(t[t.length-1],i[i.length-1]))}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FF{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cb{constructor(e,t,i,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=s}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(i=s,this.getBaseDocument(e,t,i))).next(s=>(i!==null&&po(i.mutation,s,kt.empty(),se.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,U()).next(()=>i))}getLocalViewOfDocuments(e,t,i=U()){const s=on();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,i).next(r=>{let o=eo();return r.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const i=on();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,U()))}populateOverlays(e,t,i){const s=[];return i.forEach(r=>{t.has(r)||s.push(r)}),this.documentOverlayCache.getOverlays(e,s).next(r=>{r.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,s){let r=wt();const o=go(),a=go();return t.forEach((c,l)=>{const u=i.get(l.key);s.has(l.key)&&(u===void 0||u.mutation instanceof Vn)?r=r.insert(l.key,l):u!==void 0&&(o.set(l.key,u.mutation.getFieldMask()),po(u.mutation,l,u.mutation.getFieldMask(),se.now()))}),this.recalculateAndSaveOverlays(e,r).next(c=>(c.forEach((l,u)=>o.set(l,u)),t.forEach((l,u)=>{var h;return a.set(l,new FF(u,(h=o.get(l))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){const i=go();let s=new ce((o,a)=>o-a),r=U();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(c=>{const l=t.get(c);if(l===null)return;let u=i.get(c)||kt.empty();u=a.applyToLocalView(l,u),i.set(c,u);const h=(s.get(a.batchId)||U()).add(c);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),l=c.key,u=c.value,h=UE();u.forEach(d=>{if(!r.has(d)){const f=DE(t.get(d),i.get(d));f!==null&&h.set(d,f),r=r.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,h))}return g.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i){return function(s){return b.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Ep(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i):this.getDocumentsMatchingCollectionQuery(e,t,i)}getNextDocuments(e,t,i,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,s).next(r=>{const o=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,s-r.size):g.resolve(on());let a=-1,c=r;return o.next(l=>g.forEach(l,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),r.get(u)?g.resolve():this.getBaseDocument(e,u,h).next(d=>{c=c.insert(u,d)}))).next(()=>this.populateOverlays(e,l,r)).next(()=>this.computeViews(e,c,l,U())).next(u=>({batchId:a,changes:FE(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new b(t)).next(i=>{let s=eo();return i.isFoundDocument()&&(s=s.insert(i.key,i)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,i){const s=t.collectionGroup;let r=eo();return this.indexManager.getCollectionParents(e,s).next(o=>g.forEach(o,a=>{const c=function(l,u){return new Un(u,null,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(t,a.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,i).next(l=>{l.forEach((u,h)=>{r=r.insert(u,h)})})}).next(()=>r))}getDocumentsMatchingCollectionQuery(e,t,i){let s;return this.remoteDocumentCache.getAllFromCollection(e,t.path,i).next(r=>(s=r,this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId))).next(r=>{r.forEach((a,c)=>{const l=c.getKey();s.get(l)===null&&(s=s.insert(l,Z.newInvalidDocument(l)))});let o=eo();return s.forEach((a,c)=>{const l=r.get(a);l!==void 0&&po(l.mutation,c,kt.empty(),se.now()),bp(t,c)&&(o=o.insert(a,c))}),o})}getBaseDocument(e,t,i){return i===null||i.mutation.type===1?this.remoteDocumentCache.getEntry(e,t):g.resolve(Z.newInvalidDocument(t))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UF{constructor(e){this.wt=e,this.Jn=new Map,this.Yn=new Map}getBundleMetadata(e,t){return g.resolve(this.Jn.get(t))}saveBundleMetadata(e,t){var i;return this.Jn.set(t.id,{id:(i=t).id,version:i.version,createTime:Ne(i.createTime)}),g.resolve()}getNamedQuery(e,t){return g.resolve(this.Yn.get(t))}saveNamedQuery(e,t){return this.Yn.set(t.name,function(i){return{name:i.name,query:Np(i.bundledQuery),readTime:Ne(i.readTime)}}(t)),g.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VF{constructor(){this.overlays=new ce(b.comparator),this.Xn=new Map}getOverlay(e,t){return g.resolve(this.overlays.get(t))}getOverlays(e,t){const i=on();return g.forEach(t,s=>this.getOverlay(e,s).next(r=>{r!==null&&i.set(s,r)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((s,r)=>{this.ie(e,t,r)}),g.resolve()}removeOverlaysForBatchId(e,t,i){const s=this.Xn.get(i);return s!==void 0&&(s.forEach(r=>this.overlays=this.overlays.remove(r)),this.Xn.delete(i)),g.resolve()}getOverlaysForCollection(e,t,i){const s=on(),r=t.length+1,o=new b(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,l=c.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===r&&c.largestBatchId>i&&s.set(c.getKey(),c)}return g.resolve(s)}getOverlaysForCollectionGroup(e,t,i,s){let r=new ce((l,u)=>l-u);const o=this.overlays.getIterator();for(;o.hasNext();){const l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>i){let u=r.get(l.largestBatchId);u===null&&(u=on(),r=r.insert(l.largestBatchId,u)),u.set(l.getKey(),l)}}const a=on(),c=r.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((l,u)=>a.set(l,u)),!(a.size()>=s)););return g.resolve(a)}ie(e,t,i){const s=this.overlays.get(i.key);if(s!==null){const o=this.Xn.get(s.largestBatchId).delete(i.key);this.Xn.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new Rp(t,i));let r=this.Xn.get(t);r===void 0&&(r=U(),this.Xn.set(t,r)),this.Xn.set(t,r.add(i.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dp{constructor(){this.Zn=new Q(Ee.ts),this.es=new Q(Ee.ns)}isEmpty(){return this.Zn.isEmpty()}addReference(e,t){const i=new Ee(e,t);this.Zn=this.Zn.add(i),this.es=this.es.add(i)}ss(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.rs(new Ee(e,t))}os(e,t){e.forEach(i=>this.removeReference(i,t))}us(e){const t=new b(new j([])),i=new Ee(t,e),s=new Ee(t,e+1),r=[];return this.es.forEachInRange([i,s],o=>{this.rs(o),r.push(o.key)}),r}cs(){this.Zn.forEach(e=>this.rs(e))}rs(e){this.Zn=this.Zn.delete(e),this.es=this.es.delete(e)}hs(e){const t=new b(new j([])),i=new Ee(t,e),s=new Ee(t,e+1);let r=U();return this.es.forEachInRange([i,s],o=>{r=r.add(o.key)}),r}containsKey(e){const t=new Ee(e,0),i=this.Zn.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class Ee{constructor(e,t){this.key=e,this.ls=t}static ts(e,t){return b.comparator(e.key,t.key)||F(e.ls,t.ls)}static ns(e,t){return F(e.ls,t.ls)||b.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BF{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.fs=1,this.ds=new Q(Ee.ts)}checkEmpty(e){return g.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,s){const r=this.fs;this.fs++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new kp(r,t,i,s);this.mutationQueue.push(o);for(const a of s)this.ds=this.ds.add(new Ee(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return g.resolve(o)}lookupMutationBatch(e,t){return g.resolve(this._s(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,s=this.ws(i),r=s<0?0:s;return g.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return g.resolve(this.mutationQueue.length===0?-1:this.fs-1)}getAllMutationBatches(e){return g.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new Ee(t,0),s=new Ee(t,Number.POSITIVE_INFINITY),r=[];return this.ds.forEachInRange([i,s],o=>{const a=this._s(o.ls);r.push(a)}),g.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Q(F);return t.forEach(s=>{const r=new Ee(s,0),o=new Ee(s,Number.POSITIVE_INFINITY);this.ds.forEachInRange([r,o],a=>{i=i.add(a.ls)})}),g.resolve(this.gs(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,s=i.length+1;let r=i;b.isDocumentKey(r)||(r=r.child(""));const o=new Ee(new b(r),0);let a=new Q(F);return this.ds.forEachWhile(c=>{const l=c.key.path;return!!i.isPrefixOf(l)&&(l.length===s&&(a=a.add(c.ls)),!0)},o),g.resolve(this.gs(a))}gs(e){const t=[];return e.forEach(i=>{const s=this._s(i);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){O(this.ys(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.ds;return g.forEach(t.mutations,s=>{const r=new Ee(s.key,t.batchId);return i=i.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.ds=i})}In(e){}containsKey(e,t){const i=new Ee(t,0),s=this.ds.firstAfterOrEqual(i);return g.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,g.resolve()}ys(e,t){return this.ws(e)}ws(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}_s(e){const t=this.ws(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $F{constructor(e){this.ps=e,this.docs=new ce(b.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,s=this.docs.get(i),r=s?s.size:0,o=this.ps(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return g.resolve(i?i.document.mutableCopy():Z.newInvalidDocument(t))}getEntries(e,t){let i=wt();return t.forEach(s=>{const r=this.docs.get(s);i=i.insert(s,r?r.document.mutableCopy():Z.newInvalidDocument(s))}),g.resolve(i)}getAllFromCollection(e,t,i){let s=wt();const r=new b(t.child("")),o=this.docs.getIteratorFrom(r);for(;o.hasNext();){const{key:a,value:{document:c}}=o.getNext();if(!t.isPrefixOf(a.path))break;a.path.length>t.length+1||yp(hE(c),i)<=0||(s=s.insert(c.key,c.mutableCopy()))}return g.resolve(s)}getAllFromCollectionGroup(e,t,i,s){k()}Is(e,t){return g.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new qF(this)}getSize(e){return g.resolve(this.size)}}class qF extends ob{constructor(e){super(),this.zn=e}applyChanges(e){const t=[];return this.changes.forEach((i,s)=>{s.isValidDocument()?t.push(this.zn.addEntry(e,s)):this.zn.removeEntry(i)}),g.waitFor(t)}getFromCache(e,t){return this.zn.getEntry(e,t)}getAllFromCache(e,t){return this.zn.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jF{constructor(e){this.persistence=e,this.Ts=new Ti(t=>ls(t),Oa),this.lastRemoteSnapshotVersion=D.min(),this.highestTargetId=0,this.Es=0,this.As=new Dp,this.targetCount=0,this.Rs=ps.An()}forEachTarget(e,t){return this.Ts.forEach((i,s)=>t(s)),g.resolve()}getLastRemoteSnapshotVersion(e){return g.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return g.resolve(this.Es)}allocateTargetId(e){return this.highestTargetId=this.Rs.next(),g.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.Es&&(this.Es=t),g.resolve()}vn(e){this.Ts.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Rs=new ps(t),this.highestTargetId=t),e.sequenceNumber>this.Es&&(this.Es=e.sequenceNumber)}addTargetData(e,t){return this.vn(t),this.targetCount+=1,g.resolve()}updateTargetData(e,t){return this.vn(t),g.resolve()}removeTargetData(e,t){return this.Ts.delete(t.target),this.As.us(t.targetId),this.targetCount-=1,g.resolve()}removeTargets(e,t,i){let s=0;const r=[];return this.Ts.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.Ts.delete(o),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),g.waitFor(r).next(()=>s)}getTargetCount(e){return g.resolve(this.targetCount)}getTargetData(e,t){const i=this.Ts.get(t)||null;return g.resolve(i)}addMatchingKeys(e,t,i){return this.As.ss(t,i),g.resolve()}removeMatchingKeys(e,t,i){this.As.os(t,i);const s=this.persistence.referenceDelegate,r=[];return s&&t.forEach(o=>{r.push(s.markPotentiallyOrphaned(e,o))}),g.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.As.us(t),g.resolve()}getMatchingKeysForTargetId(e,t){const i=this.As.hs(t);return g.resolve(i)}containsKey(e,t){return g.resolve(this.As.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lb{constructor(e,t){this.bs={},this.overlays={},this.Ps=new yt(0),this.vs=!1,this.vs=!0,this.referenceDelegate=e(this),this.Vs=new jF(this),this.indexManager=new AF,this.remoteDocumentCache=function(i){return new $F(i)}(i=>this.referenceDelegate.Ss(i)),this.wt=new tb(t),this.Ds=new UF(this.wt)}start(){return Promise.resolve()}shutdown(){return this.vs=!1,Promise.resolve()}get started(){return this.vs}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new VF,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.bs[e.toKey()];return i||(i=new BF(t,this.referenceDelegate),this.bs[e.toKey()]=i),i}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ds}runTransaction(e,t,i){I("MemoryPersistence","Starting transaction:",e);const s=new KF(this.Ps.next());return this.referenceDelegate.Cs(),i(s).next(r=>this.referenceDelegate.xs(s).next(()=>r)).toPromise().then(r=>(s.raiseOnCommittedEvent(),r))}Ns(e,t){return g.or(Object.values(this.bs).map(i=>()=>i.containsKey(e,t)))}}class KF extends fE{constructor(e){super(),this.currentSequenceNumber=e}}class Iu{constructor(e){this.persistence=e,this.ks=new Dp,this.Os=null}static Ms(e){return new Iu(e)}get Fs(){if(this.Os)return this.Os;throw k()}addReference(e,t,i){return this.ks.addReference(i,t),this.Fs.delete(i.toString()),g.resolve()}removeReference(e,t,i){return this.ks.removeReference(i,t),this.Fs.add(i.toString()),g.resolve()}markPotentiallyOrphaned(e,t){return this.Fs.add(t.toString()),g.resolve()}removeTarget(e,t){this.ks.us(t.targetId).forEach(s=>this.Fs.add(s.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(r=>this.Fs.add(r.toString()))}).next(()=>i.removeTargetData(e,t))}Cs(){this.Os=new Set}xs(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return g.forEach(this.Fs,i=>{const s=b.fromPath(i);return this.$s(e,s).next(r=>{r||t.removeEntry(s,D.min())})}).next(()=>(this.Os=null,t.apply(e)))}updateLimboDocument(e,t){return this.$s(e,t).next(i=>{i?this.Fs.delete(t.toString()):this.Fs.add(t.toString())})}Ss(e){return 0}$s(e,t){return g.or([()=>g.resolve(this.ks.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ns(e,t)])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GF{constructor(e){this.wt=e}O(e,t,i,s){const r=new gu("createOrUpgrade",t);i<1&&s>=1&&(function(a){a.createObjectStore("owner")}(e),function(a){a.createObjectStore("mutationQueues",{keyPath:"userId"}),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",D_,{unique:!0}),a.createObjectStore("documentMutations")}(e),z_(e),function(a){a.createObjectStore("remoteDocuments")}(e));let o=g.resolve();return i<3&&s>=3&&(i!==0&&(function(a){a.deleteObjectStore("targetDocuments"),a.deleteObjectStore("targets"),a.deleteObjectStore("targetGlobal")}(e),z_(e)),o=o.next(()=>function(a){const c=a.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:D.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(r))),i<4&&s>=4&&(i!==0&&(o=o.next(()=>function(a,c){return c.store("mutations").K().next(l=>{a.deleteObjectStore("mutations"),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",D_,{unique:!0});const u=c.store("mutations"),h=l.map(d=>u.put(d));return g.waitFor(h)})}(e,r))),o=o.next(()=>{(function(a){a.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),i<5&&s>=5&&(o=o.next(()=>this.Bs(r))),i<6&&s>=6&&(o=o.next(()=>(function(a){a.createObjectStore("remoteDocumentGlobal")}(e),this.Ls(r)))),i<7&&s>=7&&(o=o.next(()=>this.Us(r))),i<8&&s>=8&&(o=o.next(()=>this.qs(e,r))),i<9&&s>=9&&(o=o.next(()=>{(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(e)})),i<10&&s>=10&&(o=o.next(()=>this.Ks(r))),i<11&&s>=11&&(o=o.next(()=>{(function(a){a.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(a){a.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),i<12&&s>=12&&(o=o.next(()=>{(function(a){const c=a.createObjectStore("documentOverlays",{keyPath:mF});c.createIndex("collectionPathOverlayIndex",_F,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",yF,{unique:!1})})(e)})),i<13&&s>=13&&(o=o.next(()=>function(a){const c=a.createObjectStore("remoteDocumentsV14",{keyPath:rF});c.createIndex("documentKeyIndex",oF),c.createIndex("collectionGroupIndex",aF)}(e)).next(()=>this.Gs(e,r)).next(()=>e.deleteObjectStore("remoteDocuments"))),i<14&&s>=14&&(o=o.next(()=>this.Qs(e,r))),i<15&&s>=15&&(o=o.next(()=>function(a){a.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),a.createObjectStore("indexState",{keyPath:dF}).createIndex("sequenceNumberIndex",fF,{unique:!1}),a.createObjectStore("indexEntries",{keyPath:pF}).createIndex("documentKeyIndex",gF,{unique:!1})}(e))),o}Ls(e){let t=0;return e.store("remoteDocuments").J((i,s)=>{t+=rl(s)}).next(()=>{const i={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",i)})}Bs(e){const t=e.store("mutationQueues"),i=e.store("mutations");return t.K().next(s=>g.forEach(s,r=>{const o=IDBKeyRange.bound([r.userId,-1],[r.userId,r.lastAcknowledgedBatchId]);return i.K("userMutationsIndex",o).next(a=>g.forEach(a,c=>{O(c.userId===r.userId);const l=Di(this.wt,c);return ib(e,r.userId,l).next(()=>{})}))}))}Us(e){const t=e.store("targetDocuments"),i=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const r=[];return i.J((o,a)=>{const c=new j(o),l=function(u){return[0,dt(u)]}(c);r.push(t.get(l).next(u=>u?g.resolve():(h=>t.put({targetId:0,path:dt(h),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>g.waitFor(r))})}qs(e,t){e.createObjectStore("collectionParents",{keyPath:hF});const i=t.store("collectionParents"),s=new Pp,r=o=>{if(s.add(o)){const a=o.lastSegment(),c=o.popLast();return i.put({collectionId:a,parent:dt(c)})}};return t.store("remoteDocuments").J({H:!0},(o,a)=>{const c=new j(o);return r(c.popLast())}).next(()=>t.store("documentMutations").J({H:!0},([o,a,c],l)=>{const u=an(a);return r(u.popLast())}))}Ks(e){const t=e.store("targets");return t.J((i,s)=>{const r=to(s),o=nb(this.wt,r);return t.put(o)})}Gs(e,t){const i=t.store("remoteDocuments"),s=[];return i.J((r,o)=>{const a=t.store("remoteDocumentsV14"),c=(l=o,l.document?new b(j.fromString(l.document.name).popFirst(5)):l.noDocument?b.fromSegments(l.noDocument.path):l.unknownDocument?b.fromSegments(l.unknownDocument.path):k()).path.toArray();var l;/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>g.waitFor(s))}Qs(e,t){const i=t.store("mutations"),s=ab(this.wt),r=new lb(Iu.Ms,this.wt.ne);return i.K().next(o=>{const a=new Map;return o.forEach(c=>{var l;let u=(l=a.get(c.userId))!==null&&l!==void 0?l:U();Di(this.wt,c).keys().forEach(h=>u=u.add(h)),a.set(c.userId,u)}),g.forEach(a,(c,l)=>{const u=new Ce(l),h=wu.se(this.wt,u),d=r.getIndexManager(u),f=vu.se(u,this.wt,d,r.referenceDelegate);return new cb(s,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new Id(t,yt.ot),c).next()})})}}function z_(n){n.createObjectStore("targetDocuments",{keyPath:lF}).createIndex("documentTargetsIndex",uF,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",cF,{unique:!0}),n.createObjectStore("targetGlobal")}const ch="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Op{constructor(e,t,i,s,r,o,a,c,l,u,h=14){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.js=r,this.window=o,this.document=a,this.Ws=l,this.zs=u,this.Hs=h,this.Ps=null,this.vs=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Js=null,this.inForeground=!1,this.Ys=null,this.Xs=null,this.Zs=Number.NEGATIVE_INFINITY,this.ti=d=>Promise.resolve(),!Op.V())throw new y(m.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new xF(this,s),this.ei=t+"main",this.wt=new tb(c),this.ni=new Gt(this.ei,this.Hs,new GF(this.wt)),this.Vs=new NF(this.referenceDelegate,this.wt),this.remoteDocumentCache=ab(this.wt),this.Ds=new TF,this.window&&this.window.localStorage?this.si=this.window.localStorage:(this.si=null,u===!1&&me("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ii().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(m.FAILED_PRECONDITION,ch);return this.ri(),this.oi(),this.ui(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Vs.getHighestSequenceNumber(e))}).then(e=>{this.Ps=new yt(e,this.Ws)}).then(()=>{this.vs=!0}).catch(e=>(this.ni&&this.ni.close(),Promise.reject(e)))}ci(e){return this.ti=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ni.F(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.js.enqueueAndForget(async()=>{this.started&&await this.ii()}))}ii(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>sc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.ai(e).next(t=>{t||(this.isPrimary=!1,this.js.enqueueRetryable(()=>this.ti(!1)))})}).next(()=>this.hi(e)).next(t=>this.isPrimary&&!t?this.li(e).next(()=>!1):!!t&&this.fi(e).next(()=>!0))).catch(e=>{if(Ii(e))return I("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return I("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.js.enqueueRetryable(()=>this.ti(e)),this.isPrimary=e})}ai(e){return Qr(e).get("owner").next(t=>g.resolve(this.di(t)))}_i(e){return sc(e).delete(this.clientId)}async wi(){if(this.isPrimary&&!this.mi(this.Zs,18e5)){this.Zs=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const i=Ue(t,"clientMetadata");return i.K().next(s=>{const r=this.gi(s,18e5),o=s.filter(a=>r.indexOf(a)===-1);return g.forEach(o,a=>i.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.si)for(const t of e)this.si.removeItem(this.yi(t.clientId))}}ui(){this.Xs=this.js.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ii().then(()=>this.wi()).then(()=>this.ui()))}di(e){return!!e&&e.ownerId===this.clientId}hi(e){return this.zs?g.resolve(!0):Qr(e).get("owner").next(t=>{if(t!==null&&this.mi(t.leaseTimestampMs,5e3)&&!this.pi(t.ownerId)){if(this.di(t)&&this.networkEnabled)return!0;if(!this.di(t)){if(!t.allowTabSynchronization)throw new y(m.FAILED_PRECONDITION,ch);return!1}}return!(!this.networkEnabled||!this.inForeground)||sc(e).K().next(i=>this.gi(i,5e3).find(s=>{if(this.clientId!==s.clientId){const r=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(r||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&I("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.vs=!1,this.Ii(),this.Xs&&(this.Xs.cancel(),this.Xs=null),this.Ti(),this.Ei(),await this.ni.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Id(e,yt.ot);return this.li(t).next(()=>this._i(t))}),this.ni.close(),this.Ai()}gi(e,t){return e.filter(i=>this.mi(i.updateTimeMs,t)&&!this.pi(i.clientId))}Ri(){return this.runTransaction("getActiveClients","readonly",e=>sc(e).K().next(t=>this.gi(t,18e5).map(i=>i.clientId)))}get started(){return this.vs}getMutationQueue(e,t){return vu.se(e,this.wt,t,this.referenceDelegate)}getTargetCache(){return this.Vs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new RF(e,this.wt.ne.databaseId)}getDocumentOverlayCache(e){return wu.se(this.wt,e)}getBundleCache(){return this.Ds}runTransaction(e,t,i){I("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",r=(o=this.Hs)===15?vF:o===14?eb:o===13?ZE:o===12?wF:o===11?JE:void k();var o;let a;return this.ni.runTransaction(e,s,r,c=>(a=new Id(c,this.Ps?this.Ps.next():yt.ot),t==="readwrite-primary"?this.ai(a).next(l=>!!l||this.hi(a)).next(l=>{if(!l)throw me(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.js.enqueueRetryable(()=>this.ti(!1)),new y(m.FAILED_PRECONDITION,dE);return i(a)}).next(l=>this.fi(a).next(()=>l)):this.bi(a).next(()=>i(a)))).then(c=>(a.raiseOnCommittedEvent(),c))}bi(e){return Qr(e).get("owner").next(t=>{if(t!==null&&this.mi(t.leaseTimestampMs,5e3)&&!this.pi(t.ownerId)&&!this.di(t)&&!(this.zs||this.allowTabSynchronization&&t.allowTabSynchronization))throw new y(m.FAILED_PRECONDITION,ch)})}fi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Qr(e).put("owner",t)}static V(){return Gt.V()}li(e){const t=Qr(e);return t.get("owner").next(i=>this.di(i)?(I("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):g.resolve())}mi(e,t){const i=Date.now();return!(e<i-t)&&(!(e>i)||(me(`Detected an update time that is in the future: ${e} > ${i}`),!1))}ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ys=()=>{this.js.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.ii()))},this.document.addEventListener("visibilitychange",this.Ys),this.inForeground=this.document.visibilityState==="visible")}Ti(){this.Ys&&(this.document.removeEventListener("visibilitychange",this.Ys),this.Ys=null)}oi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Js=()=>{this.Ii(),MC()&&navigator.appVersion.match(/Version\/1[45]/)&&this.js.enterRestrictedMode(!0),this.js.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Js))}Ei(){this.Js&&(this.window.removeEventListener("pagehide",this.Js),this.Js=null)}pi(e){var t;try{const i=((t=this.si)===null||t===void 0?void 0:t.getItem(this.yi(e)))!==null;return I("IndexedDbPersistence",`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return me("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}Ii(){if(this.si)try{this.si.setItem(this.yi(this.clientId),String(Date.now()))}catch(e){me("Failed to set zombie client id.",e)}}Ai(){if(this.si)try{this.si.removeItem(this.yi(this.clientId))}catch{}}yi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Qr(n){return Ue(n,"owner")}function sc(n){return Ue(n,"clientMetadata")}function xp(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mp{constructor(e,t,i,s){this.targetId=e,this.fromCache=t,this.Pi=i,this.vi=s}static Vi(e,t){let i=U(),s=U();for(const r of t.docChanges)switch(r.type){case 0:i=i.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new Mp(e,t.fromCache,i,s)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ub{constructor(){this.Si=!1}initialize(e,t){this.Di=e,this.indexManager=t,this.Si=!0}getDocumentsMatchingQuery(e,t,i,s){return this.Ci(e,t).next(r=>r||this.xi(e,t,s,i)).next(r=>r||this.Ni(e,t))}Ci(e,t){return g.resolve(null)}xi(e,t,i,s){return N1(t)||s.isEqual(D.min())?this.Ni(e,t):this.Di.getDocuments(e,i).next(r=>{const o=this.ki(t,r);return this.Oi(t,o,i,s)?this.Ni(e,t):(pd()<=Ct.DEBUG&&I("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),yd(t)),this.Mi(e,o,t,uE(s,-1)))})}ki(e,t){let i=new Q(bE(e));return t.forEach((s,r)=>{bp(e,r)&&(i=i.add(r))}),i}Oi(e,t,i,s){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const r=e.limitType==="F"?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Ni(e,t){return pd()<=Ct.DEBUG&&I("QueryEngine","Using full collection scan to execute query:",yd(t)),this.Di.getDocumentsMatchingQuery(e,t,Nt.min())}Mi(e,t,i,s){return this.Di.getDocumentsMatchingQuery(e,i,s).next(r=>(t.forEach(o=>{r=r.insert(o.key,o)}),r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WF{constructor(e,t,i,s){this.persistence=e,this.Fi=t,this.wt=s,this.$i=new ce(F),this.Bi=new Ti(r=>ls(r),Oa),this.Li=new Map,this.Ui=e.getRemoteDocumentCache(),this.Vs=e.getTargetCache(),this.Ds=e.getBundleCache(),this.qi(i)}qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new cb(this.Ui,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ui.setIndexManager(this.indexManager),this.Fi.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.$i))}}function hb(n,e,t,i){return new WF(n,e,t,i)}async function db(n,e){const t=S(n);return await t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(r=>(s=r,t.qi(e),t.mutationQueue.getAllMutationBatches(i))).next(r=>{const o=[],a=[];let c=U();for(const l of s){o.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}for(const l of r){a.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}return t.localDocuments.getDocuments(i,c).next(l=>({Ki:l,removedBatchIds:o,addedBatchIds:a}))})})}function HF(n,e){const t=S(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const s=e.batch.keys(),r=t.Ui.newChangeBuffer({trackRemovals:!0});return function(o,a,c,l){const u=c.batch,h=u.keys();let d=g.resolve();return h.forEach(f=>{d=d.next(()=>l.getEntry(a,f)).next(p=>{const _=c.docVersions.get(f);O(_!==null),p.version.compareTo(_)<0&&(u.applyToRemoteDocument(p,c),p.isValidDocument()&&(p.setReadTime(c.commitVersion),l.addEntry(p)))})}),d.next(()=>o.mutationQueue.removeMutationBatch(a,u))}(t,i,e,r).next(()=>r.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(o){let a=U();for(let c=0;c<o.mutationResults.length;++c)o.mutationResults[c].transformResults.length>0&&(a=a.add(o.batch.mutations[c].key));return a}(e))).next(()=>t.localDocuments.getDocuments(i,s))})}function fb(n){const e=S(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Vs.getLastRemoteSnapshotVersion(t))}function zF(n,e){const t=S(n),i=e.snapshotVersion;let s=t.$i;return t.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{const o=t.Ui.newChangeBuffer({trackRemovals:!0});s=t.$i;const a=[];e.targetChanges.forEach((u,h)=>{const d=s.get(h);if(!d)return;a.push(t.Vs.removeMatchingKeys(r,u.removedDocuments,h).next(()=>t.Vs.addMatchingKeys(r,u.addedDocuments,h)));let f=d.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.has(h)?f=f.withResumeToken(ve.EMPTY_BYTE_STRING,D.min()).withLastLimboFreeSnapshotVersion(D.min()):u.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(u.resumeToken,i)),s=s.insert(h,f),function(p,_,v){return p.resumeToken.approximateByteSize()===0||_.snapshotVersion.toMicroseconds()-p.snapshotVersion.toMicroseconds()>=3e8?!0:v.addedDocuments.size+v.modifiedDocuments.size+v.removedDocuments.size>0}(d,f,u)&&a.push(t.Vs.updateTargetData(r,f))});let c=wt(),l=U();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(r,u))}),a.push(pb(r,o,e.documentUpdates).next(u=>{c=u.Gi,l=u.Qi})),!i.isEqual(D.min())){const u=t.Vs.getLastRemoteSnapshotVersion(r).next(h=>t.Vs.setTargetsMetadata(r,r.currentSequenceNumber,i));a.push(u)}return g.waitFor(a).next(()=>o.apply(r)).next(()=>t.localDocuments.getLocalViewOfDocuments(r,c,l)).next(()=>c)}).then(r=>(t.$i=s,r))}function pb(n,e,t){let i=U(),s=U();return t.forEach(r=>i=i.add(r)),e.getEntries(n,i).next(r=>{let o=wt();return t.forEach((a,c)=>{const l=r.get(a);c.isFoundDocument()!==l.isFoundDocument()&&(s=s.add(a)),c.isNoDocument()&&c.version.isEqual(D.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):I("LocalStore","Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",c.version)}),{Gi:o,Qi:s}})}function QF(n,e){const t=S(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function hr(n,e){const t=S(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let s;return t.Vs.getTargetData(i,e).next(r=>r?(s=r,g.resolve(s)):t.Vs.allocateTargetId(i).next(o=>(s=new ei(e,o,0,i.currentSequenceNumber),t.Vs.addTargetData(i,s).next(()=>s))))}).then(i=>{const s=t.$i.get(i.targetId);return(s===null||i.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.$i=t.$i.insert(i.targetId,i),t.Bi.set(e,i.targetId)),i})}async function dr(n,e,t){const i=S(n),s=i.$i.get(e),r=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",r,o=>i.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Ii(o))throw o;I("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}i.$i=i.$i.remove(e),i.Bi.delete(s.target)}function ol(n,e,t){const i=S(n);let s=D.min(),r=U();return i.persistence.runTransaction("Execute query","readonly",o=>function(a,c,l){const u=S(a),h=u.Bi.get(l);return h!==void 0?g.resolve(u.$i.get(h)):u.Vs.getTargetData(c,l)}(i,o,Bt(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,i.Vs.getMatchingKeysForTargetId(o,a.targetId).next(c=>{r=c})}).next(()=>i.Fi.getDocumentsMatchingQuery(o,e,t?s:D.min(),t?r:U())).next(a=>(_b(i,EE(e),a),{documents:a,ji:r})))}function gb(n,e){const t=S(n),i=S(t.Vs),s=t.$i.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",r=>i.te(r,e).next(o=>o?o.target:null))}function mb(n,e){const t=S(n),i=t.Li.get(e)||D.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Ui.getAllFromCollectionGroup(s,e,uE(i,-1),Number.MAX_SAFE_INTEGER)).then(s=>(_b(t,e,s),s))}function _b(n,e,t){let i=D.min();t.forEach((s,r)=>{r.readTime.compareTo(i)>0&&(i=r.readTime)}),n.Li.set(e,i)}async function YF(n,e,t,i){const s=S(n);let r=U(),o=wt();for(const l of t){const u=e.Wi(l.metadata.name);l.document&&(r=r.add(u));const h=e.zi(l);h.setReadTime(e.Hi(l.metadata.readTime)),o=o.insert(u,h)}const a=s.Ui.newChangeBuffer({trackRemovals:!0}),c=await hr(s,function(l){return Bt(Ar(j.fromString(`__bundle__/docs/${l}`)))}(i));return s.persistence.runTransaction("Apply bundle documents","readwrite",l=>pb(l,a,o).next(u=>(a.apply(l),u)).next(u=>s.Vs.removeMatchingKeysForTargetId(l,c.targetId).next(()=>s.Vs.addMatchingKeys(l,r,c.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(l,u.Gi,u.Qi)).next(()=>u.Gi)))}async function XF(n,e,t=U()){const i=await hr(n,Bt(Np(e.bundledQuery))),s=S(n);return s.persistence.runTransaction("Save named query","readwrite",r=>{const o=Ne(e.readTime);if(i.snapshotVersion.compareTo(o)>=0)return s.Ds.saveNamedQuery(r,e);const a=i.withResumeToken(ve.EMPTY_BYTE_STRING,o);return s.$i=s.$i.insert(a.targetId,a),s.Vs.updateTargetData(r,a).next(()=>s.Vs.removeMatchingKeysForTargetId(r,i.targetId)).next(()=>s.Vs.addMatchingKeys(r,t,i.targetId)).next(()=>s.Ds.saveNamedQuery(r,e))})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q_(n,e){return`firestore_clients_${n}_${e}`}function Y_(n,e,t){let i=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}function lh(n,e){return`firestore_targets_${n}_${e}`}class al{constructor(e,t,i,s){this.user=e,this.batchId=t,this.state=i,this.error=s}static Ji(e,t,i){const s=JSON.parse(i);let r,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(r=new y(s.error.code,s.error.message))),o?new al(e,t,s.state,r):(me("SharedClientState",`Failed to parse mutation state for ID '${t}': ${i}`),null)}Yi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class mo{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static Ji(e,t){const i=JSON.parse(t);let s,r=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return r&&i.error&&(r=typeof i.error.message=="string"&&typeof i.error.code=="string",r&&(s=new y(i.error.code,i.error.message))),r?new mo(e,i.state,s):(me("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Yi(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class cl{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ji(e,t){const i=JSON.parse(t);let s=typeof i=="object"&&i.activeTargetIds instanceof Array,r=yu();for(let o=0;s&&o<i.activeTargetIds.length;++o)s=mE(i.activeTargetIds[o]),r=r.add(i.activeTargetIds[o]);return s?new cl(e,r):(me("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Lp{constructor(e,t){this.clientId=e,this.onlineState=t}static Ji(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Lp(t.clientId,t.onlineState):(me("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Td{constructor(){this.activeTargetIds=yu()}Xi(e){this.activeTargetIds=this.activeTargetIds.add(e)}Zi(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Yi(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class uh{constructor(e,t,i,s,r){this.window=e,this.js=t,this.persistenceKey=i,this.tr=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.er=this.nr.bind(this),this.sr=new ce(F),this.started=!1,this.ir=[];const o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=r,this.rr=Q_(this.persistenceKey,this.tr),this.ur=function(a){return`firestore_sequence_number_${a}`}(this.persistenceKey),this.sr=this.sr.insert(this.tr,new Td),this.cr=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.ar=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.hr=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.lr=function(a){return`firestore_online_state_${a}`}(this.persistenceKey),this.dr=function(a){return`firestore_bundle_loaded_v2_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this.er)}static V(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Ri();for(const i of e){if(i===this.tr)continue;const s=this.getItem(Q_(this.persistenceKey,i));if(s){const r=cl.Ji(i,s);r&&(this.sr=this.sr.insert(r.clientId,r))}}this._r();const t=this.storage.getItem(this.lr);if(t){const i=this.wr(t);i&&this.mr(i)}for(const i of this.ir)this.nr(i);this.ir=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.ur,JSON.stringify(e))}getAllActiveQueryTargets(){return this.gr(this.sr)}isActiveQueryTarget(e){let t=!1;return this.sr.forEach((i,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.yr(e,"pending")}updateMutationState(e,t,i){this.yr(e,t,i),this.pr(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem(lh(this.persistenceKey,e));if(i){const s=mo.Ji(e,i);s&&(t=s.state)}}return this.Ir.Xi(e),this._r(),t}removeLocalQueryTarget(e){this.Ir.Zi(e),this._r()}isLocalQueryTarget(e){return this.Ir.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(lh(this.persistenceKey,e))}updateQueryState(e,t,i){this.Tr(e,t,i)}handleUserChange(e,t,i){t.forEach(s=>{this.pr(s)}),this.currentUser=e,i.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.Er(e)}notifyBundleLoaded(e){this.Ar(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.er),this.removeItem(this.rr),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return I("SharedClientState","READ",e,t),t}setItem(e,t){I("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){I("SharedClientState","REMOVE",e),this.storage.removeItem(e)}nr(e){const t=e;if(t.storageArea===this.storage){if(I("SharedClientState","EVENT",t.key,t.newValue),t.key===this.rr)return void me("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.js.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.cr.test(t.key)){if(t.newValue==null){const i=this.Rr(t.key);return this.br(i,null)}{const i=this.Pr(t.key,t.newValue);if(i)return this.br(i.clientId,i)}}else if(this.ar.test(t.key)){if(t.newValue!==null){const i=this.vr(t.key,t.newValue);if(i)return this.Vr(i)}}else if(this.hr.test(t.key)){if(t.newValue!==null){const i=this.Sr(t.key,t.newValue);if(i)return this.Dr(i)}}else if(t.key===this.lr){if(t.newValue!==null){const i=this.wr(t.newValue);if(i)return this.mr(i)}}else if(t.key===this.ur){const i=function(s){let r=yt.ot;if(s!=null)try{const o=JSON.parse(s);O(typeof o=="number"),r=o}catch(o){me("SharedClientState","Failed to read sequence number from WebStorage",o)}return r}(t.newValue);i!==yt.ot&&this.sequenceNumberHandler(i)}else if(t.key===this.dr){const i=this.Cr(t.newValue);await Promise.all(i.map(s=>this.syncEngine.Nr(s)))}}}else this.ir.push(t)})}}get Ir(){return this.sr.get(this.tr)}_r(){this.setItem(this.rr,this.Ir.Yi())}yr(e,t,i){const s=new al(this.currentUser,e,t,i),r=Y_(this.persistenceKey,this.currentUser,e);this.setItem(r,s.Yi())}pr(e){const t=Y_(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Er(e){const t={clientId:this.tr,onlineState:e};this.storage.setItem(this.lr,JSON.stringify(t))}Tr(e,t,i){const s=lh(this.persistenceKey,e),r=new mo(e,t,i);this.setItem(s,r.Yi())}Ar(e){const t=JSON.stringify(Array.from(e));this.setItem(this.dr,t)}Rr(e){const t=this.cr.exec(e);return t?t[1]:null}Pr(e,t){const i=this.Rr(e);return cl.Ji(i,t)}vr(e,t){const i=this.ar.exec(e),s=Number(i[1]),r=i[2]!==void 0?i[2]:null;return al.Ji(new Ce(r),s,t)}Sr(e,t){const i=this.hr.exec(e),s=Number(i[1]);return mo.Ji(s,t)}wr(e){return Lp.Ji(e)}Cr(e){return JSON.parse(e)}async Vr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.kr(e.batchId,e.state,e.error);I("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Dr(e){return this.syncEngine.Or(e.targetId,e.state,e.error)}br(e,t){const i=t?this.sr.insert(e,t):this.sr.remove(e),s=this.gr(this.sr),r=this.gr(i),o=[],a=[];return r.forEach(c=>{s.has(c)||o.push(c)}),s.forEach(c=>{r.has(c)||a.push(c)}),this.syncEngine.Mr(o,a).then(()=>{this.sr=i})}mr(e){this.sr.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}gr(e){let t=yu();return e.forEach((i,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class yb{constructor(){this.Fr=new Td,this.$r={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e){return this.Fr.Xi(e),this.$r[e]||"not-current"}updateQueryState(e,t,i){this.$r[e]=t}removeLocalQueryTarget(e){this.Fr.Zi(e)}isLocalQueryTarget(e){return this.Fr.activeTargetIds.has(e)}clearQueryState(e){delete this.$r[e]}getAllActiveQueryTargets(){return this.Fr.activeTargetIds}isActiveQueryTarget(e){return this.Fr.activeTargetIds.has(e)}start(){return this.Fr=new Td,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JF{Br(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X_{constructor(){this.Lr=()=>this.Ur(),this.qr=()=>this.Kr(),this.Gr=[],this.Qr()}Br(e){this.Gr.push(e)}shutdown(){window.removeEventListener("online",this.Lr),window.removeEventListener("offline",this.qr)}Qr(){window.addEventListener("online",this.Lr),window.addEventListener("offline",this.qr)}Ur(){I("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Gr)e(0)}Kr(){I("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Gr)e(1)}static V(){return typeof window!="undefined"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZF={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eU{constructor(e){this.jr=e.jr,this.Wr=e.Wr}zr(e){this.Hr=e}Jr(e){this.Yr=e}onMessage(e){this.Xr=e}close(){this.Wr()}send(e){this.jr(e)}Zr(){this.Hr()}eo(e){this.Yr(e)}no(e){this.Xr(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tU extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.so=t+"://"+e.host,this.io="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}ro(e,t,i,s,r){const o=this.oo(e,t);I("RestConnection","Sending: ",o,i);const a={};return this.uo(a,s,r),this.co(e,o,a,i).then(c=>(I("RestConnection","Received: ",c),c),c=>{throw qo("RestConnection",`${e} failed with error: `,c,"url: ",o,"request:",i),c})}ao(e,t,i,s,r,o){return this.ro(e,t,i,s,r)}uo(e,t,i){e["X-Goog-Api-Client"]="gl-js/ fire/"+kr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,r)=>e[r]=s),i&&i.headers.forEach((s,r)=>e[r]=s)}oo(e,t){const i=ZF[e];return`${this.so}/v1/${t}:${i}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}co(e,t,i,s){return new Promise((r,o)=>{const a=new JL;a.listenOnce(QL.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case oh.NO_ERROR:const l=a.getResponseJson();I("Connection","XHR received:",JSON.stringify(l)),r(l);break;case oh.TIMEOUT:I("Connection",'RPC "'+e+'" timed out'),o(new y(m.DEADLINE_EXCEEDED,"Request time out"));break;case oh.HTTP_ERROR:const u=a.getStatus();if(I("Connection",'RPC "'+e+'" failed with status:',u,"response text:",a.getResponseText()),u>0){const h=a.getResponseJson().error;if(h&&h.status&&h.message){const d=function(f){const p=f.toLowerCase().replace(/_/g,"-");return Object.values(m).indexOf(p)>=0?p:m.UNKNOWN}(h.status);o(new y(d,h.message))}else o(new y(m.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new y(m.UNAVAILABLE,"Connection failed."));break;default:k()}}finally{I("Connection",'RPC "'+e+'" completed.')}});const c=JSON.stringify(s);a.send(t,"POST",c,i,15)})}ho(e,t,i){const s=[this.so,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=HL(),o=zL(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new XL({})),this.uo(a.initMessageHeaders,t,i),wl()||aa()||LC()||xd()||FC()||oa()||(a.httpHeadersOverwriteParam="$httpHeaders");const c=s.join("");I("Connection","Creating WebChannel: "+c,a);const l=r.createWebChannel(c,a);let u=!1,h=!1;const d=new eU({jr:p=>{h?I("Connection","Not sending because WebChannel is closed:",p):(u||(I("Connection","Opening WebChannel transport."),l.open(),u=!0),I("Connection","WebChannel sending:",p),l.send(p))},Wr:()=>l.close()}),f=(p,_,v)=>{p.listen(_,R=>{try{v(R)}catch(x){setTimeout(()=>{throw x},0)}})};return f(l,Za.EventType.OPEN,()=>{h||I("Connection","WebChannel transport opened.")}),f(l,Za.EventType.CLOSE,()=>{h||(h=!0,I("Connection","WebChannel transport closed"),d.eo())}),f(l,Za.EventType.ERROR,p=>{h||(h=!0,qo("Connection","WebChannel transport errored:",p),d.eo(new y(m.UNAVAILABLE,"The operation could not be completed")))}),f(l,Za.EventType.MESSAGE,p=>{var _;if(!h){const v=p.data[0];O(!!v);const R=v,x=R.error||((_=R[0])===null||_===void 0?void 0:_.error);if(x){I("Connection","WebChannel received error:",x);const A=x.status;let M=function(G){const he=ge[G];if(he!==void 0)return ME(he)}(A),H=x.message;M===void 0&&(M=m.INTERNAL,H="Unknown error status: "+A+" with message "+x.message),h=!0,d.eo(new y(M,H)),l.close()}else I("Connection","WebChannel received:",v),d.no(v)}}),f(o,YL.STAT_EVENT,p=>{p.stat===c_.PROXY?I("Connection","Detected buffering proxy"):p.stat===c_.NOPROXY&&I("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.Zr()},0),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wb(){return typeof window!="undefined"?window:null}function yc(){return typeof document!="undefined"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ua(n){return new W1(n,!0)}class Fp{constructor(e,t,i=1e3,s=1.5,r=6e4){this.js=e,this.timerId=t,this.lo=i,this.fo=s,this._o=r,this.wo=0,this.mo=null,this.yo=Date.now(),this.reset()}reset(){this.wo=0}po(){this.wo=this._o}Io(e){this.cancel();const t=Math.floor(this.wo+this.To()),i=Math.max(0,Date.now()-this.yo),s=Math.max(0,t-i);s>0&&I("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.wo} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.mo=this.js.enqueueAfterDelay(this.timerId,s,()=>(this.yo=Date.now(),e())),this.wo*=this.fo,this.wo<this.lo&&(this.wo=this.lo),this.wo>this._o&&(this.wo=this._o)}Eo(){this.mo!==null&&(this.mo.skipDelay(),this.mo=null)}cancel(){this.mo!==null&&(this.mo.cancel(),this.mo=null)}To(){return(Math.random()-.5)*this.wo}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vb{constructor(e,t,i,s,r,o,a,c){this.js=e,this.Ao=i,this.Ro=s,this.bo=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Po=0,this.vo=null,this.Vo=null,this.stream=null,this.So=new Fp(e,t)}Do(){return this.state===1||this.state===5||this.Co()}Co(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.xo()}async stop(){this.Do()&&await this.close(0)}No(){this.state=0,this.So.reset()}ko(){this.Co()&&this.vo===null&&(this.vo=this.js.enqueueAfterDelay(this.Ao,6e4,()=>this.Oo()))}Mo(e){this.Fo(),this.stream.send(e)}async Oo(){if(this.Co())return this.close(0)}Fo(){this.vo&&(this.vo.cancel(),this.vo=null)}$o(){this.Vo&&(this.Vo.cancel(),this.Vo=null)}async close(e,t){this.Fo(),this.$o(),this.So.cancel(),this.Po++,e!==4?this.So.reset():t&&t.code===m.RESOURCE_EXHAUSTED?(me(t.toString()),me("Using maximum backoff delay to prevent overloading the backend."),this.So.po()):t&&t.code===m.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Bo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Jr(t)}Bo(){}auth(){this.state=1;const e=this.Lo(this.Po),t=this.Po;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,s])=>{this.Po===t&&this.Uo(i,s)},i=>{e(()=>{const s=new y(m.UNKNOWN,"Fetching auth token failed: "+i.message);return this.qo(s)})})}Uo(e,t){const i=this.Lo(this.Po);this.stream=this.Ko(e,t),this.stream.zr(()=>{i(()=>(this.state=2,this.Vo=this.js.enqueueAfterDelay(this.Ro,1e4,()=>(this.Co()&&(this.state=3),Promise.resolve())),this.listener.zr()))}),this.stream.Jr(s=>{i(()=>this.qo(s))}),this.stream.onMessage(s=>{i(()=>this.onMessage(s))})}xo(){this.state=5,this.So.Io(async()=>{this.state=0,this.start()})}qo(e){return I("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Lo(e){return t=>{this.js.enqueueAndForget(()=>this.Po===e?t():(I("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class nU extends vb{constructor(e,t,i,s,r,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,s,o),this.wt=r}Ko(e,t){return this.bo.ho("Listen",e,t)}onMessage(e){this.So.reset();const t=Q1(this.wt,e),i=function(s){if(!("targetChange"in s))return D.min();const r=s.targetChange;return r.targetIds&&r.targetIds.length?D.min():r.readTime?Ne(r.readTime):D.min()}(e);return this.listener.Go(t,i)}Qo(e){const t={};t.database=Yo(this.wt),t.addTarget=function(s,r){let o;const a=r.target;return o=nl(a)?{documents:WE(s,a)}:{query:HE(s,a)},o.targetId=r.targetId,r.resumeToken.approximateByteSize()>0?o.resumeToken=$E(s,r.resumeToken):r.snapshotVersion.compareTo(D.min())>0&&(o.readTime=zo(s,r.snapshotVersion.toTimestamp())),o}(this.wt,e);const i=X1(this.wt,e);i&&(t.labels=i),this.Mo(t)}jo(e){const t={};t.database=Yo(this.wt),t.removeTarget=e,this.Mo(t)}}class iU extends vb{constructor(e,t,i,s,r,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,s,o),this.wt=r,this.Wo=!1}get zo(){return this.Wo}start(){this.Wo=!1,this.lastStreamToken=void 0,super.start()}Bo(){this.Wo&&this.Ho([])}Ko(e,t){return this.bo.ho("Write",e,t)}onMessage(e){if(O(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Wo){this.So.reset();const t=Y1(e.writeResults,e.commitTime),i=Ne(e.commitTime);return this.listener.Jo(i,t)}return O(!e.writeResults||e.writeResults.length===0),this.Wo=!0,this.listener.Yo()}Xo(){const e={};e.database=Yo(this.wt),this.Mo(e)}Ho(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>Xo(this.wt,i))};this.Mo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sU extends class{}{constructor(e,t,i,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.bo=i,this.wt=s,this.Zo=!1}tu(){if(this.Zo)throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}ro(e,t,i){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,r])=>this.bo.ro(e,t,i,s,r)).catch(s=>{throw s.name==="FirebaseError"?(s.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(m.UNKNOWN,s.toString())})}ao(e,t,i,s){return this.tu(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,o])=>this.bo.ao(e,t,i,r,o,s)).catch(r=>{throw r.name==="FirebaseError"?(r.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new y(m.UNKNOWN,r.toString())})}terminate(){this.Zo=!0}}class rU{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.eu=0,this.nu=null,this.su=!0}iu(){this.eu===0&&(this.ru("Unknown"),this.nu=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.nu=null,this.ou("Backend didn't respond within 10 seconds."),this.ru("Offline"),Promise.resolve())))}uu(e){this.state==="Online"?this.ru("Unknown"):(this.eu++,this.eu>=1&&(this.cu(),this.ou(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ru("Offline")))}set(e){this.cu(),this.eu=0,e==="Online"&&(this.su=!1),this.ru(e)}ru(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ou(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.su?(me(t),this.su=!1):I("OnlineStateTracker",t)}cu(){this.nu!==null&&(this.nu.cancel(),this.nu=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oU{constructor(e,t,i,s,r){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.au=[],this.hu=new Map,this.lu=new Set,this.fu=[],this.du=r,this.du.Br(o=>{i.enqueueAndForget(async()=>{Ei(this)&&(I("RemoteStore","Restarting streams for network reachability change."),await async function(a){const c=S(a);c.lu.add(4),await Pr(c),c._u.set("Unknown"),c.lu.delete(4),await Va(c)}(this))})}),this._u=new rU(i,s)}}async function Va(n){if(Ei(n))for(const e of n.fu)await e(!0)}async function Pr(n){for(const e of n.fu)await e(!1)}function Tu(n,e){const t=S(n);t.hu.has(e.targetId)||(t.hu.set(e.targetId,e),Bp(t)?Vp(t):Or(t).Co()&&Up(t,e))}function Jo(n,e){const t=S(n),i=Or(t);t.hu.delete(e),i.Co()&&Ib(t,e),t.hu.size===0&&(i.Co()?i.ko():Ei(t)&&t._u.set("Unknown"))}function Up(n,e){n.wu.Nt(e.targetId),Or(n).Qo(e)}function Ib(n,e){n.wu.Nt(e),Or(n).jo(e)}function Vp(n){n.wu=new j1({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),te:e=>n.hu.get(e)||null}),Or(n).start(),n._u.iu()}function Bp(n){return Ei(n)&&!Or(n).Do()&&n.hu.size>0}function Ei(n){return S(n).lu.size===0}function Tb(n){n.wu=void 0}async function aU(n){n.hu.forEach((e,t)=>{Up(n,e)})}async function cU(n,e){Tb(n),Bp(n)?(n._u.uu(e),Vp(n)):n._u.set("Unknown")}async function lU(n,e,t){if(n._u.set("Online"),e instanceof BE&&e.state===2&&e.cause)try{await async function(i,s){const r=s.cause;for(const o of s.targetIds)i.hu.has(o)&&(await i.remoteSyncer.rejectListen(o,r),i.hu.delete(o),i.wu.removeTarget(o))}(n,e)}catch(i){I("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),await ll(n,i)}else if(e instanceof mc?n.wu.Ut(e):e instanceof VE?n.wu.zt(e):n.wu.Gt(e),!t.isEqual(D.min()))try{const i=await fb(n.localStore);t.compareTo(i)>=0&&await function(s,r){const o=s.wu.Yt(r);return o.targetChanges.forEach((a,c)=>{if(a.resumeToken.approximateByteSize()>0){const l=s.hu.get(c);l&&s.hu.set(c,l.withResumeToken(a.resumeToken,r))}}),o.targetMismatches.forEach(a=>{const c=s.hu.get(a);if(!c)return;s.hu.set(a,c.withResumeToken(ve.EMPTY_BYTE_STRING,c.snapshotVersion)),Ib(s,a);const l=new ei(c.target,a,1,c.sequenceNumber);Up(s,l)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t)}catch(i){I("RemoteStore","Failed to raise snapshot:",i),await ll(n,i)}}async function ll(n,e,t){if(!Ii(e))throw e;n.lu.add(1),await Pr(n),n._u.set("Offline"),t||(t=()=>fb(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{I("RemoteStore","Retrying IndexedDB access"),await t(),n.lu.delete(1),await Va(n)})}function Eb(n,e){return e().catch(t=>ll(n,t,e))}async function Dr(n){const e=S(n),t=hi(e);let i=e.au.length>0?e.au[e.au.length-1].batchId:-1;for(;uU(e);)try{const s=await QF(e.localStore,i);if(s===null){e.au.length===0&&t.ko();break}i=s.batchId,hU(e,s)}catch(s){await ll(e,s)}bb(e)&&Sb(e)}function uU(n){return Ei(n)&&n.au.length<10}function hU(n,e){n.au.push(e);const t=hi(n);t.Co()&&t.zo&&t.Ho(e.mutations)}function bb(n){return Ei(n)&&!hi(n).Do()&&n.au.length>0}function Sb(n){hi(n).start()}async function dU(n){hi(n).Xo()}async function fU(n){const e=hi(n);for(const t of n.au)e.Ho(t.mutations)}async function pU(n,e,t){const i=n.au.shift(),s=Ap.from(i,e,t);await Eb(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await Dr(n)}async function gU(n,e){e&&hi(n).zo&&await async function(t,i){if(s=i.code,xE(s)&&s!==m.ABORTED){const r=t.au.shift();hi(t).No(),await Eb(t,()=>t.remoteSyncer.rejectFailedWrite(r.batchId,i)),await Dr(t)}var s}(n,e),bb(n)&&Sb(n)}async function J_(n,e){const t=S(n);t.asyncQueue.verifyOperationInProgress(),I("RemoteStore","RemoteStore received new credentials");const i=Ei(t);t.lu.add(3),await Pr(t),i&&t._u.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.lu.delete(3),await Va(t)}async function Ed(n,e){const t=S(n);e?(t.lu.delete(2),await Va(t)):e||(t.lu.add(2),await Pr(t),t._u.set("Unknown"))}function Or(n){return n.mu||(n.mu=function(e,t,i){const s=S(e);return s.tu(),new nU(t,s.bo,s.authCredentials,s.appCheckCredentials,s.wt,i)}(n.datastore,n.asyncQueue,{zr:aU.bind(null,n),Jr:cU.bind(null,n),Go:lU.bind(null,n)}),n.fu.push(async e=>{e?(n.mu.No(),Bp(n)?Vp(n):n._u.set("Unknown")):(await n.mu.stop(),Tb(n))})),n.mu}function hi(n){return n.gu||(n.gu=function(e,t,i){const s=S(e);return s.tu(),new iU(t,s.bo,s.authCredentials,s.appCheckCredentials,s.wt,i)}(n.datastore,n.asyncQueue,{zr:dU.bind(null,n),Jr:gU.bind(null,n),Yo:fU.bind(null,n),Jo:pU.bind(null,n)}),n.fu.push(async e=>{e?(n.gu.No(),await Dr(n)):(await n.gu.stop(),n.au.length>0&&(I("RemoteStore",`Stopping write stream with ${n.au.length} pending writes`),n.au=[]))})),n.gu}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $p{constructor(e,t,i,s,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=s,this.removalCallback=r,this.deferred=new Re,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,i,s,r){const o=Date.now()+i,a=new $p(e,t,o,s,r);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new y(m.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function xr(n,e){if(me("AsyncQueue",`${e}: ${n}`),Ii(n))return new y(m.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zs{constructor(e){this.comparator=e?(t,i)=>e(t,i)||b.comparator(t.key,i.key):(t,i)=>b.comparator(t.key,i.key),this.keyedMap=eo(),this.sortedSet=new ce(this.comparator)}static emptySet(e){return new zs(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof zs)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,r=i.getNext().key;if(!s.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new zs;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z_{constructor(){this.yu=new ce(b.comparator)}track(e){const t=e.doc.key,i=this.yu.get(t);i?e.type!==0&&i.type===3?this.yu=this.yu.insert(t,e):e.type===3&&i.type!==1?this.yu=this.yu.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.yu=this.yu.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.yu=this.yu.remove(t):e.type===1&&i.type===2?this.yu=this.yu.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.yu=this.yu.insert(t,{type:2,doc:e.doc}):k():this.yu=this.yu.insert(t,e)}pu(){const e=[];return this.yu.inorderTraversal((t,i)=>{e.push(i)}),e}}class fr{constructor(e,t,i,s,r,o,a,c){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=s,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c}static fromInitialDocuments(e,t,i,s){const r=[];return t.forEach(o=>{r.push({type:0,doc:o})}),new fr(e,t,zs.emptySet(t),r,i,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&xa(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==i[s].type||!t[s].doc.isEqual(i[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mU{constructor(){this.Iu=void 0,this.listeners=[]}}class _U{constructor(){this.queries=new Ti(e=>TE(e),xa),this.onlineState="Unknown",this.Tu=new Set}}async function qp(n,e){const t=S(n),i=e.query;let s=!1,r=t.queries.get(i);if(r||(s=!0,r=new mU),s)try{r.Iu=await t.onListen(i)}catch(o){const a=xr(o,`Initialization of query '${yd(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,r),r.listeners.push(e),e.Eu(t.onlineState),r.Iu&&e.Au(r.Iu)&&Kp(t)}async function jp(n,e){const t=S(n),i=e.query;let s=!1;const r=t.queries.get(i);if(r){const o=r.listeners.indexOf(e);o>=0&&(r.listeners.splice(o,1),s=r.listeners.length===0)}if(s)return t.queries.delete(i),t.onUnlisten(i)}function yU(n,e){const t=S(n);let i=!1;for(const s of e){const r=s.query,o=t.queries.get(r);if(o){for(const a of o.listeners)a.Au(s)&&(i=!0);o.Iu=s}}i&&Kp(t)}function wU(n,e,t){const i=S(n),s=i.queries.get(e);if(s)for(const r of s.listeners)r.onError(t);i.queries.delete(e)}function Kp(n){n.Tu.forEach(e=>{e.next()})}class Gp{constructor(e,t,i){this.query=e,this.Ru=t,this.bu=!1,this.Pu=null,this.onlineState="Unknown",this.options=i||{}}Au(e){if(!this.options.includeMetadataChanges){const i=[];for(const s of e.docChanges)s.type!==3&&i.push(s);e=new fr(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}let t=!1;return this.bu?this.vu(e)&&(this.Ru.next(e),t=!0):this.Vu(e,this.onlineState)&&(this.Su(e),t=!0),this.Pu=e,t}onError(e){this.Ru.error(e)}Eu(e){this.onlineState=e;let t=!1;return this.Pu&&!this.bu&&this.Vu(this.Pu,e)&&(this.Su(this.Pu),t=!0),t}Vu(e,t){if(!e.fromCache)return!0;const i=t!=="Offline";return(!this.options.Du||!i)&&(!e.docs.isEmpty()||t==="Offline")}vu(e){if(e.docChanges.length>0)return!0;const t=this.Pu&&this.Pu.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Su(e){e=fr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.bu=!0,this.Ru.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vU{constructor(e,t){this.payload=e,this.byteLength=t}Cu(){return"metadata"in this.payload}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ey{constructor(e){this.wt=e}Wi(e){return ln(this.wt,e)}zi(e){return e.metadata.exists?GE(this.wt,e.document,!1):Z.newNoDocument(this.Wi(e.metadata.name),this.Hi(e.metadata.readTime))}Hi(e){return Ne(e)}}class IU{constructor(e,t,i){this.xu=e,this.localStore=t,this.wt=i,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Cb(e)}Nu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;const i=j.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(i.get(i.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ku(e){const t=new Map,i=new ey(this.wt);for(const s of e)if(s.metadata.queries){const r=i.Wi(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||U()).add(r);t.set(o,a)}}return t}async complete(){const e=await YF(this.localStore,new ey(this.wt),this.documents,this.xu.id),t=this.ku(this.documents);for(const i of this.queries)await XF(this.localStore,i,t.get(i.name));return this.progress.taskState="Success",{progress:this.progress,Ou:this.collectionGroups,Mu:e}}}function Cb(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kb{constructor(e){this.key=e}}class Ab{constructor(e){this.key=e}}class Rb{constructor(e,t){this.query=e,this.Fu=t,this.$u=null,this.current=!1,this.Bu=U(),this.mutatedKeys=U(),this.Lu=bE(e),this.Uu=new zs(this.Lu)}get qu(){return this.Fu}Ku(e,t){const i=t?t.Gu:new Z_,s=t?t.Uu:this.Uu;let r=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,l=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((u,h)=>{const d=s.get(u),f=bp(this.query,h)?h:null,p=!!d&&this.mutatedKeys.has(d.key),_=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let v=!1;d&&f?d.data.isEqual(f.data)?p!==_&&(i.track({type:3,doc:f}),v=!0):this.Qu(d,f)||(i.track({type:2,doc:f}),v=!0,(c&&this.Lu(f,c)>0||l&&this.Lu(f,l)<0)&&(a=!0)):!d&&f?(i.track({type:0,doc:f}),v=!0):d&&!f&&(i.track({type:1,doc:d}),v=!0,(c||l)&&(a=!0)),v&&(f?(o=o.add(f),r=_?r.add(u):r.delete(u)):(o=o.delete(u),r=r.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),r=r.delete(u.key),i.track({type:1,doc:u})}return{Uu:o,Gu:i,Oi:a,mutatedKeys:r}}Qu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i){const s=this.Uu;this.Uu=e.Uu,this.mutatedKeys=e.mutatedKeys;const r=e.Gu.pu();r.sort((l,u)=>function(h,d){const f=p=>{switch(p){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return k()}};return f(h)-f(d)}(l.type,u.type)||this.Lu(l.doc,u.doc)),this.ju(i);const o=t?this.Wu():[],a=this.Bu.size===0&&this.current?1:0,c=a!==this.$u;return this.$u=a,r.length!==0||c?{snapshot:new fr(this.query,e.Uu,s,r,e.mutatedKeys,a===0,c,!1),zu:o}:{zu:o}}Eu(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Uu:this.Uu,Gu:new Z_,mutatedKeys:this.mutatedKeys,Oi:!1},!1)):{zu:[]}}Hu(e){return!this.Fu.has(e)&&!!this.Uu.has(e)&&!this.Uu.get(e).hasLocalMutations}ju(e){e&&(e.addedDocuments.forEach(t=>this.Fu=this.Fu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.Fu=this.Fu.delete(t)),this.current=e.current)}Wu(){if(!this.current)return[];const e=this.Bu;this.Bu=U(),this.Uu.forEach(i=>{this.Hu(i.key)&&(this.Bu=this.Bu.add(i.key))});const t=[];return e.forEach(i=>{this.Bu.has(i)||t.push(new Ab(i))}),this.Bu.forEach(i=>{e.has(i)||t.push(new kb(i))}),t}Ju(e){this.Fu=e.ji,this.Bu=U();const t=this.Ku(e.documents);return this.applyChanges(t,!0)}Yu(){return fr.fromInitialDocuments(this.query,this.Uu,this.mutatedKeys,this.$u===0)}}class TU{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class EU{constructor(e){this.key=e,this.Xu=!1}}class bU{constructor(e,t,i,s,r,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.Zu={},this.tc=new Ti(a=>TE(a),xa),this.ec=new Map,this.nc=new Set,this.sc=new ce(b.comparator),this.ic=new Map,this.rc=new Dp,this.oc={},this.uc=new Map,this.cc=ps.Rn(),this.onlineState="Unknown",this.ac=void 0}get isPrimaryClient(){return this.ac===!0}}async function SU(n,e){const t=Yp(n);let i,s;const r=t.tc.get(e);if(r)i=r.targetId,t.sharedClientState.addLocalQueryTarget(i),s=r.view.Yu();else{const o=await hr(t.localStore,Bt(e));t.isPrimaryClient&&Tu(t.remoteStore,o);const a=t.sharedClientState.addLocalQueryTarget(o.targetId);i=o.targetId,s=await Wp(t,e,i,a==="current")}return s}async function Wp(n,e,t,i){n.hc=(u,h,d)=>async function(f,p,_,v){let R=p.view.Ku(_);R.Oi&&(R=await ol(f.localStore,p.query,!1).then(({documents:M})=>p.view.Ku(M,R)));const x=v&&v.targetChanges.get(p.targetId),A=p.view.applyChanges(R,f.isPrimaryClient,x);return bd(f,p.targetId,A.zu),A.snapshot}(n,u,h,d);const s=await ol(n.localStore,e,!0),r=new Rb(e,s.ji),o=r.Ku(s.documents),a=Fa.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline"),c=r.applyChanges(o,n.isPrimaryClient,a);bd(n,t,c.zu);const l=new TU(e,t,r);return n.tc.set(e,l),n.ec.has(t)?n.ec.get(t).push(e):n.ec.set(t,[e]),c.snapshot}async function CU(n,e){const t=S(n),i=t.tc.get(e),s=t.ec.get(i.targetId);if(s.length>1)return t.ec.set(i.targetId,s.filter(r=>!xa(r,e))),void t.tc.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(i.targetId),t.sharedClientState.isActiveQueryTarget(i.targetId)||await dr(t.localStore,i.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(i.targetId),Jo(t.remoteStore,i.targetId),pr(t,i.targetId)}).catch(vi)):(pr(t,i.targetId),await dr(t.localStore,i.targetId,!0))}async function kU(n,e,t){const i=Xp(n);try{const s=await function(r,o){const a=S(r),c=se.now(),l=o.reduce((d,f)=>d.add(f.key),U());let u,h;return a.persistence.runTransaction("Locally write mutations","readwrite",d=>{let f=wt(),p=U();return a.Ui.getEntries(d,l).next(_=>{f=_,f.forEach((v,R)=>{R.isValidDocument()||(p=p.add(v))})}).next(()=>a.localDocuments.getOverlayedDocuments(d,f)).next(_=>{u=_;const v=[];for(const R of o){const x=F1(R,u.get(R.key).overlayedDocument);x!=null&&v.push(new Vn(R.key,x,yE(x.value.mapValue),oe.exists(!0)))}return a.mutationQueue.addMutationBatch(d,c,v,o)}).next(_=>{h=_;const v=_.applyToLocalDocumentSet(u,p);return a.documentOverlayCache.saveOverlays(d,_.batchId,v)})}).then(()=>({batchId:h.batchId,changes:FE(u)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(s.batchId),function(r,o,a){let c=r.oc[r.currentUser.toKey()];c||(c=new ce(F)),c=c.insert(o,a),r.oc[r.currentUser.toKey()]=c}(i,s.batchId,t),await Bn(i,s.changes),await Dr(i.remoteStore)}catch(s){const r=xr(s,"Failed to persist write");t.reject(r)}}async function Nb(n,e){const t=S(n);try{const i=await zF(t.localStore,e);e.targetChanges.forEach((s,r)=>{const o=t.ic.get(r);o&&(O(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.Xu=!0:s.modifiedDocuments.size>0?O(o.Xu):s.removedDocuments.size>0&&(O(o.Xu),o.Xu=!1))}),await Bn(t,i,e)}catch(i){await vi(i)}}function ty(n,e,t){const i=S(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const s=[];i.tc.forEach((r,o)=>{const a=o.view.Eu(e);a.snapshot&&s.push(a.snapshot)}),function(r,o){const a=S(r);a.onlineState=o;let c=!1;a.queries.forEach((l,u)=>{for(const h of u.listeners)h.Eu(o)&&(c=!0)}),c&&Kp(a)}(i.eventManager,e),s.length&&i.Zu.Go(s),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function AU(n,e,t){const i=S(n);i.sharedClientState.updateQueryState(e,"rejected",t);const s=i.ic.get(e),r=s&&s.key;if(r){let o=new ce(b.comparator);o=o.insert(r,Z.newNoDocument(r,D.min()));const a=U().add(r),c=new La(D.min(),new Map,new Q(F),o,a);await Nb(i,c),i.sc=i.sc.remove(r),i.ic.delete(e),Qp(i)}else await dr(i.localStore,e,!1).then(()=>pr(i,e,t)).catch(vi)}async function RU(n,e){const t=S(n),i=e.batch.batchId;try{const s=await HF(t.localStore,e);zp(t,i,null),Hp(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await Bn(t,s)}catch(s){await vi(s)}}async function NU(n,e,t){const i=S(n);try{const s=await function(r,o){const a=S(r);return a.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return a.mutationQueue.lookupMutationBatch(c,o).next(u=>(O(u!==null),l=u.keys(),a.mutationQueue.removeMutationBatch(c,u))).next(()=>a.mutationQueue.performConsistencyCheck(c)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(c,l,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>a.localDocuments.getDocuments(c,l))})}(i.localStore,e);zp(i,e,t),Hp(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await Bn(i,s)}catch(s){await vi(s)}}async function PU(n,e){const t=S(n);Ei(t.remoteStore)||I("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const i=await function(r){const o=S(r);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.mutationQueue.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(i===-1)return void e.resolve();const s=t.uc.get(i)||[];s.push(e),t.uc.set(i,s)}catch(i){const s=xr(i,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function Hp(n,e){(n.uc.get(e)||[]).forEach(t=>{t.resolve()}),n.uc.delete(e)}function zp(n,e,t){const i=S(n);let s=i.oc[i.currentUser.toKey()];if(s){const r=s.get(e);r&&(t?r.reject(t):r.resolve(),s=s.remove(e)),i.oc[i.currentUser.toKey()]=s}}function pr(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.ec.get(e))n.tc.delete(i),t&&n.Zu.lc(i,t);n.ec.delete(e),n.isPrimaryClient&&n.rc.us(e).forEach(i=>{n.rc.containsKey(i)||Pb(n,i)})}function Pb(n,e){n.nc.delete(e.path.canonicalString());const t=n.sc.get(e);t!==null&&(Jo(n.remoteStore,t),n.sc=n.sc.remove(e),n.ic.delete(t),Qp(n))}function bd(n,e,t){for(const i of t)i instanceof kb?(n.rc.addReference(i.key,e),DU(n,i)):i instanceof Ab?(I("SyncEngine","Document no longer in limbo: "+i.key),n.rc.removeReference(i.key,e),n.rc.containsKey(i.key)||Pb(n,i.key)):k()}function DU(n,e){const t=e.key,i=t.path.canonicalString();n.sc.get(t)||n.nc.has(i)||(I("SyncEngine","New document in limbo: "+t),n.nc.add(i),Qp(n))}function Qp(n){for(;n.nc.size>0&&n.sc.size<n.maxConcurrentLimboResolutions;){const e=n.nc.values().next().value;n.nc.delete(e);const t=new b(j.fromString(e)),i=n.cc.next();n.ic.set(i,new EU(t)),n.sc=n.sc.insert(t,i),Tu(n.remoteStore,new ei(Bt(Ar(t.path)),i,2,yt.ot))}}async function Bn(n,e,t){const i=S(n),s=[],r=[],o=[];i.tc.isEmpty()||(i.tc.forEach((a,c)=>{o.push(i.hc(c,e,t).then(l=>{if(l){i.isPrimaryClient&&i.sharedClientState.updateQueryState(c.targetId,l.fromCache?"not-current":"current"),s.push(l);const u=Mp.Vi(c.targetId,l);r.push(u)}}))}),await Promise.all(o),i.Zu.Go(s),await async function(a,c){const l=S(a);try{await l.persistence.runTransaction("notifyLocalViewChanges","readwrite",u=>g.forEach(c,h=>g.forEach(h.Pi,d=>l.persistence.referenceDelegate.addReference(u,h.targetId,d)).next(()=>g.forEach(h.vi,d=>l.persistence.referenceDelegate.removeReference(u,h.targetId,d)))))}catch(u){if(!Ii(u))throw u;I("LocalStore","Failed to update sequence numbers: "+u)}for(const u of c){const h=u.targetId;if(!u.fromCache){const d=l.$i.get(h),f=d.snapshotVersion,p=d.withLastLimboFreeSnapshotVersion(f);l.$i=l.$i.insert(h,p)}}}(i.localStore,r))}async function OU(n,e){const t=S(n);if(!t.currentUser.isEqual(e)){I("SyncEngine","User change. New user:",e.toKey());const i=await db(t.localStore,e);t.currentUser=e,function(s,r){s.uc.forEach(o=>{o.forEach(a=>{a.reject(new y(m.CANCELLED,r))})}),s.uc.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await Bn(t,i.Ki)}}function xU(n,e){const t=S(n),i=t.ic.get(e);if(i&&i.Xu)return U().add(i.key);{let s=U();const r=t.ec.get(e);if(!r)return s;for(const o of r){const a=t.tc.get(o);s=s.unionWith(a.view.qu)}return s}}async function MU(n,e){const t=S(n),i=await ol(t.localStore,e.query,!0),s=e.view.Ju(i);return t.isPrimaryClient&&bd(t,e.targetId,s.zu),s}async function LU(n,e){const t=S(n);return mb(t.localStore,e).then(i=>Bn(t,i))}async function FU(n,e,t,i){const s=S(n),r=await function(o,a){const c=S(o),l=S(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",u=>l.yn(u,a).next(h=>h?c.localDocuments.getDocuments(u,h):g.resolve(null)))}(s.localStore,e);r!==null?(t==="pending"?await Dr(s.remoteStore):t==="acknowledged"||t==="rejected"?(zp(s,e,i||null),Hp(s,e),function(o,a){S(S(o).mutationQueue).In(a)}(s.localStore,e)):k(),await Bn(s,r)):I("SyncEngine","Cannot apply mutation batch with id: "+e)}async function UU(n,e){const t=S(n);if(Yp(t),Xp(t),e===!0&&t.ac!==!0){const i=t.sharedClientState.getAllActiveQueryTargets(),s=await ny(t,i.toArray());t.ac=!0,await Ed(t.remoteStore,!0);for(const r of s)Tu(t.remoteStore,r)}else if(e===!1&&t.ac!==!1){const i=[];let s=Promise.resolve();t.ec.forEach((r,o)=>{t.sharedClientState.isLocalQueryTarget(o)?i.push(o):s=s.then(()=>(pr(t,o),dr(t.localStore,o,!0))),Jo(t.remoteStore,o)}),await s,await ny(t,i),function(r){const o=S(r);o.ic.forEach((a,c)=>{Jo(o.remoteStore,c)}),o.rc.cs(),o.ic=new Map,o.sc=new ce(b.comparator)}(t),t.ac=!1,await Ed(t.remoteStore,!1)}}async function ny(n,e,t){const i=S(n),s=[],r=[];for(const o of e){let a;const c=i.ec.get(o);if(c&&c.length!==0){a=await hr(i.localStore,Bt(c[0]));for(const l of c){const u=i.tc.get(l),h=await MU(i,u);h.snapshot&&r.push(h.snapshot)}}else{const l=await gb(i.localStore,o);a=await hr(i.localStore,l),await Wp(i,Db(l),o,!1)}s.push(a)}return i.Zu.Go(r),s}function Db(n){return vE(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function VU(n){const e=S(n);return S(S(e.localStore).persistence).Ri()}async function BU(n,e,t,i){const s=S(n);if(s.ac)return void I("SyncEngine","Ignoring unexpected query state notification.");const r=s.ec.get(e);if(r&&r.length>0)switch(t){case"current":case"not-current":{const o=await mb(s.localStore,EE(r[0])),a=La.createSynthesizedRemoteEventForCurrentChange(e,t==="current");await Bn(s,o,a);break}case"rejected":await dr(s.localStore,e,!0),pr(s,e,i);break;default:k()}}async function $U(n,e,t){const i=Yp(n);if(i.ac){for(const s of e){if(i.ec.has(s)){I("SyncEngine","Adding an already active target "+s);continue}const r=await gb(i.localStore,s),o=await hr(i.localStore,r);await Wp(i,Db(r),o.targetId,!1),Tu(i.remoteStore,o)}for(const s of t)i.ec.has(s)&&await dr(i.localStore,s,!1).then(()=>{Jo(i.remoteStore,s),pr(i,s)}).catch(vi)}}function Yp(n){const e=S(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Nb.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xU.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=AU.bind(null,e),e.Zu.Go=yU.bind(null,e.eventManager),e.Zu.lc=wU.bind(null,e.eventManager),e}function Xp(n){const e=S(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=RU.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=NU.bind(null,e),e}function qU(n,e,t){const i=S(n);(async function(s,r,o){try{const a=await r.getMetadata();if(await function(h,d){const f=S(h),p=Ne(d.createTime);return f.persistence.runTransaction("hasNewerBundle","readonly",_=>f.Ds.getBundleMetadata(_,d.id)).then(_=>!!_&&_.createTime.compareTo(p)>=0)}(s.localStore,a))return await r.close(),o._completeWith(function(h){return{taskState:"Success",documentsLoaded:h.totalDocuments,bytesLoaded:h.totalBytes,totalDocuments:h.totalDocuments,totalBytes:h.totalBytes}}(a)),Promise.resolve(new Set);o._updateProgress(Cb(a));const c=new IU(a,s.localStore,r.wt);let l=await r.fc();for(;l;){const h=await c.Nu(l);h&&o._updateProgress(h),l=await r.fc()}const u=await c.complete();return await Bn(s,u.Mu,void 0),await function(h,d){const f=S(h);return f.persistence.runTransaction("Save bundle","readwrite",p=>f.Ds.saveBundleMetadata(p,d))}(s.localStore,a),o._completeWith(u.progress),Promise.resolve(u.Ou)}catch(a){return qo("SyncEngine",`Loading bundle failed with ${a}`),o._failWith(a),Promise.resolve(new Set)}})(i,e,t).then(s=>{i.sharedClientState.notifyBundleLoaded(s)})}class Ob{constructor(){this.synchronizeTabs=!1}async initialize(e){this.wt=Ua(e.databaseInfo.databaseId),this.sharedClientState=this.dc(e),this.persistence=this._c(e),await this.persistence.start(),this.localStore=this.wc(e),this.gcScheduler=this.mc(e,this.localStore),this.indexBackfillerScheduler=this.gc(e,this.localStore)}mc(e,t){return null}gc(e,t){return null}wc(e){return hb(this.persistence,new ub,e.initialUser,this.wt)}_c(e){return new lb(Iu.Ms,this.wt)}dc(e){return new yb}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class xb extends Ob{constructor(e,t,i){super(),this.yc=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.yc.initialize(this,e),await Xp(this.yc.syncEngine),await Dr(this.yc.remoteStore),await this.persistence.ci(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}wc(e){return hb(this.persistence,new ub,e.initialUser,this.wt)}mc(e,t){const i=this.persistence.referenceDelegate.garbageCollector;return new DF(i,e.asyncQueue,t)}gc(e,t){const i=new p1(t,this.persistence);return new f1(e.asyncQueue,i)}_c(e){const t=xp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?gt.withCacheSize(this.cacheSizeBytes):gt.DEFAULT;return new Op(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,wb(),yc(),this.wt,this.sharedClientState,!!this.forceOwnership)}dc(e){return new yb}}class jU extends xb{constructor(e,t){super(e,t,!1),this.yc=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.yc.syncEngine;this.sharedClientState instanceof uh&&(this.sharedClientState.syncEngine={kr:FU.bind(null,t),Or:BU.bind(null,t),Mr:$U.bind(null,t),Ri:VU.bind(null,t),Nr:LU.bind(null,t)},await this.sharedClientState.start()),await this.persistence.ci(async i=>{await UU(this.yc.syncEngine,i),this.gcScheduler&&(i&&!this.gcScheduler.started?this.gcScheduler.start():i||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(i&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():i||this.indexBackfillerScheduler.stop())})}dc(e){const t=wb();if(!uh.V(t))throw new y(m.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const i=xp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new uh(t,e.asyncQueue,i,e.clientId,e.initialUser)}}class Jp{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>ty(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=OU.bind(null,this.syncEngine),await Ed(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new _U}createDatastore(e){const t=Ua(e.databaseInfo.databaseId),i=(s=e.databaseInfo,new tU(s));var s;return function(r,o,a,c){return new sU(r,o,a,c)}(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return t=this.localStore,i=this.datastore,s=e.asyncQueue,r=a=>ty(this.syncEngine,a,0),o=X_.V()?new X_:new JF,new oU(t,i,s,r,o);var t,i,s,r,o}createSyncEngine(e,t){return function(i,s,r,o,a,c,l){const u=new bU(i,s,r,o,a,c);return l&&(u.ac=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=S(e);I("RemoteStore","RemoteStore shutting down."),t.lu.add(5),await Pr(t),t.du.shutdown(),t._u.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iy(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eu{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Ic(this.observer.next,e)}error(e){this.observer.error?this.Ic(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}Tc(){this.muted=!0}Ic(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KU{constructor(e,t){this.Ec=e,this.wt=t,this.metadata=new Re,this.buffer=new Uint8Array,this.Ac=new TextDecoder("utf-8"),this.Rc().then(i=>{i&&i.Cu()?this.metadata.resolve(i.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(i==null?void 0:i.payload)}`))},i=>this.metadata.reject(i))}close(){return this.Ec.cancel()}async getMetadata(){return this.metadata.promise}async fc(){return await this.getMetadata(),this.Rc()}async Rc(){const e=await this.bc();if(e===null)return null;const t=this.Ac.decode(e),i=Number(t);isNaN(i)&&this.Pc(`length string (${t}) is not valid number`);const s=await this.vc(i);return new vU(JSON.parse(s),e.length+i)}Vc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async bc(){for(;this.Vc()<0&&!await this.Sc(););if(this.buffer.length===0)return null;const e=this.Vc();e<0&&this.Pc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async vc(e){for(;this.buffer.length<e;)await this.Sc()&&this.Pc("Reached the end of bundle when more is expected.");const t=this.Ac.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Pc(e){throw this.Ec.cancel(),new Error(`Invalid bundle format: ${e}`)}async Sc(){const e=await this.Ec.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GU{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new y(m.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(i,s){const r=S(i),o=Yo(r.wt)+"/documents",a={documents:s.map(h=>Qo(r.wt,h))},c=await r.ao("BatchGetDocuments",o,a,s.length),l=new Map;c.forEach(h=>{const d=z1(r.wt,h);l.set(d.key.toString(),d)});const u=[];return s.forEach(h=>{const d=l.get(h.toString());O(!!d),u.push(d)}),u}(this.datastore,e);return t.forEach(i=>this.recordVersion(i)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastWriteError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new Nr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,i)=>{const s=b.fromPath(i);this.mutations.push(new Sp(s,this.precondition(s)))}),await async function(t,i){const s=S(t),r=Yo(s.wt)+"/documents",o={writes:i.map(a=>Xo(s.wt,a))};await s.ro("Commit",r,o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw k();t=D.min()}const i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new y(m.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?oe.updateTime(t):oe.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(D.min()))throw new y(m.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return oe.updateTime(t)}return oe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WU{constructor(e,t,i,s,r){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=s,this.deferred=r,this.Dc=i.maxAttempts,this.So=new Fp(this.asyncQueue,"transaction_retry")}run(){this.Dc-=1,this.Cc()}Cc(){this.So.Io(async()=>{const e=new GU(this.datastore),t=this.xc(e);t&&t.then(i=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(i)}).catch(s=>{this.Nc(s)}))}).catch(i=>{this.Nc(i)})})}xc(e){try{const t=this.updateFunction(e);return!Da(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Nc(e){this.Dc>0&&this.kc(e)?(this.Dc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Cc(),Promise.resolve()))):this.deferred.reject(e)}kc(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||!xE(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HU{constructor(e,t,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=s,this.user=Ce.UNAUTHENTICATED,this.clientId=aE.I(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,async r=>{I("FirestoreClient","Received user=",r.uid),await this.authCredentialListener(r),this.user=r}),this.appCheckCredentials.start(i,r=>(I("FirestoreClient","Received new app check token=",r),this.appCheckCredentialListener(r,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Re;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=xr(t,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}async function Mb(n,e){n.asyncQueue.verifyOperationInProgress(),I("FirestoreClient","Initializing OfflineComponentProvider");const t=await n.getConfiguration();await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(async s=>{i.isEqual(s)||(await db(e.localStore,s),i=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}async function Lb(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Zp(n);I("FirestoreClient","Initializing OnlineComponentProvider");const i=await n.getConfiguration();await e.initialize(t,i),n.setCredentialChangeListener(s=>J_(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,r)=>J_(e.remoteStore,r)),n.onlineComponents=e}async function Zp(n){return n.offlineComponents||(I("FirestoreClient","Using default OfflineComponentProvider"),await Mb(n,new Ob)),n.offlineComponents}async function bu(n){return n.onlineComponents||(I("FirestoreClient","Using default OnlineComponentProvider"),await Lb(n,new Jp)),n.onlineComponents}function Fb(n){return Zp(n).then(e=>e.persistence)}function eg(n){return Zp(n).then(e=>e.localStore)}function Ub(n){return bu(n).then(e=>e.remoteStore)}function tg(n){return bu(n).then(e=>e.syncEngine)}async function gr(n){const e=await bu(n),t=e.eventManager;return t.onListen=SU.bind(null,e.syncEngine),t.onUnlisten=CU.bind(null,e.syncEngine),t}function zU(n){return n.asyncQueue.enqueue(async()=>{const e=await Fb(n),t=await Ub(n);return e.setNetworkEnabled(!0),function(i){const s=S(i);return s.lu.delete(0),Va(s)}(t)})}function QU(n){return n.asyncQueue.enqueue(async()=>{const e=await Fb(n),t=await Ub(n);return e.setNetworkEnabled(!1),async function(i){const s=S(i);s.lu.add(0),await Pr(s),s._u.set("Offline")}(t)})}function YU(n,e){const t=new Re;return n.asyncQueue.enqueueAndForget(async()=>async function(i,s,r){try{const o=await function(a,c){const l=S(a);return l.persistence.runTransaction("read document","readonly",u=>l.localDocuments.getDocument(u,c))}(i,s);o.isFoundDocument()?r.resolve(o):o.isNoDocument()?r.resolve(null):r.reject(new y(m.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(o){const a=xr(o,`Failed to get document '${s} from cache`);r.reject(a)}}(await eg(n),e,t)),t.promise}function Vb(n,e,t={}){const i=new Re;return n.asyncQueue.enqueueAndForget(async()=>function(s,r,o,a,c){const l=new Eu({next:h=>{r.enqueueAndForget(()=>jp(s,u));const d=h.docs.has(o);!d&&h.fromCache?c.reject(new y(m.UNAVAILABLE,"Failed to get document because the client is offline.")):d&&h.fromCache&&a&&a.source==="server"?c.reject(new y(m.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(h)},error:h=>c.reject(h)}),u=new Gp(Ar(o.path),l,{includeMetadataChanges:!0,Du:!0});return qp(s,u)}(await gr(n),n.asyncQueue,e,t,i)),i.promise}function XU(n,e){const t=new Re;return n.asyncQueue.enqueueAndForget(async()=>async function(i,s,r){try{const o=await ol(i,s,!0),a=new Rb(s,o.ji),c=a.Ku(o.documents),l=a.applyChanges(c,!1);r.resolve(l.snapshot)}catch(o){const a=xr(o,`Failed to execute query '${s} against cache`);r.reject(a)}}(await eg(n),e,t)),t.promise}function Bb(n,e,t={}){const i=new Re;return n.asyncQueue.enqueueAndForget(async()=>function(s,r,o,a,c){const l=new Eu({next:h=>{r.enqueueAndForget(()=>jp(s,u)),h.fromCache&&a.source==="server"?c.reject(new y(m.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(h)},error:h=>c.reject(h)}),u=new Gp(o,l,{includeMetadataChanges:!0,Du:!0});return qp(s,u)}(await gr(n),n.asyncQueue,e,t,i)),i.promise}function JU(n,e){const t=new Eu(e);return n.asyncQueue.enqueueAndForget(async()=>function(i,s){S(i).Tu.add(s),s.next()}(await gr(n),t)),()=>{t.Tc(),n.asyncQueue.enqueueAndForget(async()=>function(i,s){S(i).Tu.delete(s)}(await gr(n),t))}}function ZU(n,e,t){const i=new Re;return n.asyncQueue.enqueueAndForget(async()=>{const s=await function(r){return bu(r).then(o=>o.datastore)}(n);new WU(n.asyncQueue,s,t,e,i).run()}),i.promise}function eV(n,e,t,i){const s=function(r,o){let a;return a=typeof r=="string"?new TextEncoder().encode(r):r,function(c,l){return new KU(c,l)}(function(c,l){if(c instanceof Uint8Array)return iy(c,l);if(c instanceof ArrayBuffer)return iy(new Uint8Array(c),l);if(c instanceof ReadableStream)return c.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),o)}(t,Ua(e));n.asyncQueue.enqueueAndForget(async()=>{qU(await tg(n),s,i)})}function tV(n,e){return n.asyncQueue.enqueue(async()=>function(t,i){const s=S(t);return s.persistence.runTransaction("Get named query","readonly",r=>s.Ds.getNamedQuery(r,i))}(await eg(n),e))}const sy=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ng(n,e,t){if(!t)throw new y(m.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function $b(n,e,t,i){if(e===!0&&i===!0)throw new y(m.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ry(n){if(!b.isDocumentKey(n))throw new y(m.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function oy(n){if(b.isDocumentKey(n))throw new y(m.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Su(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":k()}function K(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new y(m.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Su(n);throw new y(m.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function qb(n,e){if(e<=0)throw new y(m.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay{constructor(e){var t;if(e.host===void 0){if(e.ssl!==void 0)throw new y(m.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new y(m.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,$b("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ba{constructor(e,t,i){this._authCredentials=t,this._appCheckCredentials=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ay({}),this._settingsFrozen=!1,e instanceof xn?this._databaseId=e:(this._app=e,this._databaseId=function(s){if(!Object.prototype.hasOwnProperty.apply(s.options,["projectId"]))throw new y(m.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new xn(s.options.projectId)}(e))}get app(){if(!this._app)throw new y(m.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ay(e),e.credentials!==void 0&&(this._authCredentials=function(t){if(!t)return new t1;switch(t.type){case"gapi":const i=t.client;return O(!(typeof i!="object"||i===null||!i.auth||!i.auth.getAuthHeaderValueForFirstParty)),new r1(i,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new y(m.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=sy.get(e);t&&(I("ComponentProvider","Removing Datastore"),sy.delete(e),t.terminate())}(this),Promise.resolve()}}function nV(n,e,t,i={}){var s;const r=(n=K(n,Ba))._getSettings();if(r.host!=="firestore.googleapis.com"&&r.host!==e&&qo("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},r),{host:`${e}:${t}`,ssl:!1})),i.mockUserToken){let o,a;if(typeof i.mockUserToken=="string")o=i.mockUserToken,a=Ce.MOCK_USER;else{o=Ld(i.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new y(m.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new Ce(c)}n._authCredentials=new n1(new oE(o,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class te{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new un(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new te(this.firestore,e,this._key)}}class nt{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new nt(this.firestore,e,this._query)}}class un extends nt{constructor(e,t,i){super(e,t,Ar(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new te(this.firestore,null,new b(e))}withConverter(e){return new un(this.firestore,e,this._path)}}function jb(n,e,...t){if(n=w(n),ng("collection","path",e),n instanceof Ba){const i=j.fromString(e,...t);return oy(i),new un(n,null,i)}{if(!(n instanceof te||n instanceof un))throw new y(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(j.fromString(e,...t));return oy(i),new un(n.firestore,null,i)}}function iV(n,e){if(n=K(n,Ba),ng("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new y(m.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new nt(n,null,function(t){return new Un(j.emptyPath(),t)}(e))}function ul(n,e,...t){if(n=w(n),arguments.length===1&&(e=aE.I()),ng("doc","path",e),n instanceof Ba){const i=j.fromString(e,...t);return ry(i),new te(n,null,new b(i))}{if(!(n instanceof te||n instanceof un))throw new y(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(j.fromString(e,...t));return ry(i),new te(n.firestore,n instanceof un?n.converter:null,new b(i))}}function Kb(n,e){return n=w(n),e=w(e),(n instanceof te||n instanceof un)&&(e instanceof te||e instanceof un)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Gb(n,e){return n=w(n),e=w(e),n instanceof nt&&e instanceof nt&&n.firestore===e.firestore&&xa(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sV{constructor(){this.Oc=Promise.resolve(),this.Mc=[],this.Fc=!1,this.$c=[],this.Bc=null,this.Lc=!1,this.Uc=!1,this.qc=[],this.So=new Fp(this,"async_queue_retry"),this.Kc=()=>{const t=yc();t&&I("AsyncQueue","Visibility state changed to "+t.visibilityState),this.So.Eo()};const e=yc();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Kc)}get isShuttingDown(){return this.Fc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Gc(),this.Qc(e)}enterRestrictedMode(e){if(!this.Fc){this.Fc=!0,this.Uc=e||!1;const t=yc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Kc)}}enqueue(e){if(this.Gc(),this.Fc)return new Promise(()=>{});const t=new Re;return this.Qc(()=>this.Fc&&this.Uc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Mc.push(e),this.jc()))}async jc(){if(this.Mc.length!==0){try{await this.Mc[0](),this.Mc.shift(),this.So.reset()}catch(e){if(!Ii(e))throw e;I("AsyncQueue","Operation failed with retryable error: "+e)}this.Mc.length>0&&this.So.Io(()=>this.jc())}}Qc(e){const t=this.Oc.then(()=>(this.Lc=!0,e().catch(i=>{this.Bc=i,this.Lc=!1;const s=function(r){let o=r.message||"";return r.stack&&(o=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),o}(i);throw me("INTERNAL UNHANDLED ERROR: ",s),i}).then(i=>(this.Lc=!1,i))));return this.Oc=t,t}enqueueAfterDelay(e,t,i){this.Gc(),this.qc.indexOf(e)>-1&&(t=0);const s=$p.createAndSchedule(this,e,t,i,r=>this.Wc(r));return this.$c.push(s),s}Gc(){this.Bc&&k()}verifyOperationInProgress(){}async zc(){let e;do e=this.Oc,await e;while(e!==this.Oc)}Hc(e){for(const t of this.$c)if(t.timerId===e)return!0;return!1}Jc(e){return this.zc().then(()=>{this.$c.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.$c)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.zc()})}Yc(e){this.qc.push(e)}Wc(e){const t=this.$c.indexOf(e);this.$c.splice(t,1)}}function Sd(n){return function(e,t){if(typeof e!="object"||e===null)return!1;const i=e;for(const s of t)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}class rV{constructor(){this._progressObserver={},this._taskCompletionResolver=new Re,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,i){this._progressObserver={next:e,error:t,complete:i}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oV=-1;class le extends Ba{constructor(e,t,i){super(e,t,i),this.type="firestore",this._queue=new sV,this._persistenceKey="name"in e?e.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Wb(this),this._firestoreClient.terminate()}}function Ve(n){return n._firestoreClient||Wb(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function Wb(n){var e;const t=n._freezeSettings(),i=function(s,r,o,a){return new _1(s,r,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,t);n._firestoreClient=new HU(n._authCredentials,n._appCheckCredentials,n._queue,i)}function aV(n,e){zb(n=K(n,le));const t=Ve(n),i=n._freezeSettings(),s=new Jp;return Hb(t,s,new xb(s,i.cacheSizeBytes,e==null?void 0:e.forceOwnership))}function cV(n){zb(n=K(n,le));const e=Ve(n),t=n._freezeSettings(),i=new Jp;return Hb(e,i,new jU(i,t.cacheSizeBytes))}function Hb(n,e,t){const i=new Re;return n.asyncQueue.enqueue(async()=>{try{await Mb(n,t),await Lb(n,e),i.resolve()}catch(s){const r=s;if(!function(o){return o.name==="FirebaseError"?o.code===m.FAILED_PRECONDITION||o.code===m.UNIMPLEMENTED:typeof DOMException!="undefined"&&o instanceof DOMException?o.code===22||o.code===20||o.code===11:!0}(r))throw r;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r)}}).then(()=>i.promise)}function lV(n){if(n._initialized&&!n._terminated)throw new y(m.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Re;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(t){if(!Gt.V())return Promise.resolve();const i=t+"main";await Gt.delete(i)}(xp(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function uV(n){return function(e){const t=new Re;return e.asyncQueue.enqueueAndForget(async()=>PU(await tg(e),t)),t.promise}(Ve(n=K(n,le)))}function hV(n){return zU(Ve(n=K(n,le)))}function dV(n){return QU(Ve(n=K(n,le)))}function fV(n,e){const t=Ve(n=K(n,le)),i=new rV;return eV(t,n._databaseId,e,i),i}function pV(n,e){return tV(Ve(n=K(n,le)),e).then(t=>t?new nt(n,null,t.query):null)}function zb(n){if(n._initialized||n._terminated)throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class di{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new y(m.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new de(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new yn(ve.fromBase64String(e))}catch(t){throw new y(m.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new yn(ve.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cs{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new y(m.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new y(m.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return F(this._lat,e._lat)||F(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gV=/^__.*__$/;class mV{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Vn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Rr(e,this.data,t,this.fieldTransforms)}}class Qb{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Vn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Yb(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw k()}}class ku{constructor(e,t,i,s,r,o){this.settings=e,this.databaseId=t,this.wt=i,this.ignoreUndefinedProperties=s,r===void 0&&this.Xc(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Zc(){return this.settings.Zc}ta(e){return new ku(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.wt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ea(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.ta({path:i,na:!1});return s.sa(e),s}ia(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.ta({path:i,na:!1});return s.Xc(),s}ra(e){return this.ta({path:void 0,na:!0})}oa(e){return hl(e,this.settings.methodName,this.settings.ua||!1,this.path,this.settings.ca)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Xc(){if(this.path)for(let e=0;e<this.path.length;e++)this.sa(this.path.get(e))}sa(e){if(e.length===0)throw this.oa("Document fields must not be empty");if(Yb(this.Zc)&&gV.test(e))throw this.oa('Document fields cannot begin and end with "__"')}}class _V{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.wt=i||Ua(e)}aa(e,t,i,s=!1){return new ku({Zc:e,methodName:t,ca:i,path:de.emptyPath(),na:!1,ua:s},this.databaseId,this.wt,this.ignoreUndefinedProperties)}}function ks(n){const e=n._freezeSettings(),t=Ua(n._databaseId);return new _V(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Au(n,e,t,i,s,r={}){const o=n.aa(r.merge||r.mergeFields?2:0,e,t,s);og("Data must be an object, but it was:",o,i);const a=Zb(i,o);let c,l;if(r.merge)c=new kt(o.fieldMask),l=o.fieldTransforms;else if(r.mergeFields){const u=[];for(const h of r.mergeFields){const d=Cd(e,h,t);if(!o.contains(d))throw new y(m.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);tS(u,d)||u.push(d)}c=new kt(u),l=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,l=o.fieldTransforms;return new mV(new qe(a),c,l)}class $a extends Cs{_toFieldTransform(e){if(e.Zc!==2)throw e.Zc===1?e.oa(`${this._methodName}() can only appear at the top level of your update data`):e.oa(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof $a}}function Xb(n,e,t){return new ku({Zc:3,ca:e.settings.ca,methodName:n._methodName,na:t},e.databaseId,e.wt,e.ignoreUndefinedProperties)}class ig extends Cs{_toFieldTransform(e){return new Ma(e.path,new lr)}isEqual(e){return e instanceof ig}}class yV extends Cs{constructor(e,t){super(e),this.ha=t}_toFieldTransform(e){const t=Xb(this,e,!0),i=this.ha.map(r=>As(r,t)),s=new us(i);return new Ma(e.path,s)}isEqual(e){return this===e}}class wV extends Cs{constructor(e,t){super(e),this.ha=t}_toFieldTransform(e){const t=Xb(this,e,!0),i=this.ha.map(r=>As(r,t)),s=new hs(i);return new Ma(e.path,s)}isEqual(e){return this===e}}class vV extends Cs{constructor(e,t){super(e),this.la=t}_toFieldTransform(e){const t=new ur(e.wt,kE(e.wt,this.la));return new Ma(e.path,t)}isEqual(e){return this===e}}function sg(n,e,t,i){const s=n.aa(1,e,t);og("Data must be an object, but it was:",s,i);const r=[],o=qe.empty();Ss(i,(c,l)=>{const u=ag(e,c,t);l=w(l);const h=s.ia(u);if(l instanceof $a)r.push(u);else{const d=As(l,h);d!=null&&(r.push(u),o.set(u,d))}});const a=new kt(r);return new Qb(o,a,s.fieldTransforms)}function rg(n,e,t,i,s,r){const o=n.aa(1,e,t),a=[Cd(e,i,t)],c=[s];if(r.length%2!=0)throw new y(m.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<r.length;d+=2)a.push(Cd(e,r[d])),c.push(r[d+1]);const l=[],u=qe.empty();for(let d=a.length-1;d>=0;--d)if(!tS(l,a[d])){const f=a[d];let p=c[d];p=w(p);const _=o.ia(f);if(p instanceof $a)l.push(f);else{const v=As(p,_);v!=null&&(l.push(f),u.set(f,v))}}const h=new kt(l);return new Qb(u,h,o.fieldTransforms)}function Jb(n,e,t,i=!1){return As(t,n.aa(i?4:3,e))}function As(n,e){if(eS(n=w(n)))return og("Unsupported field value:",e,n),Zb(n,e);if(n instanceof Cs)return function(t,i){if(!Yb(i.Zc))throw i.oa(`${t._methodName}() can only be used with update() and set()`);if(!i.path)throw i.oa(`${t._methodName}() is not currently supported inside arrays`);const s=t._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.na&&e.Zc!==4)throw e.oa("Nested arrays are not supported");return function(t,i){const s=[];let r=0;for(const o of t){let a=As(o,i.ra(r));a==null&&(a={nullValue:"NULL_VALUE"}),s.push(a),r++}return{arrayValue:{values:s}}}(n,e)}return function(t,i){if((t=w(t))===null)return{nullValue:"NULL_VALUE"};if(typeof t=="number")return kE(i.wt,t);if(typeof t=="boolean")return{booleanValue:t};if(typeof t=="string")return{stringValue:t};if(t instanceof Date){const s=se.fromDate(t);return{timestampValue:zo(i.wt,s)}}if(t instanceof se){const s=new se(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:zo(i.wt,s)}}if(t instanceof Cu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof yn)return{bytesValue:$E(i.wt,t._byteString)};if(t instanceof te){const s=i.databaseId,r=t.firestore._databaseId;if(!r.isEqual(s))throw i.oa(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Cp(t.firestore._databaseId||i.databaseId,t._key.path)}}throw i.oa(`Unsupported field value: ${Su(t)}`)}(n,e)}function Zb(n,e){const t={};return pE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ss(n,(i,s)=>{const r=As(s,e.ea(i));r!=null&&(t[i]=r)}),{mapValue:{fields:t}}}function eS(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof se||n instanceof Cu||n instanceof yn||n instanceof te||n instanceof Cs)}function og(n,e,t){if(!eS(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const i=Su(t);throw i==="an object"?e.oa(n+" a custom object"):e.oa(n+" "+i)}}function Cd(n,e,t){if((e=w(e))instanceof di)return e._internalPath;if(typeof e=="string")return ag(n,e);throw hl("Field path arguments must be of type string or ",n,!1,void 0,t)}const IV=new RegExp("[~\\*/\\[\\]]");function ag(n,e,t){if(e.search(IV)>=0)throw hl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new di(...e.split("."))._internalPath}catch{throw hl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function hl(n,e,t,i,s){const r=i&&!i.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${i}`),o&&(c+=` in document ${s}`),c+=")"),new y(m.INVALID_ARGUMENT,a+n+c)}function tS(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zo{constructor(e,t,i,s,r){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new te(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new TV(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ru("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class TV extends Zo{data(){return super.data()}}function Ru(n,e){return typeof e=="string"?ag(n,e):e instanceof di?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $i{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Mn extends Zo{constructor(e,t,i,s,r,o){super(e,t,i,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new _o(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(Ru("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class _o extends Mn{data(e={}){return super.data(e)}}class fi{constructor(e,t,i,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new $i(s.hasPendingWrites,s.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new _o(this._firestore,this._userDataWriter,i.key,i,new $i(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new y(m.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let r=0;return i._snapshot.docChanges.map(o=>({type:"added",doc:new _o(i._firestore,i._userDataWriter,o.doc.key,o.doc,new $i(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:r++}))}{let r=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(o=>s||o.type!==3).map(o=>{const a=new _o(i._firestore,i._userDataWriter,o.doc.key,o.doc,new $i(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,l=-1;return o.type!==0&&(c=r.indexOf(o.doc.key),r=r.delete(o.doc.key)),o.type!==1&&(r=r.add(o.doc),l=r.indexOf(o.doc.key)),{type:EV(o.type),doc:a,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function EV(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return k()}}function nS(n,e){return n instanceof Mn&&e instanceof Mn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof fi&&e instanceof fi&&n._firestore===e._firestore&&Gb(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iS(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new y(m.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class qa{}function Kn(n,...e){for(const t of e)n=t._apply(n);return n}class bV extends qa{constructor(e,t,i){super(),this.fa=e,this.da=t,this._a=i,this.type="where"}_apply(e){const t=ks(e.firestore),i=function(s,r,o,a,c,l,u){let h;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new y(m.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){ly(u,l);const f=[];for(const p of u)f.push(cy(a,s,p));h={arrayValue:{values:f}}}else h=cy(a,s,u)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||ly(u,l),h=Jb(o,r,u,l==="in"||l==="not-in");const d=je.create(c,l,h);return function(f,p){if(p.ht()){const v=Tp(f);if(v!==null&&!v.isEqual(p.field))throw new y(m.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${v.toString()}' and '${p.field.toString()}'`);const R=Ip(f);R!==null&&cS(f,p.field,R)}const _=function(v,R){for(const x of v.filters)if(R.indexOf(x.op)>=0)return x.op;return null}(f,function(v){switch(v){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(p.op));if(_!==null)throw _===p.op?new y(m.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${p.op.toString()}' filter.`):new y(m.INVALID_ARGUMENT,`Invalid query. You cannot use '${p.op.toString()}' filters with '${_.toString()}' filters.`)}(s,d),d}(e._query,"where",t,e.firestore._databaseId,this.fa,this.da,this._a);return new nt(e.firestore,e.converter,function(s,r){const o=s.filters.concat([r]);return new Un(s.path,s.collectionGroup,s.explicitOrderBy.slice(),o,s.limit,s.limitType,s.startAt,s.endAt)}(e._query,i))}}function SV(n,e,t){const i=e,s=Ru("where",n);return new bV(s,i,t)}class CV extends qa{constructor(e,t){super(),this.fa=e,this.wa=t,this.type="orderBy"}_apply(e){const t=function(i,s,r){if(i.startAt!==null)throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new Hs(s,r);return function(a,c){if(Ip(a)===null){const l=Tp(a);l!==null&&cS(a,l,c.field)}}(i,o),o}(e._query,this.fa,this.wa);return new nt(e.firestore,e.converter,function(i,s){const r=i.explicitOrderBy.concat([s]);return new Un(i.path,i.collectionGroup,r,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function kV(n,e="asc"){const t=e,i=Ru("orderBy",n);return new CV(i,t)}class sS extends qa{constructor(e,t,i){super(),this.type=e,this.ma=t,this.ga=i}_apply(e){return new nt(e.firestore,e.converter,IE(e._query,this.ma,this.ga))}}function AV(n){return qb("limit",n),new sS("limit",n,"F")}function RV(n){return qb("limitToLast",n),new sS("limitToLast",n,"L")}class rS extends qa{constructor(e,t,i){super(),this.type=e,this.ya=t,this.pa=i}_apply(e){const t=aS(e,this.type,this.ya,this.pa);return new nt(e.firestore,e.converter,function(i,s){return new Un(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}}function NV(...n){return new rS("startAt",n,!0)}function PV(...n){return new rS("startAfter",n,!1)}class oS extends qa{constructor(e,t,i){super(),this.type=e,this.ya=t,this.pa=i}_apply(e){const t=aS(e,this.type,this.ya,this.pa);return new nt(e.firestore,e.converter,function(i,s){return new Un(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}}function DV(...n){return new oS("endBefore",n,!1)}function OV(...n){return new oS("endAt",n,!0)}function aS(n,e,t,i){if(t[0]=w(t[0]),t[0]instanceof Zo)return function(s,r,o,a,c){if(!a)throw new y(m.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const l=[];for(const u of cr(s))if(u.field.isKeyField())l.push(cs(r,a.key));else{const h=a.data.field(u.field);if(vp(h))throw new y(m.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(h===null){const d=u.field.canonicalString();throw new y(m.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${d}' (used as the orderBy) does not exist.`)}l.push(h)}return new ui(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,i);{const s=ks(n.firestore);return function(r,o,a,c,l,u){const h=r.explicitOrderBy;if(l.length>h.length)throw new y(m.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const d=[];for(let f=0;f<l.length;f++){const p=l[f];if(h[f].field.isKeyField()){if(typeof p!="string")throw new y(m.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof p}`);if(!Ep(r)&&p.indexOf("/")!==-1)throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${p}' contains a slash.`);const _=r.path.child(j.fromString(p));if(!b.isDocumentKey(_))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${_}' is not because it contains an odd number of segments.`);const v=new b(_);d.push(cs(o,v))}else{const _=Jb(a,c,p);d.push(_)}}return new ui(d,u)}(n._query,n.firestore._databaseId,s,e,t,i)}}function cy(n,e,t){if(typeof(t=w(t))=="string"){if(t==="")throw new y(m.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ep(e)&&t.indexOf("/")!==-1)throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(j.fromString(t));if(!b.isDocumentKey(i))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return cs(n,new b(i))}if(t instanceof te)return cs(n,t._key);throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Su(t)}.`)}function ly(n,e){if(!Array.isArray(n)||n.length===0)throw new y(m.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new y(m.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function cS(n,e,t){if(!t.isEqual(e))throw new y(m.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xV={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cg{convertValue(e,t="none"){switch(as(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ae(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(os(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw k()}}convertObject(e,t){const i={};return Ss(e.fields,(s,r)=>{i[s]=this.convertValue(r,t)}),i}convertGeoPoint(e){return new Cu(ae(e.latitude),ae(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=gE(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(Ko(e));default:return null}}convertTimestamp(e){const t=ci(e);return new se(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=j.fromString(e);O(YE(i));const s=new xn(i.get(1),i.get(3)),r=new b(i.popFirst(5));return s.isEqual(t)||me(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nu(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class MV extends cg{constructor(e){super(),this.firestore=e}convertBytes(e){return new yn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new te(this.firestore,null,t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LV{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=ks(e)}set(e,t,i){this._verifyNotCommitted();const s=Wn(e,this._firestore),r=Nu(s.converter,t,i),o=Au(this._dataReader,"WriteBatch.set",s._key,r,s.converter!==null,i);return this._mutations.push(o.toMutation(s._key,oe.none())),this}update(e,t,i,...s){this._verifyNotCommitted();const r=Wn(e,this._firestore);let o;return o=typeof(t=w(t))=="string"||t instanceof di?rg(this._dataReader,"WriteBatch.update",r._key,t,i,s):sg(this._dataReader,"WriteBatch.update",r._key,t),this._mutations.push(o.toMutation(r._key,oe.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Wn(e,this._firestore);return this._mutations=this._mutations.concat(new Nr(t._key,oe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(m.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Wn(n,e){if((n=w(n)).firestore!==e)throw new y(m.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FV(n){n=K(n,te);const e=K(n.firestore,le);return Vb(Ve(e),n._key).then(t=>lg(e,n,t))}class Rs extends cg{constructor(e){super(),this.firestore=e}convertBytes(e){return new yn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new te(this.firestore,null,t)}}function UV(n){n=K(n,te);const e=K(n.firestore,le),t=Ve(e),i=new Rs(e);return YU(t,n._key).then(s=>new Mn(e,i,n._key,s,new $i(s!==null&&s.hasLocalMutations,!0),n.converter))}function VV(n){n=K(n,te);const e=K(n.firestore,le);return Vb(Ve(e),n._key,{source:"server"}).then(t=>lg(e,n,t))}function BV(n){n=K(n,nt);const e=K(n.firestore,le),t=Ve(e),i=new Rs(e);return iS(n._query),Bb(t,n._query).then(s=>new fi(e,i,n,s))}function $V(n){n=K(n,nt);const e=K(n.firestore,le),t=Ve(e),i=new Rs(e);return XU(t,n._query).then(s=>new fi(e,i,n,s))}function qV(n){n=K(n,nt);const e=K(n.firestore,le),t=Ve(e),i=new Rs(e);return Bb(t,n._query,{source:"server"}).then(s=>new fi(e,i,n,s))}function uy(n,e,t){n=K(n,te);const i=K(n.firestore,le),s=Nu(n.converter,e,t);return ja(i,[Au(ks(i),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,oe.none())])}function hy(n,e,t,...i){n=K(n,te);const s=K(n.firestore,le),r=ks(s);let o;return o=typeof(e=w(e))=="string"||e instanceof di?rg(r,"updateDoc",n._key,e,t,i):sg(r,"updateDoc",n._key,e),ja(s,[o.toMutation(n._key,oe.exists(!0))])}function jV(n){return ja(K(n.firestore,le),[new Nr(n._key,oe.none())])}function KV(n,e){const t=K(n.firestore,le),i=ul(n),s=Nu(n.converter,e);return ja(t,[Au(ks(n.firestore),"addDoc",i._key,s,n.converter!==null,{}).toMutation(i._key,oe.exists(!1))]).then(()=>i)}function lS(n,...e){var t,i,s;n=w(n);let r={includeMetadataChanges:!1},o=0;typeof e[o]!="object"||Sd(e[o])||(r=e[o],o++);const a={includeMetadataChanges:r.includeMetadataChanges};if(Sd(e[o])){const h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(i=h.error)===null||i===void 0?void 0:i.bind(h),e[o+2]=(s=h.complete)===null||s===void 0?void 0:s.bind(h)}let c,l,u;if(n instanceof te)l=K(n.firestore,le),u=Ar(n._key.path),c={next:h=>{e[o]&&e[o](lg(l,n,h))},error:e[o+1],complete:e[o+2]};else{const h=K(n,nt);l=K(h.firestore,le),u=h._query;const d=new Rs(l);c={next:f=>{e[o]&&e[o](new fi(l,d,h,f))},error:e[o+1],complete:e[o+2]},iS(n._query)}return function(h,d,f,p){const _=new Eu(p),v=new Gp(d,_,f);return h.asyncQueue.enqueueAndForget(async()=>qp(await gr(h),v)),()=>{_.Tc(),h.asyncQueue.enqueueAndForget(async()=>jp(await gr(h),v))}}(Ve(l),u,a,c)}function GV(n,e){return JU(Ve(n=K(n,le)),Sd(e)?e:{next:e})}function ja(n,e){return function(t,i){const s=new Re;return t.asyncQueue.enqueueAndForget(async()=>kU(await tg(t),i,s)),s.promise}(Ve(n),e)}function lg(n,e,t){const i=t.docs.get(e._key),s=new Rs(n);return new Mn(n,s,e._key,i,new $i(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WV extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=ks(e)}get(e){const t=Wn(e,this._firestore),i=new MV(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||s.length!==1)return k();const r=s[0];if(r.isFoundDocument())return new Zo(this._firestore,i,r.key,r,t.converter);if(r.isNoDocument())return new Zo(this._firestore,i,t._key,null,t.converter);throw k()})}set(e,t,i){const s=Wn(e,this._firestore),r=Nu(s.converter,t,i),o=Au(this._dataReader,"Transaction.set",s._key,r,s.converter!==null,i);return this._transaction.set(s._key,o),this}update(e,t,i,...s){const r=Wn(e,this._firestore);let o;return o=typeof(t=w(t))=="string"||t instanceof di?rg(this._dataReader,"Transaction.update",r._key,t,i,s):sg(this._dataReader,"Transaction.update",r._key,t),this._transaction.update(r._key,o),this}delete(e){const t=Wn(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Wn(e,this._firestore),i=new Rs(this._firestore);return super.get(e).then(s=>new Mn(this._firestore,i,t._key,s._document,new $i(!1,!1),t.converter))}}function HV(n,e,t){n=K(n,le);const i=Object.assign(Object.assign({},xV),t);return function(s){if(s.maxAttempts<1)throw new y(m.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),ZU(Ve(n),s=>e(new WV(n,s)),i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zV(){return new $a("deleteField")}function QV(){return new ig("serverTimestamp")}function YV(...n){return new yV("arrayUnion",n)}function XV(...n){return new wV("arrayRemove",n)}function JV(n){return new vV("increment",n)}(function(n,e=!0){(function(t){kr=t})(gi),Qe(new Y("firestore",(t,{options:i})=>{const s=t.getProvider("app").getImmediate(),r=new le(s,new i1(t.getProvider("auth-internal")),new a1(t.getProvider("app-check-internal")));return i=Object.assign({useFetchStreams:e},i),r._setSettings(i),r},"PUBLIC")),fe(l_,"3.4.12",n),fe(l_,"3.4.12","esm2017")})();const ZV="@firebase/firestore-compat",eB="0.1.21";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ug(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dy(){if(typeof Uint8Array=="undefined")throw new y("unimplemented","Uint8Arrays are not available in this environment.")}function fy(){if(!g1())throw new y("unimplemented","Blobs are unavailable in Firestore in this environment.")}class ea{constructor(e){this._delegate=e}static fromBase64String(e){return fy(),new ea(yn.fromBase64String(e))}static fromUint8Array(e){return dy(),new ea(yn.fromUint8Array(e))}toBase64(){return fy(),this._delegate.toBase64()}toUint8Array(){return dy(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kd(n){return tB(n,["next","error","complete"])}function tB(n,e){if(typeof n!="object"||n===null)return!1;const t=n;for(const i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nB{enableIndexedDbPersistence(e,t){return aV(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return cV(e._delegate)}clearIndexedDbPersistence(e){return lV(e._delegate)}}class uS{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof xn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&qo("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,i={}){nV(this._delegate,e,t,i)}enableNetwork(){return hV(this._delegate)}disableNetwork(){return dV(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,$b("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return uV(this._delegate)}onSnapshotsInSync(e){return GV(this._delegate,e)}get app(){if(!this._appCompat)throw new y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new mr(this,jb(this._delegate,e))}catch(t){throw rt(t,"collection()","Firestore.collection()")}}doc(e){try{return new xt(this,ul(this._delegate,e))}catch(t){throw rt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new st(this,iV(this._delegate,e))}catch(t){throw rt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return HV(this._delegate,t=>e(new hS(this,t)))}batch(){return Ve(this._delegate),new dS(new LV(this._delegate,e=>ja(this._delegate,e)))}loadBundle(e){return fV(this._delegate,e)}namedQuery(e){return pV(this._delegate,e).then(t=>t?new st(this,t):null)}}class Pu extends cg{constructor(e){super(),this.firestore=e}convertBytes(e){return new ea(new yn(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return xt.forKey(t,this.firestore,null)}}function iB(n){ZL(n)}class hS{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Pu(e)}get(e){const t=qi(e);return this._delegate.get(t).then(i=>new ta(this._firestore,new Mn(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){const s=qi(e);return i?(ug("Transaction.set",i),this._delegate.set(s,t,i)):this._delegate.set(s,t),this}update(e,t,i,...s){const r=qi(e);return arguments.length===2?this._delegate.update(r,t):this._delegate.update(r,t,i,...s),this}delete(e){const t=qi(e);return this._delegate.delete(t),this}}class dS{constructor(e){this._delegate=e}set(e,t,i){const s=qi(e);return i?(ug("WriteBatch.set",i),this._delegate.set(s,t,i)):this._delegate.set(s,t),this}update(e,t,i,...s){const r=qi(e);return arguments.length===2?this._delegate.update(r,t):this._delegate.update(r,t,i,...s),this}delete(e){const t=qi(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class gs{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){const i=new _o(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new na(this._firestore,i),t!=null?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const i=gs.INSTANCES;let s=i.get(e);s||(s=new WeakMap,i.set(e,s));let r=s.get(t);return r||(r=new gs(e,new Pu(e),t),s.set(t,r)),r}}gs.INSTANCES=new WeakMap;class xt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Pu(e)}static forPath(e,t,i){if(e.length%2!==0)throw new y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new xt(t,new te(t._delegate,i,new b(e)))}static forKey(e,t,i){return new xt(t,new te(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new mr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new mr(this.firestore,jb(this._delegate,e))}catch(t){throw rt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=w(e),e instanceof te?Kb(this._delegate,e):!1}set(e,t){t=ug("DocumentReference.set",t);try{return t?uy(this._delegate,e,t):uy(this._delegate,e)}catch(i){throw rt(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return arguments.length===1?hy(this._delegate,e):hy(this._delegate,e,t,...i)}catch(s){throw rt(s,"updateDoc()","DocumentReference.update()")}}delete(){return jV(this._delegate)}onSnapshot(...e){const t=fS(e),i=pS(e,s=>new ta(this.firestore,new Mn(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return lS(this._delegate,t,i)}get(e){let t;return(e==null?void 0:e.source)==="cache"?t=UV(this._delegate):(e==null?void 0:e.source)==="server"?t=VV(this._delegate):t=FV(this._delegate),t.then(i=>new ta(this.firestore,new Mn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new xt(this.firestore,e?this._delegate.withConverter(gs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function rt(n,e,t){return n.message=n.message.replace(e,t),n}function fS(n){for(const e of n)if(typeof e=="object"&&!kd(e))return e;return{}}function pS(n,e){var t,i;let s;return kd(n[0])?s=n[0]:kd(n[1])?s=n[1]:typeof n[0]=="function"?s={next:n[0],error:n[1],complete:n[2]}:s={next:n[1],error:n[2],complete:n[3]},{next:r=>{s.next&&s.next(e(r))},error:(t=s.error)===null||t===void 0?void 0:t.bind(s),complete:(i=s.complete)===null||i===void 0?void 0:i.bind(s)}}class ta{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new xt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return nS(this._delegate,e._delegate)}}class na extends ta{data(e){const t=this._delegate.data(e);return e1(t!==void 0),t}}class st{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Pu(e)}where(e,t,i){try{return new st(this.firestore,Kn(this._delegate,SV(e,t,i)))}catch(s){throw rt(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new st(this.firestore,Kn(this._delegate,kV(e,t)))}catch(i){throw rt(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new st(this.firestore,Kn(this._delegate,AV(e)))}catch(t){throw rt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new st(this.firestore,Kn(this._delegate,RV(e)))}catch(t){throw rt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new st(this.firestore,Kn(this._delegate,NV(...e)))}catch(t){throw rt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new st(this.firestore,Kn(this._delegate,PV(...e)))}catch(t){throw rt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new st(this.firestore,Kn(this._delegate,DV(...e)))}catch(t){throw rt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new st(this.firestore,Kn(this._delegate,OV(...e)))}catch(t){throw rt(t,"endAt()","Query.endAt()")}}isEqual(e){return Gb(this._delegate,e._delegate)}get(e){let t;return(e==null?void 0:e.source)==="cache"?t=$V(this._delegate):(e==null?void 0:e.source)==="server"?t=qV(this._delegate):t=BV(this._delegate),t.then(i=>new Ad(this.firestore,new fi(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){const t=fS(e),i=pS(e,s=>new Ad(this.firestore,new fi(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return lS(this._delegate,t,i)}withConverter(e){return new st(this.firestore,e?this._delegate.withConverter(gs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class sB{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new na(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Ad{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new st(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new na(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new sB(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new na(this._firestore,i))})}isEqual(e){return nS(this._delegate,e._delegate)}}class mr extends st{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new xt(this.firestore,e):null}doc(e){try{return e===void 0?new xt(this.firestore,ul(this._delegate)):new xt(this.firestore,ul(this._delegate,e))}catch(t){throw rt(t,"doc()","CollectionReference.doc()")}}add(e){return KV(this._delegate,e).then(t=>new xt(this.firestore,t))}isEqual(e){return Kb(this._delegate,e._delegate)}withConverter(e){return new mr(this.firestore,e?this._delegate.withConverter(gs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function qi(n){return K(n,te)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hg{constructor(...e){this._delegate=new di(...e)}static documentId(){return new hg(de.keyField().canonicalString())}isEqual(e){return e=w(e),e instanceof di?this._delegate._internalPath.isEqual(e._internalPath):!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mi{constructor(e){this._delegate=e}static serverTimestamp(){const e=QV();return e._methodName="FieldValue.serverTimestamp",new Mi(e)}static delete(){const e=zV();return e._methodName="FieldValue.delete",new Mi(e)}static arrayUnion(...e){const t=YV(...e);return t._methodName="FieldValue.arrayUnion",new Mi(t)}static arrayRemove(...e){const t=XV(...e);return t._methodName="FieldValue.arrayRemove",new Mi(t)}static increment(e){const t=JV(e);return t._methodName="FieldValue.increment",new Mi(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rB={Firestore:uS,GeoPoint:Cu,Timestamp:se,Blob:ea,Transaction:hS,WriteBatch:dS,DocumentReference:xt,DocumentSnapshot:ta,Query:st,QueryDocumentSnapshot:na,QuerySnapshot:Ad,CollectionReference:mr,FieldPath:hg,FieldValue:Mi,setLogLevel:iB,CACHE_SIZE_UNLIMITED:oV};function oB(n,e){n.INTERNAL.registerComponent(new Y("firestore-compat",t=>{const i=t.getProvider("app-compat").getImmediate(),s=t.getProvider("firestore").getImmediate();return e(i,s)},"PUBLIC").setServiceProps(Object.assign({},rB)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aB(n){oB(n,(e,t)=>new uS(e,t,new nB)),n.registerVersion(ZV,eB)}aB(Le);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cB="type.googleapis.com/google.protobuf.Int64Value",lB="type.googleapis.com/google.protobuf.UInt64Value";function gS(n,e){const t={};for(const i in n)n.hasOwnProperty(i)&&(t[i]=e(n[i]));return t}function Rd(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>Rd(e));if(typeof n=="function"||typeof n=="object")return gS(n,e=>Rd(e));throw new Error("Data cannot be encoded in JSON: "+n)}function dl(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case cB:case lB:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>dl(e)):typeof n=="function"||typeof n=="object"?gS(n,e=>dl(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mS="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const py={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Qs extends Ke{constructor(e,t,i){super(`${mS}/${e}`,t||""),this.details=i}}function uB(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function hB(n,e){let t=uB(n),i=t,s;try{const r=e&&e.error;if(r){const o=r.status;if(typeof o=="string"){if(!py[o])return new Qs("internal","internal");t=py[o],i=o}const a=r.message;typeof a=="string"&&(i=a),s=r.details,s!==void 0&&(s=dl(s))}}catch{}return t==="ok"?null:new Qs(t,i,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dB{constructor(e,t,i){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(s=>this.auth=s,()=>{}),this.messaging||t.get().then(s=>this.messaging=s,()=>{}),this.appCheck||i.get().then(s=>this.appCheck=s,()=>{})}async getAuthToken(){if(!!this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(){if(this.appCheck){const e=await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(){const e=await this.getAuthToken(),t=await this.getMessagingToken(),i=await this.getAppCheckToken();return{authToken:e,messagingToken:t,appCheckToken:i}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gy="us-central1";function fB(n){let e=null;return{promise:new Promise((t,i)=>{e=setTimeout(()=>{i(new Qs("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}class pB{constructor(e,t,i,s,r=gy,o){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new dB(t,i,s),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(r);this.customDomain=a.origin,this.region=gy}catch{this.customDomain=null,this.region=r}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function gB(n,e,t){n.emulatorOrigin=`http://${e}:${t}`}function mB(n,e,t){return i=>wB(n,e,i,t||{})}function _B(n,e,t){return i=>_S(n,e,i,t||{})}async function yB(n,e,t,i){t["Content-Type"]="application/json";let s;try{s=await i(n,{method:"POST",body:JSON.stringify(e),headers:t})}catch{return{status:0,json:null}}let r=null;try{r=await s.json()}catch{}return{status:s.status,json:r}}function wB(n,e,t,i){const s=n._url(e);return _S(n,s,t,i)}async function _S(n,e,t,i){t=Rd(t);const s={data:t},r={},o=await n.contextProvider.getContext();o.authToken&&(r.Authorization="Bearer "+o.authToken),o.messagingToken&&(r["Firebase-Instance-ID-Token"]=o.messagingToken),o.appCheckToken!==null&&(r["X-Firebase-AppCheck"]=o.appCheckToken);const a=i.timeout||7e4,c=fB(a),l=await Promise.race([yB(e,s,r,n.fetchImpl),c.promise,n.cancelAllRequests]);if(c.cancel(),!l)throw new Qs("cancelled","Firebase Functions instance was deleted.");const u=hB(l.status,l.json);if(u)throw u;if(!l.json)throw new Qs("internal","Response is not valid JSON object.");let h=l.json.data;if(typeof h=="undefined"&&(h=l.json.result),typeof h=="undefined")throw new Qs("internal","Response is missing data field.");return{data:dl(h)}}const my="@firebase/functions",_y="0.8.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vB="auth-internal",IB="app-check-internal",TB="messaging-internal";function EB(n,e){const t=(i,{instanceIdentifier:s})=>{const r=i.getProvider("app").getImmediate(),o=i.getProvider(vB),a=i.getProvider(TB),c=i.getProvider(IB);return new pB(r,o,a,c,s,n)};Qe(new Y(mS,t,"PUBLIC").setMultipleInstances(!0)),fe(my,_y,e),fe(my,_y,"esm2017")}function yy(n,e,t){gB(w(n),e,t)}function bB(n,e,t){return mB(w(n),e,t)}function SB(n,e,t){return _B(w(n),e,t)}EB(fetch.bind(self));const CB="@firebase/functions-compat",kB="0.2.4";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yS{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return bB(this._delegate,e,t)}httpsCallableFromURL(e,t){return SB(this._delegate,e,t)}useFunctionsEmulator(e){const t=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(t==null)throw new Ke("functions","No origin provided to useFunctionsEmulator()");if(t[2]==null)throw new Ke("functions","Port missing in origin provided to useFunctionsEmulator()");return yy(this._delegate,t[1],Number(t[2]))}useEmulator(e,t){return yy(this._delegate,e,t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AB="us-central1",RB=(n,{instanceIdentifier:e})=>{const t=n.getProvider("app-compat").getImmediate(),i=n.getProvider("functions").getImmediate({identifier:e!=null?e:AB});return new yS(t,i)};function NB(){const n={Functions:yS};Le.INTERNAL.registerComponent(new Y("functions-compat",RB,"PUBLIC").setServiceProps(n).setMultipleInstances(!0))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */NB();Le.registerVersion(CB,kB);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PB="/firebase-messaging-sw.js",DB="/firebase-cloud-messaging-push-scope",wS="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",OB="https://fcmregistrations.googleapis.com/v1",vS="google.c.a.c_id",xB="google.c.a.c_l",MB="google.c.a.ts",LB="google.c.a.e";var wy;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(wy||(wy={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var ia;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(ia||(ia={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vn(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function FB(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(t),s=new Uint8Array(i.length);for(let r=0;r<i.length;++r)s[r]=i.charCodeAt(r);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hh="fcm_token_details_db",UB=5,vy="fcm_token_object_Store";async function VB(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(r=>r.name).includes(hh))return null;let e=null;return(await ra(hh,UB,{upgrade:async(i,s,r,o)=>{var a;if(s<2||!i.objectStoreNames.contains(vy))return;const c=o.objectStore(vy),l=await c.index("fcmSenderId").get(n);if(await c.clear(),!!l){if(s===2){const u=l;if(!u.auth||!u.p256dh||!u.endpoint)return;e={token:u.fcmToken,createTime:(a=u.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:u.auth,p256dh:u.p256dh,endpoint:u.endpoint,swScope:u.swScope,vapidKey:typeof u.vapidKey=="string"?u.vapidKey:vn(u.vapidKey)}}}else if(s===3){const u=l;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:vn(u.auth),p256dh:vn(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:vn(u.vapidKey)}}}else if(s===4){const u=l;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:vn(u.auth),p256dh:vn(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:vn(u.vapidKey)}}}}}})).close(),await Bs(hh),await Bs("fcm_vapid_details_db"),await Bs("undefined"),BB(e)?e:null}function BB(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $B="firebase-messaging-database",qB=1,ms="firebase-messaging-store";let dh=null;function dg(){return dh||(dh=ra($B,qB,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(ms)}}})),dh}async function IS(n){const e=pg(n),i=await(await dg()).transaction(ms).objectStore(ms).get(e);if(i)return i;{const s=await VB(n.appConfig.senderId);if(s)return await fg(n,s),s}}async function fg(n,e){const t=pg(n),s=(await dg()).transaction(ms,"readwrite");return await s.objectStore(ms).put(e,t),await s.done,e}async function jB(n){const e=pg(n),i=(await dg()).transaction(ms,"readwrite");await i.objectStore(ms).delete(e),await i.done}function pg({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KB={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["only-available-in-window"]:"This method is available in a Window context.",["only-available-in-sw"]:"This method is available in a service worker context.",["permission-default"]:"The notification permission was not granted and dismissed instead.",["permission-blocked"]:"The notification permission was not granted and blocked instead.",["unsupported-browser"]:"This browser doesn't support the API's required to use the Firebase SDK.",["indexed-db-unsupported"]:"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)",["failed-service-worker-registration"]:"We are unable to register the default service worker. {$browserErrorMessage}",["token-subscribe-failed"]:"A problem occurred while subscribing the user to FCM: {$errorInfo}",["token-subscribe-no-token"]:"FCM returned no token when subscribing the user to push.",["token-unsubscribe-failed"]:"A problem occurred while unsubscribing the user from FCM: {$errorInfo}",["token-update-failed"]:"A problem occurred while updating the user from FCM: {$errorInfo}",["token-update-no-token"]:"FCM returned no token when updating the user to push.",["use-sw-after-get-token"]:"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",["invalid-sw-registration"]:"The input to useServiceWorker() must be a ServiceWorkerRegistration.",["invalid-bg-handler"]:"The input to setBackgroundMessageHandler() must be a function.",["invalid-vapid-key"]:"The public VAPID key must be a string.",["use-vapid-key-after-get-token"]:"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},ft=new Yt("messaging","Messaging",KB);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function GB(n,e){var t;const i=await mg(n),s=ES(e),r={method:"POST",headers:i,body:JSON.stringify(s)};let o;try{o=await(await fetch(gg(n.appConfig),r)).json()}catch(a){throw ft.create("token-subscribe-failed",{errorInfo:(t=a)===null||t===void 0?void 0:t.toString()})}if(o.error){const a=o.error.message;throw ft.create("token-subscribe-failed",{errorInfo:a})}if(!o.token)throw ft.create("token-subscribe-no-token");return o.token}async function WB(n,e){var t;const i=await mg(n),s=ES(e.subscriptionOptions),r={method:"PATCH",headers:i,body:JSON.stringify(s)};let o;try{o=await(await fetch(`${gg(n.appConfig)}/${e.token}`,r)).json()}catch(a){throw ft.create("token-update-failed",{errorInfo:(t=a)===null||t===void 0?void 0:t.toString()})}if(o.error){const a=o.error.message;throw ft.create("token-update-failed",{errorInfo:a})}if(!o.token)throw ft.create("token-update-no-token");return o.token}async function TS(n,e){var t;const i=await mg(n),s={method:"DELETE",headers:i};try{const o=await(await fetch(`${gg(n.appConfig)}/${e}`,s)).json();if(o.error){const a=o.error.message;throw ft.create("token-unsubscribe-failed",{errorInfo:a})}}catch(r){throw ft.create("token-unsubscribe-failed",{errorInfo:(t=r)===null||t===void 0?void 0:t.toString()})}}function gg({projectId:n}){return`${OB}/projects/${n}/registrations`}async function mg({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function ES({p256dh:n,auth:e,endpoint:t,vapidKey:i}){const s={web:{endpoint:t,auth:e,p256dh:n}};return i!==wS&&(s.web.applicationPubKey=i),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HB=7*24*60*60*1e3;async function zB(n){const e=await YB(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:vn(e.getKey("auth")),p256dh:vn(e.getKey("p256dh"))},i=await IS(n.firebaseDependencies);if(i){if(XB(i.subscriptionOptions,t))return Date.now()>=i.createTime+HB?QB(n,{token:i.token,createTime:Date.now(),subscriptionOptions:t}):i.token;try{await TS(n.firebaseDependencies,i.token)}catch(s){console.warn(s)}return Iy(n.firebaseDependencies,t)}else return Iy(n.firebaseDependencies,t)}async function bS(n){const e=await IS(n.firebaseDependencies);e&&(await TS(n.firebaseDependencies,e.token),await jB(n.firebaseDependencies));const t=await n.swRegistration.pushManager.getSubscription();return t?t.unsubscribe():!0}async function QB(n,e){try{const t=await WB(n.firebaseDependencies,e),i=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await fg(n.firebaseDependencies,i),t}catch(t){throw await bS(n),t}}async function Iy(n,e){const i={token:await GB(n,e),createTime:Date.now(),subscriptionOptions:e};return await fg(n,i),i.token}async function YB(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:FB(e)})}function XB(n,e){const t=e.vapidKey===n.vapidKey,i=e.endpoint===n.endpoint,s=e.auth===n.auth,r=e.p256dh===n.p256dh;return t&&i&&s&&r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ty(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return JB(e,n),ZB(e,n),e$(e,n),e}function JB(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const i=e.notification.body;i&&(n.notification.body=i);const s=e.notification.image;s&&(n.notification.image=s)}function ZB(n,e){!e.data||(n.data=e.data)}function e$(n,e){var t,i,s,r,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(i=e.fcmOptions)===null||i===void 0?void 0:i.link)!==null&&s!==void 0?s:(r=e.notification)===null||r===void 0?void 0:r.click_action;a&&(n.fcmOptions.link=a);const c=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;c&&(n.fcmOptions.analyticsLabel=c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t$(n){return typeof n=="object"&&!!n&&vS in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */SS("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o");SS("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function SS(n,e){const t=[];for(let i=0;i<n.length;i++)t.push(n.charAt(i)),i<e.length&&t.push(e.charAt(i));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n$(n){if(!n||!n.options)throw fh("App Configuration Object");if(!n.name)throw fh("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const i of e)if(!t[i])throw fh(i);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function fh(n){return ft.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i${constructor(e,t,i){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=n$(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:i}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CS(n){var e;try{n.swRegistration=await navigator.serviceWorker.register(PB,{scope:DB}),n.swRegistration.update().catch(()=>{})}catch(t){throw ft.create("failed-service-worker-registration",{browserErrorMessage:(e=t)===null||e===void 0?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function s$(n,e){if(!e&&!n.swRegistration&&await CS(n),!(!e&&!!n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw ft.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function r$(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=wS)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kS(n,e){if(!navigator)throw ft.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw ft.create("permission-blocked");return await r$(n,e==null?void 0:e.vapidKey),await s$(n,e==null?void 0:e.serviceWorkerRegistration),zB(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function o$(n,e,t){const i=a$(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(i,{message_id:t[vS],message_name:t[xB],message_time:t[MB],message_device_time:Math.floor(Date.now()/1e3)})}function a$(n){switch(n){case ia.NOTIFICATION_CLICKED:return"notification_open";case ia.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function c$(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===ia.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(Ty(t)):n.onMessageHandler.next(Ty(t)));const i=t.data;t$(i)&&i[LB]==="1"&&await o$(n,t.messageType,i)}const Ey="@firebase/messaging",by="0.9.16";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const l$=n=>{const e=new i$(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>c$(e,t)),e},u$=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:i=>kS(e,i)}};function h$(){Qe(new Y("messaging",l$,"PUBLIC")),Qe(new Y("messaging-internal",u$,"PRIVATE")),fe(Ey,by),fe(Ey,by,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function d$(n){if(!navigator)throw ft.create("only-available-in-window");return n.swRegistration||await CS(n),bS(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function f$(n,e){if(!navigator)throw ft.create("only-available-in-window");return n.onMessageHandler=e,()=>{n.onMessageHandler=null}}async function p$(n,e){return n=w(n),kS(n,e)}function g$(n){return n=w(n),d$(n)}function m$(n,e){return n=w(n),f$(n,e)}h$();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AS="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",_$="https://fcmregistrations.googleapis.com/v1",RS="FCM_MSG",y$="google.c.a.c_id",w$=3,v$=1;var fl;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(fl||(fl={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var pl;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(pl||(pl={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function In(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function I$(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(t),s=new Uint8Array(i.length);for(let r=0;r<i.length;++r)s[r]=i.charCodeAt(r);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ph="fcm_token_details_db",T$=5,Sy="fcm_token_object_Store";async function E$(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(r=>r.name).includes(ph))return null;let e=null;return(await ra(ph,T$,{upgrade:async(i,s,r,o)=>{var a;if(s<2||!i.objectStoreNames.contains(Sy))return;const c=o.objectStore(Sy),l=await c.index("fcmSenderId").get(n);if(await c.clear(),!!l){if(s===2){const u=l;if(!u.auth||!u.p256dh||!u.endpoint)return;e={token:u.fcmToken,createTime:(a=u.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:u.auth,p256dh:u.p256dh,endpoint:u.endpoint,swScope:u.swScope,vapidKey:typeof u.vapidKey=="string"?u.vapidKey:In(u.vapidKey)}}}else if(s===3){const u=l;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:In(u.auth),p256dh:In(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:In(u.vapidKey)}}}else if(s===4){const u=l;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:In(u.auth),p256dh:In(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:In(u.vapidKey)}}}}}})).close(),await Bs(ph),await Bs("fcm_vapid_details_db"),await Bs("undefined"),b$(e)?e:null}function b$(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S$="firebase-messaging-database",C$=1,_s="firebase-messaging-store";let gh=null;function _g(){return gh||(gh=ra(S$,C$,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(_s)}}})),gh}async function yg(n){const e=vg(n),i=await(await _g()).transaction(_s).objectStore(_s).get(e);if(i)return i;{const s=await E$(n.appConfig.senderId);if(s)return await wg(n,s),s}}async function wg(n,e){const t=vg(n),s=(await _g()).transaction(_s,"readwrite");return await s.objectStore(_s).put(e,t),await s.done,e}async function k$(n){const e=vg(n),i=(await _g()).transaction(_s,"readwrite");await i.objectStore(_s).delete(e),await i.done}function vg({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const A$={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["only-available-in-window"]:"This method is available in a Window context.",["only-available-in-sw"]:"This method is available in a service worker context.",["permission-default"]:"The notification permission was not granted and dismissed instead.",["permission-blocked"]:"The notification permission was not granted and blocked instead.",["unsupported-browser"]:"This browser doesn't support the API's required to use the Firebase SDK.",["indexed-db-unsupported"]:"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)",["failed-service-worker-registration"]:"We are unable to register the default service worker. {$browserErrorMessage}",["token-subscribe-failed"]:"A problem occurred while subscribing the user to FCM: {$errorInfo}",["token-subscribe-no-token"]:"FCM returned no token when subscribing the user to push.",["token-unsubscribe-failed"]:"A problem occurred while unsubscribing the user from FCM: {$errorInfo}",["token-update-failed"]:"A problem occurred while updating the user from FCM: {$errorInfo}",["token-update-no-token"]:"FCM returned no token when updating the user to push.",["use-sw-after-get-token"]:"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",["invalid-sw-registration"]:"The input to useServiceWorker() must be a ServiceWorkerRegistration.",["invalid-bg-handler"]:"The input to setBackgroundMessageHandler() must be a function.",["invalid-vapid-key"]:"The public VAPID key must be a string.",["use-vapid-key-after-get-token"]:"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},hn=new Yt("messaging","Messaging",A$);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function R$(n,e){var t;const i=await Tg(n),s=PS(e),r={method:"POST",headers:i,body:JSON.stringify(s)};let o;try{o=await(await fetch(Ig(n.appConfig),r)).json()}catch(a){throw hn.create("token-subscribe-failed",{errorInfo:(t=a)===null||t===void 0?void 0:t.toString()})}if(o.error){const a=o.error.message;throw hn.create("token-subscribe-failed",{errorInfo:a})}if(!o.token)throw hn.create("token-subscribe-no-token");return o.token}async function N$(n,e){var t;const i=await Tg(n),s=PS(e.subscriptionOptions),r={method:"PATCH",headers:i,body:JSON.stringify(s)};let o;try{o=await(await fetch(`${Ig(n.appConfig)}/${e.token}`,r)).json()}catch(a){throw hn.create("token-update-failed",{errorInfo:(t=a)===null||t===void 0?void 0:t.toString()})}if(o.error){const a=o.error.message;throw hn.create("token-update-failed",{errorInfo:a})}if(!o.token)throw hn.create("token-update-no-token");return o.token}async function NS(n,e){var t;const i=await Tg(n),s={method:"DELETE",headers:i};try{const o=await(await fetch(`${Ig(n.appConfig)}/${e}`,s)).json();if(o.error){const a=o.error.message;throw hn.create("token-unsubscribe-failed",{errorInfo:a})}}catch(r){throw hn.create("token-unsubscribe-failed",{errorInfo:(t=r)===null||t===void 0?void 0:t.toString()})}}function Ig({projectId:n}){return`${_$}/projects/${n}/registrations`}async function Tg({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function PS({p256dh:n,auth:e,endpoint:t,vapidKey:i}){const s={web:{endpoint:t,auth:e,p256dh:n}};return i!==AS&&(s.web.applicationPubKey=i),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P$=7*24*60*60*1e3;async function D$(n){const e=await x$(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:In(e.getKey("auth")),p256dh:In(e.getKey("p256dh"))},i=await yg(n.firebaseDependencies);if(i){if(M$(i.subscriptionOptions,t))return Date.now()>=i.createTime+P$?O$(n,{token:i.token,createTime:Date.now(),subscriptionOptions:t}):i.token;try{await NS(n.firebaseDependencies,i.token)}catch(s){console.warn(s)}return Cy(n.firebaseDependencies,t)}else return Cy(n.firebaseDependencies,t)}async function Nd(n){const e=await yg(n.firebaseDependencies);e&&(await NS(n.firebaseDependencies,e.token),await k$(n.firebaseDependencies));const t=await n.swRegistration.pushManager.getSubscription();return t?t.unsubscribe():!0}async function O$(n,e){try{const t=await N$(n.firebaseDependencies,e),i=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await wg(n.firebaseDependencies,i),t}catch(t){throw await Nd(n),t}}async function Cy(n,e){const i={token:await R$(n,e),createTime:Date.now(),subscriptionOptions:e};return await wg(n,i),i.token}async function x$(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:I$(e)})}function M$(n,e){const t=e.vapidKey===n.vapidKey,i=e.endpoint===n.endpoint,s=e.auth===n.auth,r=e.p256dh===n.p256dh;return t&&i&&s&&r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L$(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return F$(e,n),U$(e,n),V$(e,n),e}function F$(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const i=e.notification.body;i&&(n.notification.body=i);const s=e.notification.image;s&&(n.notification.image=s)}function U$(n,e){!e.data||(n.data=e.data)}function V$(n,e){var t,i,s,r,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(i=e.fcmOptions)===null||i===void 0?void 0:i.link)!==null&&s!==void 0?s:(r=e.notification)===null||r===void 0?void 0:r.click_action;a&&(n.fcmOptions.link=a);const c=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;c&&(n.fcmOptions.analyticsLabel=c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B$(n){return typeof n=="object"&&!!n&&y$ in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $$(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */DS("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o");DS("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");async function q$(n,e){const t=j$(e,await n.firebaseDependencies.installations.getId());K$(n,t)}function j$(n,e){var t,i;const s={};return n.from&&(s.project_number=n.from),n.fcmMessageId&&(s.message_id=n.fcmMessageId),s.instance_id=e,n.notification?s.message_type=fl.DISPLAY_NOTIFICATION.toString():s.message_type=fl.DATA_MESSAGE.toString(),s.sdk_platform=w$.toString(),s.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),n.collapse_key&&(s.collapse_key=n.collapse_key),s.event=v$.toString(),!((t=n.fcmOptions)===null||t===void 0)&&t.analytics_label&&(s.analytics_label=(i=n.fcmOptions)===null||i===void 0?void 0:i.analytics_label),s}function K$(n,e){const t={};t.event_time_ms=Math.floor(Date.now()).toString(),t.source_extension_json_proto3=JSON.stringify(e),n.logEvents.push(t)}function DS(n,e){const t=[];for(let i=0;i<n.length;i++)t.push(n.charAt(i)),i<e.length&&t.push(e.charAt(i));return t.join("")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function G$(n,e){var t,i;const{newSubscription:s}=n;if(!s){await Nd(e);return}const r=await yg(e.firebaseDependencies);await Nd(e),e.vapidKey=(i=(t=r==null?void 0:r.subscriptionOptions)===null||t===void 0?void 0:t.vapidKey)!==null&&i!==void 0?i:AS,await D$(e)}async function W$(n,e){const t=Q$(n);if(!t)return;e.deliveryMetricsExportedToBigQueryEnabled&&await q$(e,t);const i=await OS();if(X$(i))return J$(i,t);if(t.notification&&await Z$(z$(t)),!!e&&e.onBackgroundMessageHandler){const s=L$(t);typeof e.onBackgroundMessageHandler=="function"?await e.onBackgroundMessageHandler(s):e.onBackgroundMessageHandler.next(s)}}async function H$(n){var e,t;const i=(t=(e=n.notification)===null||e===void 0?void 0:e.data)===null||t===void 0?void 0:t[RS];if(i){if(n.action)return}else return;n.stopImmediatePropagation(),n.notification.close();const s=eq(i);if(!s)return;const r=new URL(s,self.location.href),o=new URL(self.location.origin);if(r.host!==o.host)return;let a=await Y$(r);if(a?a=await a.focus():(a=await self.clients.openWindow(s),await $$(3e3)),!!a)return i.messageType=pl.NOTIFICATION_CLICKED,i.isFirebaseMessaging=!0,a.postMessage(i)}function z$(n){const e=Object.assign({},n.notification);return e.data={[RS]:n},e}function Q$({data:n}){if(!n)return null;try{return n.json()}catch{return null}}async function Y$(n){const e=await OS();for(const t of e){const i=new URL(t.url,self.location.href);if(n.host===i.host)return t}return null}function X$(n){return n.some(e=>e.visibilityState==="visible"&&!e.url.startsWith("chrome-extension://"))}function J$(n,e){e.isFirebaseMessaging=!0,e.messageType=pl.PUSH_RECEIVED;for(const t of n)t.postMessage(e)}function OS(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function Z$(n){var e;const{actions:t}=n,{maxActions:i}=Notification;return t&&i&&t.length>i&&console.warn(`This browser only supports ${i} actions. The remaining actions will not be displayed.`),self.registration.showNotification((e=n.title)!==null&&e!==void 0?e:"",n)}function eq(n){var e,t,i;const s=(t=(e=n.fcmOptions)===null||e===void 0?void 0:e.link)!==null&&t!==void 0?t:(i=n.notification)===null||i===void 0?void 0:i.click_action;return s||(B$(n.data)?self.location.origin:null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tq(n){if(!n||!n.options)throw mh("App Configuration Object");if(!n.name)throw mh("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const i of e)if(!t[i])throw mh(i);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function mh(n){return hn.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nq{constructor(e,t,i){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=tq(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:i}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iq=n=>{const e=new nq(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return self.addEventListener("push",t=>{t.waitUntil(W$(t,e))}),self.addEventListener("pushsubscriptionchange",t=>{t.waitUntil(G$(t,e))}),self.addEventListener("notificationclick",t=>{t.waitUntil(H$(t))}),e};function sq(){Qe(new Y("messaging-sw",iq,"PUBLIC"))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rq(n,e){if(self.document!==void 0)throw hn.create("only-available-in-sw");return n.onBackgroundMessageHandler=e,()=>{n.onBackgroundMessageHandler=null}}function oq(n,e){return n=w(n),rq(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */sq();const aq="@firebase/messaging-compat",cq="0.1.16";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lq(){return self&&"ServiceWorkerGlobalScope"in self?hq():uq()}function uq(){return typeof window!="undefined"&&At()&&_l()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}function hq(){return At()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}class ky{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return p$(this._delegate,e)}async deleteToken(){return g$(this._delegate)}onMessage(e){return m$(this._delegate,e)}onBackgroundMessage(e){return oq(this._delegate,e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dq=n=>self&&"ServiceWorkerGlobalScope"in self?new ky(n.getProvider("app-compat").getImmediate(),n.getProvider("messaging-sw").getImmediate()):new ky(n.getProvider("app-compat").getImmediate(),n.getProvider("messaging").getImmediate()),fq={isSupported:lq};function pq(){Le.INTERNAL.registerComponent(new Y("messaging-compat",dq,"PUBLIC").setServiceProps(fq))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */pq();Le.registerVersion(aq,cq);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xS="firebasestorage.googleapis.com",MS="storageBucket",gq=2*60*1e3,mq=10*60*1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ue extends Ke{constructor(e,t){super(_h(e),`Firebase Storage: ${t} (${_h(e)})`),this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ue.prototype)}_codeEquals(e){return _h(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function _h(n){return"storage/"+n}function Eg(){const n="An unknown error occurred, please check the error payload for server response.";return new ue("unknown",n)}function _q(n){return new ue("object-not-found","Object '"+n+"' does not exist.")}function yq(n){return new ue("quota-exceeded","Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function wq(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new ue("unauthenticated",n)}function vq(){return new ue("unauthorized-app","This app does not have permission to access Firebase Storage on this project.")}function Iq(n){return new ue("unauthorized","User does not have permission to access '"+n+"'.")}function Tq(){return new ue("retry-limit-exceeded","Max retry time for operation exceeded, please try again.")}function LS(){return new ue("canceled","User canceled the upload/download.")}function Eq(n){return new ue("invalid-url","Invalid URL '"+n+"'.")}function bq(n){return new ue("invalid-default-bucket","Invalid default bucket '"+n+"'.")}function Sq(){return new ue("no-default-bucket","No default bucket found. Did you set the '"+MS+"' property when initializing the app?")}function FS(){return new ue("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function Cq(){return new ue("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.")}function kq(){return new ue("no-download-url","The given file does not have any download URLs.")}function Ys(n){return new ue("invalid-argument",n)}function US(){return new ue("app-deleted","The Firebase app was deleted.")}function VS(n){return new ue("invalid-root-operation","The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function yo(n,e){return new ue("invalid-format","String does not match format '"+n+"': "+e)}function Yr(n){throw new ue("internal-error","Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ze{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let i;try{i=Ze.makeFromUrl(e,t)}catch{return new Ze(e,"")}if(i.path==="")return i;throw bq(e)}static makeFromUrl(e,t){let i=null;const s="([A-Za-z0-9.\\-_]+)";function r(M){M.path.charAt(M.path.length-1)==="/"&&(M.path_=M.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),c={bucket:1,path:3};function l(M){M.path_=decodeURIComponent(M.path)}const u="v[A-Za-z0-9_]+",h=t.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",f=new RegExp(`^https?://${h}/${u}/b/${s}/o${d}`,"i"),p={bucket:1,path:3},_=t===xS?"(?:storage.googleapis.com|storage.cloud.google.com)":t,v="([^?#]*)",R=new RegExp(`^https?://${_}/${s}/${v}`,"i"),A=[{regex:a,indices:c,postModify:r},{regex:f,indices:p,postModify:l},{regex:R,indices:{bucket:1,path:2},postModify:l}];for(let M=0;M<A.length;M++){const H=A[M],G=H.regex.exec(e);if(G){const he=G[H.indices.bucket];let It=G[H.indices.path];It||(It=""),i=new Ze(he,It),H.postModify(i);break}}if(i==null)throw Eq(e);return i}}class Aq{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rq(n,e,t){let i=1,s=null,r=null,o=!1,a=0;function c(){return a===2}let l=!1;function u(...v){l||(l=!0,e.apply(null,v))}function h(v){s=setTimeout(()=>{s=null,n(f,c())},v)}function d(){r&&clearTimeout(r)}function f(v,...R){if(l){d();return}if(v){d(),u.call(null,v,...R);return}if(c()||o){d(),u.call(null,v,...R);return}i<64&&(i*=2);let A;a===1?(a=2,A=0):A=(i+Math.random())*1e3,h(A)}let p=!1;function _(v){p||(p=!0,d(),!l&&(s!==null?(v||(a=2),clearTimeout(s),h(0)):v||(a=1)))}return h(0),r=setTimeout(()=>{o=!0,_(!0)},t),_}function Nq(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pq(n){return n!==void 0}function Dq(n){return typeof n=="function"}function Oq(n){return typeof n=="object"&&!Array.isArray(n)}function Du(n){return typeof n=="string"||n instanceof String}function Ay(n){return bg()&&n instanceof Blob}function bg(){return typeof Blob!="undefined"}function Pd(n,e,t,i){if(i<e)throw Ys(`Invalid value for '${n}'. Expected ${e} or greater.`);if(i>t)throw Ys(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bi(n,e,t){let i=e;return t==null&&(i=`https://${e}`),`${t}://${i}/v0${n}`}function BS(n){const e=encodeURIComponent;let t="?";for(const i in n)if(n.hasOwnProperty(i)){const s=e(i)+"="+e(n[i]);t=t+s+"&"}return t=t.slice(0,-1),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Hi;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Hi||(Hi={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xq{constructor(e,t,i,s,r,o,a,c,l,u,h){this.url_=e,this.method_=t,this.headers_=i,this.body_=s,this.successCodes_=r,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=c,this.timeout_=l,this.progressCallback_=u,this.connectionFactory_=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((d,f)=>{this.resolve_=d,this.reject_=f,this.start_()})}start_(){const e=(i,s)=>{if(s){i(!1,new rc(!1,null,!0));return}const r=this.connectionFactory_();this.pendingConnection_=r;const o=a=>{const c=a.loaded,l=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,l)};this.progressCallback_!==null&&r.addUploadProgressListener(o),r.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&r.removeUploadProgressListener(o),this.pendingConnection_=null;const a=r.getErrorCode()===Hi.NO_ERROR,c=r.getStatus();if(!a||this.isRetryStatusCode_(c)){const u=r.getErrorCode()===Hi.ABORT;i(!1,new rc(!1,null,u));return}const l=this.successCodes_.indexOf(c)!==-1;i(!0,new rc(l,r))})},t=(i,s)=>{const r=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const c=this.callback_(a,a.getResponse());Pq(c)?r(c):r()}catch(c){o(c)}else if(a!==null){const c=Eg();c.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,c)):o(c)}else if(s.canceled){const c=this.appDelete_?US():LS();o(c)}else{const c=Tq();o(c)}};this.canceled_?t(!1,new rc(!1,null,!0)):this.backoffId_=Rq(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&Nq(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}isRetryStatusCode_(e){const t=e>=500&&e<600,s=[408,429].indexOf(e)!==-1,r=this.additionalRetryCodes_.indexOf(e)!==-1;return t||s||r}}class rc{constructor(e,t,i){this.wasSuccessCode=e,this.connection=t,this.canceled=!!i}}function Mq(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function Lq(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e!=null?e:"AppManager")}function Fq(n,e){e&&(n["X-Firebase-GMPID"]=e)}function Uq(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function Vq(n,e,t,i,s,r){const o=BS(n.urlParams),a=n.url+o,c=Object.assign({},n.headers);return Fq(c,e),Mq(c,t),Lq(c,r),Uq(c,i),new xq(a,n.method,c,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bq(){return typeof BlobBuilder!="undefined"?BlobBuilder:typeof WebKitBlobBuilder!="undefined"?WebKitBlobBuilder:void 0}function $q(...n){const e=Bq();if(e!==void 0){const t=new e;for(let i=0;i<n.length;i++)t.append(n[i]);return t.getBlob()}else{if(bg())return new Blob(n);throw new ue("unsupported-environment","This browser doesn't seem to support creating Blobs")}}function qq(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jq(n){return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mt={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class yh{constructor(e,t){this.data=e,this.contentType=t||null}}function $S(n,e){switch(n){case Mt.RAW:return new yh(qS(e));case Mt.BASE64:case Mt.BASE64URL:return new yh(jS(n,e));case Mt.DATA_URL:return new yh(Gq(e),Wq(e))}throw Eg()}function qS(n){const e=[];for(let t=0;t<n.length;t++){let i=n.charCodeAt(t);if(i<=127)e.push(i);else if(i<=2047)e.push(192|i>>6,128|i&63);else if((i&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const r=i,o=n.charCodeAt(++t);i=65536|(r&1023)<<10|o&1023,e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|i&63)}else(i&64512)===56320?e.push(239,191,189):e.push(224|i>>12,128|i>>6&63,128|i&63)}return new Uint8Array(e)}function Kq(n){let e;try{e=decodeURIComponent(n)}catch{throw yo(Mt.DATA_URL,"Malformed data URL.")}return qS(e)}function jS(n,e){switch(n){case Mt.BASE64:{const s=e.indexOf("-")!==-1,r=e.indexOf("_")!==-1;if(s||r)throw yo(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Mt.BASE64URL:{const s=e.indexOf("+")!==-1,r=e.indexOf("/")!==-1;if(s||r)throw yo(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=jq(e)}catch{throw yo(n,"Invalid character found")}const i=new Uint8Array(t.length);for(let s=0;s<t.length;s++)i[s]=t.charCodeAt(s);return i}class KS{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw yo(Mt.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const i=t[1]||null;i!=null&&(this.base64=Hq(i,";base64"),this.contentType=this.base64?i.substring(0,i.length-7):i),this.rest=e.substring(e.indexOf(",")+1)}}function Gq(n){const e=new KS(n);return e.base64?jS(Mt.BASE64,e.rest):Kq(e.rest)}function Wq(n){return new KS(n).contentType}function Hq(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{constructor(e,t){let i=0,s="";Ay(e)?(this.data_=e,i=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),i=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),i=e.length),this.size_=i,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(Ay(this.data_)){const i=this.data_,s=qq(i,e,t);return s===null?null:new Tn(s)}else{const i=new Uint8Array(this.data_.buffer,e,t-e);return new Tn(i,!0)}}static getBlob(...e){if(bg()){const t=e.map(i=>i instanceof Tn?i.data_:i);return new Tn($q.apply(null,t))}else{const t=e.map(o=>Du(o)?$S(Mt.RAW,o).data:o.data_);let i=0;t.forEach(o=>{i+=o.byteLength});const s=new Uint8Array(i);let r=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)s[r++]=o[a]}),new Tn(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sg(n){let e;try{e=JSON.parse(n)}catch{return null}return Oq(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zq(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function Qq(n,e){const t=e.split("/").filter(i=>i.length>0).join("/");return n.length===0?t:n+"/"+t}function GS(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yq(n,e){return e}class it{constructor(e,t,i,s){this.server=e,this.local=t||e,this.writable=!!i,this.xform=s||Yq}}let oc=null;function Xq(n){return!Du(n)||n.length<2?n:GS(n)}function Ou(){if(oc)return oc;const n=[];n.push(new it("bucket")),n.push(new it("generation")),n.push(new it("metageneration")),n.push(new it("name","fullPath",!0));function e(r,o){return Xq(o)}const t=new it("name");t.xform=e,n.push(t);function i(r,o){return o!==void 0?Number(o):o}const s=new it("size");return s.xform=i,n.push(s),n.push(new it("timeCreated")),n.push(new it("updated")),n.push(new it("md5Hash",null,!0)),n.push(new it("cacheControl",null,!0)),n.push(new it("contentDisposition",null,!0)),n.push(new it("contentEncoding",null,!0)),n.push(new it("contentLanguage",null,!0)),n.push(new it("contentType",null,!0)),n.push(new it("metadata","customMetadata",!0)),oc=n,oc}function Jq(n,e){function t(){const i=n.bucket,s=n.fullPath,r=new Ze(i,s);return e._makeStorageReference(r)}Object.defineProperty(n,"ref",{get:t})}function Zq(n,e,t){const i={};i.type="file";const s=t.length;for(let r=0;r<s;r++){const o=t[r];i[o.local]=o.xform(i,e[o.server])}return Jq(i,n),i}function WS(n,e,t){const i=Sg(e);return i===null?null:Zq(n,i,t)}function ej(n,e,t,i){const s=Sg(e);if(s===null||!Du(s.downloadTokens))return null;const r=s.downloadTokens;if(r.length===0)return null;const o=encodeURIComponent;return r.split(",").map(l=>{const u=n.bucket,h=n.fullPath,d="/b/"+o(u)+"/o/"+o(h),f=bi(d,t,i),p=BS({alt:"media",token:l});return f+p})[0]}function Cg(n,e){const t={},i=e.length;for(let s=0;s<i;s++){const r=e[s];r.writable&&(t[r.server]=n[r.local])}return JSON.stringify(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ry="prefixes",Ny="items";function tj(n,e,t){const i={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[Ry])for(const s of t[Ry]){const r=s.replace(/\/$/,""),o=n._makeStorageReference(new Ze(e,r));i.prefixes.push(o)}if(t[Ny])for(const s of t[Ny]){const r=n._makeStorageReference(new Ze(e,s.name));i.items.push(r)}return i}function nj(n,e,t){const i=Sg(t);return i===null?null:tj(n,e,i)}class $n{constructor(e,t,i,s){this.url=e,this.method=t,this.handler=i,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dn(n){if(!n)throw Eg()}function xu(n,e){function t(i,s){const r=WS(n,s,e);return dn(r!==null),r}return t}function ij(n,e){function t(i,s){const r=nj(n,e,s);return dn(r!==null),r}return t}function sj(n,e){function t(i,s){const r=WS(n,s,e);return dn(r!==null),ej(r,s,n.host,n._protocol)}return t}function Mr(n){function e(t,i){let s;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?s=vq():s=wq():t.getStatus()===402?s=yq(n.bucket):t.getStatus()===403?s=Iq(n.path):s=i,s.serverResponse=i.serverResponse,s}return e}function Mu(n){const e=Mr(n);function t(i,s){let r=e(i,s);return i.getStatus()===404&&(r=_q(n.path)),r.serverResponse=s.serverResponse,r}return t}function HS(n,e,t){const i=e.fullServerUrl(),s=bi(i,n.host,n._protocol),r="GET",o=n.maxOperationRetryTime,a=new $n(s,r,xu(n,t),o);return a.errorHandler=Mu(e),a}function rj(n,e,t,i,s){const r={};e.isRoot?r.prefix="":r.prefix=e.path+"/",t&&t.length>0&&(r.delimiter=t),i&&(r.pageToken=i),s&&(r.maxResults=s);const o=e.bucketOnlyServerUrl(),a=bi(o,n.host,n._protocol),c="GET",l=n.maxOperationRetryTime,u=new $n(a,c,ij(n,e.bucket),l);return u.urlParams=r,u.errorHandler=Mr(e),u}function oj(n,e,t){const i=e.fullServerUrl(),s=bi(i,n.host,n._protocol),r="GET",o=n.maxOperationRetryTime,a=new $n(s,r,sj(n,t),o);return a.errorHandler=Mu(e),a}function aj(n,e,t,i){const s=e.fullServerUrl(),r=bi(s,n.host,n._protocol),o="PATCH",a=Cg(t,i),c={"Content-Type":"application/json; charset=utf-8"},l=n.maxOperationRetryTime,u=new $n(r,o,xu(n,i),l);return u.headers=c,u.body=a,u.errorHandler=Mu(e),u}function cj(n,e){const t=e.fullServerUrl(),i=bi(t,n.host,n._protocol),s="DELETE",r=n.maxOperationRetryTime;function o(c,l){}const a=new $n(i,s,o,r);return a.successCodes=[200,204],a.errorHandler=Mu(e),a}function lj(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function zS(n,e,t){const i=Object.assign({},t);return i.fullPath=n.path,i.size=e.size(),i.contentType||(i.contentType=lj(null,e)),i}function uj(n,e,t,i,s){const r=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let A="";for(let M=0;M<2;M++)A=A+Math.random().toString().slice(2);return A}const c=a();o["Content-Type"]="multipart/related; boundary="+c;const l=zS(e,i,s),u=Cg(l,t),h="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+u+`\r
--`+c+`\r
Content-Type: `+l.contentType+`\r
\r
`,d=`\r
--`+c+"--",f=Tn.getBlob(h,i,d);if(f===null)throw FS();const p={name:l.fullPath},_=bi(r,n.host,n._protocol),v="POST",R=n.maxUploadRetryTime,x=new $n(_,v,xu(n,t),R);return x.urlParams=p,x.headers=o,x.body=f.uploadData(),x.errorHandler=Mr(e),x}class gl{constructor(e,t,i,s){this.current=e,this.total=t,this.finalized=!!i,this.metadata=s||null}}function kg(n,e){let t=null;try{t=n.getResponseHeader("X-Goog-Upload-Status")}catch{dn(!1)}return dn(!!t&&(e||["active"]).indexOf(t)!==-1),t}function hj(n,e,t,i,s){const r=e.bucketOnlyServerUrl(),o=zS(e,i,s),a={name:o.fullPath},c=bi(r,n.host,n._protocol),l="POST",u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${i.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=Cg(o,t),d=n.maxUploadRetryTime;function f(_){kg(_);let v;try{v=_.getResponseHeader("X-Goog-Upload-URL")}catch{dn(!1)}return dn(Du(v)),v}const p=new $n(c,l,f,d);return p.urlParams=a,p.headers=u,p.body=h,p.errorHandler=Mr(e),p}function dj(n,e,t,i){const s={"X-Goog-Upload-Command":"query"};function r(l){const u=kg(l,["active","final"]);let h=null;try{h=l.getResponseHeader("X-Goog-Upload-Size-Received")}catch{dn(!1)}h||dn(!1);const d=Number(h);return dn(!isNaN(d)),new gl(d,i.size(),u==="final")}const o="POST",a=n.maxUploadRetryTime,c=new $n(t,o,r,a);return c.headers=s,c.errorHandler=Mr(e),c}const Py=256*1024;function fj(n,e,t,i,s,r,o,a){const c=new gl(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=i.size()),i.size()!==c.total)throw Cq();const l=c.total-c.current;let u=l;s>0&&(u=Math.min(u,s));const h=c.current,d=h+u,p={"X-Goog-Upload-Command":u===l?"upload, finalize":"upload","X-Goog-Upload-Offset":`${c.current}`},_=i.slice(h,d);if(_===null)throw FS();function v(M,H){const G=kg(M,["active","final"]),he=c.current+u,It=i.size();let Si;return G==="final"?Si=xu(e,r)(M,H):Si=null,new gl(he,It,G==="final",Si)}const R="POST",x=e.maxUploadRetryTime,A=new $n(t,R,v,x);return A.headers=p,A.body=_.uploadData(),A.progressCallback=a||null,A.errorHandler=Mr(n),A}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pj={STATE_CHANGED:"state_changed"},ot={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function wh(n){switch(n){case"running":case"pausing":case"canceling":return ot.RUNNING;case"paused":return ot.PAUSED;case"success":return ot.SUCCESS;case"canceled":return ot.CANCELED;case"error":return ot.ERROR;default:return ot.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gj{constructor(e,t,i){if(Dq(e)||t!=null||i!=null)this.next=e,this.error=t!=null?t:void 0,this.complete=i!=null?i:void 0;else{const r=e;this.next=r.next,this.error=r.error,this.complete=r.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ms(n){return(...e)=>{Promise.resolve().then(()=>n(...e))}}class mj{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Hi.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Hi.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Hi.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,i,s){if(this.sent_)throw Yr("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),s!==void 0)for(const r in s)s.hasOwnProperty(r)&&this.xhr_.setRequestHeader(r,s[r].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Yr("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Yr("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Yr("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Yr("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class _j extends mj{initXhr(){this.xhr_.responseType="text"}}function sn(){return new _j}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QS{constructor(e,t,i=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=i,this._mappings=Ou(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=s=>{this._request=void 0,this._chunkMultiplier=1,s._codeEquals("canceled")?(this._needToFetchStatus=!0,this.completeTransitions_()):(this._error=s,this._transition("error"))},this._metadataErrorHandler=s=>{this._request=void 0,s._codeEquals("canceled")?this.completeTransitions_():(this._error=s,this._transition("error"))},this._promise=new Promise((s,r)=>{this._resolve=s,this._reject=r,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,i])=>{switch(this._state){case"running":e(t,i);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,t)=>{const i=hj(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(i,sn,e,t);this._request=s,s.getPromise().then(r=>{this._request=void 0,this._uploadUrl=r,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((t,i)=>{const s=dj(this._ref.storage,this._ref._location,e,this._blob),r=this._ref.storage._makeRequest(s,sn,t,i);this._request=r,r.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=Py*this._chunkMultiplier,t=new gl(this._transferred,this._blob.size()),i=this._uploadUrl;this._resolveToken((s,r)=>{let o;try{o=fj(this._ref._location,this._ref.storage,i,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(c){this._error=c,this._transition("error");return}const a=this._ref.storage._makeRequest(o,sn,s,r);this._request=a,a.getPromise().then(c=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(c.current),c.finalized?(this._metadata=c.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){Py*this._chunkMultiplier<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{const i=HS(this._ref.storage,this._ref._location,this._mappings),s=this._ref.storage._makeRequest(i,sn,e,t);this._request=s,s.getPromise().then(r=>{this._request=void 0,this._metadata=r,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{const i=uj(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(i,sn,e,t);this._request=s,s.getPromise().then(r=>{this._request=void 0,this._metadata=r,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":this._state=e,this._request!==void 0&&this._request.cancel();break;case"pausing":this._state=e,this._request!==void 0&&this._request.cancel();break;case"running":const t=this._state==="paused";this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=LS(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=wh(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,i,s){const r=new gj(t||void 0,i||void 0,s||void 0);return this._addObserver(r),()=>{this._removeObserver(r)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);t!==-1&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(t=>{this._notifyObserver(t)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(wh(this._state)){case ot.SUCCESS:Ms(this._resolve.bind(null,this.snapshot))();break;case ot.CANCELED:case ot.ERROR:const t=this._reject;Ms(t.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(wh(this._state)){case ot.RUNNING:case ot.PAUSED:e.next&&Ms(e.next.bind(e,this.snapshot))();break;case ot.SUCCESS:e.complete&&Ms(e.complete.bind(e))();break;case ot.CANCELED:case ot.ERROR:e.error&&Ms(e.error.bind(e,this._error))();break;default:e.error&&Ms(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ys{constructor(e,t){this._service=e,t instanceof Ze?this._location=t:this._location=Ze.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new ys(e,t)}get root(){const e=new Ze(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return GS(this._location.path)}get storage(){return this._service}get parent(){const e=zq(this._location.path);if(e===null)return null;const t=new Ze(this._location.bucket,e);return new ys(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw VS(e)}}function yj(n,e,t){return n._throwIfRoot("uploadBytesResumable"),new QS(n,new Tn(e),t)}function wj(n){const e={prefixes:[],items:[]};return YS(n,e).then(()=>e)}async function YS(n,e,t){const s=await XS(n,{pageToken:t});e.prefixes.push(...s.prefixes),e.items.push(...s.items),s.nextPageToken!=null&&await YS(n,e,s.nextPageToken)}function XS(n,e){e!=null&&typeof e.maxResults=="number"&&Pd("options.maxResults",1,1e3,e.maxResults);const t=e||{},i=rj(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(i,sn)}function vj(n){n._throwIfRoot("getMetadata");const e=HS(n.storage,n._location,Ou());return n.storage.makeRequestWithTokens(e,sn)}function Ij(n,e){n._throwIfRoot("updateMetadata");const t=aj(n.storage,n._location,e,Ou());return n.storage.makeRequestWithTokens(t,sn)}function Tj(n){n._throwIfRoot("getDownloadURL");const e=oj(n.storage,n._location,Ou());return n.storage.makeRequestWithTokens(e,sn).then(t=>{if(t===null)throw kq();return t})}function Ej(n){n._throwIfRoot("deleteObject");const e=cj(n.storage,n._location);return n.storage.makeRequestWithTokens(e,sn)}function JS(n,e){const t=Qq(n._location.path,e),i=new Ze(n._location.bucket,t);return new ys(n.storage,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bj(n){return/^[A-Za-z]+:\/\//.test(n)}function Sj(n,e){return new ys(n,e)}function ZS(n,e){if(n instanceof Ag){const t=n;if(t._bucket==null)throw Sq();const i=new ys(t,t._bucket);return e!=null?ZS(i,e):i}else return e!==void 0?JS(n,e):n}function Cj(n,e){if(e&&bj(e)){if(n instanceof Ag)return Sj(n,e);throw Ys("To use ref(service, url), the first argument must be a Storage instance.")}else return ZS(n,e)}function Dy(n,e){const t=e==null?void 0:e[MS];return t==null?null:Ze.makeFromBucketSpec(t,n)}function kj(n,e,t,i={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:s}=i;s&&(n._overrideAuthToken=typeof s=="string"?s:Ld(s,n.app.options.projectId))}class Ag{constructor(e,t,i,s,r){this.app=e,this._authProvider=t,this._appCheckProvider=i,this._url=s,this._firebaseVersion=r,this._bucket=null,this._host=xS,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=gq,this._maxUploadRetryTime=mq,this._requests=new Set,s!=null?this._bucket=Ze.makeFromBucketSpec(s,this._host):this._bucket=Dy(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=Ze.makeFromBucketSpec(this._url,e):this._bucket=Dy(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){Pd("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){Pd("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ys(this,e)}_makeRequest(e,t,i,s){if(this._deleted)return new Aq(US());{const r=Vq(e,this._appId,i,s,t,this._firebaseVersion);return this._requests.add(r),r.getPromise().then(()=>this._requests.delete(r),()=>this._requests.delete(r)),r}}async makeRequestWithTokens(e,t){const[i,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,i,s).getPromise()}}const Oy="@firebase/storage",xy="0.9.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Aj="storage";function Rj(n,e,t){return n=w(n),yj(n,e,t)}function Nj(n){return n=w(n),vj(n)}function Pj(n,e){return n=w(n),Ij(n,e)}function Dj(n,e){return n=w(n),XS(n,e)}function Oj(n){return n=w(n),wj(n)}function xj(n){return n=w(n),Tj(n)}function Mj(n){return n=w(n),Ej(n)}function My(n,e){return n=w(n),Cj(n,e)}function Lj(n,e){return JS(n,e)}function Fj(n,e,t,i={}){kj(n,e,t,i)}function Uj(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),i=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new Ag(t,i,s,e,gi)}function Vj(){Qe(new Y(Aj,Uj,"PUBLIC").setMultipleInstances(!0)),fe(Oy,xy,""),fe(Oy,xy,"esm2017")}Vj();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ac{constructor(e,t,i){this._delegate=e,this.task=t,this.ref=i}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ly{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new ac(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then(i=>{if(e)return e(new ac(i,this,this._ref))},t)}on(e,t,i,s){let r;return t&&(typeof t=="function"?r=o=>t(new ac(o,this,this._ref)):r={next:t.next?o=>t.next(new ac(o,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,r,i||void 0,s||void 0)}}class Fy{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new Nn(e,this._service))}get items(){return this._delegate.items.map(e=>new Nn(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nn{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){const t=Lj(this._delegate,e);return new Nn(t,this.storage)}get root(){return new Nn(this._delegate.root,this.storage)}get parent(){const e=this._delegate.parent;return e==null?null:new Nn(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new Ly(Rj(this._delegate,e,t),this)}putString(e,t=Mt.RAW,i){this._throwIfRoot("putString");const s=$S(t,e),r=Object.assign({},i);return r.contentType==null&&s.contentType!=null&&(r.contentType=s.contentType),new Ly(new QS(this._delegate,new Tn(s.data,!0),r),this)}listAll(){return Oj(this._delegate).then(e=>new Fy(e,this.storage))}list(e){return Dj(this._delegate,e||void 0).then(t=>new Fy(t,this.storage))}getMetadata(){return Nj(this._delegate)}updateMetadata(e){return Pj(this._delegate,e)}getDownloadURL(){return xj(this._delegate)}delete(){return this._throwIfRoot("delete"),Mj(this._delegate)}_throwIfRoot(e){if(this._delegate._location.path==="")throw VS(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eC{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(Uy(e))throw Ys("ref() expected a child path but got a URL, use refFromURL instead.");return new Nn(My(this._delegate,e),this)}refFromURL(e){if(!Uy(e))throw Ys("refFromURL() expected a full URL but got a child path, use ref() instead.");try{Ze.makeFromUrl(e,this._delegate.host)}catch{throw Ys("refFromUrl() expected a valid full URL but got an invalid one.")}return new Nn(My(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,i={}){Fj(this._delegate,e,t,i)}}function Uy(n){return/^[A-Za-z]+:\/\//.test(n)}const Bj="@firebase/storage-compat",$j="0.1.17";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qj="storage-compat";function jj(n,{instanceIdentifier:e}){const t=n.getProvider("app-compat").getImmediate(),i=n.getProvider("storage").getImmediate({identifier:e});return new eC(t,i)}function Kj(n){const e={TaskState:ot,TaskEvent:pj,StringFormat:Mt,Storage:eC,Reference:Nn};n.INTERNAL.registerComponent(new Y(qj,jj,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),n.registerVersion(Bj,$j)}Kj(Le);const Vy="@firebase/performance",Dd="0.5.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tC=Dd,Gj="FB-PERF-TRACE-START",Wj="FB-PERF-TRACE-STOP",Od="FB-PERF-TRACE-MEASURE",nC="_wt_",iC="_fp",sC="_fcp",rC="_fid",oC="@firebase/performance/config",aC="@firebase/performance/configexpire",Hj="performance",cC="Performance";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zj={["trace started"]:"Trace {$traceName} was started before.",["trace stopped"]:"Trace {$traceName} is not running.",["nonpositive trace startTime"]:"Trace {$traceName} startTime should be positive.",["nonpositive trace duration"]:"Trace {$traceName} duration should be positive.",["no window"]:"Window is not available.",["no app id"]:"App id is not available.",["no project id"]:"Project id is not available.",["no api key"]:"Api key is not available.",["invalid cc log"]:"Attempted to queue invalid cc event",["FB not default"]:"Performance can only start when Firebase app instance is the default one.",["RC response not ok"]:"RC response is not ok",["invalid attribute name"]:"Attribute name {$attributeName} is invalid.",["invalid attribute value"]:"Attribute value {$attributeValue} is invalid.",["invalid custom metric name"]:"Custom metric name {$customMetricName} is invalid",["invalid String merger input"]:"Input for String merger is invalid, contact support team to resolve.",["already initialized"]:"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."},Je=new Yt(Hj,cC,zj);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wn=new pi(cC);wn.logLevel=Ct.INFO;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let vh,lC;class Pe{constructor(e){if(this.window=e,!e)throw Je.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){!this.performance||!this.performance.mark||this.performance.mark(e)}measure(e,t,i){!this.performance||!this.performance.measure||this.performance.measure(e,t,i)}getEntriesByType(e){return!this.performance||!this.performance.getEntriesByType?[]:this.performance.getEntriesByType(e)}getEntriesByName(e){return!this.performance||!this.performance.getEntriesByName?[]:this.performance.getEntriesByName(e)}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return!fetch||!Promise||!_l()?(wn.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1):At()?!0:(wn.info("IndexedDB is not supported by current browswer"),!1)}setupObserver(e,t){if(!this.PerformanceObserver)return;new this.PerformanceObserver(s=>{for(const r of s.getEntries())t(r)}).observe({entryTypes:[e]})}static getInstance(){return vh===void 0&&(vh=new Pe(lC)),vh}}function Qj(n){lC=n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let uC;function Yj(n){const e=n.getId();return e.then(t=>{uC=t}),e}function Rg(){return uC}function Xj(n){const e=n.getToken();return e.then(t=>{}),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function By(n,e){const t=n.length-e.length;if(t<0||t>1)throw Je.create("invalid String merger input");const i=[];for(let s=0;s<n.length;s++)i.push(n.charAt(s)),e.length>s&&i.push(e.charAt(s));return i.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ih;class St{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=By("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=By("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return Ih===void 0&&(Ih=new St),Ih}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Xs;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.VISIBLE=1]="VISIBLE",n[n.HIDDEN=2]="HIDDEN"})(Xs||(Xs={}));const Jj=["firebase_","google_","ga_"],Zj=new RegExp("^[a-zA-Z]\\w*$"),eK=40,tK=100;function nK(){const n=Pe.getInstance().navigator;return"serviceWorker"in n?n.serviceWorker.controller?2:3:1}function hC(){switch(Pe.getInstance().document.visibilityState){case"visible":return Xs.VISIBLE;case"hidden":return Xs.HIDDEN;default:return Xs.UNKNOWN}}function iK(){const e=Pe.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function sK(n){return n.length===0||n.length>eK?!1:!Jj.some(t=>n.startsWith(t))&&!!n.match(Zj)}function rK(n){return n.length!==0&&n.length<=tK}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dC(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.appId;if(!t)throw Je.create("no app id");return t}function oK(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.projectId;if(!t)throw Je.create("no project id");return t}function aK(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.apiKey;if(!t)throw Je.create("no api key");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cK="0.0.1",jt={loggingEnabled:!0},lK="FIREBASE_INSTALLATIONS_AUTH";function uK(n,e){const t=hK();return t?($y(t),Promise.resolve()):pK(n,e).then($y).then(i=>dK(i),()=>{})}function hK(){const n=Pe.getInstance().localStorage;if(!n)return;const e=n.getItem(aC);if(!e||!gK(e))return;const t=n.getItem(oC);if(!!t)try{return JSON.parse(t)}catch{return}}function dK(n){const e=Pe.getInstance().localStorage;!n||!e||(e.setItem(oC,JSON.stringify(n)),e.setItem(aC,String(Date.now()+St.getInstance().configTimeToLive*60*60*1e3)))}const fK="Could not fetch config, will use default configs";function pK(n,e){return Xj(n.installations).then(t=>{const i=oK(n.app),s=aK(n.app),r=`https://firebaseremoteconfig.googleapis.com/v1/projects/${i}/namespaces/fireperf:fetch?key=${s}`,o=new Request(r,{method:"POST",headers:{Authorization:`${lK} ${t}`},body:JSON.stringify({app_instance_id:e,app_instance_id_token:t,app_id:dC(n.app),app_version:tC,sdk_version:cK})});return fetch(o).then(a=>{if(a.ok)return a.json();throw Je.create("RC response not ok")})}).catch(()=>{wn.info(fK)})}function $y(n){if(!n)return n;const e=St.getInstance(),t=n.entries||{};return t.fpr_enabled!==void 0?e.loggingEnabled=String(t.fpr_enabled)==="true":e.loggingEnabled=jt.loggingEnabled,t.fpr_log_source?e.logSource=Number(t.fpr_log_source):jt.logSource&&(e.logSource=jt.logSource),t.fpr_log_endpoint_url?e.logEndPointUrl=t.fpr_log_endpoint_url:jt.logEndPointUrl&&(e.logEndPointUrl=jt.logEndPointUrl),t.fpr_log_transport_key?e.transportKey=t.fpr_log_transport_key:jt.transportKey&&(e.transportKey=jt.transportKey),t.fpr_vc_network_request_sampling_rate!==void 0?e.networkRequestsSamplingRate=Number(t.fpr_vc_network_request_sampling_rate):jt.networkRequestsSamplingRate!==void 0&&(e.networkRequestsSamplingRate=jt.networkRequestsSamplingRate),t.fpr_vc_trace_sampling_rate!==void 0?e.tracesSamplingRate=Number(t.fpr_vc_trace_sampling_rate):jt.tracesSamplingRate!==void 0&&(e.tracesSamplingRate=jt.tracesSamplingRate),e.logTraceAfterSampling=qy(e.tracesSamplingRate),e.logNetworkAfterSampling=qy(e.networkRequestsSamplingRate),n}function gK(n){return Number(n)>Date.now()}function qy(n){return Math.random()<=n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ng=1,Th;function fC(n){return Ng=2,Th=Th||_K(n),Th}function mK(){return Ng===3}function _K(n){return yK().then(()=>Yj(n.installations)).then(e=>uK(n,e)).then(()=>jy(),()=>jy())}function yK(){const n=Pe.getInstance().document;return new Promise(e=>{if(n&&n.readyState!=="complete"){const t=()=>{n.readyState==="complete"&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}function jy(){Ng=3}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pg=10*1e3,wK=5.5*1e3,pC=3,vK=1e3;let ml=pC,ti=[],Ky=!1;function IK(){Ky||(Lu(wK),Ky=!0)}function Lu(n){setTimeout(()=>{if(ml!==0){if(!ti.length)return Lu(Pg);TK()}},n)}function TK(){const n=ti.splice(0,vK),e=n.map(i=>({source_extension_json_proto3:i.message,event_time_ms:String(i.eventTime)})),t={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:St.getInstance().logSource,log_event:e};EK(t,n).catch(()=>{ti=[...n,...ti],ml--,wn.info(`Tries left: ${ml}.`),Lu(Pg)})}function EK(n,e){return bK(n).then(t=>(t.ok||wn.info("Call to Firebase backend failed."),t.json())).then(t=>{const i=Number(t.nextRequestWaitMillis);let s=Pg;isNaN(i)||(s=Math.max(i,s));const r=t.logResponseDetails;Array.isArray(r)&&r.length>0&&r[0].responseAction==="RETRY_REQUEST_LATER"&&(ti=[...e,...ti],wn.info("Retry transport request later.")),ml=pC,Lu(s)})}function bK(n){const e=St.getInstance().getFlTransportFullUrl();return fetch(e,{method:"POST",body:JSON.stringify(n)})}function SK(n){if(!n.eventTime||!n.message)throw Je.create("invalid cc log");ti=[...ti,n]}function CK(n){return(...e)=>{const t=n(...e);SK({message:t,eventTime:Date.now()})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Eh;function gC(n,e){Eh||(Eh=CK(AK)),Eh(n,e)}function cc(n){const e=St.getInstance();!e.instrumentationEnabled&&n.isAuto||!e.dataCollectionEnabled&&!n.isAuto||!Pe.getInstance().requiredApisAvailable()||n.isAuto&&hC()!==Xs.VISIBLE||(mK()?bh(n):fC(n.performanceController).then(()=>bh(n),()=>bh(n)))}function bh(n){if(!Rg())return;const e=St.getInstance();!e.loggingEnabled||!e.logTraceAfterSampling||setTimeout(()=>gC(n,1),0)}function kK(n){const e=St.getInstance();if(!e.instrumentationEnabled)return;const t=n.url,i=e.logEndPointUrl.split("?")[0],s=e.flTransportEndpointUrl.split("?")[0];t===i||t===s||!e.loggingEnabled||!e.logNetworkAfterSampling||setTimeout(()=>gC(n,0),0)}function AK(n,e){return e===0?RK(n):NK(n)}function RK(n){const e={url:n.url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},t={application_info:mC(n.performanceController.app),network_request_metric:e};return JSON.stringify(t)}function NK(n){const e={name:n.name,is_auto:n.isAuto,client_start_time_us:n.startTimeUs,duration_us:n.durationUs};Object.keys(n.counters).length!==0&&(e.counters=n.counters);const t=n.getAttributes();Object.keys(t).length!==0&&(e.custom_attributes=t);const i={application_info:mC(n.performanceController.app),trace_metric:e};return JSON.stringify(i)}function mC(n){return{google_app_id:dC(n),app_instance_id:Rg(),web_app_info:{sdk_version:tC,page_url:Pe.getInstance().getUrl(),service_worker_status:nK(),visibility_state:hC(),effective_connection_type:iK()},application_process_state:0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PK=100,DK="_",OK=[iC,sC,rC];function xK(n,e){return n.length===0||n.length>PK?!1:e&&e.startsWith(nC)&&OK.indexOf(n)>-1||!n.startsWith(DK)}function MK(n){const e=Math.floor(n);return e<n&&wn.info(`Metric value should be an Integer, setting the value as : ${e}.`),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ni{constructor(e,t,i=!1,s){this.performanceController=e,this.name=t,this.isAuto=i,this.state=1,this.customAttributes={},this.counters={},this.api=Pe.getInstance(),this.randomId=Math.floor(Math.random()*1e6),this.isAuto||(this.traceStartMark=`${Gj}-${this.randomId}-${this.name}`,this.traceStopMark=`${Wj}-${this.randomId}-${this.name}`,this.traceMeasure=s||`${Od}-${this.randomId}-${this.name}`,s&&this.calculateTraceMetrics())}start(){if(this.state!==1)throw Je.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(this.state!==2)throw Je.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),cc(this)}record(e,t,i){if(e<=0)throw Je.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw Je.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(t*1e3),this.startTimeUs=Math.floor(e*1e3),i&&i.attributes&&(this.customAttributes=Object.assign({},i.attributes)),i&&i.metrics)for(const s of Object.keys(i.metrics))isNaN(Number(i.metrics[s]))||(this.counters[s]=Math.floor(Number(i.metrics[s])));cc(this)}incrementMetric(e,t=1){this.counters[e]===void 0?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(xK(e,this.name))this.counters[e]=MK(t!=null?t:0);else throw Je.create("invalid custom metric name",{customMetricName:e})}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const i=sK(e),s=rK(t);if(i&&s){this.customAttributes[e]=t;return}if(!i)throw Je.create("invalid attribute name",{attributeName:e});if(!s)throw Je.create("invalid attribute value",{attributeValue:t})}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){this.customAttributes[e]!==void 0&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(t.duration*1e3),this.startTimeUs=Math.floor((t.startTime+this.api.getTimeOrigin())*1e3))}static createOobTrace(e,t,i,s){const r=Pe.getInstance().getUrl();if(!r)return;const o=new ni(e,nC+r,!0),a=Math.floor(Pe.getInstance().getTimeOrigin()*1e3);o.setStartTime(a),t&&t[0]&&(o.setDuration(Math.floor(t[0].duration*1e3)),o.putMetric("domInteractive",Math.floor(t[0].domInteractive*1e3)),o.putMetric("domContentLoadedEventEnd",Math.floor(t[0].domContentLoadedEventEnd*1e3)),o.putMetric("loadEventEnd",Math.floor(t[0].loadEventEnd*1e3)));const c="first-paint",l="first-contentful-paint";if(i){const u=i.find(d=>d.name===c);u&&u.startTime&&o.putMetric(iC,Math.floor(u.startTime*1e3));const h=i.find(d=>d.name===l);h&&h.startTime&&o.putMetric(sC,Math.floor(h.startTime*1e3)),s&&o.putMetric(rC,Math.floor(s*1e3))}cc(o)}static createUserTimingTrace(e,t){const i=new ni(e,t,!1,t);cc(i)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gy(n,e){const t=e;if(!t||t.responseStart===void 0)return;const i=Pe.getInstance().getTimeOrigin(),s=Math.floor((t.startTime+i)*1e3),r=t.responseStart?Math.floor((t.responseStart-t.startTime)*1e3):void 0,o=Math.floor((t.responseEnd-t.startTime)*1e3),a=t.name&&t.name.split("?")[0],c={performanceController:n,url:a,responsePayloadBytes:t.transferSize,startTimeUs:s,timeToResponseInitiatedUs:r,timeToResponseCompletedUs:o};kK(c)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LK=5e3;function Wy(n){!Rg()||(setTimeout(()=>UK(n),0),setTimeout(()=>FK(n),0),setTimeout(()=>VK(n),0))}function FK(n){const e=Pe.getInstance(),t=e.getEntriesByType("resource");for(const i of t)Gy(n,i);e.setupObserver("resource",i=>Gy(n,i))}function UK(n){const e=Pe.getInstance(),t=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let s=setTimeout(()=>{ni.createOobTrace(n,t,i),s=void 0},LK);e.onFirstInputDelay(r=>{s&&(clearTimeout(s),ni.createOobTrace(n,t,i,r))})}else ni.createOobTrace(n,t,i)}function VK(n){const e=Pe.getInstance(),t=e.getEntriesByType("measure");for(const i of t)Hy(n,i);e.setupObserver("measure",i=>Hy(n,i))}function Hy(n,e){const t=e.name;t.substring(0,Od.length)!==Od&&ni.createUserTimingTrace(n,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BK{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||((e==null?void 0:e.dataCollectionEnabled)!==void 0&&(this.dataCollectionEnabled=e.dataCollectionEnabled),(e==null?void 0:e.instrumentationEnabled)!==void 0&&(this.instrumentationEnabled=e.instrumentationEnabled),Pe.getInstance().requiredApisAvailable()?yl().then(t=>{t&&(IK(),fC(this).then(()=>Wy(this),()=>Wy(this)),this.initialized=!0)}).catch(t=>{wn.info(`Environment doesn't support IndexedDB: ${t}`)}):wn.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){St.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return St.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){St.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return St.getInstance().dataCollectionEnabled}}const $K="[DEFAULT]";function qK(n,e){return n=w(n),new ni(n,e)}const jK=(n,{options:e})=>{const t=n.getProvider("app").getImmediate(),i=n.getProvider("installations-internal").getImmediate();if(t.name!==$K)throw Je.create("FB not default");if(typeof window=="undefined")throw Je.create("no window");Qj(window);const s=new BK(t,i);return s._init(e),s};function KK(){Qe(new Y("performance",jK,"PUBLIC")),fe(Vy,Dd),fe(Vy,Dd,"esm2017")}KK();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GK{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return qK(this._delegate,e)}}const WK="@firebase/performance-compat",HK="0.1.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zK(n){n.INTERNAL.registerComponent(new Y("performance-compat",QK,"PUBLIC")),n.registerVersion(WK,HK)}function QK(n){const e=n.getProvider("app-compat").getImmediate(),t=n.getProvider("performance").getImmediate();return new GK(e,t)}zK(Le);const Sh="@firebase/remote-config",zy="0.3.11";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YK{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XK="remote-config";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JK={["registration-window"]:"Undefined window object. This SDK only supports usage in a browser environment.",["registration-project-id"]:"Undefined project identifier. Check Firebase app initialization.",["registration-api-key"]:"Undefined API key. Check Firebase app initialization.",["registration-app-id"]:"Undefined app identifier. Check Firebase app initialization.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["storage-delete"]:"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",["fetch-client-network"]:"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",["fetch-timeout"]:'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',["fetch-throttle"]:'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',["fetch-client-parse"]:"Fetch client could not parse response. Original error: {$originalErrorMessage}.",["fetch-status"]:"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",["indexed-db-unavailable"]:"Indexed DB is not supported by current browser"},mt=new Yt("remoteconfig","Remote Config",JK);function ZK(n,e){return n instanceof Ke&&n.code.indexOf(e)!==-1}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eG=!1,tG="",Qy=0,nG=["1","true","t","yes","y","on"];class Ch{constructor(e,t=tG){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return this._source==="static"?eG:nG.indexOf(this._value.toLowerCase())>=0}asNumber(){if(this._source==="static")return Qy;let e=Number(this._value);return isNaN(e)&&(e=Qy),e}getSource(){return this._source}}async function _C(n){const e=w(n),[t,i]=await Promise.all([e._storage.getLastSuccessfulFetchResponse(),e._storage.getActiveConfigEtag()]);return!t||!t.config||!t.eTag||t.eTag===i?!1:(await Promise.all([e._storageCache.setActiveConfig(t.config),e._storage.setActiveConfigEtag(t.eTag)]),!0)}function yC(n){const e=w(n);return e._initializePromise||(e._initializePromise=e._storageCache.loadFromStorage().then(()=>{e._isInitializationComplete=!0})),e._initializePromise}async function wC(n){const e=w(n),t=new YK;setTimeout(async()=>{t.abort()},e.settings.fetchTimeoutMillis);try{await e._client.fetch({cacheMaxAgeMillis:e.settings.minimumFetchIntervalMillis,signal:t}),await e._storageCache.setLastFetchStatus("success")}catch(i){const s=ZK(i,"fetch-throttle")?"throttle":"failure";throw await e._storageCache.setLastFetchStatus(s),i}}function iG(n){const e=w(n);return cG(e._storageCache.getActiveConfig(),e.defaultConfig).reduce((t,i)=>(t[i]=Ka(n,i),t),{})}function sG(n,e){return Ka(w(n),e).asBoolean()}function rG(n,e){return Ka(w(n),e).asNumber()}function oG(n,e){return Ka(w(n),e).asString()}function Ka(n,e){const t=w(n);t._isInitializationComplete||t._logger.debug(`A value was requested for key "${e}" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.`);const i=t._storageCache.getActiveConfig();return i&&i[e]!==void 0?new Ch("remote",i[e]):t.defaultConfig&&t.defaultConfig[e]!==void 0?new Ch("default",String(t.defaultConfig[e])):(t._logger.debug(`Returning static value for key "${e}". Define a default or remote value if this is unintentional.`),new Ch("static"))}function aG(n,e){const t=w(n);switch(e){case"debug":t._logger.logLevel=Ct.DEBUG;break;case"silent":t._logger.logLevel=Ct.SILENT;break;default:t._logger.logLevel=Ct.ERROR}}function cG(n={},e={}){return Object.keys(Object.assign(Object.assign({},n),e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lG{constructor(e,t,i,s){this.client=e,this.storage=t,this.storageCache=i,this.logger=s}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const i=Date.now()-t,s=i<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${i}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${s}.`),s}async fetch(e){const[t,i]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(i&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return i;e.eTag=i&&i.eTag;const s=await this.client.fetch(e),r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return s.status===200&&r.push(this.storage.setLastSuccessfulFetchResponse(s)),await Promise.all(r),s}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uG(n=navigator){return n.languages&&n.languages[0]||n.language}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hG{constructor(e,t,i,s,r,o){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=i,this.projectId=s,this.apiKey=r,this.appId=o}async fetch(e){var t,i,s;const[r,o]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),c=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,l={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},u={sdk_version:this.sdkVersion,app_instance_id:r,app_instance_id_token:o,app_id:this.appId,language_code:uG()},h={method:"POST",headers:l,body:JSON.stringify(u)},d=fetch(c,h),f=new Promise((A,M)=>{e.signal.addEventListener(()=>{const H=new Error("The operation was aborted.");H.name="AbortError",M(H)})});let p;try{await Promise.race([d,f]),p=await d}catch(A){let M="fetch-client-network";throw((t=A)===null||t===void 0?void 0:t.name)==="AbortError"&&(M="fetch-timeout"),mt.create(M,{originalErrorMessage:(i=A)===null||i===void 0?void 0:i.message})}let _=p.status;const v=p.headers.get("ETag")||void 0;let R,x;if(p.status===200){let A;try{A=await p.json()}catch(M){throw mt.create("fetch-client-parse",{originalErrorMessage:(s=M)===null||s===void 0?void 0:s.message})}R=A.entries,x=A.state}if(x==="INSTANCE_STATE_UNSPECIFIED"?_=500:x==="NO_CHANGE"?_=304:(x==="NO_TEMPLATE"||x==="EMPTY_CONFIG")&&(R={}),_!==304&&_!==200)throw mt.create("fetch-status",{httpStatus:_});return{status:_,eTag:v,config:R}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dG(n,e){return new Promise((t,i)=>{const s=Math.max(e-Date.now(),0),r=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(r),i(mt.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function fG(n){if(!(n instanceof Ke)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class pG{constructor(e,t){this.client=e,this.storage=t}async fetch(e){const t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:i}){await dG(e.signal,t);try{const s=await this.client.fetch(e);return await this.storage.deleteThrottleMetadata(),s}catch(s){if(!fG(s))throw s;const r={throttleEndTimeMillis:Date.now()+vc(i),backoffCount:i+1};return await this.storage.setThrottleMetadata(r),this.attemptFetch(e,r)}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gG=60*1e3,mG=12*60*60*1e3;class _G{constructor(e,t,i,s,r){this.app=e,this._client=t,this._storageCache=i,this._storage=s,this._logger=r,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:gG,minimumFetchIntervalMillis:mG},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wc(n,e){var t;const i=n.target.error||void 0;return mt.create(e,{originalErrorMessage:i&&((t=i)===null||t===void 0?void 0:t.message)})}const Ni="app_namespace_store",yG="firebase_remote_config",wG=1;function vG(){return new Promise((n,e)=>{var t;try{const i=indexedDB.open(yG,wG);i.onerror=s=>{e(wc(s,"storage-open"))},i.onsuccess=s=>{n(s.target.result)},i.onupgradeneeded=s=>{const r=s.target.result;switch(s.oldVersion){case 0:r.createObjectStore(Ni,{keyPath:"compositeKey"})}}}catch(i){e(mt.create("storage-open",{originalErrorMessage:(t=i)===null||t===void 0?void 0:t.message}))}})}class IG{constructor(e,t,i,s=vG()){this.appId=e,this.appName=t,this.namespace=i,this.openDbPromise=s}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(e){const t=await this.openDbPromise;return new Promise((i,s)=>{var r;const a=t.transaction([Ni],"readonly").objectStore(Ni),c=this.createCompositeKey(e);try{const l=a.get(c);l.onerror=u=>{s(wc(u,"storage-get"))},l.onsuccess=u=>{const h=u.target.result;i(h?h.value:void 0)}}catch(l){s(mt.create("storage-get",{originalErrorMessage:(r=l)===null||r===void 0?void 0:r.message}))}})}async set(e,t){const i=await this.openDbPromise;return new Promise((s,r)=>{var o;const c=i.transaction([Ni],"readwrite").objectStore(Ni),l=this.createCompositeKey(e);try{const u=c.put({compositeKey:l,value:t});u.onerror=h=>{r(wc(h,"storage-set"))},u.onsuccess=()=>{s()}}catch(u){r(mt.create("storage-set",{originalErrorMessage:(o=u)===null||o===void 0?void 0:o.message}))}})}async delete(e){const t=await this.openDbPromise;return new Promise((i,s)=>{var r;const a=t.transaction([Ni],"readwrite").objectStore(Ni),c=this.createCompositeKey(e);try{const l=a.delete(c);l.onerror=u=>{s(wc(u,"storage-delete"))},l.onsuccess=()=>{i()}}catch(l){s(mt.create("storage-delete",{originalErrorMessage:(r=l)===null||r===void 0?void 0:r.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TG{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){const e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),i=this.storage.getActiveConfig(),s=await e;s&&(this.lastFetchStatus=s);const r=await t;r&&(this.lastSuccessfulFetchTimestampMillis=r);const o=await i;o&&(this.activeConfig=o)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EG(){Qe(new Y(XK,n,"PUBLIC").setMultipleInstances(!0)),fe(Sh,zy),fe(Sh,zy,"esm2017");function n(e,{instanceIdentifier:t}){const i=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();if(typeof window=="undefined")throw mt.create("registration-window");if(!At())throw mt.create("indexed-db-unavailable");const{projectId:r,apiKey:o,appId:a}=i.options;if(!r)throw mt.create("registration-project-id");if(!o)throw mt.create("registration-api-key");if(!a)throw mt.create("registration-app-id");t=t||"firebase";const c=new IG(a,i.name,t),l=new TG(c),u=new pi(Sh);u.logLevel=Ct.ERROR;const h=new hG(s,gi,t,r,o,a),d=new pG(h,c),f=new lG(d,c,l,u),p=new _G(i,f,l,c,u);return yC(p),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bG(n){return n=w(n),await wC(n),_C(n)}async function SG(){if(!At())return!1;try{return await yl()}catch{return!1}}EG();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class CG{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return _C(this._delegate)}ensureInitialized(){return yC(this._delegate)}fetch(){return wC(this._delegate)}fetchAndActivate(){return bG(this._delegate)}getAll(){return iG(this._delegate)}getBoolean(e){return sG(this._delegate,e)}getNumber(e){return rG(this._delegate,e)}getString(e){return oG(this._delegate,e)}getValue(e){return Ka(this._delegate,e)}setLogLevel(e){aG(this._delegate,e)}}const kG="@firebase/remote-config-compat",AG="0.1.12";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RG(n){n.INTERNAL.registerComponent(new Y("remoteConfig-compat",NG,"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:SG})),n.registerVersion(kG,AG)}function NG(n,{instanceIdentifier:e}){const t=n.getProvider("app-compat").getImmediate(),i=n.getProvider("remote-config").getImmediate({identifier:e});return new CG(t,i)}RG(Le);var PG="firebase",DG="9.9.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Le.registerVersion(PG,DG,"app-compat");var OG="firebase",xG="9.9.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */console.warn(`
It looks like you're using the development build of the Firebase JS SDK.
When deploying Firebase apps to production, it is advisable to only import
the individual SDK components you intend to use.

For the module builds, these are available in the following manner
(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):

CommonJS Modules:
const firebase = require('firebase/app');
require('firebase/<PACKAGE>');

ES Modules:
import firebase from 'firebase/app';
import 'firebase/<PACKAGE>';

Typescript:
import firebase from 'firebase/app';
import 'firebase/<PACKAGE>';
`);Le.registerVersion(OG,xG,"compat");
